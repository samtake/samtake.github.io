<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.3',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"avatar":"/images/avatar.gif","rounded":false,"rotated":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="学习资料:gin项目地址gin中文文档Gin入门实战文中demo Gin运行流程 engine:实现了ServeHTTP接口的handlermethodTree:根据http请求方法分别维护的路由树routerGroup:将路由表分组，方便中间件统一处理Context:Gin的上下文，在handler之间传递参数 示例代码Router ：路由规则定义 12345678910111213141516">
<meta name="keywords" content="Golang,Gin">
<meta property="og:type" content="article">
<meta property="og:title" content="Gin基本了解">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;14&#x2F;Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3&#x2F;index.html">
<meta property="og:site_name" content="samtake">
<meta property="og:description" content="学习资料:gin项目地址gin中文文档Gin入门实战文中demo Gin运行流程 engine:实现了ServeHTTP接口的handlermethodTree:根据http请求方法分别维护的路由树routerGroup:将路由表分组，方便中间件统一处理Context:Gin的上下文，在handler之间传递参数 示例代码Router ：路由规则定义 12345678910111213141516">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;14&#x2F;Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3&#x2F;gin.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;14&#x2F;Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3&#x2F;gin-first.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;14&#x2F;Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3&#x2F;validate-form.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;14&#x2F;Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3&#x2F;gin-server-stop.png">
<meta property="og:updated_time" content="2020-02-27T16:55:42.791Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;14&#x2F;Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3&#x2F;gin.png">

<link rel="canonical" href="http://yoursite.com/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Gin基本了解 | samtake</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">samtake</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">10000*365=27.3972603</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Gin基本了解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-14 17:39:54" itemprop="dateCreated datePublished" datetime="2020-02-14T17:39:54+08:00">2020-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-02-28 00:55:42" itemprop="dateModified" datetime="2020-02-28T00:55:42+08:00">2020-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Gin/" itemprop="url" rel="index">
                    <span itemprop="name">Gin</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Gin/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>学习资料:<br><a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">gin项目地址</a><br><a href="https://gin-gonic.com/zh-cn/" target="_blank" rel="noopener">gin中文文档</a><br><a href="https://www.imooc.com/learn/1175" target="_blank" rel="noopener">Gin入门实战</a><br><a href="https://github.com/samtake/gin-demo" target="_blank" rel="noopener">文中demo</a></p>
<h2 id="Gin运行流程"><a href="#Gin运行流程" class="headerlink" title="Gin运行流程"></a>Gin运行流程</h2><p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/gin.png" alt></p>
<p><code>engine</code>:实现了ServeHTTP接口的handler<br><code>methodTree</code>:根据http请求方法分别维护的路由树<br><code>routerGroup</code>:将路由表分组，方便中间件统一处理<br><code>Context</code>:Gin的上下文，在handler之间传递参数</p>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><p>Router ：路由规则定义</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	hdl <span class="string">"filestore-server/handler"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// Router ：路由规则定义</span><br><span class="line">func Router() *gin.Engine &#123;</span><br><span class="line">	// gin framework</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	// 静态资源处理</span><br><span class="line">	router.Static(<span class="string">"/static/"</span>, <span class="string">"./static"</span>)</span><br><span class="line"></span><br><span class="line">	// 定义接口</span><br><span class="line">	router.GET(<span class="string">"/user/signup"</span>, hdl.SignupHandler)</span><br><span class="line">    router.POST(<span class="string">"/user/signup"</span>, hdl.DoSignupHandler)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>handler</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// SignupHandler : 处理用户注册请求</span><br><span class="line">func SignupHandler(c *gin.Context) &#123;</span><br><span class="line">	c.Redirect(http.StatusFound, <span class="string">"http://"</span>+c.Request.Host+<span class="string">"/static/view/signup.html"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// DoSignupHandler : 处理用户注册请求</span><br><span class="line">func DoSignupHandler(c *gin.Context) &#123;</span><br><span class="line">	username := c.Request.FormValue(<span class="string">"username"</span>)</span><br><span class="line">	passwd := c.Request.FormValue(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> len(username) &lt; 3 || len(passwd) &lt; 5 &#123;</span><br><span class="line">		c.JSON(http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"msg"</span>: <span class="string">"Invalid parameter"</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 对密码进行加盐及取Sha1值加密</span><br><span class="line">	encPasswd := util.Sha1([]byte(passwd + pwdSalt))</span><br><span class="line">	// 将用户信息注册到用户表中</span><br><span class="line">	suc := dblayer.UserSignup(username, encPasswd)</span><br><span class="line">	<span class="keyword">if</span> suc &#123;</span><br><span class="line">		c.JSON(http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>:    0,</span><br><span class="line">				<span class="string">"msg"</span>:     <span class="string">"注册成功"</span>,</span><br><span class="line">				<span class="string">"data"</span>:    nil,</span><br><span class="line">				<span class="string">"forward"</span>: <span class="string">"/user/signin"</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>: 0,</span><br><span class="line">				<span class="string">"msg"</span>:  <span class="string">"注册失败"</span>,</span><br><span class="line">				<span class="string">"data"</span>: nil,</span><br><span class="line">			&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终main.go可简洁为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	// gin framework</span><br><span class="line">	router := route.Router()</span><br><span class="line"></span><br><span class="line">	// 启动服务并监听端口</span><br><span class="line">	err := router.Run(config.UploadServiceHost)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Failed to start server, err:%s\n"</span>, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"first"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		fmt.Println(<span class="string">"first ........."</span>)</span><br><span class="line">		c.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	authorized := r.Group(<span class="string">"/try"</span>)</span><br><span class="line"></span><br><span class="line">	authorized.POST(<span class="string">"/second"</span>, second)</span><br><span class="line">	authorized.POST(<span class="string">"/third"</span>, third)</span><br><span class="line"></span><br><span class="line">	// 嵌套路由组</span><br><span class="line">	testing := authorized.Group(<span class="string">"testing"</span>)</span><br><span class="line">	testing.GET(<span class="string">"/forth"</span>, fourth)</span><br><span class="line"></span><br><span class="line">	// 监听并在 0.0.0.0:8080 上启动服务</span><br><span class="line">	r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func second(c *gin.Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">"second ........."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func third(c *gin.Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">"third ........."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func fourth(c *gin.Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">"fourth ........."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜  gin-demo git:(master) ✗ lsof -i tcp:8080    </span><br><span class="line">COMMAND     PID    USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</span><br><span class="line">QQ          327 samtake   29u  IPv4 0xfdcbb6b79716f31f      0t0  TCP huangloshansmbp:50202-&gt;157.255.13.190:http-alt (ESTABLISHED)</span><br><span class="line">QQ          327 samtake   48u  IPv4 0xfdcbb6b79716f31f      0t0  TCP huangloshansmbp:50202-&gt;157.255.13.190:http-alt (ESTABLISHED)</span><br><span class="line">Google      420 samtake   26u  IPv4 0xfdcbb6b793e58fb7      0t0  TCP localhost:51492-&gt;localhost:http-alt (ESTABLISHED)</span><br><span class="line">Postman   66875 samtake   67u  IPv4 0xfdcbb6b778668ca7      0t0  TCP localhost:51499-&gt;localhost:http-alt (ESTABLISHED)</span><br><span class="line">main      67553 samtake    3u  IPv6 0xfdcbb6b793ea9b8f      0t0  TCP *:http-alt (LISTEN)</span><br><span class="line">main      67553 samtake    7u  IPv6 0xfdcbb6b793eac3cf      0t0  TCP localhost:http-alt-&gt;localhost:51492 (ESTABLISHED)</span><br><span class="line">main      67553 samtake    8u  IPv6 0xfdcbb6b7912a55cf      0t0  TCP localhost:http-alt-&gt;localhost:51499 (ESTABLISHED)</span><br><span class="line">➜  gin-demo git:(master) ✗ <span class="built_in">kill</span> -9  67553      </span><br><span class="line">➜  gin-demo git:(master) ✗ go run start/main.go</span><br><span class="line">[GIN-debug] [WARNING] Running <span class="keyword">in</span> <span class="string">"debug"</span> mode. Switch to <span class="string">"release"</span> mode <span class="keyword">in</span> production.</span><br><span class="line"> - using env:   <span class="built_in">export</span> GIN_MODE=release</span><br><span class="line"> - using code:  gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">[GIN-debug] GET    /first                    --&gt; main.main.func1 (3 handlers)</span><br><span class="line">[GIN-debug] POST   /try/second               --&gt; main.second (3 handlers)</span><br><span class="line">[GIN-debug] POST   /try/third                --&gt; main.third (3 handlers)</span><br><span class="line">[GIN-debug] GET    /try/testing/forth        --&gt; main.fourth (3 handlers)</span><br><span class="line">[GIN-debug] Listening and serving HTTP on :8080</span><br><span class="line">first .........</span><br><span class="line">[GIN] 2020/02/25 - 11:51:19 | 200 |     176.613µs |       127.0.0.1 | GET      /first</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/gin-first.png" alt></p>
<h2 id="1-请求路由"><a href="#1-请求路由" class="headerlink" title="1.请求路由"></a>1.请求路由</h2><h3 id="多种请求"><a href="#多种请求" class="headerlink" title="多种请求"></a>多种请求</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"get"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"get"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.POST(<span class="string">"post"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"post"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.DELETE(<span class="string">"delete"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"delete"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Any(<span class="string">"/any"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"any"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>给我们创建的any请求几乎覆盖了所有种类的请求</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[GIN-debug] GET    /get                      --&gt; main.main.func1 (3 handlers)</span><br><span class="line">[GIN-debug] POST   /post                     --&gt; main.main.func2 (3 handlers)</span><br><span class="line">[GIN-debug] DELETE /delete                   --&gt; main.main.func3 (3 handlers)</span><br><span class="line">[GIN-debug] GET    /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] POST   /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] PUT    /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] PATCH  /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] HEAD   /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] OPTIONS /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] DELETE /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] CONNECT /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] TRACE  /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] Environment variable PORT is undefined. Using port :8080 by default</span><br><span class="line">[GIN-debug] Listening and serving HTTP on :8080</span><br></pre></td></tr></table></figure>

<h3 id="静态文件夹"><a href="#静态文件夹" class="headerlink" title="静态文件夹"></a>静态文件夹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	// 静态文件夹绑定+路由，有两种写法：</span><br><span class="line">	r.Static(<span class="string">"/assets"</span>, <span class="string">"./assets"</span>)</span><br><span class="line">	r.StaticFS(<span class="string">"/static"</span>, http.Dir(<span class="string">"static"</span>))</span><br><span class="line"></span><br><span class="line">	//又或者路由+资源</span><br><span class="line">	r.StaticFile(<span class="string">"/favicon.ico"</span>, <span class="string">"/favicon.ico"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>go build -o router_static &amp;&amp; ./router_static</code>这需要在routerstatic文件夹下运行，不然找不到资源文件，最后访问<code>http://localhost:8080/assets/a.html</code>以及<code>http://localhost:8080/static/b.html</code>测试即可。</p>
<h3 id="参数作为url"><a href="#参数作为url" class="headerlink" title="参数作为url"></a>参数作为url</h3><p>Get请求<code>http://localhost:8080/Sam/520</code>即可得到相应参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"520"</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Sam"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="2-获取请求参数"><a href="#2-获取请求参数" class="headerlink" title="2.获取请求参数"></a>2.获取请求参数</h2><ul>
<li>获取get请求参数</li>
<li>获取post请求参数</li>
<li>获取body值</li>
<li>获取参数绑定结构体</li>
</ul>
<h3 id="泛绑定"><a href="#泛绑定" class="headerlink" title="泛绑定"></a>泛绑定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/user/*action"</span>, func(c *gin.Context) &#123; //设置获取name和id的参数</span><br><span class="line">		c.String(200, <span class="string">"泛绑定～"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有user前缀的请求都能请求到：<code>http://localhost:8080/user/&lt;XXXX&gt;</code></p>
<h3 id="获取get参数"><a href="#获取get参数" class="headerlink" title="获取get参数"></a>获取get参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/testGetParam"</span>, func(c *gin.Context) &#123; //设置获取name和id的参数</span><br><span class="line">		param1 := c.Query(<span class="string">"parm1"</span>)</span><br><span class="line">		param2 := c.Query(<span class="string">"parm2"</span>)</span><br><span class="line"></span><br><span class="line">		c.String(http.StatusOK, <span class="string">"%s, %s"</span>, param1, param2)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl -X GET <span class="string">'http://127.0.0.1:8080/testGetParam?parm1=11111'</span> </span><br><span class="line">11111, %  </span><br><span class="line">➜  ~ curl -X GET <span class="string">'http://127.0.0.1:8080/testGetParam?parm1=11111&amp;parm2=2222'</span></span><br><span class="line">11111, 2222%</span><br></pre></td></tr></table></figure>



<h3 id="获取body内容"><a href="#获取body内容" class="headerlink" title="获取body内容"></a>获取body内容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.POST(<span class="string">"/parmBody"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		bodyBytes, err := ioutil.ReadAll(c.Request.Body)</span><br><span class="line">		<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">			c.String(http.StatusBadRequest, err.Error())</span><br><span class="line">			c.Abort()</span><br><span class="line">		&#125;</span><br><span class="line">		c.Request.Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes)) //重新回写到缓存才能拿到parm1 parm2</span><br><span class="line">		parm1 := c.PostForm(<span class="string">"parm1"</span>)</span><br><span class="line">		parm2 := c.PostForm(<span class="string">"parm2"</span>)</span><br><span class="line">		c.String(http.StatusOK, <span class="string">"%s %s %s"</span>, parm1, parm2, string(bodyBytes))</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl -X POST <span class="string">'http://127.0.0.1:8080/parmBody'</span> -d <span class="string">'parm1=value1&amp;parm2=value2'</span> </span><br><span class="line">value1 value2 parm1=value1&amp;parm2=value2%                                                                                                                               </span><br><span class="line">➜  ~ curl -X POST <span class="string">'http://127.0.0.1:8080/parmBody'</span> -d <span class="string">'&#123;"parm1":"value1","parm2":"value2"&#125;'</span></span><br><span class="line">  &#123;<span class="string">"parm1"</span>:<span class="string">"value1"</span>,<span class="string">"parm2"</span>:<span class="string">"value2"</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="获取bind参数"><a href="#获取bind参数" class="headerlink" title="获取bind参数"></a>获取bind参数</h3><p>同时响应post和get，同时访问到同一个回调方法。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> Person struct &#123;</span><br><span class="line">	Name     string    `form:<span class="string">"name"</span>` //设置tag `form`可以由参数转变成结构体</span><br><span class="line">	Address  string    `form:<span class="string">"address"</span>`</span><br><span class="line">	Birthday time.Time `form:<span class="string">"birthday"</span> time_format:<span class="string">"2006-01-03"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, testHandler)</span><br><span class="line">	r.POST(<span class="string">"/test"</span>, testHandler)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func testHandler(c *gin.Context) &#123;</span><br><span class="line">	var person Person</span><br><span class="line">	//根据请求content-type来作不同的binding操作</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBind(&amp;person); err == nil &#123;</span><br><span class="line">		c.String(200, <span class="string">"%v"</span>, person)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.String(200, <span class="string">"person bind error"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl -X GET  <span class="string">'http://127.0.0.1:8080/test?name=samtake&amp;adress=gd'</span></span><br><span class="line">&#123;samtake  0001-01-01 00:00:00 +0000 UTC&#125;</span><br><span class="line">➜  ~ curl -X GET  <span class="string">'http://127.0.0.1:8080/test?name=samtake&amp;address=gd'</span></span><br><span class="line">&#123;samtake gd 0001-01-01 00:00:00 +0000 UTC&#125;%  </span><br><span class="line">➜  ~ curl -X POST  <span class="string">'http://127.0.0.1:8080/test?name=samtake&amp;address=gd&amp;birthday=2008-09-09'</span></span><br><span class="line">&#123;samtake gd 2008-09-01 09:00:00 +0800 CST&#125;%   </span><br><span class="line">➜  ~ curl -X POST  <span class="string">'http://127.0.0.1:8080/test'</span>  -d <span class="string">'name=samtake&amp;address=gd&amp;birthday=2008-09-09'</span></span><br><span class="line">&#123;samtake gd 2008-09-01 09:00:00 +0800 CST&#125;%   </span><br><span class="line">➜  ~ curl -H <span class="string">"Content-Type:application/json"</span>  -X POST <span class="string">"http://127.0.0.1:8080/test"</span>  -d <span class="string">'&#123;"name":"wang"&#125;'</span></span><br><span class="line">&#123;wang  0001-01-01 00:00:00 +0000 UTC&#125;%</span><br></pre></td></tr></table></figure>


<p>这里有个坑：如果时间格式写成像<code>time_format:&quot;2006-01-03&quot;</code>这种会报错，解析不了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person <span class="built_in">bind</span> error%!(EXTRA *time.ParseError=parsing time <span class="string">"2008-00-08"</span> as <span class="string">"2011-01-03"</span>: cannot parse <span class="string">"-00-08"</span> as <span class="string">"1"</span>)</span><br></pre></td></tr></table></figure>


<h2 id="验证请求参数"><a href="#验证请求参数" class="headerlink" title="验证请求参数"></a>验证请求参数</h2><ul>
<li>结构体验证</li>
<li>自定义验证</li>
<li>支持多语言错误信息</li>
</ul>
<h3 id="结构体验证"><a href="#结构体验证" class="headerlink" title="结构体验证"></a>结构体验证</h3><p><a href="https://godoc.org/gopkg.in/go-playground/validator.v9" target="_blank" rel="noopener">validate规则</a><br>binding条件满足</p>
<p>坑的记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> Person struct &#123;</span><br><span class="line">	Age     int    `form:<span class="string">"age"</span>  binding:<span class="string">"required,gt=10"</span>`</span><br><span class="line">	Name    string `form:<span class="string">"name"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">	Address string `form:<span class="string">"address"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/validate-form.png" alt></p>
<p>正确的完整源码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> Person struct &#123;</span><br><span class="line">	Age     int    `form:<span class="string">"Age"</span>  binding:<span class="string">"required,gt=10"</span>`</span><br><span class="line">	Name    string `form:<span class="string">"Name"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">	Address string `form:<span class="string">"Address"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, testHandler)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func testHandler(c *gin.Context) &#123;</span><br><span class="line">	var person Person</span><br><span class="line">	//根据请求content-type来作不同的binding操作</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBind(&amp;person); err != nil &#123;</span><br><span class="line">		c.String(500, <span class="string">"%v"</span>, err)</span><br><span class="line">		c.Abort()</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(200, <span class="string">"%v"</span>, person)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl -X GET  <span class="string">"http://127.0.0.1:8080/test?age=19&amp;name=samtake&amp;address=gd"</span></span><br><span class="line">Key: <span class="string">'Person.Age'</span> Error:Field validation <span class="keyword">for</span> <span class="string">'Age'</span> failed on the <span class="string">'required'</span> tag</span><br><span class="line">Key: <span class="string">'Person.Name'</span> Error:Field validation <span class="keyword">for</span> <span class="string">'Name'</span> failed on the <span class="string">'required'</span> tag</span><br><span class="line">Key: <span class="string">'Person.Address'</span> Error:Field validation <span class="keyword">for</span> <span class="string">'Address'</span> failed on the <span class="string">'required'</span> tag% </span><br><span class="line">➜  ~ curl -X GET  <span class="string">"http://127.0.0.1:8080/test?Age=19&amp;Name=samtake&amp;Address=gd"</span></span><br><span class="line">&#123;19 samtake gd&#125;%</span><br></pre></td></tr></table></figure>

<h3 id="自定义验证"><a href="#自定义验证" class="headerlink" title="自定义验证"></a>自定义验证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;reflect&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/gin-gonic/gin&quot;</span><br><span class="line">	&quot;github.com/gin-gonic/gin/binding&quot;</span><br><span class="line">	&quot;gopkg.in/go-playground/validator.v9&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Booking struct &#123;</span><br><span class="line">	CheckIn  time.Time `form:&quot;check_in&quot;  binding:&quot;required,bookabledate&quot; time_format:&quot;2006-01-01&quot;`</span><br><span class="line">	CheckOut time.Time `form:&quot;check_out&quot;  binding:&quot;required,gtfield=checkIn&quot; time_format:&quot;2006-01-01&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func customFunc(v *validator.Validate, topStruct reflect.Value, currentStructOrField reflect.Value, field reflect.Value, fieldType reflect.Type, fieldKind reflect.Kind, param string) bool &#123;</span><br><span class="line">	if date, ok := field.Interface().(time.Time); ok &#123;</span><br><span class="line">		today := time.Now()</span><br><span class="line">		if date.Unix() &gt; today.Unix() &#123;</span><br><span class="line">			return true</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	if v, ok := binding.Validator.Engine().(*validator.Validate); ok &#123;</span><br><span class="line">		v.RegisterValidation(&quot;bookabledate&quot;, customFunc)</span><br><span class="line">	&#125;</span><br><span class="line">	r.GET(&quot;/bookable&quot;, testHandler)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func testHandler(c *gin.Context) &#123;</span><br><span class="line">	var b Booking</span><br><span class="line">	if err := c.ShouldBind(&amp;b); err != nil &#123;</span><br><span class="line">		c.JSON(500, gin.H&#123;&quot;error&quot;: err.Error()&#125;)</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(200, gin.H&#123;&quot;message&quot;: &quot;ok!&quot;, &quot;booking&quot;: b&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有个报错，我自己也还没弄明白，然而我看了下源码，上面的使用方法是正确的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># command-line-arguments</span></span><br><span class="line">validCustom/validCustom.go:30:24: cannot use customFunc (<span class="built_in">type</span> func(*validator.Validate, reflect.Value, reflect.Value, reflect.Value, reflect.Typ</span><br><span class="line">e, reflect.Kind, string) bool) as <span class="built_in">type</span> validator.Func <span class="keyword">in</span> argument to v.RegisterValidation</span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// RegisterValidation adds a validation with the given tag</span><br><span class="line">//</span><br><span class="line">// NOTES:</span><br><span class="line">// - <span class="keyword">if</span> the key already exists, the previous validation <span class="keyword">function</span> will be replaced.</span><br><span class="line">// - this method is not thread-safe it is intended that these all be registered prior to any validation</span><br><span class="line">func (v *Validate) RegisterValidation(tag string, fn Func) error &#123;</span><br><span class="line">	<span class="built_in">return</span> v.RegisterValidationCtx(tag, wrapFunc(fn))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支持多语言错误信息"><a href="#支持多语言错误信息" class="headerlink" title="支持多语言错误信息"></a>支持多语言错误信息</h3><h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><ul>
<li>使用Gin中间件</li>
<li>自定义<code>ip白名单</code>中间件</li>
</ul>
<h3 id="Gin中间件"><a href="#Gin中间件" class="headerlink" title="Gin中间件"></a>Gin中间件</h3><p><code>Logger</code>日志<br><code>Recovery</code>捕获panic</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	f, _ := os.Create(<span class="string">"gin.log"</span>)</span><br><span class="line">	gin.DefaultWriter = io.MultiWriter(f)</span><br><span class="line">	gin.DefaultErrorWriter = io.MultiWriter(f)</span><br><span class="line"></span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(gin.Logger(),gin.Recovery())</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		name := c.DefaultQuery(<span class="string">"name"</span>, <span class="string">"default_name"</span>)</span><br><span class="line">		c.String(200, <span class="string">"%s"</span>, name)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h3><p><code>r.User(IPAuthMiddleware())</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">func IPAuthMiddleware() gin.HandlerFunc &#123;</span><br><span class="line">	<span class="built_in">return</span> func(c *gin.Context) &#123;</span><br><span class="line">		ipList := []string&#123;</span><br><span class="line">			<span class="string">"127.0.0.1"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">		flag := <span class="literal">false</span></span><br><span class="line">		clientIP := c.ClientIP()</span><br><span class="line">		<span class="keyword">for</span> _, host := range ipList &#123;</span><br><span class="line">			<span class="keyword">if</span> clientIP == host &#123;</span><br><span class="line">				flag = <span class="literal">true</span></span><br><span class="line">				<span class="built_in">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !flag &#123;</span><br><span class="line">			c.String(401, <span class="string">"%s,not in iplist"</span>, clientIP)</span><br><span class="line">			c.Abort()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(IPAuthMiddleware())</span><br><span class="line">	r.Use(gin.Logger(), gin.Recovery())</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"%s"</span>, <span class="string">"hello test"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Gin延展"><a href="#Gin延展" class="headerlink" title="Gin延展"></a>Gin延展</h2><ul>
<li>服务器优雅关停</li>
<li>模版渲染</li>
<li>自动证书配置</li>
</ul>
<h3 id="服务器关停"><a href="#服务器关停" class="headerlink" title="服务器关停"></a>服务器关停</h3><p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/gin-server-stop.png" alt></p>
<h3 id="模版渲染"><a href="#模版渲染" class="headerlink" title="模版渲染"></a>模版渲染</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.LoadHTMLGlob(<span class="string">"template/*"</span>)</span><br><span class="line">	r.GET(<span class="string">"/index"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.HTML(200, <span class="string">"index.html"</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"index.html"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl -X GET  <span class="string">"http://127.0.0.1:8080/index"</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;h1&gt;</span><br><span class="line">        index.html</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">&lt;/html&gt;%                                                                        </span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure>

<h3 id="自动证书配置"><a href="#自动证书配置" class="headerlink" title="自动证书配置"></a>自动证书配置</h3><h2 id="脚手架"><a href="#脚手架" class="headerlink" title="脚手架"></a>脚手架</h2><p>项目地址：<br><a href="https://github.com/e421083458/gin_scaffold" target="_blank" rel="noopener">gin_scaffold</a><br><a href="https://github.com/e421083458/golang_common" target="_blank" rel="noopener">golang_common</a><br><a href="https://github.com/e421083458/vue-admin" target="_blank" rel="noopener">vue-admin</a></p>
<h3 id="轻量级Golang类库"><a href="#轻量级Golang类库" class="headerlink" title="轻量级Golang类库"></a>轻量级Golang类库</h3><p>GORM:<a href="https://gorm.io/zh_CN/" target="_blank" rel="noopener">https://gorm.io/zh_CN/</a><br>redigo:<a href="https://godoc.org/github.com/gomodule/redigo/redis" target="_blank" rel="noopener">https://godoc.org/github.com/gomodule/redigo/redis</a></p>
<p>├── README.md<br>├── conf   配置文件夹<br>│   └── dev<br>│       ├── base.toml<br>│       ├── mysql_map.toml<br>│       └── redis_map.toml<br>├── controller 控制器<br>│   └── demo.go<br>├── dao DB数据访问层<br>│   └── demo.go<br>├── dto  Bind结构体层<br>│   └── demo.go<br>├── gin_scaffold.inf.log  info日志<br>├── gin_scaffold.wf.log warning日志<br>├── go.mod go module管理文件<br>├── go.sum<br>├── main.go<br>├── middleware 中间件层<br>│   ├── panic.go<br>│   ├── response.go<br>│   ├── token_auth.go<br>│   └── translation.go<br>├── public  公共文件<br>│   ├── log.go<br>│   ├── mysql.go<br>│   └── validate.go<br>├── router  路由层<br>│   ├── httpserver.go<br>│   └── route.go<br>└── tmpl</p>
<h3 id="输出格式统一封装"><a href="#输出格式统一封装" class="headerlink" title="输出格式统一封装"></a>输出格式统一封装</h3><h3 id="自定义中间件日志打印"><a href="#自定义中间件日志打印" class="headerlink" title="自定义中间件日志打印"></a>自定义中间件日志打印</h3><h3 id="请求数据绑定结构体与校验"><a href="#请求数据绑定结构体与校验" class="headerlink" title="请求数据绑定结构体与校验"></a>请求数据绑定结构体与校验</h3>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Golang/" rel="tag"># Golang</a>
              <a href="/tags/Gin/" rel="tag"># Gin</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2020/02/12/%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85RabbitMQ/" rel="next" title="通过Docker安装RabbitMQ">
                  <i class="fa fa-chevron-left"></i> 通过Docker安装RabbitMQ
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2020/02/14/RPC/" rel="prev" title="RPC">
                  RPC <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Gin运行流程"><span class="nav-number">1.</span> <span class="nav-text">Gin运行流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#示例代码"><span class="nav-number">2.</span> <span class="nav-text">示例代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#快速开始"><span class="nav-number">3.</span> <span class="nav-text">快速开始</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-请求路由"><span class="nav-number">4.</span> <span class="nav-text">1.请求路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#多种请求"><span class="nav-number">4.1.</span> <span class="nav-text">多种请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#静态文件夹"><span class="nav-number">4.2.</span> <span class="nav-text">静态文件夹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数作为url"><span class="nav-number">4.3.</span> <span class="nav-text">参数作为url</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-获取请求参数"><span class="nav-number">5.</span> <span class="nav-text">2.获取请求参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#泛绑定"><span class="nav-number">5.1.</span> <span class="nav-text">泛绑定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取get参数"><span class="nav-number">5.2.</span> <span class="nav-text">获取get参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取body内容"><span class="nav-number">5.3.</span> <span class="nav-text">获取body内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取bind参数"><span class="nav-number">5.4.</span> <span class="nav-text">获取bind参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证请求参数"><span class="nav-number">6.</span> <span class="nav-text">验证请求参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#结构体验证"><span class="nav-number">6.1.</span> <span class="nav-text">结构体验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义验证"><span class="nav-number">6.2.</span> <span class="nav-text">自定义验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支持多语言错误信息"><span class="nav-number">6.3.</span> <span class="nav-text">支持多语言错误信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间件"><span class="nav-number">7.</span> <span class="nav-text">中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gin中间件"><span class="nav-number">7.1.</span> <span class="nav-text">Gin中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#白名单"><span class="nav-number">7.2.</span> <span class="nav-text">白名单</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gin延展"><span class="nav-number">8.</span> <span class="nav-text">Gin延展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器关停"><span class="nav-number">8.1.</span> <span class="nav-text">服务器关停</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模版渲染"><span class="nav-number">8.2.</span> <span class="nav-text">模版渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自动证书配置"><span class="nav-number">8.3.</span> <span class="nav-text">自动证书配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#脚手架"><span class="nav-number">9.</span> <span class="nav-text">脚手架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#轻量级Golang类库"><span class="nav-number">9.1.</span> <span class="nav-text">轻量级Golang类库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#输出格式统一封装"><span class="nav-number">9.2.</span> <span class="nav-text">输出格式统一封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义中间件日志打印"><span class="nav-number">9.3.</span> <span class="nav-text">自定义中间件日志打印</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#请求数据绑定结构体与校验"><span class="nav-number">9.4.</span> <span class="nav-text">请求数据绑定结构体与校验</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Sam"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Sam</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/samtake" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;samtake" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:943430195@qq.com" title="E-Mail &amp;rarr; mailto:943430195@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sam</span>
</div>
  <div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.3
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

</body>
</html>
