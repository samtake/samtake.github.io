<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.3',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"avatar":"/images/avatar.gif","rounded":false,"rotated":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="samtake">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="samtake">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>samtake</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">samtake</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">10000*365=27.3972603</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/09/jwt-go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/09/jwt-go/" class="post-title-link" itemprop="url">jwt-go</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-09 23:27:28 / Modified: 23:48:17" itemprop="dateCreated datePublished" datetime="2020-04-09T23:27:28+08:00">2020-04-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://github.com/dgrijalva/jwt-go" target="_blank" rel="noopener">github</a></p>
<p><a href="https://godoc.org/github.com/dgrijalva/jwt-go" target="_blank" rel="noopener">Documentation</a></p>
<p>引入包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get <span class="string">"github.com/dgrijalva/jwt-go"</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package common</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"gin_vue_bs/model"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/dgrijalva/jwt-go"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//定义 jwt 加密密钥</span><br><span class="line">var jwtKey = []byte(<span class="string">"a_secret_crect"</span>)</span><br><span class="line"></span><br><span class="line">//Claims .</span><br><span class="line"><span class="built_in">type</span> Claims struct &#123;</span><br><span class="line">	UserID uint</span><br><span class="line">	jwt.StandardClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ReleaseToken 登录成功则调用该方法发放token.</span><br><span class="line">func ReleaseToken(user model.User) (string, error) &#123;</span><br><span class="line">	expirationTime := time.Now().Add(7 * 24 * time.Hour) //token的过期时间7天</span><br><span class="line">	claims := &amp;Claims&#123;</span><br><span class="line">		UserID: user.ID,</span><br><span class="line">		StandardClaims: jwt.StandardClaims&#123;</span><br><span class="line">			ExpiresAt: expirationTime.Unix(),</span><br><span class="line">			IssuedAt:  time.Now().Unix(), //token发放时间</span><br><span class="line">			Issuer:    <span class="string">"samtake"</span>,         //是谁发放的token</span><br><span class="line">			Subject:   <span class="string">"user token"</span>,      //主题</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)</span><br><span class="line">	tokenString, err := token.SignedString(jwtKey)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="string">""</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> tokenString, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/09/gorm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/09/gorm/" class="post-title-link" itemprop="url">gorm</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-09 18:31:28 / Modified: 18:43:34" itemprop="dateCreated datePublished" datetime="2020-04-09T18:31:28+08:00">2020-04-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://gorm.io" target="_blank" rel="noopener">https://gorm.io</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/e421083458/gorm"</span> //https://gorm.io</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> User struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name      string `gorm:<span class="string">"type:varchar(20);not null"</span>`</span><br><span class="line">	Telephone string `gorm:<span class="string">"varchar(110;not null;unique"</span>`</span><br><span class="line">	Password  string `gorm:<span class="string">"size:255;not null"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">	db := InitDb()</span><br><span class="line">	defer db.Close()</span><br><span class="line"></span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line">	r.POST(<span class="string">"/api/auth/register"</span>, func(ctx *gin.Context) &#123;</span><br><span class="line">		//获取参数</span><br><span class="line">		name := ctx.PostForm(<span class="string">"name"</span>)</span><br><span class="line">		telephone := ctx.PostForm(<span class="string">"telephone"</span>)</span><br><span class="line">		password := ctx.PostForm(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">		//验证数据</span><br><span class="line">		<span class="keyword">if</span> len(telephone) != 11 &#123;</span><br><span class="line">			ctx.JSON(http.StatusServiceUnavailable,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"手机号必须为11为"</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> len(password) &lt; 6 &#123;</span><br><span class="line">			ctx.JSON(http.StatusUnprocessableEntity,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"密码不能少于6位"</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//名称如果没有传，则返回随机字符串</span><br><span class="line">		<span class="keyword">if</span> len(name) == 0 &#123;</span><br><span class="line">			name = RandomString(10)</span><br><span class="line">		&#125;</span><br><span class="line">		//判断手机号是否存在</span><br><span class="line">		<span class="keyword">if</span> isTelephoneExist(db, telephone) &#123;</span><br><span class="line">			ctx.JSON(http.StatusUnprocessableEntity,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"用户已经存在"</span>&#125;)</span><br><span class="line">			<span class="built_in">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//创建用户</span><br><span class="line">		newUser := User&#123;</span><br><span class="line">			Name:      name,</span><br><span class="line">			Telephone: telephone,</span><br><span class="line">			Password:  password,</span><br><span class="line">		&#125;</span><br><span class="line">		db.Create(&amp;newUser)</span><br><span class="line"></span><br><span class="line">		//返回结果</span><br><span class="line">		ctx.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"msg"</span>: <span class="string">"注册成功"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	panic(r.Run(<span class="string">":8099"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func isTelephoneExist(db *gorm.DB, telephone string) bool &#123;</span><br><span class="line">	var user User</span><br><span class="line">	db.Where(<span class="string">"telephone = ?"</span>, telephone).First(&amp;user)</span><br><span class="line">	<span class="keyword">if</span> user.ID != 0 &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//返回随机字符串</span><br><span class="line">func RandomString(n int) string &#123;</span><br><span class="line">	var letters = []byte(<span class="string">"iasdhjklfhascvxnjklasdfhjkasdfklasdfhnjklasdfjklasdfjklfasdsdfjk"</span>)</span><br><span class="line">	result := make([]byte, n)</span><br><span class="line"></span><br><span class="line">	rand.Seed(time.Now().Unix())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := range result &#123;</span><br><span class="line">		result[i] = letters[rand.Intn(len(letters))]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> string(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func InitDb() *gorm.DB &#123;</span><br><span class="line">	driverName := <span class="string">"mysql"</span></span><br><span class="line">	host := <span class="string">"127.0.0.1"</span></span><br><span class="line">	port := <span class="string">"3306"</span></span><br><span class="line">	database := <span class="string">"gin_vue_bs"</span></span><br><span class="line">	username := <span class="string">"root"</span></span><br><span class="line">	passwoed := <span class="string">"123456"</span></span><br><span class="line">	charset := <span class="string">"utf8"</span></span><br><span class="line">	args := fmt.Sprintf(<span class="string">"%s:%s@tcp(%s:%s)/%s?charset=%s&amp;parseTime=true"</span>,</span><br><span class="line">		username,</span><br><span class="line">		passwoed,</span><br><span class="line">		host,</span><br><span class="line">		port,</span><br><span class="line">		database,</span><br><span class="line">		charset)</span><br><span class="line"></span><br><span class="line">	db, err := gorm.Open(driverName, args)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(<span class="string">"failed to connect database,err"</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//创建数据表</span><br><span class="line">	db.AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> db</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><img src="/2020/04/09/gorm/gorm01.png" alt="gorm01.png"></p>
<p><img src="/2020/04/09/gorm/gorm02.png" alt="gorm02.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/30/OpenGL-%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/30/OpenGL-%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">OpenGL-学习教程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-30 01:14:44" itemprop="dateCreated datePublished" datetime="2020-03-30T01:14:44+08:00">2020-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-09 18:37:13" itemprop="dateModified" datetime="2020-04-09T18:37:13+08:00">2020-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>世界上最好的OpenGL教程，没有之一：<a href="https://learnopengl-cn.github.io" target="_blank" rel="noopener">LearnOpenGL CN</a></p>
<p>好好努力！勤奋敲码！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/28/OpenGL-%E7%9D%80%E8%89%B2%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/28/OpenGL-%E7%9D%80%E8%89%B2%E5%99%A8/" class="post-title-link" itemprop="url">OpenGL-着色器</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-28 16:54:55" itemprop="dateCreated datePublished" datetime="2020-03-28T16:54:55+08:00">2020-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-29 23:40:38" itemprop="dateModified" datetime="2020-03-29T23:40:38+08:00">2020-03-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>OpenGL分为两个部分：CPU上C++编写，GPU采用GLSL语言编写，后者就是着色器的编写方式。</p>
<h1 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h1><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">float</td>
<td align="left">ieee 32 位浮点数</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">ieee 64 位浮点数</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">有符号二进制补码的 32 位整数</td>
</tr>
<tr>
<td align="left">uint</td>
<td align="left">无符号的32位整数</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">布尔值</td>
</tr>
</tbody></table>
<h1 id="变量初始化"><a href="#变量初始化" class="headerlink" title="变量初始化"></a>变量初始化</h1><p>所有变量都必须在声明的同时进行初始化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int i,nums = 1500;</span><br><span class="line"><span class="built_in">float</span> force,g = -9.8;</span><br><span class="line">bool falling = <span class="literal">true</span>;</span><br><span class="line">double pi = 3.145555LF;</span><br></pre></td></tr></table></figure>

<h1 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h1><p>所有其他的数值转换都需要提供显示的转换构造函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> f = 10.0;</span><br><span class="line">int ten = int(f);</span><br></pre></td></tr></table></figure>


<h1 id="聚合类型"><a href="#聚合类型" class="headerlink" title="聚合类型"></a>聚合类型</h1><p>GLSL的向量与矩阵类型 </p>
<table>
<thead>
<tr>
<th align="left">基本数据类型</th>
<th align="left">2D向量</th>
<th align="left">3D向量</th>
<th align="left">矩阵类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">float</td>
<td align="left">vec2</td>
<td align="left">vec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">dvec2</td>
<td align="left">dvec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">ivec2</td>
<td align="left">ivec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">uint</td>
<td align="left">uvec2</td>
<td align="left">uvec3</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">bvec2</td>
<td align="left">bvec3</td>
<td align="left">-</td>
</tr>
</tbody></table>
<p>类型声明的变量的初始化：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vec3 velocity = vec3(0.0, 2.0, 3.0);</span><br></pre></td></tr></table></figure>


<p>类型之间的等价转换：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ivec3 steps = ivec3(velocity);</span><br></pre></td></tr></table></figure>


<p>向量之间的转换：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 减短</span></span><br><span class="line">vec4 color;</span><br><span class="line">vec3 RGB = vec3(color);//只取了color的前面三个分量R、G、B</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加长</span></span><br><span class="line">vec3 white = vec3(1.0);//white = (1.0, 1.0, 1.0)</span><br><span class="line"></span><br><span class="line">vec4 translate = vec4(white, 0.5);</span><br></pre></td></tr></table></figure>


<p>注意⚠️：传入的数据将首先填充列，再填充行。</p>
<h1 id="访问向量和矩阵中的元素"><a href="#访问向量和矩阵中的元素" class="headerlink" title="访问向量和矩阵中的元素"></a>访问向量和矩阵中的元素</h1><p>向量中的各个分量可以通过名称访问：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> red = color.r;</span><br><span class="line"><span class="built_in">float</span> v_y = velocity.y;</span><br></pre></td></tr></table></figure>

<p>或者通过一个从0开始的索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> red = color[0];</span><br><span class="line"><span class="built_in">float</span> v_y = velocity[1];</span><br></pre></td></tr></table></figure>

<p>向量分量的访问符</p>
<table>
<thead>
<tr>
<th align="left">分量访问符</th>
<th align="left">符号描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">(X,Y,Z,W)</td>
<td align="left">与位置相关的分量</td>
</tr>
<tr>
<td align="left">(r,g,b,a)</td>
<td align="left">与颜色相关的分量</td>
</tr>
<tr>
<td align="left">(s,t,p,q)</td>
<td align="left">与纹理坐标相关的分量</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vec3 luminance = color.rrr; <span class="comment"># 输入颜色的红色分量来设置一个亮度值</span></span><br><span class="line"></span><br><span class="line">color = colot.abgr; <span class="comment"># 反转color的每个分量</span></span><br></pre></td></tr></table></figure>

<h1 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct Partical &#123;</span><br><span class="line">    <span class="built_in">float</span> lifetime;</span><br><span class="line">    vec3 position;</span><br><span class="line">    vec3 velocity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Partical p = Partical(1.0, pos, vel); <span class="comment"># pos、 vel均为vec3类型</span></span><br></pre></td></tr></table></figure>

<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>数组的声明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> coffee[3];        <span class="comment">#有三个float元素的数组</span></span><br><span class="line"><span class="built_in">float</span>[3]  coffee;       <span class="comment">#同上</span></span><br><span class="line">int indices;            <span class="comment">#为定义维数</span></span><br></pre></td></tr></table></figure>

<p>静态初始化一个数组的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> coffee[3]  = <span class="built_in">float</span>[3](2.00, 3.00, 5.23);</span><br></pre></td></tr></table></figure>
<p>操作一个数组中的所有值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(int i = 0; i&lt;coffee.length(); i++)&#123;</span><br><span class="line">    coffee[i] *= 2.0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取列数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mat3x4 m;</span><br><span class="line">int c = m.length();         <span class="comment"># m包含的列数为3</span></span><br><span class="line">int r = m[0].length();      <span class="comment"># 第0个列向量中分量的个数为4</span></span><br></pre></td></tr></table></figure>
<h1 id="存储限制符"><a href="#存储限制符" class="headerlink" title="存储限制符"></a>存储限制符</h1><table>
<thead>
<tr>
<th align="left">类型修饰符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">const</td>
<td align="left">将一个变量定义为只读形式。如果它初始化时用的是一个编译时变量，那么它本身也会成为编译时常量</td>
</tr>
<tr>
<td align="left">in</td>
<td align="left">设置这个变量为着色器阶段的输入变量</td>
</tr>
<tr>
<td align="left">out</td>
<td align="left">设置这个变量为着色器阶段的输出变量</td>
</tr>
<tr>
<td align="left">uniform</td>
<td align="left">设置这个变量为用户应用程序传递给着色器的数据，它对于给定的图元而言是一个常量</td>
</tr>
<tr>
<td align="left">buffer</td>
<td align="left">设置应用程序共享的一块可读写的内存。这块内存也作为着色器中的存储缓存使用</td>
</tr>
<tr>
<td align="left">shared</td>
<td align="left">设置变量是本地工作组中共享的。它只能用于计算着色器中</td>
</tr>
</tbody></table>
<p>获取uniform变量的索引并且设置具体值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GLint timeLoc;                                      <span class="comment">#着色器中的uniform变量time的索引</span></span><br><span class="line">GLfloat timeValue;                                  <span class="comment">#程序运行的时间</span></span><br><span class="line">timeLoc = glGetUniformLocation(program, <span class="string">"time"</span>)     <span class="comment">#返回着色器中nuiform变量time对应的索引值</span></span><br><span class="line">glUniformlf(timeLoc, timeValue);                    <span class="comment">#设置uniform变量timeLoc的值</span></span><br></pre></td></tr></table></figure>

<h1 id="算术操作符"><a href="#算术操作符" class="headerlink" title="算术操作符"></a>算术操作符</h1><table>
<thead>
<tr>
<th align="left">优先级</th>
<th align="left">操作符</th>
<th align="left">可用类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">()</td>
<td align="left">-</td>
<td align="left">成组的操作</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><br>[]<br> <br>f()<br>  <br>.<br> <br>++、–<br></td>
<td align="left"><br>[数组、矩阵、向量]<br> <br>函数<br>  <br>结构体<br> <br>算术类型<br></td>
<td align="left"><br>数组的下标<br> <br>函数的调用、构造函数<br>  <br>访问结构体的域变量/方法<br> <br>后置递增/递减<br></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><br>++、–<br> <br>+、-<br>  <br>~<br> <br>!<br></td>
<td align="left"><br>算术类型<br> <br>算术类型<br>  <br>整型<br> <br>布尔型<br></td>
<td align="left"><br>前置递增/递减<br> <br><br>  <br><br> <br><br></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>*、/、%</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>+、-</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><code>&lt;&lt;、&gt;&gt;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><code>&lt;、&gt;、&lt;=、&gt;=</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><code>==、!=</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><code>&amp;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><code>^</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">`</td>
<td align="left">`</td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><code>&amp;&amp;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><code>^^</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">`</td>
<td align="left"></td>
<td align="left">`</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><code>a?b:c</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><br><code>==</code><br> <br><code>+=、-=</code><br>  <br><code>*=、/=</code><br> <br><code>%=、&lt;&lt;=、&gt;&gt;=</code><br> <br>`&amp;=、^=、</td>
<td align="left">=`<br></td>
<td align="left"><br>任意<br> <br>算术类型<br>  <br>算术类型<br>  <br>整型<br> <br>整型<br></td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><code>,</code></td>
<td align="left">任意</td>
<td align="left">操作符序列</td>
</tr>
</tbody></table>
<h1 id="操作符重载"><a href="#操作符重载" class="headerlink" title="操作符重载"></a>操作符重载</h1><h1 id="流控制"><a href="#流控制" class="headerlink" title="流控制"></a>流控制</h1><table>
<thead>
<tr>
<th align="left">语句</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">break</td>
<td align="left">终止循环体的运行，并且继续执行循环体外的内容</td>
</tr>
<tr>
<td align="left">continue</td>
<td align="left">终止循环体内当前迭代过程的执行，跳转到代码块开始部分并继续执行下一次迭代的内容</td>
</tr>
<tr>
<td align="left">return</td>
<td align="left">从当前子例程返回，可以待会一个函数返回值</td>
</tr>
<tr>
<td align="left">discard</td>
<td align="left">丢弃当前的片元，终止着色器的执行。discard语句只在片元着色器中有效</td>
</tr>
</tbody></table>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> HornerEval(<span class="built_in">float</span> coffee[10], <span class="built_in">float</span> x);</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> HornerEval(<span class="built_in">float</span> coffee[10], <span class="built_in">float</span> x)&#123;</span><br><span class="line">    ...+</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="计算的不变性"><a href="#计算的不变性" class="headerlink" title="计算的不变性"></a>计算的不变性</h1><p>GLSL无法保证在不同的着色器中，两个完全相同的计算式会得到完全一样的结果。为了解决这个问题，需要用到<code>invariant</code>或者<code>precise</code>关键字。</p>
<h2 id="invariant"><a href="#invariant" class="headerlink" title="invariant"></a>invariant</h2><p>将一个内置的输出变量声明为<code>invariant</code>，也可以声明一个用户自定义的变量为<code>invariant</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">invariant gl_Position;</span><br><span class="line">invariant centroid out vec3 Color</span><br></pre></td></tr></table></figure>

<p>在调试过程中，可能需要将着色器中的所有可变量都设置为<code>invariant</code>。可以通过顶点着色器的预编译命令<code>pragma</code>来完成：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma STDGL invariant(all)</span></span><br></pre></td></tr></table></figure>

<h2 id="precise"><a href="#precise" class="headerlink" title="precise"></a>precise</h2><p><code>precise</code>限制符可以设置任何计算中的变量或者函数的返回值。它的作用是增加计算的可复用性</p>
<h1 id="着色器的预处理器"><a href="#着色器的预处理器" class="headerlink" title="着色器的预处理器"></a>着色器的预处理器</h1><h2 id="预处理命令"><a href="#预处理命令" class="headerlink" title="预处理命令"></a>预处理命令</h2><p>控制常量与宏的定义</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define</span></span><br><span class="line"><span class="comment">#undef</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">代码的条件编译</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="comment">#if</span></span><br><span class="line"><span class="comment">#ifdef</span></span><br><span class="line"><span class="comment">#ifndef</span></span><br><span class="line"><span class="comment">#else</span></span><br><span class="line"><span class="comment">#elif</span></span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure>

<p>强制比那一起将text文字内容插入到着色器的信息日志中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#error text</span></span><br></pre></td></tr></table></figure>



<p>控制编译器的选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma options</span></span><br></pre></td></tr></table></figure>

<p>设置编译器支持特定GLSL扩展功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#extension options</span></span><br></pre></td></tr></table></figure>

<p>设置当前使用的GLSL版本名称</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#version number</span></span><br></pre></td></tr></table></figure>


<p>设置诊断行号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#line options</span></span><br></pre></td></tr></table></figure>

<h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define NUM_ELEMENTS 10</span></span><br></pre></td></tr></table></figure>

<p>取消之前定义过的宏</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#undef LPos</span></span><br></pre></td></tr></table></figure>


<h1 id="数据快接口"><a href="#数据快接口" class="headerlink" title="数据快接口"></a>数据快接口</h1><p>着色器与应用程序之间，或者着色器个阶段之间共享的变量可以组织为变量块的形式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uniform b &#123;     //限定符可以为：uniform、<span class="keyword">in</span>、out、buffer</span><br><span class="line">    vec4 v1;    //块中的变量列表</span><br><span class="line">    vec1 v2;    //</span><br><span class="line">&#125;;              //访问匿名块成员时使用v1、v2</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uniform b &#123;     //</span><br><span class="line">    vec4 v1;    //</span><br><span class="line">    vec1 v2;    //</span><br><span class="line">&#125;name;          ////访问匿名块成员时使用name.v1、name.v2</span><br></pre></td></tr></table></figure>

<h1 id="着色器的编译"><a href="#着色器的编译" class="headerlink" title="着色器的编译"></a>着色器的编译</h1><p>创建着色器对象且通过链接生成可执行着色器程序的流程：（两部分）</p>
<p>（第一部分）对于每个着色器都会：</p>
<ul>
<li>创建一个着色器对象。</li>
<li>将着色器源代码编译为对象。</li>
<li>验证着色器的比那一是否成功。</li>
</ul>
<p>（第二部分）将多个着色器对象链接为一个着色器程序：</p>
<ul>
<li>创建一个着色器程序。</li>
<li>将着色器对象关联到着色器程序。</li>
<li>链接着色器程序。</li>
<li>判断着色器的链接过程是否成功完成。</li>
<li>使用着色器来处理顶点和片元。</li>
</ul>
<h1 id="着色器子程序"><a href="#着色器子程序" class="headerlink" title="着色器子程序"></a>着色器子程序</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//第一步</span><br><span class="line">subroutine vec4 LightFunc(vec4);</span><br><span class="line"></span><br><span class="line">//第二步</span><br><span class="line">subroutine (LightFunc) vec4 ambient(vec3 n) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> Materials.ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subroutine (LightFunc) vec4 diffuse(vec3 n)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> Materials.diffuse * max(dot (normalize(n), LightVec.xyz), 0.0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//第三步</span><br><span class="line">subroutine uniform LightFunc materialShader;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/" class="post-title-link" itemprop="url">OpenGL（三）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-28 14:27:25 / Modified: 16:42:05" itemprop="dateCreated datePublished" datetime="2020-03-28T14:27:25+08:00">2020-03-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>从这篇开始，我们就跟着课本源码边调试边熟悉OpenGL函数的使用了。里面涉及的C++语法后面会在《C++重温》这里作补充。拿到课本源码，我们需要通过Cmake编译出Mac上运行的Xcode程序。</p>
<blockquote>
<p>01-keypress.cpp</p>
</blockquote>
<h1 id="程序概括"><a href="#程序概括" class="headerlink" title="程序概括"></a>程序概括</h1><p>程序先执行init函数<code>void KeyPressExample::Initialize(const char * title)</code>再执行display函数<code>void KeyPressExample::Display(bool auto_redraw)</code>.</p>
<p>按下键盘会调用<code>void KeyPressExample::OnKey(int key, int scancode, int action, int mods)</code></p>
<p>程序窗口缩放<code>void KeyPressExample::Resize(int width, int height)</code></p>
<h1 id="init函数说明"><a href="#init函数说明" class="headerlink" title="init函数说明"></a>init函数说明</h1><p><code>glGenVertexArrays( NumVAOs, VAOs );</code><br>分配NumVAOs个未使用的对象名到数组VAOs中，用作顶点数组对象。再看下其数组定义：GLuint  VAOs[NumVAOs];</p>
<p><code>glBindVertexArray( VAOs[Triangles] );</code><br>VAOs[Triangles]</p>
<ul>
<li>输入的变量array非0，且为<code>glGenVertexArrays</code>所分配时，激活顶点数组对象，并直接影响对象中所保存的顶点数组状态。</li>
<li>array为0，OpenGL不再使用之前绑定的顶点数组。</li>
<li>array不是<code>glGenVertexArrays</code>所分配的，或者它已经被<code>glDeleteVertexArray</code>函数释放了，这时会产生一个无效错误。</li>
</ul>
<p><code>glGenBuffers( NumBuffers, Buffers );</code><br>分配NumBuffers个当前未使用的缓存对象名称，并保存到Buffers数组中。</p>
<p><code>glBindBuffer( GL_ARRAY_BUFFER, Buffers[ArrayBuffer] );</code></p>
<ul>
<li>如果绑定到一个已经创建的缓存对象，那么他将成为当前GL_ARRAY_BUFFER中被激活的缓存对象。</li>
<li>如果绑定的Buffers[ArrayBuffer]值为0，那么OpenGL将不再对当前GL_ARRAY_BUFFER使用任何缓存对象。</li>
</ul>
<p><code>glBufferData( GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW );</code><br>将数据载入缓存对象。</p>
<p><code>glVertexAttribPointer( vPosition, 2, GL_FLOAT, GL_FALSE, 0, BUFFER_OFFSET(0) );</code><br>将输入顶点着色器的数据 关联到 一个顶点属性的数组。</p>
<p><code>glEnableVertexAttribArray( vPosition );</code><br>启用顶点属性数组。</p>
<h1 id="display函数说明"><a href="#display函数说明" class="headerlink" title="display函数说明"></a>display函数说明</h1><p><code>glClear( GL_COLOR_BUFFER_BIT );</code><br>清屏。</p>
<p><code>glBindVertexArray( VAOs[Triangles] );</code></p>
<p><code>glDrawArrays( GL_TRIANGLES, 0, NumVertices );</code><br>开始绘制。</p>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p>程序默认效果<br><img src="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/keypress1.png" alt="keypress1.png"></p>
<p>按下键盘字母M的效果<br><img src="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/keypress2.png" alt="keypress2.png"></p>
<h1 id="详细源码"><a href="#详细源码" class="headerlink" title="详细源码"></a>详细源码</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">//////////////////////////////////////////////////////////////////////////////</span><br><span class="line">//</span><br><span class="line">//  Triangles.cpp</span><br><span class="line">//</span><br><span class="line">//////////////////////////////////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;vermilion.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include "vgl.h"</span></span><br><span class="line"><span class="comment">#include "vapp.h"</span></span><br><span class="line"><span class="comment">#include "LoadShaders.h"</span></span><br><span class="line"></span><br><span class="line">enum VAO_IDs &#123; Triangles, NumVAOs &#125;;</span><br><span class="line">enum Buffer_IDs &#123; ArrayBuffer, NumBuffers &#125;;</span><br><span class="line">enum Attrib_IDs &#123; vPosition = 0 &#125;;</span><br><span class="line"></span><br><span class="line">GLuint  VAOs[NumVAOs];</span><br><span class="line">GLuint  Buffers[NumBuffers];</span><br><span class="line"></span><br><span class="line">const GLuint  NumVertices = 6;</span><br><span class="line"></span><br><span class="line">BEGIN_APP_DECLARATION(KeyPressExample)</span><br><span class="line">    virtual void Initialize(const char * title);</span><br><span class="line">    virtual void Display(bool auto_redraw);</span><br><span class="line">    virtual void Finalize(void);</span><br><span class="line">    virtual void Resize(int width, int height);</span><br><span class="line">    void OnKey(int key, int scancode, int action, int mods);</span><br><span class="line">END_APP_DECLARATION()</span><br><span class="line"></span><br><span class="line">DEFINE_APP(KeyPressExample, <span class="string">"Key Press Example"</span>)</span><br><span class="line">//----------------------------------------------------------------------------</span><br><span class="line">//</span><br><span class="line">// init</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Initialize(const char * title)</span><br><span class="line">&#123;</span><br><span class="line">    //typedef class VermilionApplication base</span><br><span class="line">    base::Initialize(title);</span><br><span class="line"></span><br><span class="line">    glGenVertexArrays( NumVAOs, VAOs );</span><br><span class="line">    glBindVertexArray( VAOs[Triangles] );</span><br><span class="line"></span><br><span class="line">    GLfloat  vertices[NumVertices][2] = &#123;</span><br><span class="line">        &#123; -0.90f, -0.90f &#125;, &#123;  0.85f, -0.90f &#125;, &#123; -0.90f,  0.85f &#125;,  // Triangle 1</span><br><span class="line">        &#123;  0.90f, -0.85f &#125;, &#123;  0.90f,  0.90f &#125;, &#123; -0.85f,  0.90f &#125;   // Triangle 2</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    glGenBuffers( NumBuffers, Buffers );</span><br><span class="line">    glBindBuffer( GL_ARRAY_BUFFER, Buffers[ArrayBuffer] );</span><br><span class="line">    glBufferData( GL_ARRAY_BUFFER, sizeof(vertices),</span><br><span class="line">                  vertices, GL_STATIC_DRAW );</span><br><span class="line"></span><br><span class="line">    ShaderInfo  shaders[] = &#123;</span><br><span class="line">        &#123; GL_VERTEX_SHADER, <span class="string">"../media/shaders/keypress/keypress.vert"</span> &#125;,</span><br><span class="line">        &#123; GL_FRAGMENT_SHADER, <span class="string">"../media/shaders/keypress/keypress.frag"</span> &#125;,</span><br><span class="line">        &#123; GL_NONE, NULL &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    GLuint program = LoadShaders( shaders );</span><br><span class="line">    glUseProgram( program );</span><br><span class="line"></span><br><span class="line">    glVertexAttribPointer( vPosition, 2, GL_FLOAT,</span><br><span class="line">                           GL_FALSE, 0, BUFFER_OFFSET(0) );</span><br><span class="line">    glEnableVertexAttribArray( vPosition );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::OnKey(int key, int scancode, int action, int mods)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (action == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        switch (key)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> GLFW_KEY_M:</span><br><span class="line">                &#123;</span><br><span class="line">                    static GLenum  mode = GL_FILL;</span><br><span class="line"></span><br><span class="line">                    mode = ( mode == GL_FILL ? GL_LINE : GL_FILL );</span><br><span class="line">                    glPolygonMode( GL_FRONT_AND_BACK, mode );</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    base::OnKey(key, scancode, action, mods);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//----------------------------------------------------------------------------</span><br><span class="line">//</span><br><span class="line">// display</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Display(bool auto_redraw)</span><br><span class="line">&#123;</span><br><span class="line">    glClear( GL_COLOR_BUFFER_BIT );</span><br><span class="line"></span><br><span class="line">    glBindVertexArray( VAOs[Triangles] );</span><br><span class="line">    // GL_TRIANGLES并没有指定是画三角形的边沿还是内部也画，</span><br><span class="line">    glDrawArrays( GL_TRIANGLES, 0, NumVertices );</span><br><span class="line"></span><br><span class="line">    base::Display(auto_redraw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Resize(int width, int height)</span><br><span class="line">&#123;</span><br><span class="line">    glViewport(0, 0, width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Finalize(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">OpenGL（二）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-27 18:33:03 / Modified: 21:58:57" itemprop="dateCreated datePublished" datetime="2020-03-27T18:33:03+08:00">2020-03-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在<a href="https://samtake.github.io/2020/03/27/OpenGL/" target="_blank" rel="noopener">上篇</a>我们停留在概念上的，现在动手写写代码。</p>
<p>在<a href="https://www.khronos.org/opengl/wiki/Getting_Started#macOS" target="_blank" rel="noopener">OpenGL官网</a>我们可以看到这么一段话：</p>
<blockquote>
<p>macOS<br>Unlike other platforms, where the Operating System and OpenGL implementations are often updated separately, OpenGL updates are included as part of macOS system updates. To obtain the latest OpenGL on macOS, users should upgrade to the latest OS release, which can be found at Apple.com.</p>
</blockquote>
<p>换句话来说OpenGL已经集成在我们的Mac系统中，但是我们还需要一些执行窗口任务或者处理用户输入的函数，这里需要用到的库有：</p>
<ul>
<li>GLEW</li>
<li><a href="https://www.glfw.org/docs/latest/quick_guide.html" target="_blank" rel="noopener">GLFW</a></li>
<li><a href="https://glad.dav1d.de/" target="_blank" rel="noopener">GLAD</a></li>
</ul>
<h1 id="安装GLEW、GLEW"><a href="#安装GLEW、GLEW" class="headerlink" title="安装GLEW、GLEW"></a>安装GLEW、GLEW</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  blogs brew install glfw3</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/glfw-3.3.2.mojave.bottle.tar.gz</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==&gt; Pouring glfw-3.3.2.mojave.bottle.tar.gz</span><br><span class="line">🍺  /usr/<span class="built_in">local</span>/Cellar/glfw/3.3.2: 14 files, 492.8KB   <span class="comment">#安装位置</span></span><br><span class="line">➜  blogs brew install glew </span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/glew-2.1.0_1.mojave.bottle.tar.gz</span><br><span class="line">==&gt; Downloading from https://akamai.bintray.com/66/66638564b5b9d2d915b97841ef1cc117f701c7ec34707734fa1ce11919c28</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==&gt; Pouring glew-2.1.0_1.mojave.bottle.tar.gz</span><br><span class="line">🍺  /usr/<span class="built_in">local</span>/Cellar/glew/2.1.0_1: 38 files, 3MB  <span class="comment">#安装位置</span></span><br></pre></td></tr></table></figure>

<h1 id="在Xcode配置GLEW、GLEW"><a href="#在Xcode配置GLEW、GLEW" class="headerlink" title="在Xcode配置GLEW、GLEW"></a>在Xcode配置GLEW、GLEW</h1><p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode1.png" alt="opengl2-xcode1.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode2.png" alt="opengl2-xcode2.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode3.png" alt="opengl2-xcode3.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode4.png" alt="opengl2-xcode4.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode5.png" alt="opengl2-xcode5.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode6.png" alt="opengl2-xcode6.png"></p>
<p>添加两个dylib文件的方法时，没有在framework中搜索到这两个文件时，点击add other，然后点击shift+command+G进入<code>/usr/local</code>文件夹对应的安装路径找。</p>
<h1 id="下载GLAD库"><a href="#下载GLAD库" class="headerlink" title="下载GLAD库"></a>下载GLAD库</h1><p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/glad1.png" alt="glad1.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/glad2.png" alt="glad2.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ <span class="built_in">cd</span> /Users/samtake/Downloads/glad </span><br><span class="line">➜  glad ls</span><br><span class="line">include src</span><br><span class="line">➜  glad <span class="built_in">alias</span> tree=<span class="string">"find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"</span></span><br><span class="line">➜  glad tree </span><br><span class="line">|____include</span><br><span class="line">| |____KHR</span><br><span class="line">| | |____khrplatform.h</span><br><span class="line">| |____glad</span><br><span class="line">| | |____glad.h</span><br><span class="line">|____src</span><br><span class="line">| |____glad.c</span><br><span class="line">➜  glad</span><br></pre></td></tr></table></figure>
<p>将include文件夹中的两个文件复制到<code>/usr/local/include</code>内，然后添加<code>glad.c</code>文件到XCode工程中.</p>
<h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h1><p>复制源码代替原有的main.cpp文件，build一下编译通过即可。</p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/demo.png" alt="demo.png"></p>
<p><a href="https://github.com/samtake/helloOpenGL/tree/master/%E7%AC%AC%E4%B8%80%E7%AB%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" target="_blank" rel="noopener">demo源码</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/27/OpenGL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/27/OpenGL/" class="post-title-link" itemprop="url">OpenGL</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-27 17:21:15 / Modified: 18:21:05" itemprop="dateCreated datePublished" datetime="2020-03-27T17:21:15+08:00">2020-03-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/2020/03/27/OpenGL/opengl-book.jpeg" alt="opengl-book.jpeg"></p>
<p>啃书了！这本书买了很久都没看完，也忘的差不多了。现在试着用简洁的语言记录学习过程。</p>
<h1 id="什么是OpenGL"><a href="#什么是OpenGL" class="headerlink" title="什么是OpenGL?"></a>什么是OpenGL?</h1><p>OpenGL是一种可以对图形进行访问的软件库。它的接口与硬件无关，自身不包含任何执行窗口任务或者处理用户输入的函数（这些操作我们需要系统提供的接口来实现）。</p>
<h1 id="通过OpenGL渲染图像的主要操作-详细参考：渲染管线流程"><a href="#通过OpenGL渲染图像的主要操作-详细参考：渲染管线流程" class="headerlink" title="通过OpenGL渲染图像的主要操作(详细参考：渲染管线流程)"></a>通过OpenGL渲染图像的主要操作(详细参考：渲染管线流程)</h1><ul>
<li>设置数据，构建形状</li>
<li>着色器</li>
<li>光栅栏化，产生每个片元</li>
<li>执行片元着色器</li>
</ul>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p><code>光栅化（rasterization）</code>将输入图元的数学描述转换为与屏幕位置对应的像素片元。<br><code>渲染（render）</code>计算机从模型创建到最终图像的过程。<br><code>像素（pixel）</code>显示器上最小的可见单元。</p>
<p><code>着色器（shader）</code>专为图形处理单元编译的一种小型程序。</p>
<ul>
<li><code>定点着色器（vertex shader）</code>处理定点数据</li>
<li><code>片元着色器</code>处理光栅化的片元数据</li>
</ul>
<p><code>渲染管线（rendering pipeline）</code>OpenGL一系列数据处理过程，并且将应用程序的数据转换到最终渲染的图像。</p>
<h1 id="渲染管线流程"><a href="#渲染管线流程" class="headerlink" title="渲染管线流程"></a>渲染管线流程</h1><p><img src="/2020/03/27/OpenGL/rendering-pipeline.jpeg" alt="rendering-pipeline.jpeg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/24/FFmpeg%EF%BC%88%E5%85%AD%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/24/FFmpeg%EF%BC%88%E5%85%AD%EF%BC%89/" class="post-title-link" itemprop="url">FFmpeg（六）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-24 15:27:29 / Modified: 16:55:11" itemprop="dateCreated datePublished" datetime="2020-03-24T15:27:29+08:00">2020-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FFmpeg/" itemprop="url" rel="index">
                    <span itemprop="name">FFmpeg</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="通过FFmpeg源码使用脚本编译出可以在iOS下使用的SDK"><a href="#通过FFmpeg源码使用脚本编译出可以在iOS下使用的SDK" class="headerlink" title="通过FFmpeg源码使用脚本编译出可以在iOS下使用的SDK"></a>通过FFmpeg源码使用脚本编译出可以在iOS下使用的SDK</h1><p>具体脚本链接：<a href="https://github.com/kewlbear/FFmpeg-iOS-build-script" target="_blank" rel="noopener">FFmpeg-iOS-build-script</a></p>
<ul>
<li>在FFmpeg源码的上一级目录添加<code>build-ffmpeg.sh</code>文件</li>
<li>命令行执行：<code>./build-ffmpeg.sh</code></li>
<li>如果无执行权限的话执行：<code>chmod 777 ./build-ffmpeg.sh</code></li>
<li>注意：打包上传到商店时使用的SDK只需要真机的</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/24/FFmpeg%EF%BC%88%E4%BA%94%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/24/FFmpeg%EF%BC%88%E4%BA%94%EF%BC%89/" class="post-title-link" itemprop="url">FFmpeg（五）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-24 15:23:19 / Modified: 15:27:17" itemprop="dateCreated datePublished" datetime="2020-03-24T15:23:19+08:00">2020-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FFmpeg/" itemprop="url" rel="index">
                    <span itemprop="name">FFmpeg</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>FFmpeg与SDL结合，实现多媒体播放器，内容有：多线程与锁， 锁与条件变量在实际中的应用，音视频同步，seek等。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/24/FFmpeg%EF%BC%88%E5%9B%9B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/24/FFmpeg%EF%BC%88%E5%9B%9B%EF%BC%89/" class="post-title-link" itemprop="url">FFmpeg（四）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-24 14:16:30 / Modified: 15:24:37" itemprop="dateCreated datePublished" datetime="2020-03-24T14:16:30+08:00">2020-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FFmpeg/" itemprop="url" rel="index">
                    <span itemprop="name">FFmpeg</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://samtake.github.io/2019/11/04/FFmpeg/" target="_blank" rel="noopener">FFmpeg-安装及基本概念</a><br><a href="https://samtake.github.io/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/" target="_blank" rel="noopener">FFmpeg-命令</a><br><a href="https://samtake.github.io/2020/03/23/FFmpeg%EF%BC%88%E4%B8%89%EF%BC%89/" target="_blank" rel="noopener">通过 C语言 操作FFmpeg对多媒体文件的处理</a></p>
<h1 id="SDL简介"><a href="#SDL简介" class="headerlink" title="SDL简介"></a>SDL简介</h1><p><a href="http://libsdl.org/download-2.0.php" target="_blank" rel="noopener">SDL</a>可以对音视频进行渲染，这里主要部分有：安装SDL、使用SDL的基本步骤、SDL窗口渲染、SDL事件处理、SDL纹理渲染。</p>
<h1 id="安装SDL"><a href="#安装SDL" class="headerlink" title="安装SDL"></a>安装SDL</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ brew info SDl2</span><br><span class="line">➜  ~ brew info SDl2</span><br><span class="line">SDl2: stable 2.0.10 (bottled), HEAD</span><br><span class="line">Low-level access to audio, keyboard, mouse, joystick, and graphics</span><br><span class="line">https://www.libsdl.org/</span><br><span class="line">/usr/<span class="built_in">local</span>/Cellar/SDl2/2.0.10 (87 files, 4.6MB)</span><br><span class="line">  Poured from bottle on 2020-03-24 at 14:13:57</span><br><span class="line">From: git://mirrors.ustc.edu.cn/homebrew-core.git//Formula/sdl2.rb</span><br><span class="line">==&gt; Options</span><br><span class="line">--HEAD</span><br><span class="line">	Install HEAD version</span><br></pre></td></tr></table></figure>


<h1 id="使用SDL的基本步骤"><a href="#使用SDL的基本步骤" class="headerlink" title="使用SDL的基本步骤"></a>使用SDL的基本步骤</h1><h1 id="SDL窗口渲染"><a href="#SDL窗口渲染" class="headerlink" title="SDL窗口渲染"></a>SDL窗口渲染</h1><h1 id="SDL事件处理"><a href="#SDL事件处理" class="headerlink" title="SDL事件处理"></a>SDL事件处理</h1><h1 id="SDL彻底理解纹理渲染"><a href="#SDL彻底理解纹理渲染" class="headerlink" title="SDL彻底理解纹理渲染"></a>SDL彻底理解纹理渲染</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Sam"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Sam</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/samtake" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;samtake" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:943430195@qq.com" title="E-Mail &amp;rarr; mailto:943430195@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sam</span>
</div>
  <div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.3
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

</body>
</html>
