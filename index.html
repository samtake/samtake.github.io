<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.3',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"avatar":"/images/avatar.gif","rounded":false,"rotated":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="samtake">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="samtake">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>samtake</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">samtake</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">10000*365=27.3972603</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/18/Gin-JWT-Middleware/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/18/Gin-JWT-Middleware/" class="post-title-link" itemprop="url">Gin JWT Middleware</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-18 17:08:17 / Modified: 20:04:50" itemprop="dateCreated datePublished" datetime="2020-04-18T17:08:17+08:00">2020-04-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>åœ¨<a href="https://samtake.github.io/2020/04/09/jwt-go/" target="_blank" rel="noopener">jwt-go</a>ä¸­æˆ‘è®°å½•äº†æ‰‹åŠ¨å°è£…ä¸€ä¸ªè®¤è¯ä¸­é—´ä»¶ï¼Œç„¶åä»Šå¤©åœ¨çœ‹<a href="https://github.com/wenjianzhang/go-admin" target="_blank" rel="noopener">go-admin</a>åå°ç®¡ç†ç³»ç»Ÿæºç çš„æ—¶å€™å‘ç°ä½œè€…ç”¨åˆ°äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“<a href="https://github.com/appleboy/gin-jwt" target="_blank" rel="noopener">gin-jwt</a>å®ç°äº†åŒæ ·çš„åŠŸèƒ½ï¼Œä»Šå¤©å°±ä¸€èµ·æ¥çœ‹ä¸€ä¸‹å§ï¼</p>
<h1 id="gin-jwtèƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#gin-jwtèƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="gin-jwtèƒ½åšä»€ä¹ˆï¼Ÿ"></a>gin-jwtèƒ½åšä»€ä¹ˆï¼Ÿ</h1><ul>
<li><p><code>gin-jwt</code>æ˜¯åŸºäº<code>jwt-go</code>å®ç°çš„ä¸€ä¸ªè®¤è¯ä¸­é—´ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸“ä¸ºGinæ¡†æ¶å®ç°çš„ã€‚</p>
</li>
<li><p><code>gin-jwt</code>æä¾›äº†é¢å¤–çš„å‡½æ•°åŠŸèƒ½ï¼šç»™ç™»å½•æ¥å£ç”Ÿæˆtokenä»¤ç‰Œï¼Œä»¥åŠç”¨äºåˆ·æ–°tokençš„å‡½æ•°ã€‚</p>
</li>
</ul>
<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><p>æ•´ä¸ªæ¡†æ¶å°±ä¸€ä¸ª<a href="https://github.com/appleboy/gin-jwt/blob/master/auth_jwt.go" target="_blank" rel="noopener">auth_jwt.go</a>æ–‡ä»¶ï¼Œå…±747è¡Œä»£ç ã€‚æˆ‘ä»¬ä»å¤´å¾€ä¸‹çœ‹ï¼š</p>
<p>å…ˆå®šä¹‰äº†ä¸€ä¸ªè¿”å›å€¼ä¸ºmapç±»å‹çš„æ¥å£<br><code>type MapClaims map[string]interface{}</code></p>
<p>æ¥ç€å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“<code>GinJWTMiddleware</code>,è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä½¿ç”¨jwt-goçš„æ—¶å€™ï¼Œä¹Ÿä¼šå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢å­˜æ”¾äº†å…³äºç”Ÿæˆtokençš„ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼štokenå‘æ”¾æ—¶é—´ã€æ˜¯è°å‘æ”¾çš„tokenã€ä¸»é¢˜ç­‰ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> GinJWTMiddleware struct &#123;</span><br><span class="line">	// Realm name to display to the user. Required.</span><br><span class="line">	Realm string</span><br><span class="line"></span><br><span class="line">	// ç®—æ³•ç±»å‹ï¼š HS256, HS384, HS512é»˜è®¤æ˜¯ HS256.</span><br><span class="line">	SigningAlgorithm string</span><br><span class="line"></span><br><span class="line">	// åŠ å¯†å¯†é’¥.</span><br><span class="line">	Key []byte</span><br><span class="line"></span><br><span class="line">	// åˆ·æ–°Tokenæœ‰æ•ˆæœŸ.é»˜è®¤ä¸€ä¸ªå°æ—¶</span><br><span class="line">	MaxRefresh time.Duration</span><br><span class="line"></span><br><span class="line">	// è®¤è¯å›è°ƒå‡½æ•°</span><br><span class="line">	Authenticator func(c *gin.Context) (interface&#123;&#125;, error)</span><br><span class="line"></span><br><span class="line">	// é€šè¿‡è®¤è¯åçš„å¤„ç†å‡½æ•°</span><br><span class="line">	Authorizator func(data interface&#123;&#125;, c *gin.Context) bool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	// è®¤è¯å¤±è´¥çš„å›è°ƒå‡½æ•°</span><br><span class="line">	Unauthorized func(*gin.Context, int, string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	//ç™»å½•å“åº”å‡½æ•°</span><br><span class="line">	LoginResponse func(*gin.Context, int, string, time.Time)</span><br><span class="line"></span><br><span class="line">	// è¶…æ—¶å“åº”å‡½æ•°</span><br><span class="line">	LogoutResponse func(*gin.Context, int)</span><br><span class="line"></span><br><span class="line">	// åˆ·æ–°å“åº”å‡½æ•°</span><br><span class="line">	RefreshResponse func(*gin.Context, int, string, time.Time)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°(åªåˆ—äº†å‡ ä¸ªç›®å‰è§åˆ°çš„)</p>
<p>ç™»å½•æ˜¯è¿”å›token</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// LoginHandler can be used by clients to get a jwt token.</span><br><span class="line">// Payload needs to be json <span class="keyword">in</span> the form of &#123;<span class="string">"username"</span>: <span class="string">"USERNAME"</span>, <span class="string">"password"</span>: <span class="string">"PASSWORD"</span>&#125;.</span><br><span class="line">// Reply will be of the form &#123;<span class="string">"token"</span>: <span class="string">"TOKEN"</span>&#125;.</span><br><span class="line">func (mw *GinJWTMiddleware) LoginHandler(c *gin.Context) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ·æ–°token</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// RefreshHandler can be used to refresh a token. The token still needs to be valid on refresh.</span><br><span class="line">// Shall be put under an endpoint that is using the GinJWTMiddleware.</span><br><span class="line">// Reply will be of the form &#123;<span class="string">"token"</span>: <span class="string">"TOKEN"</span>&#125;.</span><br><span class="line">func (mw *GinJWTMiddleware) RefreshHandler(c *gin.Context) &#123;</span><br><span class="line">	tokenString, expire, err := mw.RefreshToken(c)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		mw.unauthorized(c, http.StatusUnauthorized, mw.HTTPStatusMessageFunc(err, c))</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	mw.RefreshResponse(c, http.StatusOK, tokenString, expire)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éªŒè¯APIæ˜¯éœ€è¦ç”¨åˆ°ï¼Œä¾‹å¦‚æ£€æµ‹æƒé™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// MiddlewareFunc makes GinJWTMiddleware implement the Middleware interface.</span><br><span class="line">func (mw *GinJWTMiddleware) MiddlewareFunc() gin.HandlerFunc &#123;</span><br><span class="line">	<span class="built_in">return</span> func(c *gin.Context) &#123;</span><br><span class="line">		mw.middlewareImpl(c)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><p>demoåœ°å€ï¼š<a href="https://github.com/samtake/gin-jwt-demo" target="_blank" rel="noopener">https://github.com/samtake/gin-jwt-demo</a></p>
<h2 id="æµ‹è¯•å®˜æ–¹demo"><a href="#æµ‹è¯•å®˜æ–¹demo" class="headerlink" title="æµ‹è¯•å®˜æ–¹demo"></a>æµ‹è¯•å®˜æ–¹demo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[GIN] 2020/04/18 - 18:29:51 | 200 |    1.502204ms |             ::1 | POST     <span class="string">"/login"</span></span><br><span class="line">[GIN] 2020/04/18 - 18:30:50 | 401 |     112.029Âµs |             ::1 | GET      <span class="string">"/auth/hello"</span></span><br><span class="line">[GIN] 2020/04/18 - 18:32:55 | 200 |     346.218Âµs |             ::1 | GET      <span class="string">"/auth/hello"</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è¯·æ±‚401</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"code"</span>: 401,</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"cookie token is empty"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç™»å½•è¿”å›token</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"code"</span>: 200,</span><br><span class="line">    <span class="string">"expire"</span>: <span class="string">"2020-04-18T19:29:51+08:00"</span>,</span><br><span class="line">    <span class="string">"token"</span>: <span class="string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1ODcyMDkzOTEsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTU4NzIwNTc5MX0.o55urrL-qhUqpqEKK8k8KF8yBqrgZo_EtKmuOW1bHnc"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æºå¸¦tokenè¯·æ±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"text"</span>: <span class="string">"Hello World."</span>,</span><br><span class="line">    <span class="string">"userID"</span>: <span class="string">"admin"</span>,</span><br><span class="line">    <span class="string">"userName"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="go-adminä¸­çš„ä½¿ç”¨"><a href="#go-adminä¸­çš„ä½¿ç”¨" class="headerlink" title="go-adminä¸­çš„ä½¿ç”¨"></a>go-adminä¸­çš„ä½¿ç”¨</h2><p>è¿™é‡Œä¹Ÿå°±è®°å½•åˆ«äººåœ¨é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œä»¥åŠæœ‰æ²¡æœ‰å¯ä»¥å­¦ä¹ çš„åœ°æ–¹ã€‚</p>
<p><code>auth.go</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package middleware</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	config2 <span class="string">"go-admin/config"</span></span><br><span class="line">	<span class="string">"go-admin/handler"</span></span><br><span class="line">	jwt <span class="string">"go-admin/pkg/jwtauth"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func AuthInit() (*jwt.GinJWTMiddleware, error) &#123;</span><br><span class="line">	<span class="built_in">return</span> jwt.New(&amp;jwt.GinJWTMiddleware&#123;</span><br><span class="line">		Realm:           <span class="string">"test zone"</span>,</span><br><span class="line">		Key:             []byte(<span class="string">"secret key"</span>),</span><br><span class="line">		Timeout:         time.Hour,</span><br><span class="line">		MaxRefresh:      time.Hour,</span><br><span class="line">		IdentityKey:     config2.ApplicationConfig.JwtSecret,</span><br><span class="line">		PayloadFunc:     handler.PayloadFunc,</span><br><span class="line">		IdentityHandler: handler.IdentityHandler,</span><br><span class="line">		Authenticator:   handler.Authenticator,</span><br><span class="line">		Authorizator:    handler.Authorizator,</span><br><span class="line">		Unauthorized:    handler.Unauthorized,</span><br><span class="line">		TokenLookup:     <span class="string">"header: Authorization, query: token, cookie: jwt"</span>,</span><br><span class="line">		TokenHeadName:   <span class="string">"Bearer"</span>,</span><br><span class="line">		TimeFunc:        time.Now,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>permission.go</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package middleware</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"go-admin/pkg"</span></span><br><span class="line">	mycasbin <span class="string">"go-admin/pkg/casbin"</span></span><br><span class="line">	<span class="string">"go-admin/pkg/jwtauth"</span></span><br><span class="line">	_ <span class="string">"go-admin/pkg/jwtauth"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//æƒé™æ£€æŸ¥ä¸­é—´ä»¶</span><br><span class="line">func AuthCheckRole() gin.HandlerFunc &#123;</span><br><span class="line">	<span class="built_in">return</span> func(c *gin.Context) &#123;</span><br><span class="line">		data, _ := c.Get(<span class="string">"JWT_PAYLOAD"</span>)</span><br><span class="line">		v := data.(jwtauth.MapClaims)</span><br><span class="line">		e, err := mycasbin.Casbin()</span><br><span class="line">		pkg.HasError(err,<span class="string">""</span>,500)</span><br><span class="line">		//æ£€æŸ¥æƒé™</span><br><span class="line">		res, err := e.Enforce(v[<span class="string">"rolekey"</span>], c.Request.URL.Path, c.Request.Method)</span><br><span class="line">		log.Println(<span class="string">"----------------"</span>, v[<span class="string">"rolekey"</span>], c.Request.URL.Path, c.Request.Method)</span><br><span class="line"></span><br><span class="line">			pkg.HasError(err,<span class="string">""</span>,500)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> res &#123;</span><br><span class="line">			c.Next()</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">"status"</span>: 401,</span><br><span class="line">				<span class="string">"msg"</span>:    <span class="string">"å¯¹ä¸èµ·ï¼Œæ‚¨æ²¡æœ‰è¯¥æ¥å£è®¿é—®æƒé™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜"</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">			c.Abort()</span><br><span class="line">			<span class="built_in">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>router.go</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">func InitRouter() *gin.Engine &#123;</span><br><span class="line"></span><br><span class="line">	// the jwt middleware</span><br><span class="line">	authMiddleware, err := middleware.AuthInit()//åˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		_ = fmt.Errorf(<span class="string">"JWT Error"</span>, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	r.POST(<span class="string">"/login"</span>, authMiddleware.LoginHandler)  //æ¡†æ¶è‡ªå¸¦</span><br><span class="line"></span><br><span class="line">	// Refresh time can be longer than token timeout</span><br><span class="line">	r.GET(<span class="string">"/refresh_token"</span>, authMiddleware.RefreshHandler)//æ¡†æ¶è‡ªå¸¦</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    apiv1 := r.Group(<span class="string">"/api/v1"</span>)</span><br><span class="line">	&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    auth := r.Group(<span class="string">"/api/v1"</span>)</span><br><span class="line">	auth.Use(authMiddleware.MiddlewareFunc()).Use(middleware.AuthCheckRole())//æ£€æµ‹æƒé™</span><br><span class="line">	&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>å†™åˆ°æœ€åå‘ç°è¿™é‡Œæœ‰ç¯‡åšå®¢å†™çš„æŒºå¥½çš„ï¼Œå¯ä»¥çœ‹çœ‹ï½<br><a href="https://blog.firerain.me/article/18" target="_blank" rel="noopener">https://blog.firerain.me/article/18</a></p>
<p>.end</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/17/Golang%E8%B0%83%E7%94%A8shell%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/17/Golang%E8%B0%83%E7%94%A8shell%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">Golangè°ƒç”¨shellè„šæœ¬</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-17 18:02:51 / Modified: 20:51:58" itemprop="dateCreated datePublished" datetime="2020-04-17T18:02:51+08:00">2020-04-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä»Šå¤©åœ¨ç”¨ä¸€äº›å·¥å…·å¤„ç†æ–‡ä»¶çš„æ—¶å€™ï¼Œæ‰¹é‡æ‰‹åŠ¨æ“ä½œçœŸä¼šç´¯æ­»äººï¼Œæ—¶é—´æˆæœ¬ä¸åˆ’ç®—ï¼Œæƒ³ç€æ€ä¹ˆç”¨è„šæœ¬åšæˆè‡ªåŠ¨åŒ–ï¼Œæ€è·¯å¤§æ¦‚æ˜¯æ¯ä¸ªè„šæœ¬å¤„ç†ä¸åŒçš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ²¡å¿…è¦å°†æ‰€æœ‰åŠŸèƒ½å†™åˆ°ä¸€ä¸ªè„šæœ¬äº†ï¼Œæ‹…å¿ƒä¸‡ä¸€æŸä¸ªæ¨¡å—å‡ºäº†é—®é¢˜å½±å“æ•´ä¸ªæµç¨‹ã€‚ç„¶åå…¶ä¸­ä¸€ä¸ªåŠŸèƒ½éœ€è¦è°ƒç”¨æŸä¸ªç½‘é¡µçš„æ¥å£å¤„ç†ï¼Œæƒ³äº†å¥½ä¹…ï¼Œè¯·æ•™äº†ä¸‹ä¸€äº›å‰è¾ˆï¼Œç»™å‡ºçš„å»ºè®®å°±æ˜¯ç ´è§£æ¥å£ï¼Œè¿™æ—¶å€™æˆ‘ç«‹åˆ»æƒ³åˆ°äº†Goâ€¦å¤§æ¦‚åˆ†ä¸‰æ­¥ï¼š</p>
<ul>
<li>shellè°ƒç”¨å·¥å…·æ‹¿åˆ°å¤„ç†å¥½çš„æ•°æ®</li>
<li>å†ç”±Goå®ç°å¯¹æ¥å£çš„æ•°æ®è¯·æ±‚â€¦</li>
<li>è¯·æ±‚å›æ¥æ¥å£ä¹‹åå†äº¤ç”±shellè°ƒç”¨å·¥å…·åšæœ€åçš„å¤„ç†ï¼Œä»è€Œå®Œæˆæ•´ä¸ªæ¨¡å—çš„å·¥ä½œã€‚</li>
</ul>
<p>è¿™é‡Œè®°ä½ä¸€ç‚¹ï¼šshellè„šæœ¬æ— éå°±åšæˆå‚æ•°å½¢å¼ã€‚</p>
<h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p><code>os/exec</code>åŒ…å¯ç”¨äºä»Goè§¦å‘ä»»ä½•OSå‘½ä»¤ã€‚ ç›¸åŒçš„å¯ç”¨äºè§¦å‘.shæ–‡ä»¶ã€‚</p>
<p>å…·ä½“å‡½æ•°æ¥å£å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href="https://pkg.go.dev/os/exec?tab=doc" target="_blank" rel="noopener">package exec </a></p>
<h1 id="ä¸Šä»£ç "><a href="#ä¸Šä»£ç " class="headerlink" title="ä¸Šä»£ç "></a>ä¸Šä»£ç </h1><p>é¦–å…ˆï¼Œåœ¨åŒä¸€ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªtest.shæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">your_name=<span class="string">"start test ..."</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$your_name</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ<code>chmod +x test.sh</code>ï¼Œä¸ç„¶ä¼šå› ä¸ºæ²¡æœ‰æ‰§è¡Œæƒé™æŠ¥é”™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Execute Shell:./test.sh failed with error:<span class="built_in">exit</span> status 126%</span><br></pre></td></tr></table></figure>


<p>è°ƒç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os/exec"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	fmt.Println(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">command</span> := `./test.sh .`</span><br><span class="line">	cmd := exec.Command(<span class="string">"/bin/bash"</span>, <span class="string">"-c"</span>, <span class="built_in">command</span>)</span><br><span class="line"></span><br><span class="line">	output, err := cmd.Output()</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Execute Shell:%s failed with error:%s"</span>, <span class="built_in">command</span>, err.Error())</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"Execute Shell:%s finished with output:\n%s"</span>, <span class="built_in">command</span>, string(output))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">Execute Shell:./test.sh . finished with output:</span><br><span class="line">start <span class="built_in">test</span> ...</span><br></pre></td></tr></table></figure>

<p><a href="https://golangbyexample.com//" target="_blank" rel="noopener">https://golangbyexample.com//</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/12/E-R%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/12/E-R%E5%9B%BE/" class="post-title-link" itemprop="url">E-Rå›¾</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-12 14:46:13" itemprop="dateCreated datePublished" datetime="2020-04-12T14:46:13+08:00">2020-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-13 14:41:46" itemprop="dateModified" datetime="2020-04-13T14:41:46+08:00">2020-04-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>E-Rå›¾ä¹Ÿç§°å®ä½“-è”ç³»å›¾(Entity Relationship Diagram)ï¼Œä¹Ÿå°±æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå¯ä»¥ç”¨æ¥åšæ•°æ®åº“è®¾è®¡ã€‚ä»Šå¤©å…ˆè®°å½•ä¸‹è¯¥æ€ä¹ˆçœ‹E-Rå›¾ï¼Œè‡³äºè½¯ä»¶çš„æ“ä½œä¸‹æ¬¡è¡¥å……è®°å½•ï½</p>
<p>ä½œå›¾å·¥å…·åœ¨Macç«¯å¯ä»¥ç”¨<a href="https://dbeaver.io/download/" target="_blank" rel="noopener">dbeaver</a>,åŸå› å‘¢ä¸»è¦æ˜¯å…è´¹å§ã€‚</p>
<p>ç„¶åè¯´è¯´ä»Šå¤©æˆ‘ä¸ºä»€ä¹ˆæ€ä¹ˆå°±æ‰¯åˆ°äº†E-Rå›¾å‘¢ï¼Ÿæ˜¯æˆ‘åœ¨æ’¸ä¸€ä¸ªgolangé¡¹ç›®çš„æ—¶å€™ï¼Œå‘è§‰å¯¹åå°æ•°æ®åº“ä¸çŸ¥é“æ€ä¹ˆè®¾è®¡ï¼Œç„¶åå°±æŸ¥äº†ä¸‹èµ„æ–™ï¼Œå¦‚ä½•è®¾è®¡ä¹Ÿç®—è¯´çš„å¾ˆæ˜äº†ï¼Œå¯¹åº”çš„å…³ç³»å°±æ˜¯ç”¨E-Rå›¾æ¥ç”»çš„ã€‚</p>
<h1 id="å¦‚ä½•çœ‹å›¾"><a href="#å¦‚ä½•çœ‹å›¾" class="headerlink" title="å¦‚ä½•çœ‹å›¾"></a>å¦‚ä½•çœ‹å›¾</h1><p><img src="/2020/04/12/E-R%E5%9B%BE/ER01.png" alt="ER01.png"></p>
<p>ä¸Šé¢ğŸ‘†æ¦‚å¿µæ•°æ®æ¨¡å‹ä¸­åŒ…å«äº†ï¼šæƒé™ã€è§’è‰²ã€ç”¨æˆ·ã€æ–‡ç« ã€æ ç›®ã€è¯„è®ºå’Œä¸¤ä¸ªæ¡¥è¡¨ï¼Œå…¶ä¸­1å¯¹1æˆ–1å¯¹å¤šç­‰å…³ç³»åœ¨æ¨¡å‹ä¸­ä½“ç°ã€‚å…¶ä¸­ï¼š</p>
<ul>
<li><code>PK</code>primary key</li>
<li><code>ç®­å¤´</code>ä»£è¡¨çš„æ˜¯å…³è”å…³ç³»</li>
<li><code>è™šçº¿</code>ä»£è¡¨çš„æ˜¯å¤‡æ³¨è¯´æ˜</li>
</ul>
<p>å…·ä½“ä¸¾ä¾‹ï¼ˆçº¢æ¡†éƒ¨åˆ†ï¼‰ï¼š<br><img src="/2020/04/12/E-R%E5%9B%BE/ER02.png" alt="ER02.png"></p>
<ul>
<li>ç”¨æˆ·è§’è‰²è¡¨(cms_user_role) åŒæ—¶å±äºç”¨æˆ·è¡¨(cms_user)å’Œè§’è‰²è¡¨(cms_role)</li>
<li>è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸€ä¸ªç”¨æˆ·ä¼šæœ‰å¤šä¸ªè§’è‰²</li>
</ul>
<p><img src="/2020/04/12/E-R%E5%9B%BE/%E7%94%A8%E4%BE%8B01.png" alt="ç”¨ä¾‹01.png"><br>è¯»è€…å¯ä»¥è¿›è¡Œé˜…è¯»ã€æ³¨å†Œã€ç™»å½•ç­‰æ“ä½œã€‚ç™»å½•çŠ¶æ€ä¸‹åˆå¯ä»¥è¿›è¡Œè¯„è®ºä¸é˜…è¯»æ“ä½œã€‚</p>
<p><img src="/2020/04/12/E-R%E5%9B%BE/%E7%94%A8%E4%BE%8B02.png" alt="ç”¨ä¾‹02.png"><br>å°ç¼–æ˜¯ä½œè€…èº«ä»½ï¼Œå¯ä»¥å¯¹è‡ªå·±çš„æ–‡ç« è¿›è¡Œç®¡ç†ã€‚</p>
<p><img src="/2020/04/12/E-R%E5%9B%BE/%E7%94%A8%E4%BE%8B03.png" alt="ç”¨ä¾‹03.png"><br>è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰ç³»ç»Ÿæœ€å¤§æƒé™(æˆ–è€…æ‰€æœ‰æƒé™)ï¼Œå¯ä»¥è¿›è¡Œæ ç›®ç®¡ç†ã€æ–‡ç« ç®¡ç†ï¼ˆæ–‡ç« ç®¡ç†éšå¼çš„åŒ…å«äº†æ‹¥æœ‰é˜…è¯»æƒé™ï¼‰ã€æƒé™ç®¡ç†ã€è§’è‰²ç®¡ç†ã€è¯„è®ºå®¡æ ¸ç­‰æ“ä½œã€‚å¯å¯¹æ–‡ç« è¿›è¡Œå®¡æ ¸ï¼Œæƒé™ç®¡ç†ä¸‹å¯å¯¹è§’è‰²è¿›è¡Œç®¡ç†ã€‚</p>
<h1 id="gormçš„å®ç°"><a href="#gormçš„å®ç°" class="headerlink" title="gormçš„å®ç°"></a>gormçš„å®ç°</h1><p>gormæ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹æ¨¡å‹å»ºç«‹å…³ç³»çš„çš„æ–‡æ¡£ï¼š<a href="https://gorm.io/zh_CN/docs/belongs_to.html" target="_blank" rel="noopener">https://gorm.io/zh_CN/docs/belongs_to.html</a></p>
<p>ä¾æ—§ä»¥<code>cms_user_role</code>  <code>cms_user</code> <code>cms_role</code> è¿™ä¸‰ä¸ªè¡¨ä¸ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//åœ¨gormä¸­ï¼Œæ¨¡å‹çš„ç»“æ„ä»¥é©¼å³°å‘½åæ–¹å¼ä¹¦å†™ï¼Œåœ¨æ•°æ®è¡¨ä¼šè‡ªåŠ¨è½¬æˆå¯¹åº”ä¸‹åˆ’çº¿</span><br><span class="line"></span><br><span class="line">//CmsUserRole .</span><br><span class="line"><span class="built_in">type</span> CmsUserRole struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	ID     string `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"id"</span>`</span><br><span class="line">	UserID string `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"user_id"</span>`</span><br><span class="line">	RoleID string `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"role_id"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//CmsUser .</span><br><span class="line"><span class="built_in">type</span> CmsUser struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	ID       string `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"id"</span>`</span><br><span class="line">	UserName string `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"username"</span>`</span><br><span class="line">	Password string `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"password"</span>`</span><br><span class="line">	CmsUserRole CmsUserRole `gorm:<span class="string">"foreignkey:CmsUserRoleRefer"</span>` // å°† CmsUserRoleRefer ä½œä¸ºå¤–é”®</span><br><span class="line">	CmsUserRoleRefer uint</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//CmsRole .</span><br><span class="line"><span class="built_in">type</span> CmsRole struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	ID          string      `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"id"</span>`</span><br><span class="line">	Name        string      `gorm:<span class="string">"type:varchar(100);not null"</span>json:<span class="string">"name"</span>`</span><br><span class="line">	CmsUserRole CmsUserRole `gorm:<span class="string">"foreignkey:CmsUserRoleRefer"</span>` // å°† CmsUserRoleRefer ä½œä¸ºå¤–é”®</span><br><span class="line">	CmsUserRoleRefer uint</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™ï¼Œä½ ä¹Ÿä¼šå‘è§‰ç”¨æˆ·è§’è‰²è¡¨å…¶å®æ˜¯ä¸ªä¸­é—´ä»¶ã€‚</p>
<h1 id="èµ„æ–™ï¼š"><a href="#èµ„æ–™ï¼š" class="headerlink" title="èµ„æ–™ï¼š"></a>èµ„æ–™ï¼š</h1><p><a href="https://blog.csdn.net/qq_41306364/article/details/103135904" target="_blank" rel="noopener">ã€ç®¡ç†ç³»ç»Ÿè¯¾ç¨‹è®¾è®¡ã€‘ç¾å°‘å¥³æ‰‹æŠŠæ‰‹æ•™ä½ åå°ç®¡ç†</a><br><a href="https://www.zhihu.com/question/19973018" target="_blank" rel="noopener">åœ¨macä¸Šæœ‰æ²¡æœ‰ç±»ä¼¼PowerDesignerçš„è½¯ä»¶ï¼Ÿ</a><br><a href="https://www.bilibili.com/video/BV1X7411L7kc?from=search&seid=1650702711585721122" target="_blank" rel="noopener">ç¬¬1èŠ‚ï¼š7åˆ†é’Ÿä¸Šæ‰‹ERå›¾</a><br><a href="https://zhuanlan.zhihu.com/p/50448125" target="_blank" rel="noopener">é€šä¿—æ•°æ®åº“è®¾è®¡ï¼ˆ2ï¼‰E-Rå›¾</a><br><a href="https://www.zhihu.com/question/20680795/answer/91850640" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨ MySQL workbench ç”Ÿæˆ EER å›¾ï¼Ÿ</a><br><a href="https://www.zhihu.com/topic/19630983/top-answers" target="_blank" rel="noopener">E-Rå›¾ä¸“æ </a><br><a href="https://www.bilibili.com/video/BV1dE411q7Xf?from=search&seid=12985731220509939471" target="_blank" rel="noopener">visio-æ•°æ®åº“æ¨¡å‹å›¾</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/10/%E9%80%9A%E8%BF%87viper%E8%AF%BB%E5%8F%96%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/10/%E9%80%9A%E8%BF%87viper%E8%AF%BB%E5%8F%96%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">é€šè¿‡viperè¯»å–é¡¹ç›®é…ç½®æ–‡ä»¶</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-10 22:31:12 / Modified: 22:35:59" itemprop="dateCreated datePublished" datetime="2020-04-10T22:31:12+08:00">2020-04-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://github.com/spf13/viper" target="_blank" rel="noopener">https://github.com/spf13/viper</a></p>
<p>åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª<code>config</code>æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ª<code>application.yml</code>æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8099</span><br><span class="line">datasource:</span><br><span class="line">  driverName: mysql</span><br><span class="line">  host: 127.0.0.1</span><br><span class="line">  port: 3306</span><br><span class="line">  database: gin_vue_bs</span><br><span class="line">  username: root</span><br><span class="line">  password: 123456</span><br><span class="line">  charset: utf8</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ–é…ç½®æ–‡ä»¶,è¦åœ¨åˆå§‹åŒ–æ•°æ®åº“ä¹‹å‰è°ƒç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//InitConfig åˆå§‹åŒ–é…ç½®æ–‡ä»¶.</span><br><span class="line">func <span class="function"><span class="title">InitConfig</span></span>() &#123;</span><br><span class="line">	workDir, _ := os.Getwd()                 //å·¥ç¨‹é¡¹ç›®ç›®å½•</span><br><span class="line">	viper.SetConfigName(<span class="string">"application"</span>)       //é…ç½®æ–‡ä»¶å</span><br><span class="line">	viper.SetConfigType(<span class="string">"yml"</span>)               //é…ç½®æ–‡ä»¶ç±»å‹</span><br><span class="line">	viper.AddConfigPath(workDir + <span class="string">"/config"</span>) //é…ç½®æ–‡ä»¶ç›®å½•</span><br><span class="line">	err := viper.ReadInConfig()</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è°ƒç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//InitDB .</span><br><span class="line">func InitDB() *gorm.DB &#123;</span><br><span class="line">	driverName := viper.GetString(<span class="string">"datasource.driverName"</span>)</span><br><span class="line">	host := viper.GetString(<span class="string">"datasource.host"</span>)</span><br><span class="line">	port := viper.GetString(<span class="string">"datasource.port"</span>)</span><br><span class="line">	database := viper.GetString(<span class="string">"datasource.database"</span>)</span><br><span class="line">	username := viper.GetString(<span class="string">"datasource.username"</span>)</span><br><span class="line">	passwoed := viper.GetString(<span class="string">"datasource.password"</span>)</span><br><span class="line">	charset := <span class="string">"utf8"</span></span><br><span class="line">	args := fmt.Sprintf(<span class="string">"%s:%s@tcp(%s:%s)/%s?charset=%s&amp;parseTime=true"</span>,</span><br><span class="line">		username,</span><br><span class="line">		passwoed,</span><br><span class="line">		host,</span><br><span class="line">		port,</span><br><span class="line">		database,</span><br><span class="line">		charset)</span><br><span class="line"></span><br><span class="line">	db, err := gorm.Open(driverName, args)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(<span class="string">"failed to connect database,err"</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//åˆ›å»ºæ•°æ®è¡¨</span><br><span class="line">	db.AutoMigrate(&amp;model.User&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	DB = db</span><br><span class="line">	<span class="built_in">return</span> db</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/10/dto%E4%B8%8Edao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/10/dto%E4%B8%8Edao/" class="post-title-link" itemprop="url">dtoä¸dao</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-10 21:33:56 / Modified: 21:45:18" itemprop="dateCreated datePublished" datetime="2020-04-10T21:33:56+08:00">2020-04-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="dto"><a href="#dto" class="headerlink" title="dto"></a>dto</h1><p><code>dto</code>æ•°æ®ä¼ è¾“å¯¹è±¡(Data Transfer Object)ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ä¹‹é—´ä¼ è¾“æ•°æ®çš„è½¯ä»¶åº”ç”¨ç³»ç»Ÿã€‚æ•°æ®ä¼ è¾“ç›®æ ‡å¾€å¾€æ˜¯æ•°æ®è®¿é—®å¯¹è±¡ä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®ã€‚æ•°æ®ä¼ è¾“å¯¹è±¡ä¸æ•°æ®äº¤äº’å¯¹è±¡æˆ–æ•°æ®è®¿é—®å¯¹è±¡ä¹‹é—´çš„å·®å¼‚æ˜¯ä¸€ä¸ªä»¥ä¸å…·æœ‰ä»»ä½•è¡Œä¸ºé™¤äº†å­˜å‚¨å’Œæ£€ç´¢çš„æ•°æ®ï¼ˆè®¿é—®å’Œå­˜å–å™¨ï¼‰ã€‚</p>
<p>åœ¨golangä¸­ç›®å‰æˆ‘é‡åˆ°æ˜¯ç”¨äºæ§åˆ¶è¿”å›çš„å­—æ®µï¼Œå¦‚ï¼šåœ¨Userä¸­ç”±å¤šä¸ªå­—æ®µï¼Œæˆ‘å¸Œæœ›åªè¿”å›<code>Name</code>å’Œ<code>Telephone</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package dto</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"gin_vue_bs/model"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//UserDto .</span><br><span class="line"><span class="built_in">type</span> UserDto struct &#123;</span><br><span class="line">	Name      string `json:<span class="string">"name"</span>`</span><br><span class="line">	Telephone string `json:<span class="string">"telephone"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ToUserDto .</span><br><span class="line">func ToUserDto(user model.User) UserDto &#123;</span><br><span class="line">	<span class="built_in">return</span> UserDto&#123;</span><br><span class="line">		Name:      user.Name,</span><br><span class="line">		Telephone: user.Telephone,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> User struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name      string `gorm:<span class="string">"type:varchar(20);not null"</span>`</span><br><span class="line">	Telephone string `gorm:<span class="string">"varchar(110;not null;unique"</span>`</span><br><span class="line">	Password  string `gorm:<span class="string">"size:255;not null"</span>`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.JSON(http.StatusOK, gin.H&#123;<span class="string">"code"</span>: 200, <span class="string">"data"</span>: gin.H&#123;<span class="string">"user"</span>: dto.ToUserDto(user.(model.User))&#125;&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h1><p><a href="https://baike.sogou.com/v6708028.htm?fromTitle=dao" target="_blank" rel="noopener">dao</a>å°±å«å®ƒæ•°æ®è®¿é—®æ¥å£å§ã€‚</p>
<p>è¿˜æœ‰æ·±åˆ»çš„ç†è§£ï¼Œç›¸å…³èµ„æ–™ï¼š</p>
<p><a href="http://www.imooc.com/article/33236" target="_blank" rel="noopener">http://www.imooc.com/article/33236</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/09/jwt-go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/09/jwt-go/" class="post-title-link" itemprop="url">jwt-go</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-09 23:27:28" itemprop="dateCreated datePublished" datetime="2020-04-09T23:27:28+08:00">2020-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-10 00:19:32" itemprop="dateModified" datetime="2020-04-10T00:19:32+08:00">2020-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://github.com/dgrijalva/jwt-go" target="_blank" rel="noopener">github</a></p>
<p><a href="https://godoc.org/github.com/dgrijalva/jwt-go" target="_blank" rel="noopener">Documentation</a></p>
<p>å¼•å…¥åŒ…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get <span class="string">"github.com/dgrijalva/jwt-go"</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package common</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"gin_vue_bs/model"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/dgrijalva/jwt-go"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//å®šä¹‰ jwt åŠ å¯†å¯†é’¥</span><br><span class="line">var jwtKey = []byte(<span class="string">"a_secret_crect"</span>)</span><br><span class="line"></span><br><span class="line">//Claims .</span><br><span class="line"><span class="built_in">type</span> Claims struct &#123;</span><br><span class="line">	UserID uint</span><br><span class="line">	jwt.StandardClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ReleaseToken ç™»å½•æˆåŠŸåˆ™è°ƒç”¨è¯¥æ–¹æ³•å‘æ”¾token.</span><br><span class="line">func ReleaseToken(user model.User) (string, error) &#123;</span><br><span class="line">	expirationTime := time.Now().Add(7 * 24 * time.Hour) //tokençš„è¿‡æœŸæ—¶é—´7å¤©</span><br><span class="line">	claims := &amp;Claims&#123;</span><br><span class="line">		UserID: user.ID,</span><br><span class="line">		StandardClaims: jwt.StandardClaims&#123;</span><br><span class="line">			ExpiresAt: expirationTime.Unix(),</span><br><span class="line">			IssuedAt:  time.Now().Unix(), //tokenå‘æ”¾æ—¶é—´</span><br><span class="line">			Issuer:    <span class="string">"samtake"</span>,         //æ˜¯è°å‘æ”¾çš„token</span><br><span class="line">			Subject:   <span class="string">"user token"</span>,      //ä¸»é¢˜</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)</span><br><span class="line">	tokenString, err := token.SignedString(jwtKey)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="string">""</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> tokenString, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"code"</span>: <span class="string">"200"</span>,</span><br><span class="line">    <span class="string">"data"</span>: &#123;</span><br><span class="line">        <span class="string">"token"</span>: <span class="string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjMsImV4cCI6MTU4NzA1MjA0MiwiaWF0IjoxNTg2NDQ3MjQyLCJpc3MiOiJzYW10YWtlIiwic3ViIjoidXNlciB0b2tlbiJ9.6a50w6SfsQH7XZBW7zu3_FEGFcrWHRAh2DFYTh9hbCo"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"ç™»å½•æˆåŠŸ"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>æ‰€è¿”å›çš„tokenç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šåè®®å¤´ï¼ˆtokençš„åŠ å¯†åè®®ï¼‰ã€ æºç claimså‚¨å­˜çš„ä¿¡æ¯ ã€ï¼ˆå‰é¢ä¸¤éƒ¨åˆ†+jwtKeyï¼‰çš„å“ˆå¸Œå€¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">âœ  blogs <span class="built_in">echo</span> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9  | base64 -D                                                                                                                                                         </span><br><span class="line">&#123;<span class="string">"alg"</span>:<span class="string">"HS256"</span>,<span class="string">"typ"</span>:<span class="string">"JWT"</span>&#125;%</span><br><span class="line">âœ  blogs <span class="built_in">echo</span> eyJVc2VySUQiOjMsImV4cCI6MTU4NzA1MjA0MiwiaWF0IjoxNTg2NDQ3MjQyLCJpc3MiOiJzYW10YWtlIiwic3ViIjoidXNlciB0b2tlbiJ9 | base64 -D     </span><br><span class="line">&#123;<span class="string">"UserID"</span>:3,<span class="string">"exp"</span>:1587052042,<span class="string">"iat"</span>:1586447242,<span class="string">"iss"</span>:<span class="string">"samtake"</span>,<span class="string">"sub"</span>:<span class="string">"user token"</span>&#125;%</span><br><span class="line">âœ  blogs <span class="built_in">echo</span> 6a50w6SfsQH7XZBW7zu3_FEGFcrWHRAh2DFYTh9hbCo  | base64 -D     </span><br><span class="line">?tÃ¤???]?V?;??Q??!?1XNa%</span><br><span class="line">âœ  blogs</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/09/gorm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/09/gorm/" class="post-title-link" itemprop="url">gorm</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-09 18:31:28" itemprop="dateCreated datePublished" datetime="2020-04-09T18:31:28+08:00">2020-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-11 15:07:11" itemprop="dateModified" datetime="2020-04-11T15:07:11+08:00">2020-04-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://gorm.io" target="_blank" rel="noopener">https://gorm.io</a></p>
<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p><code>ORM</code>åˆ†åˆ«ä»£è¡¨ï¼š<br>|O|R|M|<br>|:â€”-|:â€”|:â€”-|<br>|Object|Relational|Mapping|<br>|å¯¹è±¡|å…³ç³»|æ˜ å°„|<br>|ç¨‹åºä¸­çš„å¯¹è±¡/å®ä¾‹|å…³ç³»å‹æ•°æ®åº“|-|<br>|ä¾‹å¦‚Goä¸­çš„ç»“æ„ä½“å®ä¾‹|ä¾‹å¦‚MySQL|-|</p>
<p>MySQLä¸ Goçš„å¯¹åº”å…³ç³»ï¼š<br>æ•°æ®è¡¨     &lt;-&gt;     ç»“æ„ä½“<br>æ•°æ®è¡Œ     &lt;-&gt;     ç»“æ„ä½“å®ä¾‹<br>å­—æ®µ     &lt;-&gt;     ç»“æ„ä½“å­—æ®µ    </p>
<h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/e421083458/gorm"</span> //https://gorm.io</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> User struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name      string `gorm:<span class="string">"type:varchar(20);not null"</span>`</span><br><span class="line">	Telephone string `gorm:<span class="string">"varchar(110;not null;unique"</span>`</span><br><span class="line">	Password  string `gorm:<span class="string">"size:255;not null"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">	db := InitDb()</span><br><span class="line">	defer db.Close()</span><br><span class="line"></span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line">	r.POST(<span class="string">"/api/auth/register"</span>, func(ctx *gin.Context) &#123;</span><br><span class="line">		//è·å–å‚æ•°</span><br><span class="line">		name := ctx.PostForm(<span class="string">"name"</span>)</span><br><span class="line">		telephone := ctx.PostForm(<span class="string">"telephone"</span>)</span><br><span class="line">		password := ctx.PostForm(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">		//éªŒè¯æ•°æ®</span><br><span class="line">		<span class="keyword">if</span> len(telephone) != 11 &#123;</span><br><span class="line">			ctx.JSON(http.StatusServiceUnavailable,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"æ‰‹æœºå·å¿…é¡»ä¸º11ä¸º"</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> len(password) &lt; 6 &#123;</span><br><span class="line">			ctx.JSON(http.StatusUnprocessableEntity,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"å¯†ç ä¸èƒ½å°‘äº6ä½"</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//åç§°å¦‚æœæ²¡æœ‰ä¼ ï¼Œåˆ™è¿”å›éšæœºå­—ç¬¦ä¸²</span><br><span class="line">		<span class="keyword">if</span> len(name) == 0 &#123;</span><br><span class="line">			name = RandomString(10)</span><br><span class="line">		&#125;</span><br><span class="line">		//åˆ¤æ–­æ‰‹æœºå·æ˜¯å¦å­˜åœ¨</span><br><span class="line">		<span class="keyword">if</span> isTelephoneExist(db, telephone) &#123;</span><br><span class="line">			ctx.JSON(http.StatusUnprocessableEntity,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"ç”¨æˆ·å·²ç»å­˜åœ¨"</span>&#125;)</span><br><span class="line">			<span class="built_in">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//åˆ›å»ºç”¨æˆ·</span><br><span class="line">		newUser := User&#123;</span><br><span class="line">			Name:      name,</span><br><span class="line">			Telephone: telephone,</span><br><span class="line">			Password:  password,</span><br><span class="line">		&#125;</span><br><span class="line">		db.Create(&amp;newUser)</span><br><span class="line"></span><br><span class="line">		//è¿”å›ç»“æœ</span><br><span class="line">		ctx.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"msg"</span>: <span class="string">"æ³¨å†ŒæˆåŠŸ"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	panic(r.Run(<span class="string">":8099"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func isTelephoneExist(db *gorm.DB, telephone string) bool &#123;</span><br><span class="line">	var user User</span><br><span class="line">	db.Where(<span class="string">"telephone = ?"</span>, telephone).First(&amp;user)</span><br><span class="line">	<span class="keyword">if</span> user.ID != 0 &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è¿”å›éšæœºå­—ç¬¦ä¸²</span><br><span class="line">func RandomString(n int) string &#123;</span><br><span class="line">	var letters = []byte(<span class="string">"iasdhjklfhascvxnjklasdfhjkasdfklasdfhnjklasdfjklasdfjklfasdsdfjk"</span>)</span><br><span class="line">	result := make([]byte, n)</span><br><span class="line"></span><br><span class="line">	rand.Seed(time.Now().Unix())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := range result &#123;</span><br><span class="line">		result[i] = letters[rand.Intn(len(letters))]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> string(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func InitDb() *gorm.DB &#123;</span><br><span class="line">	driverName := <span class="string">"mysql"</span></span><br><span class="line">	host := <span class="string">"127.0.0.1"</span></span><br><span class="line">	port := <span class="string">"3306"</span></span><br><span class="line">	database := <span class="string">"gin_vue_bs"</span></span><br><span class="line">	username := <span class="string">"root"</span></span><br><span class="line">	passwoed := <span class="string">"123456"</span></span><br><span class="line">	charset := <span class="string">"utf8"</span></span><br><span class="line">	args := fmt.Sprintf(<span class="string">"%s:%s@tcp(%s:%s)/%s?charset=%s&amp;parseTime=true"</span>,</span><br><span class="line">		username,</span><br><span class="line">		passwoed,</span><br><span class="line">		host,</span><br><span class="line">		port,</span><br><span class="line">		database,</span><br><span class="line">		charset)</span><br><span class="line"></span><br><span class="line">	db, err := gorm.Open(driverName, args)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(<span class="string">"failed to connect database,err"</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//åˆ›å»ºæ•°æ®è¡¨</span><br><span class="line">	db.AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> db</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><img src="/2020/04/09/gorm/gorm01.png" alt="gorm01.png"></p>
<p><img src="/2020/04/09/gorm/gorm02.png" alt="gorm02.png"></p>
<p>#</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/30/OpenGL-%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/30/OpenGL-%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">OpenGL-å­¦ä¹ æ•™ç¨‹</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-30 01:14:44" itemprop="dateCreated datePublished" datetime="2020-03-30T01:14:44+08:00">2020-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-09 18:37:13" itemprop="dateModified" datetime="2020-04-09T18:37:13+08:00">2020-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ä¸–ç•Œä¸Šæœ€å¥½çš„OpenGLæ•™ç¨‹ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼š<a href="https://learnopengl-cn.github.io" target="_blank" rel="noopener">LearnOpenGL CN</a></p>
<p>å¥½å¥½åŠªåŠ›ï¼å‹¤å¥‹æ•²ç ï¼</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/28/OpenGL-%E7%9D%80%E8%89%B2%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/28/OpenGL-%E7%9D%80%E8%89%B2%E5%99%A8/" class="post-title-link" itemprop="url">OpenGL-ç€è‰²å™¨</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-28 16:54:55" itemprop="dateCreated datePublished" datetime="2020-03-28T16:54:55+08:00">2020-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-29 23:40:38" itemprop="dateModified" datetime="2020-03-29T23:40:38+08:00">2020-03-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>OpenGLåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šCPUä¸ŠC++ç¼–å†™ï¼ŒGPUé‡‡ç”¨GLSLè¯­è¨€ç¼–å†™ï¼Œåè€…å°±æ˜¯ç€è‰²å™¨çš„ç¼–å†™æ–¹å¼ã€‚</p>
<h1 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h1><table>
<thead>
<tr>
<th align="left">ç±»å‹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">float</td>
<td align="left">ieee 32 ä½æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">ieee 64 ä½æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">æœ‰ç¬¦å·äºŒè¿›åˆ¶è¡¥ç çš„ 32 ä½æ•´æ•°</td>
</tr>
<tr>
<td align="left">uint</td>
<td align="left">æ— ç¬¦å·çš„32ä½æ•´æ•°</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">å¸ƒå°”å€¼</td>
</tr>
</tbody></table>
<h1 id="å˜é‡åˆå§‹åŒ–"><a href="#å˜é‡åˆå§‹åŒ–" class="headerlink" title="å˜é‡åˆå§‹åŒ–"></a>å˜é‡åˆå§‹åŒ–</h1><p>æ‰€æœ‰å˜é‡éƒ½å¿…é¡»åœ¨å£°æ˜çš„åŒæ—¶è¿›è¡Œåˆå§‹åŒ–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int i,nums = 1500;</span><br><span class="line"><span class="built_in">float</span> force,g = -9.8;</span><br><span class="line">bool falling = <span class="literal">true</span>;</span><br><span class="line">double pi = 3.145555LF;</span><br></pre></td></tr></table></figure>

<h1 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h1><p>æ‰€æœ‰å…¶ä»–çš„æ•°å€¼è½¬æ¢éƒ½éœ€è¦æä¾›æ˜¾ç¤ºçš„è½¬æ¢æ„é€ å‡½æ•°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> f = 10.0;</span><br><span class="line">int ten = int(f);</span><br></pre></td></tr></table></figure>


<h1 id="èšåˆç±»å‹"><a href="#èšåˆç±»å‹" class="headerlink" title="èšåˆç±»å‹"></a>èšåˆç±»å‹</h1><p>GLSLçš„å‘é‡ä¸çŸ©é˜µç±»å‹ </p>
<table>
<thead>
<tr>
<th align="left">åŸºæœ¬æ•°æ®ç±»å‹</th>
<th align="left">2Då‘é‡</th>
<th align="left">3Då‘é‡</th>
<th align="left">çŸ©é˜µç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">float</td>
<td align="left">vec2</td>
<td align="left">vec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">dvec2</td>
<td align="left">dvec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">ivec2</td>
<td align="left">ivec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">uint</td>
<td align="left">uvec2</td>
<td align="left">uvec3</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">bvec2</td>
<td align="left">bvec3</td>
<td align="left">-</td>
</tr>
</tbody></table>
<p>ç±»å‹å£°æ˜çš„å˜é‡çš„åˆå§‹åŒ–ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vec3 velocity = vec3(0.0, 2.0, 3.0);</span><br></pre></td></tr></table></figure>


<p>ç±»å‹ä¹‹é—´çš„ç­‰ä»·è½¬æ¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ivec3 steps = ivec3(velocity);</span><br></pre></td></tr></table></figure>


<p>å‘é‡ä¹‹é—´çš„è½¬æ¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡çŸ­</span></span><br><span class="line">vec4 color;</span><br><span class="line">vec3 RGB = vec3(color);//åªå–äº†colorçš„å‰é¢ä¸‰ä¸ªåˆ†é‡Rã€Gã€B</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ é•¿</span></span><br><span class="line">vec3 white = vec3(1.0);//white = (1.0, 1.0, 1.0)</span><br><span class="line"></span><br><span class="line">vec4 translate = vec4(white, 0.5);</span><br></pre></td></tr></table></figure>


<p>æ³¨æ„âš ï¸ï¼šä¼ å…¥çš„æ•°æ®å°†é¦–å…ˆå¡«å……åˆ—ï¼Œå†å¡«å……è¡Œã€‚</p>
<h1 id="è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ "><a href="#è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ " class="headerlink" title="è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ "></a>è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ </h1><p>å‘é‡ä¸­çš„å„ä¸ªåˆ†é‡å¯ä»¥é€šè¿‡åç§°è®¿é—®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> red = color.r;</span><br><span class="line"><span class="built_in">float</span> v_y = velocity.y;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…é€šè¿‡ä¸€ä¸ªä»0å¼€å§‹çš„ç´¢å¼•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> red = color[0];</span><br><span class="line"><span class="built_in">float</span> v_y = velocity[1];</span><br></pre></td></tr></table></figure>

<p>å‘é‡åˆ†é‡çš„è®¿é—®ç¬¦</p>
<table>
<thead>
<tr>
<th align="left">åˆ†é‡è®¿é—®ç¬¦</th>
<th align="left">ç¬¦å·æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">(X,Y,Z,W)</td>
<td align="left">ä¸ä½ç½®ç›¸å…³çš„åˆ†é‡</td>
</tr>
<tr>
<td align="left">(r,g,b,a)</td>
<td align="left">ä¸é¢œè‰²ç›¸å…³çš„åˆ†é‡</td>
</tr>
<tr>
<td align="left">(s,t,p,q)</td>
<td align="left">ä¸çº¹ç†åæ ‡ç›¸å…³çš„åˆ†é‡</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vec3 luminance = color.rrr; <span class="comment"># è¾“å…¥é¢œè‰²çš„çº¢è‰²åˆ†é‡æ¥è®¾ç½®ä¸€ä¸ªäº®åº¦å€¼</span></span><br><span class="line"></span><br><span class="line">color = colot.abgr; <span class="comment"># åè½¬colorçš„æ¯ä¸ªåˆ†é‡</span></span><br></pre></td></tr></table></figure>

<h1 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct Partical &#123;</span><br><span class="line">    <span class="built_in">float</span> lifetime;</span><br><span class="line">    vec3 position;</span><br><span class="line">    vec3 velocity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Partical p = Partical(1.0, pos, vel); <span class="comment"># posã€ velå‡ä¸ºvec3ç±»å‹</span></span><br></pre></td></tr></table></figure>

<h1 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h1><p>æ•°ç»„çš„å£°æ˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> coffee[3];        <span class="comment">#æœ‰ä¸‰ä¸ªfloatå…ƒç´ çš„æ•°ç»„</span></span><br><span class="line"><span class="built_in">float</span>[3]  coffee;       <span class="comment">#åŒä¸Š</span></span><br><span class="line">int indices;            <span class="comment">#ä¸ºå®šä¹‰ç»´æ•°</span></span><br></pre></td></tr></table></figure>

<p>é™æ€åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„çš„å€¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> coffee[3]  = <span class="built_in">float</span>[3](2.00, 3.00, 5.23);</span><br></pre></td></tr></table></figure>
<p>æ“ä½œä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å€¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(int i = 0; i&lt;coffee.length(); i++)&#123;</span><br><span class="line">    coffee[i] *= 2.0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·å–åˆ—æ•°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mat3x4 m;</span><br><span class="line">int c = m.length();         <span class="comment"># måŒ…å«çš„åˆ—æ•°ä¸º3</span></span><br><span class="line">int r = m[0].length();      <span class="comment"># ç¬¬0ä¸ªåˆ—å‘é‡ä¸­åˆ†é‡çš„ä¸ªæ•°ä¸º4</span></span><br></pre></td></tr></table></figure>
<h1 id="å­˜å‚¨é™åˆ¶ç¬¦"><a href="#å­˜å‚¨é™åˆ¶ç¬¦" class="headerlink" title="å­˜å‚¨é™åˆ¶ç¬¦"></a>å­˜å‚¨é™åˆ¶ç¬¦</h1><table>
<thead>
<tr>
<th align="left">ç±»å‹ä¿®é¥°ç¬¦</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">const</td>
<td align="left">å°†ä¸€ä¸ªå˜é‡å®šä¹‰ä¸ºåªè¯»å½¢å¼ã€‚å¦‚æœå®ƒåˆå§‹åŒ–æ—¶ç”¨çš„æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å˜é‡ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«ä¹Ÿä¼šæˆä¸ºç¼–è¯‘æ—¶å¸¸é‡</td>
</tr>
<tr>
<td align="left">in</td>
<td align="left">è®¾ç½®è¿™ä¸ªå˜é‡ä¸ºç€è‰²å™¨é˜¶æ®µçš„è¾“å…¥å˜é‡</td>
</tr>
<tr>
<td align="left">out</td>
<td align="left">è®¾ç½®è¿™ä¸ªå˜é‡ä¸ºç€è‰²å™¨é˜¶æ®µçš„è¾“å‡ºå˜é‡</td>
</tr>
<tr>
<td align="left">uniform</td>
<td align="left">è®¾ç½®è¿™ä¸ªå˜é‡ä¸ºç”¨æˆ·åº”ç”¨ç¨‹åºä¼ é€’ç»™ç€è‰²å™¨çš„æ•°æ®ï¼Œå®ƒå¯¹äºç»™å®šçš„å›¾å…ƒè€Œè¨€æ˜¯ä¸€ä¸ªå¸¸é‡</td>
</tr>
<tr>
<td align="left">buffer</td>
<td align="left">è®¾ç½®åº”ç”¨ç¨‹åºå…±äº«çš„ä¸€å—å¯è¯»å†™çš„å†…å­˜ã€‚è¿™å—å†…å­˜ä¹Ÿä½œä¸ºç€è‰²å™¨ä¸­çš„å­˜å‚¨ç¼“å­˜ä½¿ç”¨</td>
</tr>
<tr>
<td align="left">shared</td>
<td align="left">è®¾ç½®å˜é‡æ˜¯æœ¬åœ°å·¥ä½œç»„ä¸­å…±äº«çš„ã€‚å®ƒåªèƒ½ç”¨äºè®¡ç®—ç€è‰²å™¨ä¸­</td>
</tr>
</tbody></table>
<p>è·å–uniformå˜é‡çš„ç´¢å¼•å¹¶ä¸”è®¾ç½®å…·ä½“å€¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GLint timeLoc;                                      <span class="comment">#ç€è‰²å™¨ä¸­çš„uniformå˜é‡timeçš„ç´¢å¼•</span></span><br><span class="line">GLfloat timeValue;                                  <span class="comment">#ç¨‹åºè¿è¡Œçš„æ—¶é—´</span></span><br><span class="line">timeLoc = glGetUniformLocation(program, <span class="string">"time"</span>)     <span class="comment">#è¿”å›ç€è‰²å™¨ä¸­nuiformå˜é‡timeå¯¹åº”çš„ç´¢å¼•å€¼</span></span><br><span class="line">glUniformlf(timeLoc, timeValue);                    <span class="comment">#è®¾ç½®uniformå˜é‡timeLocçš„å€¼</span></span><br></pre></td></tr></table></figure>

<h1 id="ç®—æœ¯æ“ä½œç¬¦"><a href="#ç®—æœ¯æ“ä½œç¬¦" class="headerlink" title="ç®—æœ¯æ“ä½œç¬¦"></a>ç®—æœ¯æ“ä½œç¬¦</h1><table>
<thead>
<tr>
<th align="left">ä¼˜å…ˆçº§</th>
<th align="left">æ“ä½œç¬¦</th>
<th align="left">å¯ç”¨ç±»å‹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">()</td>
<td align="left">-</td>
<td align="left">æˆç»„çš„æ“ä½œ</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><br>[]<br> <br>f()<br>  <br>.<br> <br>++ã€â€“<br></td>
<td align="left"><br>[æ•°ç»„ã€çŸ©é˜µã€å‘é‡]<br> <br>å‡½æ•°<br>  <br>ç»“æ„ä½“<br> <br>ç®—æœ¯ç±»å‹<br></td>
<td align="left"><br>æ•°ç»„çš„ä¸‹æ ‡<br> <br>å‡½æ•°çš„è°ƒç”¨ã€æ„é€ å‡½æ•°<br>  <br>è®¿é—®ç»“æ„ä½“çš„åŸŸå˜é‡/æ–¹æ³•<br> <br>åç½®é€’å¢/é€’å‡<br></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><br>++ã€â€“<br> <br>+ã€-<br>  <br>~<br> <br>!<br></td>
<td align="left"><br>ç®—æœ¯ç±»å‹<br> <br>ç®—æœ¯ç±»å‹<br>  <br>æ•´å‹<br> <br>å¸ƒå°”å‹<br></td>
<td align="left"><br>å‰ç½®é€’å¢/é€’å‡<br> <br><br>  <br><br> <br><br></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>*ã€/ã€%</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>+ã€-</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><code>&lt;&lt;ã€&gt;&gt;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><code>&lt;ã€&gt;ã€&lt;=ã€&gt;=</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><code>==ã€!=</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><code>&amp;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><code>^</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">`</td>
<td align="left">`</td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><code>&amp;&amp;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><code>^^</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">`</td>
<td align="left"></td>
<td align="left">`</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><code>a?b:c</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><br><code>==</code><br> <br><code>+=ã€-=</code><br>  <br><code>*=ã€/=</code><br> <br><code>%=ã€&lt;&lt;=ã€&gt;&gt;=</code><br> <br>`&amp;=ã€^=ã€</td>
<td align="left">=`<br></td>
<td align="left"><br>ä»»æ„<br> <br>ç®—æœ¯ç±»å‹<br>  <br>ç®—æœ¯ç±»å‹<br>  <br>æ•´å‹<br> <br>æ•´å‹<br></td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><code>,</code></td>
<td align="left">ä»»æ„</td>
<td align="left">æ“ä½œç¬¦åºåˆ—</td>
</tr>
</tbody></table>
<h1 id="æ“ä½œç¬¦é‡è½½"><a href="#æ“ä½œç¬¦é‡è½½" class="headerlink" title="æ“ä½œç¬¦é‡è½½"></a>æ“ä½œç¬¦é‡è½½</h1><h1 id="æµæ§åˆ¶"><a href="#æµæ§åˆ¶" class="headerlink" title="æµæ§åˆ¶"></a>æµæ§åˆ¶</h1><table>
<thead>
<tr>
<th align="left">è¯­å¥</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">break</td>
<td align="left">ç»ˆæ­¢å¾ªç¯ä½“çš„è¿è¡Œï¼Œå¹¶ä¸”ç»§ç»­æ‰§è¡Œå¾ªç¯ä½“å¤–çš„å†…å®¹</td>
</tr>
<tr>
<td align="left">continue</td>
<td align="left">ç»ˆæ­¢å¾ªç¯ä½“å†…å½“å‰è¿­ä»£è¿‡ç¨‹çš„æ‰§è¡Œï¼Œè·³è½¬åˆ°ä»£ç å—å¼€å§‹éƒ¨åˆ†å¹¶ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¬¡è¿­ä»£çš„å†…å®¹</td>
</tr>
<tr>
<td align="left">return</td>
<td align="left">ä»å½“å‰å­ä¾‹ç¨‹è¿”å›ï¼Œå¯ä»¥å¾…ä¼šä¸€ä¸ªå‡½æ•°è¿”å›å€¼</td>
</tr>
<tr>
<td align="left">discard</td>
<td align="left">ä¸¢å¼ƒå½“å‰çš„ç‰‡å…ƒï¼Œç»ˆæ­¢ç€è‰²å™¨çš„æ‰§è¡Œã€‚discardè¯­å¥åªåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­æœ‰æ•ˆ</td>
</tr>
</tbody></table>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> HornerEval(<span class="built_in">float</span> coffee[10], <span class="built_in">float</span> x);</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> HornerEval(<span class="built_in">float</span> coffee[10], <span class="built_in">float</span> x)&#123;</span><br><span class="line">    ...+</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="è®¡ç®—çš„ä¸å˜æ€§"><a href="#è®¡ç®—çš„ä¸å˜æ€§" class="headerlink" title="è®¡ç®—çš„ä¸å˜æ€§"></a>è®¡ç®—çš„ä¸å˜æ€§</h1><p>GLSLæ— æ³•ä¿è¯åœ¨ä¸åŒçš„ç€è‰²å™¨ä¸­ï¼Œä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„è®¡ç®—å¼ä¼šå¾—åˆ°å®Œå…¨ä¸€æ ·çš„ç»“æœã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç”¨åˆ°<code>invariant</code>æˆ–è€…<code>precise</code>å…³é”®å­—ã€‚</p>
<h2 id="invariant"><a href="#invariant" class="headerlink" title="invariant"></a>invariant</h2><p>å°†ä¸€ä¸ªå†…ç½®çš„è¾“å‡ºå˜é‡å£°æ˜ä¸º<code>invariant</code>ï¼Œä¹Ÿå¯ä»¥å£°æ˜ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ä¸º<code>invariant</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">invariant gl_Position;</span><br><span class="line">invariant centroid out vec3 Color</span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦å°†ç€è‰²å™¨ä¸­çš„æ‰€æœ‰å¯å˜é‡éƒ½è®¾ç½®ä¸º<code>invariant</code>ã€‚å¯ä»¥é€šè¿‡é¡¶ç‚¹ç€è‰²å™¨çš„é¢„ç¼–è¯‘å‘½ä»¤<code>pragma</code>æ¥å®Œæˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma STDGL invariant(all)</span></span><br></pre></td></tr></table></figure>

<h2 id="precise"><a href="#precise" class="headerlink" title="precise"></a>precise</h2><p><code>precise</code>é™åˆ¶ç¬¦å¯ä»¥è®¾ç½®ä»»ä½•è®¡ç®—ä¸­çš„å˜é‡æˆ–è€…å‡½æ•°çš„è¿”å›å€¼ã€‚å®ƒçš„ä½œç”¨æ˜¯å¢åŠ è®¡ç®—çš„å¯å¤ç”¨æ€§</p>
<h1 id="ç€è‰²å™¨çš„é¢„å¤„ç†å™¨"><a href="#ç€è‰²å™¨çš„é¢„å¤„ç†å™¨" class="headerlink" title="ç€è‰²å™¨çš„é¢„å¤„ç†å™¨"></a>ç€è‰²å™¨çš„é¢„å¤„ç†å™¨</h1><h2 id="é¢„å¤„ç†å‘½ä»¤"><a href="#é¢„å¤„ç†å‘½ä»¤" class="headerlink" title="é¢„å¤„ç†å‘½ä»¤"></a>é¢„å¤„ç†å‘½ä»¤</h2><p>æ§åˆ¶å¸¸é‡ä¸å®çš„å®šä¹‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define</span></span><br><span class="line"><span class="comment">#undef</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">ä»£ç çš„æ¡ä»¶ç¼–è¯‘</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="comment">#if</span></span><br><span class="line"><span class="comment">#ifdef</span></span><br><span class="line"><span class="comment">#ifndef</span></span><br><span class="line"><span class="comment">#else</span></span><br><span class="line"><span class="comment">#elif</span></span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure>

<p>å¼ºåˆ¶æ¯”é‚£ä¸€èµ·å°†textæ–‡å­—å†…å®¹æ’å…¥åˆ°ç€è‰²å™¨çš„ä¿¡æ¯æ—¥å¿—ä¸­</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#error text</span></span><br></pre></td></tr></table></figure>



<p>æ§åˆ¶ç¼–è¯‘å™¨çš„é€‰é¡¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma options</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç¼–è¯‘å™¨æ”¯æŒç‰¹å®šGLSLæ‰©å±•åŠŸèƒ½</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#extension options</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®å½“å‰ä½¿ç”¨çš„GLSLç‰ˆæœ¬åç§°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#version number</span></span><br></pre></td></tr></table></figure>


<p>è®¾ç½®è¯Šæ–­è¡Œå·</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#line options</span></span><br></pre></td></tr></table></figure>

<h2 id="å®å®šä¹‰"><a href="#å®å®šä¹‰" class="headerlink" title="å®å®šä¹‰"></a>å®å®šä¹‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define NUM_ELEMENTS 10</span></span><br></pre></td></tr></table></figure>

<p>å–æ¶ˆä¹‹å‰å®šä¹‰è¿‡çš„å®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#undef LPos</span></span><br></pre></td></tr></table></figure>


<h1 id="æ•°æ®å¿«æ¥å£"><a href="#æ•°æ®å¿«æ¥å£" class="headerlink" title="æ•°æ®å¿«æ¥å£"></a>æ•°æ®å¿«æ¥å£</h1><p>ç€è‰²å™¨ä¸åº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–è€…ç€è‰²å™¨ä¸ªé˜¶æ®µä¹‹é—´å…±äº«çš„å˜é‡å¯ä»¥ç»„ç»‡ä¸ºå˜é‡å—çš„å½¢å¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uniform b &#123;     //é™å®šç¬¦å¯ä»¥ä¸ºï¼šuniformã€<span class="keyword">in</span>ã€outã€buffer</span><br><span class="line">    vec4 v1;    //å—ä¸­çš„å˜é‡åˆ—è¡¨</span><br><span class="line">    vec1 v2;    //</span><br><span class="line">&#125;;              //è®¿é—®åŒ¿åå—æˆå‘˜æ—¶ä½¿ç”¨v1ã€v2</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uniform b &#123;     //</span><br><span class="line">    vec4 v1;    //</span><br><span class="line">    vec1 v2;    //</span><br><span class="line">&#125;name;          ////è®¿é—®åŒ¿åå—æˆå‘˜æ—¶ä½¿ç”¨name.v1ã€name.v2</span><br></pre></td></tr></table></figure>

<h1 id="ç€è‰²å™¨çš„ç¼–è¯‘"><a href="#ç€è‰²å™¨çš„ç¼–è¯‘" class="headerlink" title="ç€è‰²å™¨çš„ç¼–è¯‘"></a>ç€è‰²å™¨çš„ç¼–è¯‘</h1><p>åˆ›å»ºç€è‰²å™¨å¯¹è±¡ä¸”é€šè¿‡é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œç€è‰²å™¨ç¨‹åºçš„æµç¨‹ï¼šï¼ˆä¸¤éƒ¨åˆ†ï¼‰</p>
<p>ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰å¯¹äºæ¯ä¸ªç€è‰²å™¨éƒ½ä¼šï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç€è‰²å™¨å¯¹è±¡ã€‚</li>
<li>å°†ç€è‰²å™¨æºä»£ç ç¼–è¯‘ä¸ºå¯¹è±¡ã€‚</li>
<li>éªŒè¯ç€è‰²å™¨çš„æ¯”é‚£ä¸€æ˜¯å¦æˆåŠŸã€‚</li>
</ul>
<p>ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰å°†å¤šä¸ªç€è‰²å™¨å¯¹è±¡é“¾æ¥ä¸ºä¸€ä¸ªç€è‰²å™¨ç¨‹åºï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç€è‰²å™¨ç¨‹åºã€‚</li>
<li>å°†ç€è‰²å™¨å¯¹è±¡å…³è”åˆ°ç€è‰²å™¨ç¨‹åºã€‚</li>
<li>é“¾æ¥ç€è‰²å™¨ç¨‹åºã€‚</li>
<li>åˆ¤æ–­ç€è‰²å™¨çš„é“¾æ¥è¿‡ç¨‹æ˜¯å¦æˆåŠŸå®Œæˆã€‚</li>
<li>ä½¿ç”¨ç€è‰²å™¨æ¥å¤„ç†é¡¶ç‚¹å’Œç‰‡å…ƒã€‚</li>
</ul>
<h1 id="ç€è‰²å™¨å­ç¨‹åº"><a href="#ç€è‰²å™¨å­ç¨‹åº" class="headerlink" title="ç€è‰²å™¨å­ç¨‹åº"></a>ç€è‰²å™¨å­ç¨‹åº</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//ç¬¬ä¸€æ­¥</span><br><span class="line">subroutine vec4 LightFunc(vec4);</span><br><span class="line"></span><br><span class="line">//ç¬¬äºŒæ­¥</span><br><span class="line">subroutine (LightFunc) vec4 ambient(vec3 n) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> Materials.ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subroutine (LightFunc) vec4 diffuse(vec3 n)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> Materials.diffuse * max(dot (normalize(n), LightVec.xyz), 0.0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç¬¬ä¸‰æ­¥</span><br><span class="line">subroutine uniform LightFunc materialShader;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sam">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samtake">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/" class="post-title-link" itemprop="url">OpenGLï¼ˆä¸‰ï¼‰</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-28 14:27:25 / Modified: 16:42:05" itemprop="dateCreated datePublished" datetime="2020-03-28T14:27:25+08:00">2020-03-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index">
                    <span itemprop="name">OpenGL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ä»è¿™ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å°±è·Ÿç€è¯¾æœ¬æºç è¾¹è°ƒè¯•è¾¹ç†Ÿæ‚‰OpenGLå‡½æ•°çš„ä½¿ç”¨äº†ã€‚é‡Œé¢æ¶‰åŠçš„C++è¯­æ³•åé¢ä¼šåœ¨ã€ŠC++é‡æ¸©ã€‹è¿™é‡Œä½œè¡¥å……ã€‚æ‹¿åˆ°è¯¾æœ¬æºç ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡Cmakeç¼–è¯‘å‡ºMacä¸Šè¿è¡Œçš„Xcodeç¨‹åºã€‚</p>
<blockquote>
<p>01-keypress.cpp</p>
</blockquote>
<h1 id="ç¨‹åºæ¦‚æ‹¬"><a href="#ç¨‹åºæ¦‚æ‹¬" class="headerlink" title="ç¨‹åºæ¦‚æ‹¬"></a>ç¨‹åºæ¦‚æ‹¬</h1><p>ç¨‹åºå…ˆæ‰§è¡Œinitå‡½æ•°<code>void KeyPressExample::Initialize(const char * title)</code>å†æ‰§è¡Œdisplayå‡½æ•°<code>void KeyPressExample::Display(bool auto_redraw)</code>.</p>
<p>æŒ‰ä¸‹é”®ç›˜ä¼šè°ƒç”¨<code>void KeyPressExample::OnKey(int key, int scancode, int action, int mods)</code></p>
<p>ç¨‹åºçª—å£ç¼©æ”¾<code>void KeyPressExample::Resize(int width, int height)</code></p>
<h1 id="initå‡½æ•°è¯´æ˜"><a href="#initå‡½æ•°è¯´æ˜" class="headerlink" title="initå‡½æ•°è¯´æ˜"></a>initå‡½æ•°è¯´æ˜</h1><p><code>glGenVertexArrays( NumVAOs, VAOs );</code><br>åˆ†é…NumVAOsä¸ªæœªä½¿ç”¨çš„å¯¹è±¡ååˆ°æ•°ç»„VAOsä¸­ï¼Œç”¨ä½œé¡¶ç‚¹æ•°ç»„å¯¹è±¡ã€‚å†çœ‹ä¸‹å…¶æ•°ç»„å®šä¹‰ï¼šGLuint  VAOs[NumVAOs];</p>
<p><code>glBindVertexArray( VAOs[Triangles] );</code><br>VAOs[Triangles]</p>
<ul>
<li>è¾“å…¥çš„å˜é‡arrayé0ï¼Œä¸”ä¸º<code>glGenVertexArrays</code>æ‰€åˆ†é…æ—¶ï¼Œæ¿€æ´»é¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¹¶ç›´æ¥å½±å“å¯¹è±¡ä¸­æ‰€ä¿å­˜çš„é¡¶ç‚¹æ•°ç»„çŠ¶æ€ã€‚</li>
<li>arrayä¸º0ï¼ŒOpenGLä¸å†ä½¿ç”¨ä¹‹å‰ç»‘å®šçš„é¡¶ç‚¹æ•°ç»„ã€‚</li>
<li>arrayä¸æ˜¯<code>glGenVertexArrays</code>æ‰€åˆ†é…çš„ï¼Œæˆ–è€…å®ƒå·²ç»è¢«<code>glDeleteVertexArray</code>å‡½æ•°é‡Šæ”¾äº†ï¼Œè¿™æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªæ— æ•ˆé”™è¯¯ã€‚</li>
</ul>
<p><code>glGenBuffers( NumBuffers, Buffers );</code><br>åˆ†é…NumBuffersä¸ªå½“å‰æœªä½¿ç”¨çš„ç¼“å­˜å¯¹è±¡åç§°ï¼Œå¹¶ä¿å­˜åˆ°Buffersæ•°ç»„ä¸­ã€‚</p>
<p><code>glBindBuffer( GL_ARRAY_BUFFER, Buffers[ArrayBuffer] );</code></p>
<ul>
<li>å¦‚æœç»‘å®šåˆ°ä¸€ä¸ªå·²ç»åˆ›å»ºçš„ç¼“å­˜å¯¹è±¡ï¼Œé‚£ä¹ˆä»–å°†æˆä¸ºå½“å‰GL_ARRAY_BUFFERä¸­è¢«æ¿€æ´»çš„ç¼“å­˜å¯¹è±¡ã€‚</li>
<li>å¦‚æœç»‘å®šçš„Buffers[ArrayBuffer]å€¼ä¸º0ï¼Œé‚£ä¹ˆOpenGLå°†ä¸å†å¯¹å½“å‰GL_ARRAY_BUFFERä½¿ç”¨ä»»ä½•ç¼“å­˜å¯¹è±¡ã€‚</li>
</ul>
<p><code>glBufferData( GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW );</code><br>å°†æ•°æ®è½½å…¥ç¼“å­˜å¯¹è±¡ã€‚</p>
<p><code>glVertexAttribPointer( vPosition, 2, GL_FLOAT, GL_FALSE, 0, BUFFER_OFFSET(0) );</code><br>å°†è¾“å…¥é¡¶ç‚¹ç€è‰²å™¨çš„æ•°æ® å…³è”åˆ° ä¸€ä¸ªé¡¶ç‚¹å±æ€§çš„æ•°ç»„ã€‚</p>
<p><code>glEnableVertexAttribArray( vPosition );</code><br>å¯ç”¨é¡¶ç‚¹å±æ€§æ•°ç»„ã€‚</p>
<h1 id="displayå‡½æ•°è¯´æ˜"><a href="#displayå‡½æ•°è¯´æ˜" class="headerlink" title="displayå‡½æ•°è¯´æ˜"></a>displayå‡½æ•°è¯´æ˜</h1><p><code>glClear( GL_COLOR_BUFFER_BIT );</code><br>æ¸…å±ã€‚</p>
<p><code>glBindVertexArray( VAOs[Triangles] );</code></p>
<p><code>glDrawArrays( GL_TRIANGLES, 0, NumVertices );</code><br>å¼€å§‹ç»˜åˆ¶ã€‚</p>
<h1 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h1><p>ç¨‹åºé»˜è®¤æ•ˆæœ<br><img src="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/keypress1.png" alt="keypress1.png"></p>
<p>æŒ‰ä¸‹é”®ç›˜å­—æ¯Mçš„æ•ˆæœ<br><img src="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/keypress2.png" alt="keypress2.png"></p>
<h1 id="è¯¦ç»†æºç "><a href="#è¯¦ç»†æºç " class="headerlink" title="è¯¦ç»†æºç "></a>è¯¦ç»†æºç </h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">//////////////////////////////////////////////////////////////////////////////</span><br><span class="line">//</span><br><span class="line">//  Triangles.cpp</span><br><span class="line">//</span><br><span class="line">//////////////////////////////////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;vermilion.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include "vgl.h"</span></span><br><span class="line"><span class="comment">#include "vapp.h"</span></span><br><span class="line"><span class="comment">#include "LoadShaders.h"</span></span><br><span class="line"></span><br><span class="line">enum VAO_IDs &#123; Triangles, NumVAOs &#125;;</span><br><span class="line">enum Buffer_IDs &#123; ArrayBuffer, NumBuffers &#125;;</span><br><span class="line">enum Attrib_IDs &#123; vPosition = 0 &#125;;</span><br><span class="line"></span><br><span class="line">GLuint  VAOs[NumVAOs];</span><br><span class="line">GLuint  Buffers[NumBuffers];</span><br><span class="line"></span><br><span class="line">const GLuint  NumVertices = 6;</span><br><span class="line"></span><br><span class="line">BEGIN_APP_DECLARATION(KeyPressExample)</span><br><span class="line">    virtual void Initialize(const char * title);</span><br><span class="line">    virtual void Display(bool auto_redraw);</span><br><span class="line">    virtual void Finalize(void);</span><br><span class="line">    virtual void Resize(int width, int height);</span><br><span class="line">    void OnKey(int key, int scancode, int action, int mods);</span><br><span class="line">END_APP_DECLARATION()</span><br><span class="line"></span><br><span class="line">DEFINE_APP(KeyPressExample, <span class="string">"Key Press Example"</span>)</span><br><span class="line">//----------------------------------------------------------------------------</span><br><span class="line">//</span><br><span class="line">// init</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Initialize(const char * title)</span><br><span class="line">&#123;</span><br><span class="line">    //typedef class VermilionApplication base</span><br><span class="line">    base::Initialize(title);</span><br><span class="line"></span><br><span class="line">    glGenVertexArrays( NumVAOs, VAOs );</span><br><span class="line">    glBindVertexArray( VAOs[Triangles] );</span><br><span class="line"></span><br><span class="line">    GLfloat  vertices[NumVertices][2] = &#123;</span><br><span class="line">        &#123; -0.90f, -0.90f &#125;, &#123;  0.85f, -0.90f &#125;, &#123; -0.90f,  0.85f &#125;,  // Triangle 1</span><br><span class="line">        &#123;  0.90f, -0.85f &#125;, &#123;  0.90f,  0.90f &#125;, &#123; -0.85f,  0.90f &#125;   // Triangle 2</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    glGenBuffers( NumBuffers, Buffers );</span><br><span class="line">    glBindBuffer( GL_ARRAY_BUFFER, Buffers[ArrayBuffer] );</span><br><span class="line">    glBufferData( GL_ARRAY_BUFFER, sizeof(vertices),</span><br><span class="line">                  vertices, GL_STATIC_DRAW );</span><br><span class="line"></span><br><span class="line">    ShaderInfo  shaders[] = &#123;</span><br><span class="line">        &#123; GL_VERTEX_SHADER, <span class="string">"../media/shaders/keypress/keypress.vert"</span> &#125;,</span><br><span class="line">        &#123; GL_FRAGMENT_SHADER, <span class="string">"../media/shaders/keypress/keypress.frag"</span> &#125;,</span><br><span class="line">        &#123; GL_NONE, NULL &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    GLuint program = LoadShaders( shaders );</span><br><span class="line">    glUseProgram( program );</span><br><span class="line"></span><br><span class="line">    glVertexAttribPointer( vPosition, 2, GL_FLOAT,</span><br><span class="line">                           GL_FALSE, 0, BUFFER_OFFSET(0) );</span><br><span class="line">    glEnableVertexAttribArray( vPosition );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::OnKey(int key, int scancode, int action, int mods)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (action == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        switch (key)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> GLFW_KEY_M:</span><br><span class="line">                &#123;</span><br><span class="line">                    static GLenum  mode = GL_FILL;</span><br><span class="line"></span><br><span class="line">                    mode = ( mode == GL_FILL ? GL_LINE : GL_FILL );</span><br><span class="line">                    glPolygonMode( GL_FRONT_AND_BACK, mode );</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    base::OnKey(key, scancode, action, mods);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//----------------------------------------------------------------------------</span><br><span class="line">//</span><br><span class="line">// display</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Display(bool auto_redraw)</span><br><span class="line">&#123;</span><br><span class="line">    glClear( GL_COLOR_BUFFER_BIT );</span><br><span class="line"></span><br><span class="line">    glBindVertexArray( VAOs[Triangles] );</span><br><span class="line">    // GL_TRIANGLESå¹¶æ²¡æœ‰æŒ‡å®šæ˜¯ç”»ä¸‰è§’å½¢çš„è¾¹æ²¿è¿˜æ˜¯å†…éƒ¨ä¹Ÿç”»ï¼Œ</span><br><span class="line">    glDrawArrays( GL_TRIANGLES, 0, NumVertices );</span><br><span class="line"></span><br><span class="line">    base::Display(auto_redraw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Resize(int width, int height)</span><br><span class="line">&#123;</span><br><span class="line">    glViewport(0, 0, width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Finalize(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Sam"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Sam</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/samtake" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;samtake" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:943430195@qq.com" title="E-Mail &amp;rarr; mailto:943430195@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sam</span>
</div>
  <div class="theme-info">Theme â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.3
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

</body>
</html>
