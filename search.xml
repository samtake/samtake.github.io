<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>jwt-go</title>
    <url>/2020/04/09/jwt-go/</url>
    <content><![CDATA[<p><a href="https://github.com/dgrijalva/jwt-go" target="_blank" rel="noopener">github</a></p>
<p><a href="https://godoc.org/github.com/dgrijalva/jwt-go" target="_blank" rel="noopener">Documentation</a></p>
<p>å¼•å…¥åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get <span class="string">"github.com/dgrijalva/jwt-go"</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package common</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"gin_vue_bs/model"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/dgrijalva/jwt-go"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//å®šä¹‰ jwt åŠ å¯†å¯†é’¥</span><br><span class="line">var jwtKey = []byte(<span class="string">"a_secret_crect"</span>)</span><br><span class="line"></span><br><span class="line">//Claims .</span><br><span class="line"><span class="built_in">type</span> Claims struct &#123;</span><br><span class="line">	UserID uint</span><br><span class="line">	jwt.StandardClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ReleaseToken ç™»å½•æˆåŠŸåˆ™è°ƒç”¨è¯¥æ–¹æ³•å‘æ”¾token.</span><br><span class="line">func ReleaseToken(user model.User) (string, error) &#123;</span><br><span class="line">	expirationTime := time.Now().Add(7 * 24 * time.Hour) //tokençš„è¿‡æœŸæ—¶é—´7å¤©</span><br><span class="line">	claims := &amp;Claims&#123;</span><br><span class="line">		UserID: user.ID,</span><br><span class="line">		StandardClaims: jwt.StandardClaims&#123;</span><br><span class="line">			ExpiresAt: expirationTime.Unix(),</span><br><span class="line">			IssuedAt:  time.Now().Unix(), //tokenå‘æ”¾æ—¶é—´</span><br><span class="line">			Issuer:    <span class="string">"samtake"</span>,         //æ˜¯è°å‘æ”¾çš„token</span><br><span class="line">			Subject:   <span class="string">"user token"</span>,      //ä¸»é¢˜</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)</span><br><span class="line">	tokenString, err := token.SignedString(jwtKey)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="string">""</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> tokenString, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"code"</span>: <span class="string">"200"</span>,</span><br><span class="line">    <span class="string">"data"</span>: &#123;</span><br><span class="line">        <span class="string">"token"</span>: <span class="string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjMsImV4cCI6MTU4NzA1MjA0MiwiaWF0IjoxNTg2NDQ3MjQyLCJpc3MiOiJzYW10YWtlIiwic3ViIjoidXNlciB0b2tlbiJ9.6a50w6SfsQH7XZBW7zu3_FEGFcrWHRAh2DFYTh9hbCo"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"ç™»å½•æˆåŠŸ"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>æ‰€è¿”å›çš„tokenç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šåè®®å¤´ï¼ˆtokençš„åŠ å¯†åè®®ï¼‰ã€ æºç claimså‚¨å­˜çš„ä¿¡æ¯ ã€ï¼ˆå‰é¢ä¸¤éƒ¨åˆ†+jwtKeyï¼‰çš„å“ˆå¸Œå€¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  blogs <span class="built_in">echo</span> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9  | base64 -D                                                                                                                                                         </span><br><span class="line">&#123;<span class="string">"alg"</span>:<span class="string">"HS256"</span>,<span class="string">"typ"</span>:<span class="string">"JWT"</span>&#125;%</span><br><span class="line">âœ  blogs <span class="built_in">echo</span> eyJVc2VySUQiOjMsImV4cCI6MTU4NzA1MjA0MiwiaWF0IjoxNTg2NDQ3MjQyLCJpc3MiOiJzYW10YWtlIiwic3ViIjoidXNlciB0b2tlbiJ9 | base64 -D     </span><br><span class="line">&#123;<span class="string">"UserID"</span>:3,<span class="string">"exp"</span>:1587052042,<span class="string">"iat"</span>:1586447242,<span class="string">"iss"</span>:<span class="string">"samtake"</span>,<span class="string">"sub"</span>:<span class="string">"user token"</span>&#125;%</span><br><span class="line">âœ  blogs <span class="built_in">echo</span> 6a50w6SfsQH7XZBW7zu3_FEGFcrWHRAh2DFYTh9hbCo  | base64 -D     </span><br><span class="line">?tÃ¤???]?V?;??Q??!?1XNa%</span><br><span class="line">âœ  blogs</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>gorm</title>
    <url>/2020/04/09/gorm/</url>
    <content><![CDATA[<p><a href="https://gorm.io" target="_blank" rel="noopener">https://gorm.io</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/e421083458/gorm"</span> //https://gorm.io</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> User struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name      string `gorm:<span class="string">"type:varchar(20);not null"</span>`</span><br><span class="line">	Telephone string `gorm:<span class="string">"varchar(110;not null;unique"</span>`</span><br><span class="line">	Password  string `gorm:<span class="string">"size:255;not null"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">	db := InitDb()</span><br><span class="line">	defer db.Close()</span><br><span class="line"></span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line">	r.POST(<span class="string">"/api/auth/register"</span>, func(ctx *gin.Context) &#123;</span><br><span class="line">		//è·å–å‚æ•°</span><br><span class="line">		name := ctx.PostForm(<span class="string">"name"</span>)</span><br><span class="line">		telephone := ctx.PostForm(<span class="string">"telephone"</span>)</span><br><span class="line">		password := ctx.PostForm(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">		//éªŒè¯æ•°æ®</span><br><span class="line">		<span class="keyword">if</span> len(telephone) != 11 &#123;</span><br><span class="line">			ctx.JSON(http.StatusServiceUnavailable,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"æ‰‹æœºå·å¿…é¡»ä¸º11ä¸º"</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> len(password) &lt; 6 &#123;</span><br><span class="line">			ctx.JSON(http.StatusUnprocessableEntity,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"å¯†ç ä¸èƒ½å°‘äº6ä½"</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//åç§°å¦‚æœæ²¡æœ‰ä¼ ï¼Œåˆ™è¿”å›éšæœºå­—ç¬¦ä¸²</span><br><span class="line">		<span class="keyword">if</span> len(name) == 0 &#123;</span><br><span class="line">			name = RandomString(10)</span><br><span class="line">		&#125;</span><br><span class="line">		//åˆ¤æ–­æ‰‹æœºå·æ˜¯å¦å­˜åœ¨</span><br><span class="line">		<span class="keyword">if</span> isTelephoneExist(db, telephone) &#123;</span><br><span class="line">			ctx.JSON(http.StatusUnprocessableEntity,</span><br><span class="line">				gin.H&#123;<span class="string">"code"</span>: 422, <span class="string">"msg"</span>: <span class="string">"ç”¨æˆ·å·²ç»å­˜åœ¨"</span>&#125;)</span><br><span class="line">			<span class="built_in">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//åˆ›å»ºç”¨æˆ·</span><br><span class="line">		newUser := User&#123;</span><br><span class="line">			Name:      name,</span><br><span class="line">			Telephone: telephone,</span><br><span class="line">			Password:  password,</span><br><span class="line">		&#125;</span><br><span class="line">		db.Create(&amp;newUser)</span><br><span class="line"></span><br><span class="line">		//è¿”å›ç»“æœ</span><br><span class="line">		ctx.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"msg"</span>: <span class="string">"æ³¨å†ŒæˆåŠŸ"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	panic(r.Run(<span class="string">":8099"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func isTelephoneExist(db *gorm.DB, telephone string) bool &#123;</span><br><span class="line">	var user User</span><br><span class="line">	db.Where(<span class="string">"telephone = ?"</span>, telephone).First(&amp;user)</span><br><span class="line">	<span class="keyword">if</span> user.ID != 0 &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è¿”å›éšæœºå­—ç¬¦ä¸²</span><br><span class="line">func RandomString(n int) string &#123;</span><br><span class="line">	var letters = []byte(<span class="string">"iasdhjklfhascvxnjklasdfhjkasdfklasdfhnjklasdfjklasdfjklfasdsdfjk"</span>)</span><br><span class="line">	result := make([]byte, n)</span><br><span class="line"></span><br><span class="line">	rand.Seed(time.Now().Unix())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := range result &#123;</span><br><span class="line">		result[i] = letters[rand.Intn(len(letters))]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> string(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func InitDb() *gorm.DB &#123;</span><br><span class="line">	driverName := <span class="string">"mysql"</span></span><br><span class="line">	host := <span class="string">"127.0.0.1"</span></span><br><span class="line">	port := <span class="string">"3306"</span></span><br><span class="line">	database := <span class="string">"gin_vue_bs"</span></span><br><span class="line">	username := <span class="string">"root"</span></span><br><span class="line">	passwoed := <span class="string">"123456"</span></span><br><span class="line">	charset := <span class="string">"utf8"</span></span><br><span class="line">	args := fmt.Sprintf(<span class="string">"%s:%s@tcp(%s:%s)/%s?charset=%s&amp;parseTime=true"</span>,</span><br><span class="line">		username,</span><br><span class="line">		passwoed,</span><br><span class="line">		host,</span><br><span class="line">		port,</span><br><span class="line">		database,</span><br><span class="line">		charset)</span><br><span class="line"></span><br><span class="line">	db, err := gorm.Open(driverName, args)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(<span class="string">"failed to connect database,err"</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//åˆ›å»ºæ•°æ®è¡¨</span><br><span class="line">	db.AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> db</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><img src="/2020/04/09/gorm/gorm01.png" alt="gorm01.png"></p>
<p><img src="/2020/04/09/gorm/gorm02.png" alt="gorm02.png"></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenGL-å­¦ä¹ æ•™ç¨‹</title>
    <url>/2020/03/30/OpenGL-%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>ä¸–ç•Œä¸Šæœ€å¥½çš„OpenGLæ•™ç¨‹ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼š<a href="https://learnopengl-cn.github.io" target="_blank" rel="noopener">LearnOpenGL CN</a></p>
<p>å¥½å¥½åŠªåŠ›ï¼å‹¤å¥‹æ•²ç ï¼</p>
]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>OpenGL</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenGL-ç€è‰²å™¨</title>
    <url>/2020/03/28/OpenGL-%E7%9D%80%E8%89%B2%E5%99%A8/</url>
    <content><![CDATA[<p>OpenGLåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šCPUä¸ŠC++ç¼–å†™ï¼ŒGPUé‡‡ç”¨GLSLè¯­è¨€ç¼–å†™ï¼Œåè€…å°±æ˜¯ç€è‰²å™¨çš„ç¼–å†™æ–¹å¼ã€‚</p>
<h1 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h1><table>
<thead>
<tr>
<th align="left">ç±»å‹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">float</td>
<td align="left">ieee 32 ä½æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">ieee 64 ä½æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">æœ‰ç¬¦å·äºŒè¿›åˆ¶è¡¥ç çš„ 32 ä½æ•´æ•°</td>
</tr>
<tr>
<td align="left">uint</td>
<td align="left">æ— ç¬¦å·çš„32ä½æ•´æ•°</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">å¸ƒå°”å€¼</td>
</tr>
</tbody></table>
<h1 id="å˜é‡åˆå§‹åŒ–"><a href="#å˜é‡åˆå§‹åŒ–" class="headerlink" title="å˜é‡åˆå§‹åŒ–"></a>å˜é‡åˆå§‹åŒ–</h1><p>æ‰€æœ‰å˜é‡éƒ½å¿…é¡»åœ¨å£°æ˜çš„åŒæ—¶è¿›è¡Œåˆå§‹åŒ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int i,nums = 1500;</span><br><span class="line"><span class="built_in">float</span> force,g = -9.8;</span><br><span class="line">bool falling = <span class="literal">true</span>;</span><br><span class="line">double pi = 3.145555LF;</span><br></pre></td></tr></table></figure>

<h1 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h1><p>æ‰€æœ‰å…¶ä»–çš„æ•°å€¼è½¬æ¢éƒ½éœ€è¦æä¾›æ˜¾ç¤ºçš„è½¬æ¢æ„é€ å‡½æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">float</span> f = 10.0;</span><br><span class="line">int ten = int(f);</span><br></pre></td></tr></table></figure>


<h1 id="èšåˆç±»å‹"><a href="#èšåˆç±»å‹" class="headerlink" title="èšåˆç±»å‹"></a>èšåˆç±»å‹</h1><p>GLSLçš„å‘é‡ä¸çŸ©é˜µç±»å‹ </p>
<table>
<thead>
<tr>
<th align="left">åŸºæœ¬æ•°æ®ç±»å‹</th>
<th align="left">2Då‘é‡</th>
<th align="left">3Då‘é‡</th>
<th align="left">çŸ©é˜µç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">float</td>
<td align="left">vec2</td>
<td align="left">vec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">dvec2</td>
<td align="left">dvec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">ivec2</td>
<td align="left">ivec3</td>
<td align="left">..</td>
</tr>
<tr>
<td align="left">uint</td>
<td align="left">uvec2</td>
<td align="left">uvec3</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">bvec2</td>
<td align="left">bvec3</td>
<td align="left">-</td>
</tr>
</tbody></table>
<p>ç±»å‹å£°æ˜çš„å˜é‡çš„åˆå§‹åŒ–ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vec3 velocity = vec3(0.0, 2.0, 3.0);</span><br></pre></td></tr></table></figure>


<p>ç±»å‹ä¹‹é—´çš„ç­‰ä»·è½¬æ¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ivec3 steps = ivec3(velocity);</span><br></pre></td></tr></table></figure>


<p>å‘é‡ä¹‹é—´çš„è½¬æ¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡çŸ­</span></span><br><span class="line">vec4 color;</span><br><span class="line">vec3 RGB = vec3(color);//åªå–äº†colorçš„å‰é¢ä¸‰ä¸ªåˆ†é‡Rã€Gã€B</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ é•¿</span></span><br><span class="line">vec3 white = vec3(1.0);//white = (1.0, 1.0, 1.0)</span><br><span class="line"></span><br><span class="line">vec4 translate = vec4(white, 0.5);</span><br></pre></td></tr></table></figure>


<p>æ³¨æ„âš ï¸ï¼šä¼ å…¥çš„æ•°æ®å°†é¦–å…ˆå¡«å……åˆ—ï¼Œå†å¡«å……è¡Œã€‚</p>
<h1 id="è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ "><a href="#è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ " class="headerlink" title="è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ "></a>è®¿é—®å‘é‡å’ŒçŸ©é˜µä¸­çš„å…ƒç´ </h1><p>å‘é‡ä¸­çš„å„ä¸ªåˆ†é‡å¯ä»¥é€šè¿‡åç§°è®¿é—®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">float</span> red = color.r;</span><br><span class="line"><span class="built_in">float</span> v_y = velocity.y;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…é€šè¿‡ä¸€ä¸ªä»0å¼€å§‹çš„ç´¢å¼•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">float</span> red = color[0];</span><br><span class="line"><span class="built_in">float</span> v_y = velocity[1];</span><br></pre></td></tr></table></figure>

<p>å‘é‡åˆ†é‡çš„è®¿é—®ç¬¦</p>
<table>
<thead>
<tr>
<th align="left">åˆ†é‡è®¿é—®ç¬¦</th>
<th align="left">ç¬¦å·æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">(X,Y,Z,W)</td>
<td align="left">ä¸ä½ç½®ç›¸å…³çš„åˆ†é‡</td>
</tr>
<tr>
<td align="left">(r,g,b,a)</td>
<td align="left">ä¸é¢œè‰²ç›¸å…³çš„åˆ†é‡</td>
</tr>
<tr>
<td align="left">(s,t,p,q)</td>
<td align="left">ä¸çº¹ç†åæ ‡ç›¸å…³çš„åˆ†é‡</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vec3 luminance = color.rrr; <span class="comment"># è¾“å…¥é¢œè‰²çš„çº¢è‰²åˆ†é‡æ¥è®¾ç½®ä¸€ä¸ªäº®åº¦å€¼</span></span><br><span class="line"></span><br><span class="line">color = colot.abgr; <span class="comment"># åè½¬colorçš„æ¯ä¸ªåˆ†é‡</span></span><br></pre></td></tr></table></figure>

<h1 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">struct Partical &#123;</span><br><span class="line">    <span class="built_in">float</span> lifetime;</span><br><span class="line">    vec3 position;</span><br><span class="line">    vec3 velocity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Partical p = Partical(1.0, pos, vel); <span class="comment"># posã€ velå‡ä¸ºvec3ç±»å‹</span></span><br></pre></td></tr></table></figure>

<h1 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h1><p>æ•°ç»„çš„å£°æ˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">float</span> coffee[3];        <span class="comment">#æœ‰ä¸‰ä¸ªfloatå…ƒç´ çš„æ•°ç»„</span></span><br><span class="line"><span class="built_in">float</span>[3]  coffee;       <span class="comment">#åŒä¸Š</span></span><br><span class="line">int indices;            <span class="comment">#ä¸ºå®šä¹‰ç»´æ•°</span></span><br></pre></td></tr></table></figure>

<p>é™æ€åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„çš„å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">float</span> coffee[3]  = <span class="built_in">float</span>[3](2.00, 3.00, 5.23);</span><br></pre></td></tr></table></figure>
<p>æ“ä½œä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(int i = 0; i&lt;coffee.length(); i++)&#123;</span><br><span class="line">    coffee[i] *= 2.0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·å–åˆ—æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mat3x4 m;</span><br><span class="line">int c = m.length();         <span class="comment"># måŒ…å«çš„åˆ—æ•°ä¸º3</span></span><br><span class="line">int r = m[0].length();      <span class="comment"># ç¬¬0ä¸ªåˆ—å‘é‡ä¸­åˆ†é‡çš„ä¸ªæ•°ä¸º4</span></span><br></pre></td></tr></table></figure>
<h1 id="å­˜å‚¨é™åˆ¶ç¬¦"><a href="#å­˜å‚¨é™åˆ¶ç¬¦" class="headerlink" title="å­˜å‚¨é™åˆ¶ç¬¦"></a>å­˜å‚¨é™åˆ¶ç¬¦</h1><table>
<thead>
<tr>
<th align="left">ç±»å‹ä¿®é¥°ç¬¦</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">const</td>
<td align="left">å°†ä¸€ä¸ªå˜é‡å®šä¹‰ä¸ºåªè¯»å½¢å¼ã€‚å¦‚æœå®ƒåˆå§‹åŒ–æ—¶ç”¨çš„æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å˜é‡ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«ä¹Ÿä¼šæˆä¸ºç¼–è¯‘æ—¶å¸¸é‡</td>
</tr>
<tr>
<td align="left">in</td>
<td align="left">è®¾ç½®è¿™ä¸ªå˜é‡ä¸ºç€è‰²å™¨é˜¶æ®µçš„è¾“å…¥å˜é‡</td>
</tr>
<tr>
<td align="left">out</td>
<td align="left">è®¾ç½®è¿™ä¸ªå˜é‡ä¸ºç€è‰²å™¨é˜¶æ®µçš„è¾“å‡ºå˜é‡</td>
</tr>
<tr>
<td align="left">uniform</td>
<td align="left">è®¾ç½®è¿™ä¸ªå˜é‡ä¸ºç”¨æˆ·åº”ç”¨ç¨‹åºä¼ é€’ç»™ç€è‰²å™¨çš„æ•°æ®ï¼Œå®ƒå¯¹äºç»™å®šçš„å›¾å…ƒè€Œè¨€æ˜¯ä¸€ä¸ªå¸¸é‡</td>
</tr>
<tr>
<td align="left">buffer</td>
<td align="left">è®¾ç½®åº”ç”¨ç¨‹åºå…±äº«çš„ä¸€å—å¯è¯»å†™çš„å†…å­˜ã€‚è¿™å—å†…å­˜ä¹Ÿä½œä¸ºç€è‰²å™¨ä¸­çš„å­˜å‚¨ç¼“å­˜ä½¿ç”¨</td>
</tr>
<tr>
<td align="left">shared</td>
<td align="left">è®¾ç½®å˜é‡æ˜¯æœ¬åœ°å·¥ä½œç»„ä¸­å…±äº«çš„ã€‚å®ƒåªèƒ½ç”¨äºè®¡ç®—ç€è‰²å™¨ä¸­</td>
</tr>
</tbody></table>
<p>è·å–uniformå˜é‡çš„ç´¢å¼•å¹¶ä¸”è®¾ç½®å…·ä½“å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GLint timeLoc;                                      <span class="comment">#ç€è‰²å™¨ä¸­çš„uniformå˜é‡timeçš„ç´¢å¼•</span></span><br><span class="line">GLfloat timeValue;                                  <span class="comment">#ç¨‹åºè¿è¡Œçš„æ—¶é—´</span></span><br><span class="line">timeLoc = glGetUniformLocation(program, <span class="string">"time"</span>)     <span class="comment">#è¿”å›ç€è‰²å™¨ä¸­nuiformå˜é‡timeå¯¹åº”çš„ç´¢å¼•å€¼</span></span><br><span class="line">glUniformlf(timeLoc, timeValue);                    <span class="comment">#è®¾ç½®uniformå˜é‡timeLocçš„å€¼</span></span><br></pre></td></tr></table></figure>

<h1 id="ç®—æœ¯æ“ä½œç¬¦"><a href="#ç®—æœ¯æ“ä½œç¬¦" class="headerlink" title="ç®—æœ¯æ“ä½œç¬¦"></a>ç®—æœ¯æ“ä½œç¬¦</h1><table>
<thead>
<tr>
<th align="left">ä¼˜å…ˆçº§</th>
<th align="left">æ“ä½œç¬¦</th>
<th align="left">å¯ç”¨ç±»å‹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">()</td>
<td align="left">-</td>
<td align="left">æˆç»„çš„æ“ä½œ</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><br>[]<br> <br>f()<br>  <br>.<br> <br>++ã€â€“<br></td>
<td align="left"><br>[æ•°ç»„ã€çŸ©é˜µã€å‘é‡]<br> <br>å‡½æ•°<br>  <br>ç»“æ„ä½“<br> <br>ç®—æœ¯ç±»å‹<br></td>
<td align="left"><br>æ•°ç»„çš„ä¸‹æ ‡<br> <br>å‡½æ•°çš„è°ƒç”¨ã€æ„é€ å‡½æ•°<br>  <br>è®¿é—®ç»“æ„ä½“çš„åŸŸå˜é‡/æ–¹æ³•<br> <br>åç½®é€’å¢/é€’å‡<br></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><br>++ã€â€“<br> <br>+ã€-<br>  <br>~<br> <br>!<br></td>
<td align="left"><br>ç®—æœ¯ç±»å‹<br> <br>ç®—æœ¯ç±»å‹<br>  <br>æ•´å‹<br> <br>å¸ƒå°”å‹<br></td>
<td align="left"><br>å‰ç½®é€’å¢/é€’å‡<br> <br><br>  <br><br> <br><br></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>*ã€/ã€%</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>+ã€-</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><code>&lt;&lt;ã€&gt;&gt;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><code>&lt;ã€&gt;ã€&lt;=ã€&gt;=</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><code>==ã€!=</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><code>&amp;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><code>^</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">`</td>
<td align="left">`</td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><code>&amp;&amp;</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><code>^^</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">`</td>
<td align="left"></td>
<td align="left">`</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><code>a?b:c</code></td>
<td align="left"><br><br></td>
<td align="left"><br><br></td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><br><code>==</code><br> <br><code>+=ã€-=</code><br>  <br><code>*=ã€/=</code><br> <br><code>%=ã€&lt;&lt;=ã€&gt;&gt;=</code><br> <br>`&amp;=ã€^=ã€</td>
<td align="left">=`<br></td>
<td align="left"><br>ä»»æ„<br> <br>ç®—æœ¯ç±»å‹<br>  <br>ç®—æœ¯ç±»å‹<br>  <br>æ•´å‹<br> <br>æ•´å‹<br></td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><code>,</code></td>
<td align="left">ä»»æ„</td>
<td align="left">æ“ä½œç¬¦åºåˆ—</td>
</tr>
</tbody></table>
<h1 id="æ“ä½œç¬¦é‡è½½"><a href="#æ“ä½œç¬¦é‡è½½" class="headerlink" title="æ“ä½œç¬¦é‡è½½"></a>æ“ä½œç¬¦é‡è½½</h1><h1 id="æµæ§åˆ¶"><a href="#æµæ§åˆ¶" class="headerlink" title="æµæ§åˆ¶"></a>æµæ§åˆ¶</h1><table>
<thead>
<tr>
<th align="left">è¯­å¥</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">break</td>
<td align="left">ç»ˆæ­¢å¾ªç¯ä½“çš„è¿è¡Œï¼Œå¹¶ä¸”ç»§ç»­æ‰§è¡Œå¾ªç¯ä½“å¤–çš„å†…å®¹</td>
</tr>
<tr>
<td align="left">continue</td>
<td align="left">ç»ˆæ­¢å¾ªç¯ä½“å†…å½“å‰è¿­ä»£è¿‡ç¨‹çš„æ‰§è¡Œï¼Œè·³è½¬åˆ°ä»£ç å—å¼€å§‹éƒ¨åˆ†å¹¶ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¬¡è¿­ä»£çš„å†…å®¹</td>
</tr>
<tr>
<td align="left">return</td>
<td align="left">ä»å½“å‰å­ä¾‹ç¨‹è¿”å›ï¼Œå¯ä»¥å¾…ä¼šä¸€ä¸ªå‡½æ•°è¿”å›å€¼</td>
</tr>
<tr>
<td align="left">discard</td>
<td align="left">ä¸¢å¼ƒå½“å‰çš„ç‰‡å…ƒï¼Œç»ˆæ­¢ç€è‰²å™¨çš„æ‰§è¡Œã€‚discardè¯­å¥åªåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­æœ‰æ•ˆ</td>
</tr>
</tbody></table>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">float</span> HornerEval(<span class="built_in">float</span> coffee[10], <span class="built_in">float</span> x);</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> HornerEval(<span class="built_in">float</span> coffee[10], <span class="built_in">float</span> x)&#123;</span><br><span class="line">    ...+</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="è®¡ç®—çš„ä¸å˜æ€§"><a href="#è®¡ç®—çš„ä¸å˜æ€§" class="headerlink" title="è®¡ç®—çš„ä¸å˜æ€§"></a>è®¡ç®—çš„ä¸å˜æ€§</h1><p>GLSLæ— æ³•ä¿è¯åœ¨ä¸åŒçš„ç€è‰²å™¨ä¸­ï¼Œä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„è®¡ç®—å¼ä¼šå¾—åˆ°å®Œå…¨ä¸€æ ·çš„ç»“æœã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç”¨åˆ°<code>invariant</code>æˆ–è€…<code>precise</code>å…³é”®å­—ã€‚</p>
<h2 id="invariant"><a href="#invariant" class="headerlink" title="invariant"></a>invariant</h2><p>å°†ä¸€ä¸ªå†…ç½®çš„è¾“å‡ºå˜é‡å£°æ˜ä¸º<code>invariant</code>ï¼Œä¹Ÿå¯ä»¥å£°æ˜ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ä¸º<code>invariant</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">invariant gl_Position;</span><br><span class="line">invariant centroid out vec3 Color</span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦å°†ç€è‰²å™¨ä¸­çš„æ‰€æœ‰å¯å˜é‡éƒ½è®¾ç½®ä¸º<code>invariant</code>ã€‚å¯ä»¥é€šè¿‡é¡¶ç‚¹ç€è‰²å™¨çš„é¢„ç¼–è¯‘å‘½ä»¤<code>pragma</code>æ¥å®Œæˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#pragma STDGL invariant(all)</span></span><br></pre></td></tr></table></figure>

<h2 id="precise"><a href="#precise" class="headerlink" title="precise"></a>precise</h2><p><code>precise</code>é™åˆ¶ç¬¦å¯ä»¥è®¾ç½®ä»»ä½•è®¡ç®—ä¸­çš„å˜é‡æˆ–è€…å‡½æ•°çš„è¿”å›å€¼ã€‚å®ƒçš„ä½œç”¨æ˜¯å¢åŠ è®¡ç®—çš„å¯å¤ç”¨æ€§</p>
<h1 id="ç€è‰²å™¨çš„é¢„å¤„ç†å™¨"><a href="#ç€è‰²å™¨çš„é¢„å¤„ç†å™¨" class="headerlink" title="ç€è‰²å™¨çš„é¢„å¤„ç†å™¨"></a>ç€è‰²å™¨çš„é¢„å¤„ç†å™¨</h1><h2 id="é¢„å¤„ç†å‘½ä»¤"><a href="#é¢„å¤„ç†å‘½ä»¤" class="headerlink" title="é¢„å¤„ç†å‘½ä»¤"></a>é¢„å¤„ç†å‘½ä»¤</h2><p>æ§åˆ¶å¸¸é‡ä¸å®çš„å®šä¹‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#define</span></span><br><span class="line"><span class="comment">#undef</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">ä»£ç çš„æ¡ä»¶ç¼–è¯‘</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="comment">#if</span></span><br><span class="line"><span class="comment">#ifdef</span></span><br><span class="line"><span class="comment">#ifndef</span></span><br><span class="line"><span class="comment">#else</span></span><br><span class="line"><span class="comment">#elif</span></span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure>

<p>å¼ºåˆ¶æ¯”é‚£ä¸€èµ·å°†textæ–‡å­—å†…å®¹æ’å…¥åˆ°ç€è‰²å™¨çš„ä¿¡æ¯æ—¥å¿—ä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#error text</span></span><br></pre></td></tr></table></figure>



<p>æ§åˆ¶ç¼–è¯‘å™¨çš„é€‰é¡¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#pragma options</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç¼–è¯‘å™¨æ”¯æŒç‰¹å®šGLSLæ‰©å±•åŠŸèƒ½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#extension options</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®å½“å‰ä½¿ç”¨çš„GLSLç‰ˆæœ¬åç§°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#version number</span></span><br></pre></td></tr></table></figure>


<p>è®¾ç½®è¯Šæ–­è¡Œå·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#line options</span></span><br></pre></td></tr></table></figure>

<h2 id="å®å®šä¹‰"><a href="#å®å®šä¹‰" class="headerlink" title="å®å®šä¹‰"></a>å®å®šä¹‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#define NUM_ELEMENTS 10</span></span><br></pre></td></tr></table></figure>

<p>å–æ¶ˆä¹‹å‰å®šä¹‰è¿‡çš„å®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#undef LPos</span></span><br></pre></td></tr></table></figure>


<h1 id="æ•°æ®å¿«æ¥å£"><a href="#æ•°æ®å¿«æ¥å£" class="headerlink" title="æ•°æ®å¿«æ¥å£"></a>æ•°æ®å¿«æ¥å£</h1><p>ç€è‰²å™¨ä¸åº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–è€…ç€è‰²å™¨ä¸ªé˜¶æ®µä¹‹é—´å…±äº«çš„å˜é‡å¯ä»¥ç»„ç»‡ä¸ºå˜é‡å—çš„å½¢å¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">uniform b &#123;     //é™å®šç¬¦å¯ä»¥ä¸ºï¼šuniformã€<span class="keyword">in</span>ã€outã€buffer</span><br><span class="line">    vec4 v1;    //å—ä¸­çš„å˜é‡åˆ—è¡¨</span><br><span class="line">    vec1 v2;    //</span><br><span class="line">&#125;;              //è®¿é—®åŒ¿åå—æˆå‘˜æ—¶ä½¿ç”¨v1ã€v2</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">uniform b &#123;     //</span><br><span class="line">    vec4 v1;    //</span><br><span class="line">    vec1 v2;    //</span><br><span class="line">&#125;name;          ////è®¿é—®åŒ¿åå—æˆå‘˜æ—¶ä½¿ç”¨name.v1ã€name.v2</span><br></pre></td></tr></table></figure>

<h1 id="ç€è‰²å™¨çš„ç¼–è¯‘"><a href="#ç€è‰²å™¨çš„ç¼–è¯‘" class="headerlink" title="ç€è‰²å™¨çš„ç¼–è¯‘"></a>ç€è‰²å™¨çš„ç¼–è¯‘</h1><p>åˆ›å»ºç€è‰²å™¨å¯¹è±¡ä¸”é€šè¿‡é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œç€è‰²å™¨ç¨‹åºçš„æµç¨‹ï¼šï¼ˆä¸¤éƒ¨åˆ†ï¼‰</p>
<p>ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰å¯¹äºæ¯ä¸ªç€è‰²å™¨éƒ½ä¼šï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç€è‰²å™¨å¯¹è±¡ã€‚</li>
<li>å°†ç€è‰²å™¨æºä»£ç ç¼–è¯‘ä¸ºå¯¹è±¡ã€‚</li>
<li>éªŒè¯ç€è‰²å™¨çš„æ¯”é‚£ä¸€æ˜¯å¦æˆåŠŸã€‚</li>
</ul>
<p>ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰å°†å¤šä¸ªç€è‰²å™¨å¯¹è±¡é“¾æ¥ä¸ºä¸€ä¸ªç€è‰²å™¨ç¨‹åºï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç€è‰²å™¨ç¨‹åºã€‚</li>
<li>å°†ç€è‰²å™¨å¯¹è±¡å…³è”åˆ°ç€è‰²å™¨ç¨‹åºã€‚</li>
<li>é“¾æ¥ç€è‰²å™¨ç¨‹åºã€‚</li>
<li>åˆ¤æ–­ç€è‰²å™¨çš„é“¾æ¥è¿‡ç¨‹æ˜¯å¦æˆåŠŸå®Œæˆã€‚</li>
<li>ä½¿ç”¨ç€è‰²å™¨æ¥å¤„ç†é¡¶ç‚¹å’Œç‰‡å…ƒã€‚</li>
</ul>
<h1 id="ç€è‰²å™¨å­ç¨‹åº"><a href="#ç€è‰²å™¨å­ç¨‹åº" class="headerlink" title="ç€è‰²å™¨å­ç¨‹åº"></a>ç€è‰²å™¨å­ç¨‹åº</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//ç¬¬ä¸€æ­¥</span><br><span class="line">subroutine vec4 LightFunc(vec4);</span><br><span class="line"></span><br><span class="line">//ç¬¬äºŒæ­¥</span><br><span class="line">subroutine (LightFunc) vec4 ambient(vec3 n) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> Materials.ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subroutine (LightFunc) vec4 diffuse(vec3 n)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> Materials.diffuse * max(dot (normalize(n), LightVec.xyz), 0.0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç¬¬ä¸‰æ­¥</span><br><span class="line">subroutine uniform LightFunc materialShader;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>OpenGL</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenGLï¼ˆä¸‰ï¼‰</title>
    <url>/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<p>ä»è¿™ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å°±è·Ÿç€è¯¾æœ¬æºç è¾¹è°ƒè¯•è¾¹ç†Ÿæ‚‰OpenGLå‡½æ•°çš„ä½¿ç”¨äº†ã€‚é‡Œé¢æ¶‰åŠçš„C++è¯­æ³•åé¢ä¼šåœ¨ã€ŠC++é‡æ¸©ã€‹è¿™é‡Œä½œè¡¥å……ã€‚æ‹¿åˆ°è¯¾æœ¬æºç ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡Cmakeç¼–è¯‘å‡ºMacä¸Šè¿è¡Œçš„Xcodeç¨‹åºã€‚</p>
<blockquote>
<p>01-keypress.cpp</p>
</blockquote>
<h1 id="ç¨‹åºæ¦‚æ‹¬"><a href="#ç¨‹åºæ¦‚æ‹¬" class="headerlink" title="ç¨‹åºæ¦‚æ‹¬"></a>ç¨‹åºæ¦‚æ‹¬</h1><p>ç¨‹åºå…ˆæ‰§è¡Œinitå‡½æ•°<code>void KeyPressExample::Initialize(const char * title)</code>å†æ‰§è¡Œdisplayå‡½æ•°<code>void KeyPressExample::Display(bool auto_redraw)</code>.</p>
<p>æŒ‰ä¸‹é”®ç›˜ä¼šè°ƒç”¨<code>void KeyPressExample::OnKey(int key, int scancode, int action, int mods)</code></p>
<p>ç¨‹åºçª—å£ç¼©æ”¾<code>void KeyPressExample::Resize(int width, int height)</code></p>
<h1 id="initå‡½æ•°è¯´æ˜"><a href="#initå‡½æ•°è¯´æ˜" class="headerlink" title="initå‡½æ•°è¯´æ˜"></a>initå‡½æ•°è¯´æ˜</h1><p><code>glGenVertexArrays( NumVAOs, VAOs );</code><br>åˆ†é…NumVAOsä¸ªæœªä½¿ç”¨çš„å¯¹è±¡ååˆ°æ•°ç»„VAOsä¸­ï¼Œç”¨ä½œé¡¶ç‚¹æ•°ç»„å¯¹è±¡ã€‚å†çœ‹ä¸‹å…¶æ•°ç»„å®šä¹‰ï¼šGLuint  VAOs[NumVAOs];</p>
<p><code>glBindVertexArray( VAOs[Triangles] );</code><br>VAOs[Triangles]</p>
<ul>
<li>è¾“å…¥çš„å˜é‡arrayé0ï¼Œä¸”ä¸º<code>glGenVertexArrays</code>æ‰€åˆ†é…æ—¶ï¼Œæ¿€æ´»é¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¹¶ç›´æ¥å½±å“å¯¹è±¡ä¸­æ‰€ä¿å­˜çš„é¡¶ç‚¹æ•°ç»„çŠ¶æ€ã€‚</li>
<li>arrayä¸º0ï¼ŒOpenGLä¸å†ä½¿ç”¨ä¹‹å‰ç»‘å®šçš„é¡¶ç‚¹æ•°ç»„ã€‚</li>
<li>arrayä¸æ˜¯<code>glGenVertexArrays</code>æ‰€åˆ†é…çš„ï¼Œæˆ–è€…å®ƒå·²ç»è¢«<code>glDeleteVertexArray</code>å‡½æ•°é‡Šæ”¾äº†ï¼Œè¿™æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªæ— æ•ˆé”™è¯¯ã€‚</li>
</ul>
<p><code>glGenBuffers( NumBuffers, Buffers );</code><br>åˆ†é…NumBuffersä¸ªå½“å‰æœªä½¿ç”¨çš„ç¼“å­˜å¯¹è±¡åç§°ï¼Œå¹¶ä¿å­˜åˆ°Buffersæ•°ç»„ä¸­ã€‚</p>
<p><code>glBindBuffer( GL_ARRAY_BUFFER, Buffers[ArrayBuffer] );</code></p>
<ul>
<li>å¦‚æœç»‘å®šåˆ°ä¸€ä¸ªå·²ç»åˆ›å»ºçš„ç¼“å­˜å¯¹è±¡ï¼Œé‚£ä¹ˆä»–å°†æˆä¸ºå½“å‰GL_ARRAY_BUFFERä¸­è¢«æ¿€æ´»çš„ç¼“å­˜å¯¹è±¡ã€‚</li>
<li>å¦‚æœç»‘å®šçš„Buffers[ArrayBuffer]å€¼ä¸º0ï¼Œé‚£ä¹ˆOpenGLå°†ä¸å†å¯¹å½“å‰GL_ARRAY_BUFFERä½¿ç”¨ä»»ä½•ç¼“å­˜å¯¹è±¡ã€‚</li>
</ul>
<p><code>glBufferData( GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW );</code><br>å°†æ•°æ®è½½å…¥ç¼“å­˜å¯¹è±¡ã€‚</p>
<p><code>glVertexAttribPointer( vPosition, 2, GL_FLOAT, GL_FALSE, 0, BUFFER_OFFSET(0) );</code><br>å°†è¾“å…¥é¡¶ç‚¹ç€è‰²å™¨çš„æ•°æ® å…³è”åˆ° ä¸€ä¸ªé¡¶ç‚¹å±æ€§çš„æ•°ç»„ã€‚</p>
<p><code>glEnableVertexAttribArray( vPosition );</code><br>å¯ç”¨é¡¶ç‚¹å±æ€§æ•°ç»„ã€‚</p>
<h1 id="displayå‡½æ•°è¯´æ˜"><a href="#displayå‡½æ•°è¯´æ˜" class="headerlink" title="displayå‡½æ•°è¯´æ˜"></a>displayå‡½æ•°è¯´æ˜</h1><p><code>glClear( GL_COLOR_BUFFER_BIT );</code><br>æ¸…å±ã€‚</p>
<p><code>glBindVertexArray( VAOs[Triangles] );</code></p>
<p><code>glDrawArrays( GL_TRIANGLES, 0, NumVertices );</code><br>å¼€å§‹ç»˜åˆ¶ã€‚</p>
<h1 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h1><p>ç¨‹åºé»˜è®¤æ•ˆæœ<br><img src="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/keypress1.png" alt="keypress1.png"></p>
<p>æŒ‰ä¸‹é”®ç›˜å­—æ¯Mçš„æ•ˆæœ<br><img src="/2020/03/28/OpenGL%EF%BC%88%E4%B8%89%EF%BC%89/keypress2.png" alt="keypress2.png"></p>
<h1 id="è¯¦ç»†æºç "><a href="#è¯¦ç»†æºç " class="headerlink" title="è¯¦ç»†æºç "></a>è¯¦ç»†æºç </h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//////////////////////////////////////////////////////////////////////////////</span><br><span class="line">//</span><br><span class="line">//  Triangles.cpp</span><br><span class="line">//</span><br><span class="line">//////////////////////////////////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;vermilion.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include "vgl.h"</span></span><br><span class="line"><span class="comment">#include "vapp.h"</span></span><br><span class="line"><span class="comment">#include "LoadShaders.h"</span></span><br><span class="line"></span><br><span class="line">enum VAO_IDs &#123; Triangles, NumVAOs &#125;;</span><br><span class="line">enum Buffer_IDs &#123; ArrayBuffer, NumBuffers &#125;;</span><br><span class="line">enum Attrib_IDs &#123; vPosition = 0 &#125;;</span><br><span class="line"></span><br><span class="line">GLuint  VAOs[NumVAOs];</span><br><span class="line">GLuint  Buffers[NumBuffers];</span><br><span class="line"></span><br><span class="line">const GLuint  NumVertices = 6;</span><br><span class="line"></span><br><span class="line">BEGIN_APP_DECLARATION(KeyPressExample)</span><br><span class="line">    virtual void Initialize(const char * title);</span><br><span class="line">    virtual void Display(bool auto_redraw);</span><br><span class="line">    virtual void Finalize(void);</span><br><span class="line">    virtual void Resize(int width, int height);</span><br><span class="line">    void OnKey(int key, int scancode, int action, int mods);</span><br><span class="line">END_APP_DECLARATION()</span><br><span class="line"></span><br><span class="line">DEFINE_APP(KeyPressExample, <span class="string">"Key Press Example"</span>)</span><br><span class="line">//----------------------------------------------------------------------------</span><br><span class="line">//</span><br><span class="line">// init</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Initialize(const char * title)</span><br><span class="line">&#123;</span><br><span class="line">    //typedef class VermilionApplication base</span><br><span class="line">    base::Initialize(title);</span><br><span class="line"></span><br><span class="line">    glGenVertexArrays( NumVAOs, VAOs );</span><br><span class="line">    glBindVertexArray( VAOs[Triangles] );</span><br><span class="line"></span><br><span class="line">    GLfloat  vertices[NumVertices][2] = &#123;</span><br><span class="line">        &#123; -0.90f, -0.90f &#125;, &#123;  0.85f, -0.90f &#125;, &#123; -0.90f,  0.85f &#125;,  // Triangle 1</span><br><span class="line">        &#123;  0.90f, -0.85f &#125;, &#123;  0.90f,  0.90f &#125;, &#123; -0.85f,  0.90f &#125;   // Triangle 2</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    glGenBuffers( NumBuffers, Buffers );</span><br><span class="line">    glBindBuffer( GL_ARRAY_BUFFER, Buffers[ArrayBuffer] );</span><br><span class="line">    glBufferData( GL_ARRAY_BUFFER, sizeof(vertices),</span><br><span class="line">                  vertices, GL_STATIC_DRAW );</span><br><span class="line"></span><br><span class="line">    ShaderInfo  shaders[] = &#123;</span><br><span class="line">        &#123; GL_VERTEX_SHADER, <span class="string">"../media/shaders/keypress/keypress.vert"</span> &#125;,</span><br><span class="line">        &#123; GL_FRAGMENT_SHADER, <span class="string">"../media/shaders/keypress/keypress.frag"</span> &#125;,</span><br><span class="line">        &#123; GL_NONE, NULL &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    GLuint program = LoadShaders( shaders );</span><br><span class="line">    glUseProgram( program );</span><br><span class="line"></span><br><span class="line">    glVertexAttribPointer( vPosition, 2, GL_FLOAT,</span><br><span class="line">                           GL_FALSE, 0, BUFFER_OFFSET(0) );</span><br><span class="line">    glEnableVertexAttribArray( vPosition );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::OnKey(int key, int scancode, int action, int mods)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (action == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        switch (key)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> GLFW_KEY_M:</span><br><span class="line">                &#123;</span><br><span class="line">                    static GLenum  mode = GL_FILL;</span><br><span class="line"></span><br><span class="line">                    mode = ( mode == GL_FILL ? GL_LINE : GL_FILL );</span><br><span class="line">                    glPolygonMode( GL_FRONT_AND_BACK, mode );</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    base::OnKey(key, scancode, action, mods);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//----------------------------------------------------------------------------</span><br><span class="line">//</span><br><span class="line">// display</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Display(bool auto_redraw)</span><br><span class="line">&#123;</span><br><span class="line">    glClear( GL_COLOR_BUFFER_BIT );</span><br><span class="line"></span><br><span class="line">    glBindVertexArray( VAOs[Triangles] );</span><br><span class="line">    // GL_TRIANGLESå¹¶æ²¡æœ‰æŒ‡å®šæ˜¯ç”»ä¸‰è§’å½¢çš„è¾¹æ²¿è¿˜æ˜¯å†…éƒ¨ä¹Ÿç”»ï¼Œ</span><br><span class="line">    glDrawArrays( GL_TRIANGLES, 0, NumVertices );</span><br><span class="line"></span><br><span class="line">    base::Display(auto_redraw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Resize(int width, int height)</span><br><span class="line">&#123;</span><br><span class="line">    glViewport(0, 0, width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void KeyPressExample::Finalize(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>OpenGL</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenGLï¼ˆäºŒï¼‰</title>
    <url>/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<p>åœ¨<a href="https://samtake.github.io/2020/03/27/OpenGL/" target="_blank" rel="noopener">ä¸Šç¯‡</a>æˆ‘ä»¬åœç•™åœ¨æ¦‚å¿µä¸Šçš„ï¼Œç°åœ¨åŠ¨æ‰‹å†™å†™ä»£ç ã€‚</p>
<p>åœ¨<a href="https://www.khronos.org/opengl/wiki/Getting_Started#macOS" target="_blank" rel="noopener">OpenGLå®˜ç½‘</a>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>macOS<br>Unlike other platforms, where the Operating System and OpenGL implementations are often updated separately, OpenGL updates are included as part of macOS system updates. To obtain the latest OpenGL on macOS, users should upgrade to the latest OS release, which can be found at Apple.com.</p>
</blockquote>
<p>æ¢å¥è¯æ¥è¯´OpenGLå·²ç»é›†æˆåœ¨æˆ‘ä»¬çš„Macç³»ç»Ÿä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›æ‰§è¡Œçª—å£ä»»åŠ¡æˆ–è€…å¤„ç†ç”¨æˆ·è¾“å…¥çš„å‡½æ•°ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°çš„åº“æœ‰ï¼š</p>
<ul>
<li>GLEW</li>
<li><a href="https://www.glfw.org/docs/latest/quick_guide.html" target="_blank" rel="noopener">GLFW</a></li>
<li><a href="https://glad.dav1d.de/" target="_blank" rel="noopener">GLAD</a></li>
</ul>
<h1 id="å®‰è£…GLEWã€GLEW"><a href="#å®‰è£…GLEWã€GLEW" class="headerlink" title="å®‰è£…GLEWã€GLEW"></a>å®‰è£…GLEWã€GLEW</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  blogs brew install glfw3</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/glfw-3.3.2.mojave.bottle.tar.gz</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==&gt; Pouring glfw-3.3.2.mojave.bottle.tar.gz</span><br><span class="line">ğŸº  /usr/<span class="built_in">local</span>/Cellar/glfw/3.3.2: 14 files, 492.8KB   <span class="comment">#å®‰è£…ä½ç½®</span></span><br><span class="line">âœ  blogs brew install glew </span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/glew-2.1.0_1.mojave.bottle.tar.gz</span><br><span class="line">==&gt; Downloading from https://akamai.bintray.com/66/66638564b5b9d2d915b97841ef1cc117f701c7ec34707734fa1ce11919c28</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==&gt; Pouring glew-2.1.0_1.mojave.bottle.tar.gz</span><br><span class="line">ğŸº  /usr/<span class="built_in">local</span>/Cellar/glew/2.1.0_1: 38 files, 3MB  <span class="comment">#å®‰è£…ä½ç½®</span></span><br></pre></td></tr></table></figure>

<h1 id="åœ¨Xcodeé…ç½®GLEWã€GLEW"><a href="#åœ¨Xcodeé…ç½®GLEWã€GLEW" class="headerlink" title="åœ¨Xcodeé…ç½®GLEWã€GLEW"></a>åœ¨Xcodeé…ç½®GLEWã€GLEW</h1><p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode1.png" alt="opengl2-xcode1.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode2.png" alt="opengl2-xcode2.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode3.png" alt="opengl2-xcode3.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode4.png" alt="opengl2-xcode4.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode5.png" alt="opengl2-xcode5.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/opengl2-xcode6.png" alt="opengl2-xcode6.png"></p>
<p>æ·»åŠ ä¸¤ä¸ªdylibæ–‡ä»¶çš„æ–¹æ³•æ—¶ï¼Œæ²¡æœ‰åœ¨frameworkä¸­æœç´¢åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶æ—¶ï¼Œç‚¹å‡»add otherï¼Œç„¶åç‚¹å‡»shift+command+Gè¿›å…¥<code>/usr/local</code>æ–‡ä»¶å¤¹å¯¹åº”çš„å®‰è£…è·¯å¾„æ‰¾ã€‚</p>
<h1 id="ä¸‹è½½GLADåº“"><a href="#ä¸‹è½½GLADåº“" class="headerlink" title="ä¸‹è½½GLADåº“"></a>ä¸‹è½½GLADåº“</h1><p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/glad1.png" alt="glad1.png"></p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/glad2.png" alt="glad2.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ <span class="built_in">cd</span> /Users/samtake/Downloads/glad </span><br><span class="line">âœ  glad ls</span><br><span class="line">include src</span><br><span class="line">âœ  glad <span class="built_in">alias</span> tree=<span class="string">"find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"</span></span><br><span class="line">âœ  glad tree </span><br><span class="line">|____include</span><br><span class="line">| |____KHR</span><br><span class="line">| | |____khrplatform.h</span><br><span class="line">| |____glad</span><br><span class="line">| | |____glad.h</span><br><span class="line">|____src</span><br><span class="line">| |____glad.c</span><br><span class="line">âœ  glad</span><br></pre></td></tr></table></figure>
<p>å°†includeæ–‡ä»¶å¤¹ä¸­çš„ä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°<code>/usr/local/include</code>å†…ï¼Œç„¶åæ·»åŠ <code>glad.c</code>æ–‡ä»¶åˆ°XCodeå·¥ç¨‹ä¸­.</p>
<h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h1><p>å¤åˆ¶æºç ä»£æ›¿åŸæœ‰çš„main.cppæ–‡ä»¶ï¼Œbuildä¸€ä¸‹ç¼–è¯‘é€šè¿‡å³å¯ã€‚</p>
<p><img src="/2020/03/27/OpenGL%EF%BC%88%E4%BA%8C%EF%BC%89/demo.png" alt="demo.png"></p>
<p><a href="https://github.com/samtake/helloOpenGL/tree/master/%E7%AC%AC%E4%B8%80%E7%AB%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" target="_blank" rel="noopener">demoæºç </a></p>
]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>OpenGL</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenGL</title>
    <url>/2020/03/27/OpenGL/</url>
    <content><![CDATA[<p><img src="/2020/03/27/OpenGL/opengl-book.jpeg" alt="opengl-book.jpeg"></p>
<p>å•ƒä¹¦äº†ï¼è¿™æœ¬ä¹¦ä¹°äº†å¾ˆä¹…éƒ½æ²¡çœ‹å®Œï¼Œä¹Ÿå¿˜çš„å·®ä¸å¤šäº†ã€‚ç°åœ¨è¯•ç€ç”¨ç®€æ´çš„è¯­è¨€è®°å½•å­¦ä¹ è¿‡ç¨‹ã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯OpenGL"><a href="#ä»€ä¹ˆæ˜¯OpenGL" class="headerlink" title="ä»€ä¹ˆæ˜¯OpenGL?"></a>ä»€ä¹ˆæ˜¯OpenGL?</h1><p>OpenGLæ˜¯ä¸€ç§å¯ä»¥å¯¹å›¾å½¢è¿›è¡Œè®¿é—®çš„è½¯ä»¶åº“ã€‚å®ƒçš„æ¥å£ä¸ç¡¬ä»¶æ— å…³ï¼Œè‡ªèº«ä¸åŒ…å«ä»»ä½•æ‰§è¡Œçª—å£ä»»åŠ¡æˆ–è€…å¤„ç†ç”¨æˆ·è¾“å…¥çš„å‡½æ•°ï¼ˆè¿™äº›æ“ä½œæˆ‘ä»¬éœ€è¦ç³»ç»Ÿæä¾›çš„æ¥å£æ¥å®ç°ï¼‰ã€‚</p>
<h1 id="é€šè¿‡OpenGLæ¸²æŸ“å›¾åƒçš„ä¸»è¦æ“ä½œ-è¯¦ç»†å‚è€ƒï¼šæ¸²æŸ“ç®¡çº¿æµç¨‹"><a href="#é€šè¿‡OpenGLæ¸²æŸ“å›¾åƒçš„ä¸»è¦æ“ä½œ-è¯¦ç»†å‚è€ƒï¼šæ¸²æŸ“ç®¡çº¿æµç¨‹" class="headerlink" title="é€šè¿‡OpenGLæ¸²æŸ“å›¾åƒçš„ä¸»è¦æ“ä½œ(è¯¦ç»†å‚è€ƒï¼šæ¸²æŸ“ç®¡çº¿æµç¨‹)"></a>é€šè¿‡OpenGLæ¸²æŸ“å›¾åƒçš„ä¸»è¦æ“ä½œ(è¯¦ç»†å‚è€ƒï¼šæ¸²æŸ“ç®¡çº¿æµç¨‹)</h1><ul>
<li>è®¾ç½®æ•°æ®ï¼Œæ„å»ºå½¢çŠ¶</li>
<li>ç€è‰²å™¨</li>
<li>å…‰æ …æ åŒ–ï¼Œäº§ç”Ÿæ¯ä¸ªç‰‡å…ƒ</li>
<li>æ‰§è¡Œç‰‡å…ƒç€è‰²å™¨</li>
</ul>
<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p><code>å…‰æ …åŒ–ï¼ˆrasterizationï¼‰</code>å°†è¾“å…¥å›¾å…ƒçš„æ•°å­¦æè¿°è½¬æ¢ä¸ºä¸å±å¹•ä½ç½®å¯¹åº”çš„åƒç´ ç‰‡å…ƒã€‚<br><code>æ¸²æŸ“ï¼ˆrenderï¼‰</code>è®¡ç®—æœºä»æ¨¡å‹åˆ›å»ºåˆ°æœ€ç»ˆå›¾åƒçš„è¿‡ç¨‹ã€‚<br><code>åƒç´ ï¼ˆpixelï¼‰</code>æ˜¾ç¤ºå™¨ä¸Šæœ€å°çš„å¯è§å•å…ƒã€‚</p>
<p><code>ç€è‰²å™¨ï¼ˆshaderï¼‰</code>ä¸“ä¸ºå›¾å½¢å¤„ç†å•å…ƒç¼–è¯‘çš„ä¸€ç§å°å‹ç¨‹åºã€‚</p>
<ul>
<li><code>å®šç‚¹ç€è‰²å™¨ï¼ˆvertex shaderï¼‰</code>å¤„ç†å®šç‚¹æ•°æ®</li>
<li><code>ç‰‡å…ƒç€è‰²å™¨</code>å¤„ç†å…‰æ …åŒ–çš„ç‰‡å…ƒæ•°æ®</li>
</ul>
<p><code>æ¸²æŸ“ç®¡çº¿ï¼ˆrendering pipelineï¼‰</code>OpenGLä¸€ç³»åˆ—æ•°æ®å¤„ç†è¿‡ç¨‹ï¼Œå¹¶ä¸”å°†åº”ç”¨ç¨‹åºçš„æ•°æ®è½¬æ¢åˆ°æœ€ç»ˆæ¸²æŸ“çš„å›¾åƒã€‚</p>
<h1 id="æ¸²æŸ“ç®¡çº¿æµç¨‹"><a href="#æ¸²æŸ“ç®¡çº¿æµç¨‹" class="headerlink" title="æ¸²æŸ“ç®¡çº¿æµç¨‹"></a>æ¸²æŸ“ç®¡çº¿æµç¨‹</h1><p><img src="/2020/03/27/OpenGL/rendering-pipeline.jpeg" alt="rendering-pipeline.jpeg"></p>
]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>OpenGL</tag>
      </tags>
  </entry>
  <entry>
    <title>FFmpegï¼ˆå…­ï¼‰</title>
    <url>/2020/03/24/FFmpeg%EF%BC%88%E5%85%AD%EF%BC%89/</url>
    <content><![CDATA[<h1 id="é€šè¿‡FFmpegæºç ä½¿ç”¨è„šæœ¬ç¼–è¯‘å‡ºå¯ä»¥åœ¨iOSä¸‹ä½¿ç”¨çš„SDK"><a href="#é€šè¿‡FFmpegæºç ä½¿ç”¨è„šæœ¬ç¼–è¯‘å‡ºå¯ä»¥åœ¨iOSä¸‹ä½¿ç”¨çš„SDK" class="headerlink" title="é€šè¿‡FFmpegæºç ä½¿ç”¨è„šæœ¬ç¼–è¯‘å‡ºå¯ä»¥åœ¨iOSä¸‹ä½¿ç”¨çš„SDK"></a>é€šè¿‡FFmpegæºç ä½¿ç”¨è„šæœ¬ç¼–è¯‘å‡ºå¯ä»¥åœ¨iOSä¸‹ä½¿ç”¨çš„SDK</h1><p>å…·ä½“è„šæœ¬é“¾æ¥ï¼š<a href="https://github.com/kewlbear/FFmpeg-iOS-build-script" target="_blank" rel="noopener">FFmpeg-iOS-build-script</a></p>
<ul>
<li>åœ¨FFmpegæºç çš„ä¸Šä¸€çº§ç›®å½•æ·»åŠ <code>build-ffmpeg.sh</code>æ–‡ä»¶</li>
<li>å‘½ä»¤è¡Œæ‰§è¡Œï¼š<code>./build-ffmpeg.sh</code></li>
<li>å¦‚æœæ— æ‰§è¡Œæƒé™çš„è¯æ‰§è¡Œï¼š<code>chmod 777 ./build-ffmpeg.sh</code></li>
<li>æ³¨æ„ï¼šæ‰“åŒ…ä¸Šä¼ åˆ°å•†åº—æ—¶ä½¿ç”¨çš„SDKåªéœ€è¦çœŸæœºçš„</li>
</ul>
]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>FFmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>FFmpegï¼ˆäº”ï¼‰</title>
    <url>/2020/03/24/FFmpeg%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    <content><![CDATA[<p>FFmpegä¸SDLç»“åˆï¼Œå®ç°å¤šåª’ä½“æ’­æ”¾å™¨ï¼Œå†…å®¹æœ‰ï¼šå¤šçº¿ç¨‹ä¸é”ï¼Œ é”ä¸æ¡ä»¶å˜é‡åœ¨å®é™…ä¸­çš„åº”ç”¨ï¼ŒéŸ³è§†é¢‘åŒæ­¥ï¼Œseekç­‰ã€‚</p>
]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>FFmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>FFmpegï¼ˆå››ï¼‰</title>
    <url>/2020/03/24/FFmpeg%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    <content><![CDATA[<p><a href="https://samtake.github.io/2019/11/04/FFmpeg/" target="_blank" rel="noopener">FFmpeg-å®‰è£…åŠåŸºæœ¬æ¦‚å¿µ</a><br><a href="https://samtake.github.io/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/" target="_blank" rel="noopener">FFmpeg-å‘½ä»¤</a><br><a href="https://samtake.github.io/2020/03/23/FFmpeg%EF%BC%88%E4%B8%89%EF%BC%89/" target="_blank" rel="noopener">é€šè¿‡ Cè¯­è¨€ æ“ä½œFFmpegå¯¹å¤šåª’ä½“æ–‡ä»¶çš„å¤„ç†</a></p>
<h1 id="SDLç®€ä»‹"><a href="#SDLç®€ä»‹" class="headerlink" title="SDLç®€ä»‹"></a>SDLç®€ä»‹</h1><p><a href="http://libsdl.org/download-2.0.php" target="_blank" rel="noopener">SDL</a>å¯ä»¥å¯¹éŸ³è§†é¢‘è¿›è¡Œæ¸²æŸ“ï¼Œè¿™é‡Œä¸»è¦éƒ¨åˆ†æœ‰ï¼šå®‰è£…SDLã€ä½¿ç”¨SDLçš„åŸºæœ¬æ­¥éª¤ã€SDLçª—å£æ¸²æŸ“ã€SDLäº‹ä»¶å¤„ç†ã€SDLçº¹ç†æ¸²æŸ“ã€‚</p>
<h1 id="å®‰è£…SDL"><a href="#å®‰è£…SDL" class="headerlink" title="å®‰è£…SDL"></a>å®‰è£…SDL</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ brew info SDl2</span><br><span class="line">âœ  ~ brew info SDl2</span><br><span class="line">SDl2: stable 2.0.10 (bottled), HEAD</span><br><span class="line">Low-level access to audio, keyboard, mouse, joystick, and graphics</span><br><span class="line">https://www.libsdl.org/</span><br><span class="line">/usr/<span class="built_in">local</span>/Cellar/SDl2/2.0.10 (87 files, 4.6MB)</span><br><span class="line">  Poured from bottle on 2020-03-24 at 14:13:57</span><br><span class="line">From: git://mirrors.ustc.edu.cn/homebrew-core.git//Formula/sdl2.rb</span><br><span class="line">==&gt; Options</span><br><span class="line">--HEAD</span><br><span class="line">	Install HEAD version</span><br></pre></td></tr></table></figure>


<h1 id="ä½¿ç”¨SDLçš„åŸºæœ¬æ­¥éª¤"><a href="#ä½¿ç”¨SDLçš„åŸºæœ¬æ­¥éª¤" class="headerlink" title="ä½¿ç”¨SDLçš„åŸºæœ¬æ­¥éª¤"></a>ä½¿ç”¨SDLçš„åŸºæœ¬æ­¥éª¤</h1><h1 id="SDLçª—å£æ¸²æŸ“"><a href="#SDLçª—å£æ¸²æŸ“" class="headerlink" title="SDLçª—å£æ¸²æŸ“"></a>SDLçª—å£æ¸²æŸ“</h1><h1 id="SDLäº‹ä»¶å¤„ç†"><a href="#SDLäº‹ä»¶å¤„ç†" class="headerlink" title="SDLäº‹ä»¶å¤„ç†"></a>SDLäº‹ä»¶å¤„ç†</h1><h1 id="SDLå½»åº•ç†è§£çº¹ç†æ¸²æŸ“"><a href="#SDLå½»åº•ç†è§£çº¹ç†æ¸²æŸ“" class="headerlink" title="SDLå½»åº•ç†è§£çº¹ç†æ¸²æŸ“"></a>SDLå½»åº•ç†è§£çº¹ç†æ¸²æŸ“</h1>]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>FFmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>FFmpegï¼ˆä¸‰ï¼‰</title>
    <url>/2020/03/23/FFmpeg%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<p><a href="https://samtake.github.io/2019/11/04/FFmpeg/" target="_blank" rel="noopener">FFmpeg-å®‰è£…åŠåŸºæœ¬æ¦‚å¿µ</a><br><a href="https://samtake.github.io/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/" target="_blank" rel="noopener">FFmpeg-å‘½ä»¤</a><br><a href="https://github.com/samtake/FFmpeg-demo" target="_blank" rel="noopener">FFmpeg-demoæºç åœ°å€</a><br>è¿™é‡Œè®°å½•é€šè¿‡ Cè¯­è¨€ æ“ä½œFFmpegå¯¹å¤šåª’ä½“æ–‡ä»¶çš„å¤„ç†</p>
<h1 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h1><p>å¸¸ç”¨æ—¥å¿—çº§åˆ«ï¼ˆçº§åˆ«ç”±é«˜åˆ°åº•æ’åˆ—ï¼‰<br>1.AV_LOFG_ERROR<br>2.AV_LOG_WARNING<br>3.AV_LOG_INFO</p>
<p>å¯ç”¨æ­¥éª¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">include &lt;libavutil/log.h&gt;</span><br><span class="line">av_log_set_level(AV_LOG_DEBUG) <span class="comment">#åªæœ‰è¯¥çº§åˆ«ä»¥åŠè¯¥çº§åˆ«ä¹‹ä¸Šçš„æ—¥å¿—æ‰ä¼šæ‰“å°</span></span><br><span class="line">av_log(NULL,AV_LOG_INFO,<span class="string">"hello world:%s\n"</span>,<span class="string">"op"</span> )</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  FFmpeg-demo git:(master) clang -g -o ffmpeg_log ffmpeg_log.c -lavutil</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— ./ffmpeg_log</span><br><span class="line">hello world!</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ—</span><br></pre></td></tr></table></figure>


<h1 id="æ–‡ä»¶çš„åˆ é™¤-amp-é‡å‘½å"><a href="#æ–‡ä»¶çš„åˆ é™¤-amp-é‡å‘½å" class="headerlink" title="æ–‡ä»¶çš„åˆ é™¤&amp;é‡å‘½å"></a>æ–‡ä»¶çš„åˆ é™¤&amp;é‡å‘½å</h1><p><code>avpriv_io_move(&quot;111.txt&quot;,&quot;222.txt&quot;);</code>é‡å‘½å<br><code>avpriv_io_delete(&quot;./mytestfile.txt&quot;);</code>åˆ é™¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  FFmpeg-demo git:(master) âœ— clang -g -o ffmpeg_del ffmpeg_file.c `pkg-config --libs libavformat`</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— pkg-config --libs libavformat  <span class="comment">#è¿™ä¸€å‘½ä»¤çš„ä½œç”¨æ—¶ï¼šåœ¨ç³»ç»Ÿä¸­å¯»æ‰¾åˆ°libavformatåº“æ‰€åœ¨çš„ä½ç½®</span></span><br><span class="line">-L/usr/<span class="built_in">local</span>/Cellar/ffmpeg/4.2.2_2/lib -lavformat</span><br></pre></td></tr></table></figure>

<h1 id="æ“ä½œç›®å½•"><a href="#æ“ä½œç›®å½•" class="headerlink" title="æ“ä½œç›®å½•"></a>æ“ä½œç›®å½•</h1><p><code>avio_open_dir</code><br><code>avio_read_dir</code><br><code>avio_free_directory_entry</code><br><code>avio_close_dir</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">av_log(NULL, AV_LOG_INFO, <span class="string">"%12"</span>PRId64<span class="string">"%s \n"</span>,entry-&gt;size,entry-&gt;name);</span><br><span class="line"></span><br><span class="line"><span class="comment"># PRId64 æ˜¯ffmpegé‡Œé¢å®šä¹‰çš„ä¸€ä¸ªå®ï¼Œffmpegé‡Œé¢è¯»å–çš„æ–‡ä»¶ä¹Ÿæ˜¯64ä½çš„ã€‚</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  FFmpeg-demo git:(master) âœ— clang -g -o list ffmpeg_list.c `pkg-config --libs libavformat libavutil`</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— ./list</span><br><span class="line">         186ffmpeg_log.c </span><br><span class="line">        2442build_ffmpeg_for_android.sh </span><br><span class="line">        4433list.c </span><br><span class="line">         818ffmpeg_list.c </span><br><span class="line">          96list.dSYM </span><br><span class="line">          96ffmpeg_del.dSYM </span><br><span class="line">        5209encode_audio.c </span><br><span class="line">        1051read_file.c </span><br><span class="line">       11151extr_video.c </span><br><span class="line">       11027avmerge.c </span><br><span class="line">        9532decode_video.c </span><br><span class="line">        5747cutvideo.c </span><br><span class="line">        8760ffmpeg_del </span><br><span class="line">        4265encode_video.c </span><br><span class="line">        8760ffmpeg_log </span><br><span class="line">        6500extr_audio.c </span><br><span class="line">        9380list </span><br><span class="line">          96android </span><br><span class="line">        1073mediainfo.c </span><br><span class="line">        7020decode_audio.c </span><br><span class="line">         541ffmpeg_file.c </span><br><span class="line">        5132remuxing.c </span><br><span class="line">         448.git </span><br><span class="line">          96ffmpeg_log.dSYM </span><br><span class="line">         803write_file.c </span><br><span class="line">        5066extra_audio_ffapi.c </span><br><span class="line">         288player</span><br></pre></td></tr></table></figure>

<h1 id="æ‰“å°éŸ³è§†é¢‘metaä¿¡æ¯"><a href="#æ‰“å°éŸ³è§†é¢‘metaä¿¡æ¯" class="headerlink" title="æ‰“å°éŸ³è§†é¢‘metaä¿¡æ¯"></a>æ‰“å°éŸ³è§†é¢‘metaä¿¡æ¯</h1><p><code>av_register_all</code><br><code>avformat_open_input</code><br><code>av_dump_format(fmt_ctx, 0, &quot;./test.mp4&quot;, 0/**è¾“å…¥ä¿¡æ¯*/);</code></p>
<p>è¾“å…¥ä¿¡æ¯ å¡«0<br>è¾“å…¥ä¿¡æ¯ å¡«1</p>
<p><code>avformat_close_input</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  FFmpeg-demo git:(master) âœ— clang -g -o mediainfo mediainfo.c `pkg-config --libs libavutil libavformat`</span><br><span class="line">mediainfo.c:17:5: warning: <span class="string">'av_register_all'</span> is deprecated [-Wdeprecated-declarations]</span><br><span class="line">    av_register_all();</span><br><span class="line">    ^</span><br><span class="line">/usr/<span class="built_in">local</span>/include/libavformat/avformat.h:2049:1: note: <span class="string">'av_register_all'</span> has been explicitly marked deprecated here</span><br><span class="line">attribute_deprecated</span><br><span class="line">^</span><br><span class="line">/usr/<span class="built_in">local</span>/include/libavutil/attributes.h:94:49: note: expanded from macro <span class="string">'attribute_deprecated'</span></span><br><span class="line"><span class="comment">#    define attribute_deprecated __attribute__((deprecated))</span></span><br><span class="line">                                                ^</span><br><span class="line">1 warning generated.</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— ./mediainfo</span><br><span class="line">Input <span class="comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from './test.mp4':</span></span><br><span class="line">  Metadata:</span><br><span class="line">    major_brand     : mp42</span><br><span class="line">    minor_version   : 0</span><br><span class="line">    compatible_brands: isommp42</span><br><span class="line">    creation_time   : 2020-03-19T07:15:55.000000Z</span><br><span class="line">  Duration: 00:00:55.51, start: 0.000000, bitrate: 8422 kb/s</span><br><span class="line">    Stream <span class="comment">#0:0(eng): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 380 kb/s (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2020-03-19T07:15:55.000000Z</span><br><span class="line">      handler_name    : Mainconcept MP4 Sound Media Handler</span><br><span class="line">    Stream <span class="comment">#0:1(eng): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709), 1280x720 [SAR 1:1 DAR 16:9], 8040 kb/s, 50 fps, 50 tbr, 50k tbn, 100 tbc (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2020-03-19T07:15:55.000000Z</span><br><span class="line">      handler_name    : Mainconcept MP4 Video Media Handler</span><br><span class="line">      encoder         : AVC Cod</span><br></pre></td></tr></table></figure>

<h1 id="æŠ½å–å¤šåª’ä½“ä¸­çš„éŸ³é¢‘æ•°æ®"><a href="#æŠ½å–å¤šåª’ä½“ä¸­çš„éŸ³é¢‘æ•°æ®" class="headerlink" title="æŠ½å–å¤šåª’ä½“ä¸­çš„éŸ³é¢‘æ•°æ®"></a>æŠ½å–å¤šåª’ä½“ä¸­çš„éŸ³é¢‘æ•°æ®</h1><p>av_init_packet(&amp;pkt);</p>
<p>av_find_best_stream</p>
<p>av_read_frame/av_packet_unref</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clang -g -o extr_audio  extr_audio.c `pkg-config --libs libavutil libavformat`</span><br><span class="line">./extr_audio  ./test.mp4  ./test.aac  </span><br><span class="line">ffplay test.aac</span><br></pre></td></tr></table></figure>

<h1 id="æŠ½å–å¤šåª’ä½“ä¸­çš„H264è§†é¢‘æ•°æ®"><a href="#æŠ½å–å¤šåª’ä½“ä¸­çš„H264è§†é¢‘æ•°æ®" class="headerlink" title="æŠ½å–å¤šåª’ä½“ä¸­çš„H264è§†é¢‘æ•°æ®"></a>æŠ½å–å¤šåª’ä½“ä¸­çš„H264è§†é¢‘æ•°æ®</h1><p>å…ˆè¦çŸ¥é“çš„ä¸‰ç‚¹ï¼š<br>1.å°†å¤šåª’ä½“ä¸­çš„H264è§†é¢‘æ•°æ®æŠ½å–åï¼Œå®ƒå…¶å®æ˜¯ç”±ä¸€å¸§ä¸€å¸§å‹ç¼©åçš„è§†é¢‘å¸§ç»„æˆçš„ï¼Œå¦‚ä½•åŒºåˆ†è¿™ä¸€å¸§ä¸€å¸§çš„è§†é¢‘å¸§å‘¢ï¼Ÿä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æ¯ä¸€å¸§çš„é•¿åº¦å‰é¢åŠ ä¸€ä¸ªçœŸçš„é•¿åº¦ï¼Œå½“è¯»å–ç¬¬ä¸€å¸§çš„æ—¶å€™å…ˆè¯»å–è¿™ä¸€å¸§çš„é•¿åº¦ï¼Œæ ¹æ®è¿™ä¸€å¸§çš„é•¿åº¦åœ¨è¯»å–å¸§çš„æ•°æ®é•¿åº¦ï¼Œä¾æ¬¡ä¸‹å»ã€‚ã€‚ã€‚</li>
<li>åœ¨æ¯ä¸€å¸§çš„å‰é¢åŠ å…³é”®å­—ï¼ˆç‰¹å¾ç ï¼‰ï¼Œåªè¦é‡åˆ°ç‰¹å¾ç å°±çŸ¥é“è¿™ä¸€å¸§å¼€å§‹äº†ï¼Œä¸Šä¸€å¸§ç»“æŸäº†ã€‚</li>
</ul>
<p>2.SPS/PPSï¼ˆå®ƒåªæœ‰å‡ ä¸ªå­—èŠ‚ï¼Œä¸ä¼šå¢åŠ ç½‘ç»œè´Ÿæ‹…ï¼‰<br>è§£ç çš„è§†é¢‘å‚æ•°ï¼Œä»¥åŠè§†é¢‘å¸§çš„å®½é«˜ï¼ˆä¹Ÿå°±æ˜¯å¸¸è¯´çš„è§†é¢‘åˆ†è¾¨ç‡ï¼‰ï¼Œç­‰ç­‰éƒ½æ˜¯å­˜åœ¨äºSPS/PPSã€‚</p>
<p>è§†é¢‘æ’­æ”¾æ—¶ï¼Œæ¯æ¬¡åˆ‡æ¢åˆ†è¾¨ç‡éƒ½è¦æ›´æ–°SPS/PPSã€‚</p>
<p>è€Œåœ¨è§†é¢‘ç›´æ’­æ—¶ï¼Œåœ¨æ¯ä¸ªå…³é”®å¸§é‡Œé¢éƒ½ä¼šæœ‰ä¸€ä¸ªSPS/PPSã€‚</p>
<p>3.ffmpegå¦‚ä½•è·å–SPS/PPSï¼Ÿ<br>codec-&gt;extradata</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clang -g -o extr_video  extr_video.c `pkg-config --libs libavutil libavformat`</span><br><span class="line">./extr_video ./test.mp4  test.h264</span><br><span class="line">ffplay test.h264</span><br></pre></td></tr></table></figure>

<h1 id="mp4è½¬flv"><a href="#mp4è½¬flv" class="headerlink" title="mp4è½¬flv"></a>mp4è½¬flv</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">avformat_alloc_output_context2/avformat_free_context</span><br><span class="line"></span><br><span class="line">avformat_new_stream</span><br><span class="line"></span><br><span class="line">avcodec_parameters_copy</span><br><span class="line"></span><br><span class="line">avformat_write_header  <span class="comment">#å¤´</span></span><br><span class="line"></span><br><span class="line">av_interleaved_write_frame  <span class="comment">#å¤´æ•°æ®</span></span><br><span class="line"></span><br><span class="line">av_write_trailer   <span class="comment">#å°¾</span></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clang -g -o remuxing  remuxing.c `pkg-config --libs  libavformat`</span><br><span class="line">./remuxing ./test.mp4 test.flv   </span><br><span class="line">ffplay  test.flv</span><br></pre></td></tr></table></figure>

<h1 id="éŸ³è§†é¢‘è£å‰ª"><a href="#éŸ³è§†é¢‘è£å‰ª" class="headerlink" title="éŸ³è§†é¢‘è£å‰ª"></a>éŸ³è§†é¢‘è£å‰ª</h1><p>av_seek_frame</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clang -g -o cutvideo  cutvideo.c `pkg-config --libs  libavformat  libavcodec`</span><br><span class="line">./cutvideo  10  20  ./test.mp4 cutvideo.mp4</span><br><span class="line">ffplay cutvideo.mp4</span><br></pre></td></tr></table></figure>


<h1 id="FFmpegç¼–è§£ç æ¦‚æ‹¬"><a href="#FFmpegç¼–è§£ç æ¦‚æ‹¬" class="headerlink" title="FFmpegç¼–è§£ç æ¦‚æ‹¬"></a>FFmpegç¼–è§£ç æ¦‚æ‹¬</h1><p>ç±»å‹ï¼š</p>
<ul>
<li>H264è§£ç </li>
<li>H264ç¼–ç </li>
<li>AACè§£ç </li>
<li>AACç¼–ç </li>
</ul>
<p>ç”¨åˆ°çš„å¤´æ–‡ä»¶ï¼š</p>
<ul>
<li>libavcodec/avcodec.h</li>
</ul>
<p>ç”¨åˆ°çš„ç»“æ„ä½“ï¼š</p>
<ul>
<li>AVCodecç¼–è§£ç ç»“æ„ä½“</li>
<li>AVCodecContext ç¼–è§£ç å™¨ä¸Šä¸‹æ–‡</li>
<li>AVFrame è§£ç åçš„å¸§</li>
</ul>
<p>ç»“æ„ä½“å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾APIï¼š</p>
<ul>
<li>av_frame_alloc/av_frame_free()</li>
<li>avcodec_alloc_context3()</li>
<li>avcodec_free_context()</li>
</ul>
<p>è§£ç æ­¥éª¤ï¼š</p>
<ul>
<li><code>avcodec_find_decoder</code>æŸ¥æ‰¾è§£ç å™¨</li>
<li><code>avcodec_open2</code>æ‰“å¼€è§£ç å™¨</li>
<li><code>avcodec_decode_video2</code>è§£ç ï¼Œå¾—åˆ°RGBæˆ–è€…YUVæ•°æ®</li>
</ul>
<h1 id="H264ç¼–ç "><a href="#H264ç¼–ç " class="headerlink" title="H264ç¼–ç "></a>H264ç¼–ç </h1><p>æ­¥éª¤ï¼š</p>
<ul>
<li><code>avcodec_find_encoder_by_name</code>æŸ¥çœ‹ç¼–ç å™¨</li>
<li><code>avcodec_open2</code>è®¾ç½®ç¼–ç å‚æ•°ï¼Œå¹¶æ‰“å¼€ç¼–ç å™¨</li>
<li><code>avcodec_encode_video2</code>ç¼–ç </li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  FFmpeg-demo git:(master) âœ— clang -g -o encode_video  encode_video.c `pkg-config --libs  libavcodec` </span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— ./encode_video  </span><br><span class="line">Usage: ./encode_video &lt;output file&gt; &lt;codec name&gt;</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— ./encode_video  encode_video.h264 libx264</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— ffplay encode_video.h264</span><br></pre></td></tr></table></figure>

<h1 id="è§†é¢‘è½¬å›¾ç‰‡"><a href="#è§†é¢‘è½¬å›¾ç‰‡" class="headerlink" title="è§†é¢‘è½¬å›¾ç‰‡"></a>è§†é¢‘è½¬å›¾ç‰‡</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  FFmpeg-demo git:(master) âœ— clang -g -o decode_video  decode_video.c `pkg-config --libs  libavformat libavutil libavcodec libswscale`</span><br><span class="line">âœ  FFmpeg-demo git:(master) âœ— ./decode_video ./test.mp4 ./</span><br></pre></td></tr></table></figure>



<h1 id="AACç¼–ç "><a href="#AACç¼–ç " class="headerlink" title="AACç¼–ç "></a>AACç¼–ç </h1><p>avcodec_encodec_audio2</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clang -g -o encode_audio encode_audio.c `pkg-config --libs libavcodec`</span><br><span class="line">./encode_audio encode_audio.aac</span><br><span class="line">ffplay  encode_audio.aac</span><br></pre></td></tr></table></figure>











]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>FFmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>FFmpegï¼ˆäºŒï¼‰</title>
    <url>/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<p>æ¥ç€<a href="https://samtake.github.io/2019/11/04/FFmpeg/" target="_blank" rel="noopener">FFmpegè¿™ä¸€ç¯‡</a>ï¼Œè¿™é‡Œè®°å½•FFmpegçš„å‘½ä»¤ã€‚</p>
<h1 id="å‘½ä»¤åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š"><a href="#å‘½ä»¤åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š" class="headerlink" title="å‘½ä»¤åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š"></a>å‘½ä»¤åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š</h1><ul>
<li>åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤</li>
<li>å½•åˆ¶</li>
<li>åˆ†è§£/å¤ç”¨</li>
<li>å¤„ç†åŸå§‹æ•°æ®</li>
<li>æ»¤é•œ</li>
<li>åˆ‡å‰²ä¸åˆå¹¶</li>
<li>å›¾ï¼è§†äº’è½¬</li>
<li>ç›´æ’­ç›¸å…³<br>é™¤äº† FFMPEG çš„åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤å¤–ï¼Œå…¶å®ƒå‘½ä»¤éƒ½æŒ‰ä¸‹å›¾æ‰€ç¤ºçš„æµç¨‹å¤„ç†éŸ³è§†é¢‘ã€‚</li>
</ul>
<p><img src="/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/ffmpeg%E6%92%AD%E6%94%BE%E5%A4%9A%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6%E7%9A%84%E6%B5%81%E7%A8%8B.png" alt="ffmpegæ’­æ”¾å¤šåª’ä½“æ–‡ä»¶çš„æµç¨‹"></p>
<p>ç„¶åå°†ç¼–ç çš„æ•°æ®åŒ…ä¼ é€ç»™è§£ç å™¨ï¼ˆé™¤éä¸ºæ•°æ®æµé€‰æ‹©äº†æµæ‹·è´ï¼Œè¯·å‚é˜…è¿›ä¸€æ­¥æè¿°ï¼‰ã€‚ è§£ç å™¨äº§ç”Ÿæœªå‹ç¼©çš„å¸§ï¼ˆåŸå§‹è§†é¢‘/ PCMéŸ³é¢‘/ â€¦ï¼‰ï¼Œå¯ä»¥é€šè¿‡æ»¤æ³¢è¿›ä¸€æ­¥å¤„ç†ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰ã€‚ åœ¨è¿‡æ»¤ä¹‹åï¼Œå¸§è¢«ä¼ é€’åˆ°ç¼–ç å™¨ï¼Œç¼–ç å™¨å¹¶è¾“å‡ºç¼–ç çš„æ•°æ®åŒ…ã€‚ æœ€åï¼Œè¿™äº›ä¼ é€’ç»™å¤ç”¨å™¨ï¼Œå°†ç¼–ç çš„æ•°æ®åŒ…å†™å…¥è¾“å‡ºæ–‡ä»¶ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒffmpegåªåŒ…å«è¾“å…¥æ–‡ä»¶ä¸­æ¯ç§ç±»å‹ï¼ˆè§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œå­—å¹•ï¼‰çš„ä¸€ä¸ªæµï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ¯ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­ã€‚ å®ƒæ ¹æ®ä»¥ä¸‹æ ‡å‡†æŒ‘é€‰æ¯ä¸€ä¸ªçš„â€œæœ€ä½³â€ï¼šå¯¹äºè§†é¢‘ï¼Œå®ƒæ˜¯å…·æœ‰æœ€é«˜åˆ†è¾¨ç‡çš„æµï¼Œå¯¹äºéŸ³é¢‘ï¼Œå®ƒæ˜¯å…·æœ‰æœ€å¤šchannelçš„æµï¼Œå¯¹äºå­—å¹•ï¼Œæ˜¯ç¬¬ä¸€ä¸ªå­—å¹•æµã€‚ åœ¨ç›¸åŒç±»å‹çš„å‡ ä¸ªæµç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œé€‰æ‹©å…·æœ‰æœ€ä½ç´¢å¼•çš„æµã€‚<br>æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨-vn / -an / -sn / -dné€‰é¡¹æ¥ç¦ç”¨æŸäº›é»˜è®¤è®¾ç½®ã€‚ è¦è¿›è¡Œå…¨é¢çš„æ‰‹åŠ¨æ§åˆ¶ï¼Œè¯·ä½¿ç”¨-mapé€‰é¡¹ï¼Œè¯¥é€‰é¡¹ç¦ç”¨åˆšæè¿°çš„é»˜è®¤è®¾ç½®ã€‚<br>ä¸‹é¢æˆ‘ä»¬å°±æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™äº›å‘½ä»¤ã€‚</p>
<h1 id="åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤"><a href="#åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤" class="headerlink" title="åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤"></a>åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤</h1><h2 id="åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢"><a href="#åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢" class="headerlink" title="åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢"></a>åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢</h2><p>FFMPEG å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‚æ•°è¿›è¡ŒåŸºæœ¬ä¿¡æ¯æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œæƒ³æŸ¥è¯¢ä¸€ä¸‹ç°åœ¨ä½¿ç”¨çš„ FFMPEG éƒ½æ”¯æŒå“ªäº› filterï¼Œå°±å¯ä»¥ç”¨ ffmpeg -filters æ¥æŸ¥è¯¢ã€‚è¯¦ç»†å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-version</td>
<td align="left">æ˜¾ç¤ºç‰ˆæœ¬ã€‚</td>
</tr>
<tr>
<td align="left">-formats</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„æ ¼å¼ï¼ˆåŒ…æ‹¬è®¾å¤‡ï¼‰ã€‚</td>
</tr>
<tr>
<td align="left">-demuxers</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„demuxersã€‚</td>
</tr>
<tr>
<td align="left">-muxers</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„muxersã€‚</td>
</tr>
<tr>
<td align="left">-devices</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td align="left">-codecs</td>
<td align="left">æ˜¾ç¤ºlibavcodecå·²çŸ¥çš„æ‰€æœ‰ç¼–è§£ç å™¨ã€‚</td>
</tr>
<tr>
<td align="left">-decoders</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„è§£ç å™¨ã€‚</td>
</tr>
<tr>
<td align="left">-encoders</td>
<td align="left">æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„ç¼–ç å™¨ã€‚</td>
</tr>
<tr>
<td align="left">-bsfs</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„æ¯”ç‰¹æµfilterã€‚</td>
</tr>
<tr>
<td align="left">-protocols</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„åè®®ã€‚</td>
</tr>
<tr>
<td align="left">-filters</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„libavfilterè¿‡æ»¤å™¨ã€‚</td>
</tr>
<tr>
<td align="left">-pix_fmts</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„åƒç´ æ ¼å¼ã€‚</td>
</tr>
<tr>
<td align="left">-sample_fmts</td>
<td align="left">æ˜¾ç¤ºå¯ç”¨çš„é‡‡æ ·æ ¼å¼ã€‚</td>
</tr>
<tr>
<td align="left">-layouts</td>
<td align="left">æ˜¾ç¤ºchannelåç§°å’Œæ ‡å‡†channelå¸ƒå±€ã€‚</td>
</tr>
<tr>
<td align="left">-colors</td>
<td align="left">æ˜¾ç¤ºè¯†åˆ«çš„é¢œè‰²åç§°ã€‚</td>
</tr>
</tbody></table>
<h2 id="å‘½ä»¤æ ¼å¼ä¸å‚æ•°"><a href="#å‘½ä»¤æ ¼å¼ä¸å‚æ•°" class="headerlink" title="å‘½ä»¤æ ¼å¼ä¸å‚æ•°"></a>å‘½ä»¤æ ¼å¼ä¸å‚æ•°</h2><p>æ¥ä¸‹æ¥ä»‹ç»çš„æ˜¯ FFMPEG å¤„ç†éŸ³è§†é¢‘æ—¶ä½¿ç”¨çš„å‘½ä»¤æ ¼å¼ä¸å‚æ•°ã€‚<br>ä¸‹é¢æ˜¯ FFMPEG çš„åŸºæœ¬å‘½ä»¤æ ¼å¼ï¼š<br><code>ffmpeg [global_options] {[input_file_options] -i input_url} ...</code><br>                        <code>{[output_file_options] output_url} ...</code></p>
<p><code>ffmpeg é€šè¿‡ -i é€‰é¡¹è¯»å–è¾“ä»»æ„æ•°é‡çš„è¾“å…¥â€œæ–‡ä»¶â€ï¼ˆå¯ä»¥æ˜¯å¸¸è§„æ–‡ä»¶ï¼Œç®¡é“ï¼Œç½‘ç»œæµï¼ŒæŠ“å–è®¾å¤‡ç­‰ï¼Œå¹¶å†™å…¥ä»»æ„æ•°é‡çš„è¾“å‡ºâ€œæ–‡ä»¶â€ã€‚</code></p>
<p>åŸåˆ™ä¸Šï¼Œæ¯ä¸ªè¾“å…¥/è¾“å‡ºâ€œæ–‡ä»¶â€éƒ½å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ä¸åŒç±»å‹çš„è§†é¢‘æµï¼ˆè§†é¢‘/éŸ³é¢‘/å­—å¹•/é™„ä»¶/æ•°æ®ï¼‰ã€‚ æµçš„æ•°é‡å’Œ/æˆ–ç±»å‹æ˜¯ç”±å®¹å™¨æ ¼å¼æ¥é™åˆ¶ã€‚ é€‰æ‹©ä»å“ªä¸ªè¾“å…¥è¿›å…¥åˆ°å“ªä¸ªè¾“å‡ºå°†è‡ªåŠ¨å®Œæˆæˆ–ä½¿ç”¨ -map é€‰é¡¹ã€‚<br>è¦å¼•ç”¨é€‰é¡¹ä¸­çš„è¾“å…¥æ–‡ä»¶ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨å®ƒä»¬çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰ã€‚ ä¾‹å¦‚ã€‚ ç¬¬ä¸€ä¸ªè¾“å…¥æ–‡ä»¶æ˜¯0ï¼Œç¬¬äºŒä¸ªè¾“å…¥æ–‡ä»¶æ˜¯1ï¼Œç­‰ç­‰ã€‚ç±»ä¼¼åœ°ï¼Œæ–‡ä»¶å†…çš„æµè¢«å®ƒä»¬çš„ç´¢å¼•å¼•ç”¨ã€‚ ä¾‹å¦‚ã€‚ 2ï¼š3æ˜¯æŒ‡ç¬¬ä¸‰ä¸ªè¾“å…¥æ–‡ä»¶ä¸­çš„ç¬¬å››ä¸ªæµã€‚<br>ä¸Šé¢å°±æ˜¯ FFMPEG å¤„ç†éŸ³è§†é¢‘çš„å¸¸ç”¨å‘½ä»¤ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨å‚æ•°ï¼š</p>
<h2 id="ä¸»è¦å‚æ•°"><a href="#ä¸»è¦å‚æ•°" class="headerlink" title="ä¸»è¦å‚æ•°"></a>ä¸»è¦å‚æ•°</h2><p>å‚æ•°    è¯´æ˜<br><code>-f fmtï¼ˆè¾“å…¥/è¾“å‡ºï¼‰</code>    å¼ºåˆ¶è¾“å…¥æˆ–è¾“å‡ºæ–‡ä»¶æ ¼å¼ã€‚ æ ¼å¼é€šå¸¸æ˜¯è‡ªåŠ¨æ£€æµ‹è¾“å…¥æ–‡ä»¶ï¼Œå¹¶ä»è¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶æ‰©å±•åä¸­çŒœæµ‹å‡ºæ¥ï¼Œæ‰€ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¿™ä¸ªé€‰é¡¹æ˜¯ä¸éœ€è¦çš„ã€‚<br><code>-i urlï¼ˆè¾“å…¥ï¼‰</code>    è¾“å…¥æ–‡ä»¶çš„ç½‘å€<br><code>-yï¼ˆå…¨å±€å‚æ•°ï¼‰</code>    è¦†ç›–è¾“å‡ºæ–‡ä»¶è€Œä¸è¯¢é—®ã€‚<br><code>-nï¼ˆå…¨å±€å‚æ•°ï¼‰</code>    ä¸è¦è¦†ç›–è¾“å‡ºæ–‡ä»¶ï¼Œå¦‚æœæŒ‡å®šçš„è¾“å‡ºæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¯·ç«‹å³é€€å‡ºã€‚<br><code>-c [ï¼šstream_specifier] codecï¼ˆè¾“å…¥/è¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰</code>    é€‰æ‹©ä¸€ä¸ªç¼–ç å™¨ï¼ˆå½“åœ¨è¾“å‡ºæ–‡ä»¶ä¹‹å‰ä½¿ç”¨ï¼‰æˆ–è§£ç å™¨ï¼ˆå½“åœ¨è¾“å…¥æ–‡ä»¶ä¹‹å‰ä½¿ç”¨æ—¶ï¼‰ç”¨äºä¸€ä¸ªæˆ–å¤šä¸ªæµã€‚codec æ˜¯è§£ç å™¨/ç¼–ç å™¨çš„åç§°æˆ– copyï¼ˆä»…è¾“å‡ºï¼‰ä»¥æŒ‡ç¤ºè¯¥æµä¸è¢«é‡æ–°ç¼–ç ã€‚å¦‚ï¼šffmpeg -i INPUT -map 0 -c:v libx264 -c:a copy OUTPUT<br><code>-codec [ï¼šstream_specifier]ç¼–è§£ç å™¨ï¼ˆè¾“å…¥/è¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰    åŒ -c</code>-t durationï¼ˆè¾“å…¥/è¾“å‡ºï¼‰<code>å½“ç”¨ä½œè¾“å…¥é€‰é¡¹ï¼ˆåœ¨-iä¹‹å‰ï¼‰æ—¶ï¼Œé™åˆ¶ä»è¾“å…¥æ–‡ä»¶è¯»å–çš„æ•°æ®çš„æŒç»­æ—¶é—´ã€‚å½“ç”¨ä½œè¾“å‡ºé€‰é¡¹æ—¶ï¼ˆåœ¨è¾“å‡ºurlä¹‹å‰ï¼‰ï¼Œåœ¨æŒç»­æ—¶é—´åˆ°è¾¾æŒç»­æ—¶é—´ä¹‹ååœæ­¢è¾“å‡ºã€‚</code>-ssä½ç½®ï¼ˆè¾“å…¥/è¾“å‡ºï¼‰`    å½“ç”¨ä½œè¾“å…¥é€‰é¡¹æ—¶ï¼ˆåœ¨-iä¹‹å‰ï¼‰ï¼Œåœ¨è¿™ä¸ªè¾“å…¥æ–‡ä»¶ä¸­å¯»æ‰¾ä½ç½®ã€‚ è¯·æ³¨æ„ï¼Œåœ¨å¤§å¤šæ•°æ ¼å¼ä¸­ï¼Œä¸å¯èƒ½ç²¾ç¡®æœç´¢ï¼Œå› æ­¤ffmpegå°†åœ¨ä½ç½®ä¹‹å‰å¯»æ‰¾æœ€è¿‘çš„æœç´¢ç‚¹ã€‚ å½“è½¬ç å’Œ-accurate_seekè¢«å¯ç”¨æ—¶ï¼ˆé»˜è®¤ï¼‰ï¼Œæœç´¢ç‚¹å’Œä½ç½®ä¹‹é—´çš„è¿™ä¸ªé¢å¤–çš„åˆ†æ®µå°†è¢«è§£ç å’Œä¸¢å¼ƒã€‚ å½“è¿›è¡Œæµå¼å¤åˆ¶æˆ–ä½¿ç”¨-noaccurate_seekæ—¶ï¼Œå®ƒå°†è¢«ä¿ç•™ã€‚å½“ç”¨ä½œè¾“å‡ºé€‰é¡¹ï¼ˆåœ¨è¾“å‡ºurlä¹‹å‰ï¼‰æ—¶ï¼Œè§£ç ä½†ä¸¢å¼ƒè¾“å…¥ï¼Œç›´åˆ°æ—¶é—´æˆ³åˆ°è¾¾ä½ç½®ã€‚</p>
<p><code>-frames [ï¼šstream_specifier] framecountï¼ˆoutputï¼Œper-streamï¼‰</code>    åœæ­¢åœ¨å¸§è®¡æ•°å¸§ä¹‹åå†™å…¥æµã€‚</p>
<p><code>-filter [ï¼šstream_specifier] filtergraphï¼ˆoutputï¼Œper-streamï¼‰</code>    åˆ›å»ºç”±filtergraphæŒ‡å®šçš„è¿‡æ»¤å™¨å›¾ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è¿‡æ»¤æµã€‚filtergraphæ˜¯åº”ç”¨äºæµçš„filtergraphçš„æè¿°ï¼Œå¹¶ä¸”å¿…é¡»å…·æœ‰ç›¸åŒç±»å‹çš„æµçš„å•ä¸ªè¾“å…¥å’Œå•ä¸ªè¾“å‡ºã€‚åœ¨è¿‡æ»¤å™¨å›¾å½¢ä¸­ï¼Œè¾“å…¥ä¸æ ‡ç­¾ä¸­çš„æ ‡ç­¾ç›¸å…³è”ï¼Œæ ‡ç­¾ä¸­çš„è¾“å‡ºä¸æ ‡ç­¾ç›¸å…³è”ã€‚æœ‰å…³filtergraphè¯­æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ffmpeg-filtersæ‰‹å†Œã€‚</p>
<h2 id="è§†é¢‘å‚æ•°"><a href="#è§†é¢‘å‚æ•°" class="headerlink" title="è§†é¢‘å‚æ•°"></a>è§†é¢‘å‚æ•°</h2><p>å‚æ•°    è¯´æ˜<br><code>-vframes numï¼ˆè¾“å‡ºï¼‰</code>    è®¾ç½®è¦è¾“å‡ºçš„è§†é¢‘å¸§çš„æ•°é‡ã€‚å¯¹äº-framesï¼švï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡æ—¶çš„åˆ«åï¼Œæ‚¨åº”è¯¥ä½¿ç”¨å®ƒã€‚<br><code>-r [ï¼šstream_specifier] fpsï¼ˆè¾“å…¥/è¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰</code>    è®¾ç½®å¸§ç‡ï¼ˆHzå€¼ï¼Œåˆ†æ•°æˆ–ç¼©å†™ï¼‰ã€‚ä½œä¸ºè¾“å…¥é€‰é¡¹ï¼Œå¿½ç•¥å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„ä»»ä½•æ—¶é—´æˆ³ï¼Œæ ¹æ®é€Ÿç‡ç”Ÿæˆæ–°çš„æ—¶é—´æˆ³ã€‚è¿™ä¸ç”¨äº-framerateé€‰é¡¹ä¸åŒï¼ˆå®ƒåœ¨FFmpegçš„æ—§ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„ï¼‰ã€‚å¦‚æœæœ‰ç–‘é—®ï¼Œè¯·ä½¿ç”¨-framerateè€Œä¸æ˜¯è¾“å…¥é€‰é¡¹-rã€‚ä½œä¸ºè¾“å‡ºé€‰é¡¹ï¼Œå¤åˆ¶æˆ–ä¸¢å¼ƒè¾“å…¥å¸§ä»¥å®ç°æ’å®šè¾“å‡ºå¸§é¢‘fpsã€‚<br><code>-s [ï¼šstream_specifier]å¤§å°ï¼ˆè¾“å…¥/è¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰</code>    è®¾ç½®çª—å£å¤§å°ã€‚ä½œä¸ºè¾“å…¥é€‰é¡¹ï¼Œè¿™æ˜¯video_sizeä¸“ç”¨é€‰é¡¹çš„å¿«æ·æ–¹å¼ï¼Œç”±æŸäº›åˆ†å¸§å™¨è¯†åˆ«ï¼Œå…¶å¸§å°ºå¯¸æœªè¢«å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ã€‚ä½œä¸ºè¾“å‡ºé€‰é¡¹ï¼Œè¿™ä¼šå°†ç¼©æ”¾è§†é¢‘è¿‡æ»¤å™¨æ’å…¥åˆ°ç›¸åº”è¿‡æ»¤å™¨å›¾å½¢çš„æœ«å°¾ã€‚è¯·ç›´æ¥ä½¿ç”¨æ¯”ä¾‹è¿‡æ»¤å™¨å°†å…¶æ’å…¥åˆ°å¼€å¤´æˆ–å…¶ä»–åœ°æ–¹ã€‚æ ¼å¼æ˜¯â€™wxhâ€™ï¼ˆé»˜è®¤ - ä¸æºç›¸åŒï¼‰ã€‚<br><code>-aspect [ï¼šstream_specifier] å®½é«˜æ¯”ï¼ˆè¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰</code>    è®¾ç½®æ–¹é¢æŒ‡å®šçš„è§†é¢‘æ˜¾ç¤ºå®½é«˜æ¯”ã€‚aspectå¯ä»¥æ˜¯æµ®ç‚¹æ•°å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯numï¼šdenå½¢å¼çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­numå’Œdenæ˜¯å®½é«˜æ¯”çš„åˆ†å­å’Œåˆ†æ¯ã€‚ä¾‹å¦‚â€œ4ï¼š3â€ï¼Œâ€œ16ï¼š9â€ï¼Œâ€œ1.3333â€å’Œâ€œ1.7777â€æ˜¯æœ‰æ•ˆçš„å‚æ•°å€¼ã€‚å¦‚æœä¸-vcodecå‰¯æœ¬ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™ä¼šå½±å“å­˜å‚¨åœ¨å®¹å™¨çº§åˆ«çš„å®½é«˜æ¯”ï¼Œä½†ä¸ä¼šå½±å“å­˜å‚¨åœ¨ç¼–ç å¸§ä¸­çš„å®½é«˜æ¯”ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚<br><code>-vnï¼ˆè¾“å‡ºï¼‰</code>    ç¦ç”¨è§†é¢‘å½•åˆ¶ã€‚<br><code>-vcodecç¼–è§£ç å™¨ï¼ˆè¾“å‡ºï¼‰</code>    è®¾ç½®è§†é¢‘ç¼–è§£ç å™¨ã€‚è¿™æ˜¯-codecï¼švçš„åˆ«åã€‚<br><code>-vf filtergraphï¼ˆè¾“å‡ºï¼‰</code>    åˆ›å»ºç”±filtergraphæŒ‡å®šçš„è¿‡æ»¤å™¨å›¾ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è¿‡æ»¤æµã€‚</p>
<h2 id="éŸ³é¢‘å‚æ•°"><a href="#éŸ³é¢‘å‚æ•°" class="headerlink" title="éŸ³é¢‘å‚æ•°"></a>éŸ³é¢‘å‚æ•°</h2><p>å‚æ•°    è¯´æ˜<br><code>-aframesï¼ˆè¾“å‡ºï¼‰</code>    è®¾ç½®è¦è¾“å‡ºçš„éŸ³é¢‘å¸§çš„æ•°é‡ã€‚è¿™æ˜¯-framesï¼šaçš„ä¸€ä¸ªè¿‡æ—¶çš„åˆ«åã€‚<br><code>-ar [ï¼šstream_specifier] freqï¼ˆè¾“å…¥/è¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰</code>    è®¾ç½®éŸ³é¢‘é‡‡æ ·é¢‘ç‡ã€‚å¯¹äºè¾“å‡ºæµï¼Œå®ƒé»˜è®¤è®¾ç½®ä¸ºç›¸åº”è¾“å…¥æµçš„é¢‘ç‡ã€‚å¯¹äºè¾“å…¥æµï¼Œæ­¤é€‰é¡¹ä»…é€‚ç”¨äºéŸ³é¢‘æ•è·è®¾å¤‡å’ŒåŸå§‹åˆ†è·¯å™¨ï¼Œå¹¶æ˜ å°„åˆ°ç›¸åº”çš„åˆ†è·¯å™¨é€‰ä»¶ã€‚<br><code>-ac [ï¼šstream_specifier]é€šé“ï¼ˆè¾“å…¥/è¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰</code>    è®¾ç½®éŸ³é¢‘é€šé“çš„æ•°é‡ã€‚å¯¹äºè¾“å‡ºæµï¼Œå®ƒé»˜è®¤è®¾ç½®ä¸ºè¾“å…¥éŸ³é¢‘é€šé“çš„æ•°é‡ã€‚å¯¹äºè¾“å…¥æµï¼Œæ­¤é€‰é¡¹ä»…é€‚ç”¨äºéŸ³é¢‘æ•è·è®¾å¤‡å’ŒåŸå§‹åˆ†è·¯å™¨ï¼Œå¹¶æ˜ å°„åˆ°ç›¸åº”çš„åˆ†è·¯å™¨é€‰ä»¶ã€‚<br><code>-anï¼ˆè¾“å‡ºï¼‰</code>    ç¦ç”¨å½•éŸ³ã€‚<br><code>-acodecç¼–è§£ç å™¨ï¼ˆè¾“å…¥/è¾“å‡ºï¼‰</code>    è®¾ç½®éŸ³é¢‘ç¼–è§£ç å™¨ã€‚è¿™æ˜¯-codecçš„åˆ«åï¼šaã€‚<br><code>-sample_fmt [ï¼šstream_specifier] sample_fmtï¼ˆè¾“å‡ºï¼Œæ¯ä¸ªæµï¼‰</code>    è®¾ç½®éŸ³é¢‘é‡‡æ ·æ ¼å¼ã€‚ä½¿ç”¨-sample_fmtsè·å–æ”¯æŒçš„æ ·æœ¬æ ¼å¼åˆ—è¡¨ã€‚<br><code>-af filtergraphï¼ˆè¾“å‡ºï¼‰</code>    åˆ›å»ºç”±filtergraphæŒ‡å®šçš„è¿‡æ»¤å™¨å›¾ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è¿‡æ»¤æµã€‚<br>äº†è§£äº†è¿™äº›åŸºæœ¬ä¿¡æ¯åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ FFMPEG å…·ä½“éƒ½èƒ½å¹²äº›ä»€ä¹ˆå§ã€‚</p>
<h2 id="å½•åˆ¶"><a href="#å½•åˆ¶" class="headerlink" title="å½•åˆ¶"></a>å½•åˆ¶</h2><p>é¦–å…ˆé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ mac ä¸Šéƒ½æœ‰å“ªäº›è®¾å¤‡ã€‚<br><code>ffmpeg -f avfoundation -list_devices true -i &quot;&quot;</code></p>
<h3 id="å½•å±"><a href="#å½•å±" class="headerlink" title="å½•å±"></a>å½•å±</h3><p><code>ffmpeg -f avfoundation -i 1 -r 30 out.yuv</code></p>
<ul>
<li>-f æŒ‡å®šä½¿ç”¨ avfoundation é‡‡é›†æ•°æ®ã€‚</li>
<li>-i æŒ‡å®šä»å“ªå„¿é‡‡é›†æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ç´¢å¼•å·ã€‚åœ¨æˆ‘çš„MACä¸Šï¼Œ1ä»£è¡¨æ¡Œé¢ï¼ˆå¯ä»¥é€šè¿‡ä¸Šé¢çš„å‘½ä»¤æŸ¥è¯¢è®¾å¤‡ç´¢å¼•å·ï¼‰ã€‚</li>
<li>-r æŒ‡å®šå¸§ç‡ã€‚æŒ‰ffmpegå®˜æ–¹æ–‡æ¡£è¯´-rä¸-framerateä½œç”¨ç›¸åŒï¼Œä½†å®é™…æµ‹è¯•æ—¶å‘ç°ä¸åŒã€‚-framerate ç”¨äºé™åˆ¶è¾“å…¥ï¼Œè€Œ-rç”¨äºé™åˆ¶è¾“å‡ºã€‚<br>æ³¨æ„ï¼Œæ¡Œé¢çš„è¾“å…¥å¯¹å¸§ç‡æ²¡æœ‰è¦æ±‚ï¼Œæ‰€ä»¥ä¸ç”¨é™åˆ¶æ¡Œé¢çš„å¸§ç‡ã€‚å…¶å®é™åˆ¶äº†ä¹Ÿæ²¡ç”¨ã€‚</li>
</ul>
<h3 id="å½•å±-å£°éŸ³"><a href="#å½•å±-å£°éŸ³" class="headerlink" title="å½•å±+å£°éŸ³"></a>å½•å±+å£°éŸ³</h3><p><code>ffmpeg  -f avfoundation -i 1:0  -r 29.97 -c:v libx264 -crf 0 -c:a libfdk_aac -profile:a aac_he_v2 -b:a 32k  out.flv</code></p>
<ul>
<li>-i 1:0 å†’å·å‰é¢çš„ â€œ1â€ ä»£è¡¨çš„å±å¹•ç´¢å¼•å·ã€‚å†’å·åé¢çš„â€0â€ä»£è¡¨çš„å£°éŸ³ç´¢ç›¸å·ã€‚</li>
<li>-c:v ä¸å‚æ•° -vcodec ä¸€æ ·ï¼Œè¡¨ç¤ºè§†é¢‘ç¼–ç å™¨ã€‚c æ˜¯ codec çš„ç¼©å†™ï¼Œv æ˜¯videoçš„ç¼©å†™ã€‚</li>
<li>-crf æ˜¯ x264 çš„å‚æ•°ã€‚ 0 è¡¨å¼æ— æŸå‹ç¼©ã€‚</li>
<li>-c:a ä¸å‚æ•° -acodec ä¸€æ ·ï¼Œè¡¨ç¤ºéŸ³é¢‘ç¼–ç å™¨ã€‚</li>
<li>-profile æ˜¯ fdk_aac çš„å‚æ•°ã€‚ aac_he_v2 è¡¨å¼ä½¿ç”¨ AAC_HE v2 å‹ç¼©æ•°æ®ã€‚</li>
<li>-b:a æŒ‡å®šéŸ³é¢‘ç ç‡ã€‚ b æ˜¯ bitrateçš„ç¼©å†™, aæ˜¯ audioçš„ç¼©ä¸ã€‚</li>
</ul>
<h3 id="å½•è§†é¢‘"><a href="#å½•è§†é¢‘" class="headerlink" title="å½•è§†é¢‘"></a>å½•è§†é¢‘</h3><p><code>ffmpeg -framerate 30 -f avfoundation -i 0 out.mp4</code> </p>
<ul>
<li>-framerate é™åˆ¶è§†é¢‘çš„é‡‡é›†å¸§ç‡ã€‚è¿™ä¸ªå¿…é¡»è¦æ ¹æ®æç¤ºè¦æ±‚è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœä¸è®¾ç½®å°±ä¼šæŠ¥é”™ã€‚</li>
<li>-f æŒ‡å®šä½¿ç”¨ avfoundation é‡‡é›†æ•°æ®ã€‚</li>
<li>-i æŒ‡å®šè§†é¢‘è®¾å¤‡çš„ç´¢å¼•å·ã€‚</li>
</ul>
<h3 id="è§†é¢‘-éŸ³é¢‘"><a href="#è§†é¢‘-éŸ³é¢‘" class="headerlink" title="è§†é¢‘+éŸ³é¢‘"></a>è§†é¢‘+éŸ³é¢‘</h3><p><code>ffmpeg -framerate 30 -f avfoundation -i 0:0 out.mp4</code> </p>
<h3 id="å½•éŸ³"><a href="#å½•éŸ³" class="headerlink" title="å½•éŸ³"></a>å½•éŸ³</h3><p><code>ffmpeg -f avfoundation -i :0 out.wav</code></p>
<h3 id="å½•åˆ¶éŸ³é¢‘è£¸æ•°æ®"><a href="#å½•åˆ¶éŸ³é¢‘è£¸æ•°æ®" class="headerlink" title="å½•åˆ¶éŸ³é¢‘è£¸æ•°æ®"></a>å½•åˆ¶éŸ³é¢‘è£¸æ•°æ®</h3><p><code>ffmpeg  -f avfoundation -i :0 -ar 44100 -f s16le out.pcm</code></p>
<h2 id="åˆ†è§£ä¸å¤ç”¨"><a href="#åˆ†è§£ä¸å¤ç”¨" class="headerlink" title="åˆ†è§£ä¸å¤ç”¨"></a>åˆ†è§£ä¸å¤ç”¨</h2><p>æµæ‹·è´æ˜¯é€šè¿‡å°† copy å‚æ•°æä¾›ç»™-codecé€‰é¡¹æ¥é€‰æ‹©æµçš„æ¨¡å¼ã€‚å®ƒä½¿å¾—ffmpegçœç•¥äº†æŒ‡å®šæµçš„è§£ç å’Œç¼–ç æ­¥éª¤ï¼Œæ‰€ä»¥å®ƒåªèƒ½è¿›è¡Œå¤šè·¯åˆ†è§£å’Œå¤šè·¯å¤ç”¨ã€‚ è¿™å¯¹äºæ›´æ”¹å®¹å™¨æ ¼å¼æˆ–ä¿®æ”¹å®¹å™¨çº§å…ƒæ•°æ®å¾ˆæœ‰ç”¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šå›¾å°†ç®€åŒ–ä¸ºï¼š</p>
<p><img src="/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%88%86%E8%A7%A3%E4%B8%8E%E5%A4%8D%E7%94%A8.png" alt="åˆ†è§£ä¸å¤ç”¨"></p>
<p>ç”±äºæ²¡æœ‰è§£ç æˆ–ç¼–ç ï¼Œé€Ÿåº¦éå¸¸å¿«ï¼Œæ²¡æœ‰è´¨é‡æŸå¤±ã€‚ ä½†æ˜¯ï¼Œç”±äºè®¸å¤šå› ç´ ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚ åº”ç”¨è¿‡æ»¤å™¨æ˜¾ç„¶ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºè¿‡æ»¤å™¨å¤„ç†æœªå‹ç¼©çš„æ•°æ®ã€‚</p>
<h3 id="æŠ½å–éŸ³é¢‘æµ"><a href="#æŠ½å–éŸ³é¢‘æµ" class="headerlink" title="æŠ½å–éŸ³é¢‘æµ"></a>æŠ½å–éŸ³é¢‘æµ</h3><p><code>ffmpeg -i input.mp4 -acodec copy -vn out.aac</code></p>
<ul>
<li>acodec: æŒ‡å®šéŸ³é¢‘ç¼–ç å™¨ï¼Œcopy æŒ‡æ˜åªæ‹·è´ï¼Œä¸åšç¼–è§£ç ã€‚</li>
<li>vn: v ä»£è¡¨è§†é¢‘ï¼Œn ä»£è¡¨ no ä¹Ÿå°±æ˜¯æ— è§†é¢‘çš„æ„æ€ã€‚</li>
</ul>
<h3 id="æŠ½å–è§†é¢‘æµ"><a href="#æŠ½å–è§†é¢‘æµ" class="headerlink" title="æŠ½å–è§†é¢‘æµ"></a>æŠ½å–è§†é¢‘æµ</h3><p><code>ffmpeg -i input.mp4 -vcodec copy -an out.h264</code></p>
<ul>
<li>vcodec: æŒ‡å®šè§†é¢‘ç¼–ç å™¨ï¼Œcopy æŒ‡æ˜åªæ‹·è´ï¼Œä¸åšç¼–è§£ç ã€‚</li>
<li>an: a ä»£è¡¨è§†é¢‘ï¼Œn ä»£è¡¨ no ä¹Ÿå°±æ˜¯æ— éŸ³é¢‘çš„æ„æ€ã€‚</li>
</ul>
<h3 id="è½¬æ ¼å¼"><a href="#è½¬æ ¼å¼" class="headerlink" title="è½¬æ ¼å¼"></a>è½¬æ ¼å¼</h3><p><code>ffmpeg -i out.mp4 -vcodec copy -acodec copy out.flv</code><br>ä¸Šé¢çš„å‘½ä»¤è¡¨å¼çš„æ˜¯éŸ³é¢‘ã€è§†é¢‘éƒ½ç›´æ¥ copyï¼Œåªæ˜¯å°† mp4 çš„å°è£…æ ¼å¼è½¬æˆäº†flvã€‚</p>
<h3 id="éŸ³è§†é¢‘åˆå¹¶"><a href="#éŸ³è§†é¢‘åˆå¹¶" class="headerlink" title="éŸ³è§†é¢‘åˆå¹¶"></a>éŸ³è§†é¢‘åˆå¹¶</h3><p><code>ffmpeg -i out.h264 -i out.aac -vcodec copy -acodec copy out.mp4</code></p>
<h2 id="å¤„ç†åŸå§‹æ•°æ®"><a href="#å¤„ç†åŸå§‹æ•°æ®" class="headerlink" title="å¤„ç†åŸå§‹æ•°æ®"></a>å¤„ç†åŸå§‹æ•°æ®</h2><h3 id="æå–YUVæ•°æ®"><a href="#æå–YUVæ•°æ®" class="headerlink" title="æå–YUVæ•°æ®"></a>æå–YUVæ•°æ®</h3><p><code>ffmpeg -i input.mp4 -an -c:v rawvideo -pixel_format yuv420p out.yuv
ffplay -s wxh out.yuv</code></p>
<ul>
<li>-c:v rawvideo æŒ‡å®šå°†è§†é¢‘è½¬æˆåŸå§‹æ•°æ®</li>
<li>-pixel_format yuv420p æŒ‡å®šè½¬æ¢æ ¼å¼ä¸ºyuv420p</li>
</ul>
<h3 id="YUVè½¬H264"><a href="#YUVè½¬H264" class="headerlink" title="YUVè½¬H264"></a>YUVè½¬H264</h3><p><code>ffmpeg -f rawvideo -pix_fmt yuv420p -s 320x240 -r 30 -i out.yuv -c:v libx264 -f rawvideo out.h264</code></p>
<h3 id="æå–PCMæ•°æ®"><a href="#æå–PCMæ•°æ®" class="headerlink" title="æå–PCMæ•°æ®"></a>æå–PCMæ•°æ®</h3><p><code>ffmpeg -i out.mp4 -vn -ar 44100 -ac 2 -f s16le out.pcm
ffplay -ar 44100 -ac 2 -f s16le -i out.pcm</code></p>
<h3 id="PCMè½¬WAV"><a href="#PCMè½¬WAV" class="headerlink" title="PCMè½¬WAV"></a>PCMè½¬WAV</h3><p><code>ffmpeg -f s16be -ar 8000 -ac 2 -acodec pcm_s16be -i input.raw output.wav</code></p>
<h2 id="æ»¤é•œ"><a href="#æ»¤é•œ" class="headerlink" title="æ»¤é•œ"></a>æ»¤é•œ</h2><p>åœ¨ç¼–ç ä¹‹å‰ï¼Œffmpegå¯ä»¥ä½¿ç”¨libavfilteråº“ä¸­çš„è¿‡æ»¤å™¨å¤„ç†åŸå§‹éŸ³é¢‘å’Œè§†é¢‘å¸§ã€‚ å‡ ä¸ªé“¾å¼è¿‡æ»¤å™¨å½¢æˆä¸€ä¸ªè¿‡æ»¤å™¨å›¾å½¢ã€‚ ffmpegåŒºåˆ†ä¸¤ç§ç±»å‹çš„è¿‡æ»¤å™¨å›¾å½¢ï¼šç®€å•å’Œå¤æ‚ã€‚</p>
<h3 id="ç®€å•æ»¤é•œ"><a href="#ç®€å•æ»¤é•œ" class="headerlink" title="ç®€å•æ»¤é•œ"></a>ç®€å•æ»¤é•œ</h3><p>ç®€å•çš„è¿‡æ»¤å™¨å›¾æ˜¯é‚£äº›åªæœ‰ä¸€ä¸ªè¾“å…¥å’Œè¾“å‡ºï¼Œéƒ½æ˜¯ç›¸åŒçš„ç±»å‹ã€‚ åœ¨ä¸Šé¢çš„å›¾ä¸­ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡åœ¨è§£ç å’Œç¼–ç ä¹‹é—´æ’å…¥ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤æ¥è¡¨ç¤ºï¼š</p>
<p><img src="/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/%E7%AE%80%E5%8D%95%E6%BB%A4%E9%95%9C1.png" alt="ç®€å•æ»¤é•œ1"></p>
<p>ç®€å•çš„filtergraphsé…ç½®äº†per-stream-filteré€‰é¡¹ï¼ˆåˆ†åˆ«ä¸ºè§†é¢‘å’ŒéŸ³é¢‘ä½¿ç”¨-vfå’Œ-afåˆ«åï¼‰ã€‚ ä¸€ä¸ªç®€å•çš„è§†é¢‘filtergraphå¯ä»¥çœ‹èµ·æ¥åƒè¿™æ ·çš„ä¾‹å­ï¼š</p>
<p><img src="/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/%E7%AE%80%E5%8D%95%E6%BB%A4%E9%95%9C2.png" alt="ç®€å•æ»¤é•œ2"></p>
<p>è¯·æ³¨æ„ï¼ŒæŸäº›æ»¤é•œä¼šæ›´æ”¹å¸§å±æ€§ï¼Œä½†ä¸ä¼šæ”¹å˜å¸§å†…å®¹ã€‚ ä¾‹å¦‚ã€‚ ä¸Šä¾‹ä¸­çš„fpsè¿‡æ»¤å™¨ä¼šæ”¹å˜å¸§æ•°ï¼Œä½†ä¸ä¼šè§¦åŠå¸§å†…å®¹ã€‚ å¦ä¸€ä¸ªä¾‹å­æ˜¯setptsè¿‡æ»¤å™¨ï¼Œå®ƒåªè®¾ç½®æ—¶é—´æˆ³ï¼Œå¦åˆ™ä¸æ”¹å˜å¸§ã€‚</p>
<h3 id="å¤æ‚æ»¤é•œ"><a href="#å¤æ‚æ»¤é•œ" class="headerlink" title="å¤æ‚æ»¤é•œ"></a>å¤æ‚æ»¤é•œ</h3><p>å¤æ‚çš„è¿‡æ»¤å™¨å›¾æ˜¯é‚£äº›ä¸èƒ½ç®€å•æè¿°ä¸ºåº”ç”¨äºä¸€ä¸ªæµçš„çº¿æ€§å¤„ç†é“¾çš„è¿‡æ»¤å™¨å›¾ã€‚ ä¾‹å¦‚ï¼Œå½“å›¾å½¢æœ‰å¤šä¸ªè¾“å…¥å’Œ/æˆ–è¾“å‡ºï¼Œæˆ–è€…å½“è¾“å‡ºæµç±»å‹ä¸è¾“å…¥ä¸åŒæ—¶ï¼Œå°±æ˜¯è¿™ç§æƒ…å†µã€‚ ä»–ä»¬å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼š</p>
<p><img src="/2020/03/23/FFmpeg%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%A4%8D%E6%9D%82%E6%BB%A4%E9%95%9C1.png" alt="å¤æ‚æ»¤é•œ1.png"></p>
<p>å¤æ‚çš„è¿‡æ»¤å™¨å›¾ä½¿ç”¨-filter_complexé€‰é¡¹è¿›è¡Œé…ç½®ã€‚ è¯·æ³¨æ„ï¼Œæ­¤é€‰é¡¹æ˜¯å…¨å±€æ€§çš„ï¼Œå› ä¸ºå¤æ‚çš„è¿‡æ»¤å™¨å›¾å½¢æœ¬è´¨ä¸Šä¸èƒ½ä¸å•ä¸ªæµæˆ–æ–‡ä»¶æ˜ç¡®å…³è”ã€‚<br>-lavfié€‰é¡¹ç­‰åŒäº-filter_complexã€‚<br>ä¸€ä¸ªå¤æ‚çš„è¿‡æ»¤å™¨å›¾çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯è¦†ç›–è¿‡æ»¤å™¨ï¼Œå®ƒæœ‰ä¸¤ä¸ªè§†é¢‘è¾“å…¥å’Œä¸€ä¸ªè§†é¢‘è¾“å‡ºï¼ŒåŒ…å«ä¸€ä¸ªè§†é¢‘å åŠ åœ¨å¦ä¸€ä¸ªä¸Šé¢ã€‚ å®ƒçš„éŸ³é¢‘å¯¹åº”æ˜¯amixæ»¤æ³¢å™¨ã€‚</p>
<h3 id="æ·»åŠ æ°´å°"><a href="#æ·»åŠ æ°´å°" class="headerlink" title="æ·»åŠ æ°´å°"></a>æ·»åŠ æ°´å°</h3><p><code>ffmpeg -i out.mp4  -vf &quot;movie=logo.png,scale=64:48[watermask];[in][watermask] overlay=30:10 [out]&quot; water.mp4</code></p>
<ul>
<li>-vfä¸­çš„ movie æŒ‡å®šlogoä½ç½®ã€‚scale æŒ‡å®š logo å¤§å°ã€‚overlay æŒ‡å®š logo æ‘†æ”¾çš„ä½ç½®ã€‚<h3 id="åˆ é™¤æ°´å°"><a href="#åˆ é™¤æ°´å°" class="headerlink" title="åˆ é™¤æ°´å°"></a>åˆ é™¤æ°´å°</h3>å…ˆé€šè¿‡ ffplay æ‰¾åˆ°è¦åˆ é™¤ LOGO çš„ä½ç½®<br><code>ffplay -i test.flv -vf delogo=x=806:y=20:w=70:h=80:show=1</code><br>ä½¿ç”¨ delogo æ»¤é•œåˆ é™¤ LOGO<br><code>ffmpeg -i test.flv -vf delogo=x=806:y=20:w=70:h=80 output.flv</code><h3 id="è§†é¢‘ç¼©å°ä¸€å€"><a href="#è§†é¢‘ç¼©å°ä¸€å€" class="headerlink" title="è§†é¢‘ç¼©å°ä¸€å€"></a>è§†é¢‘ç¼©å°ä¸€å€</h3><code>ffmpeg -i out.mp4 -vf scale=iw/2:-1 scale.mp4</code></li>
<li>vf scale æŒ‡å®šä½¿ç”¨ç®€å•è¿‡æ»¤å™¨ scaleï¼Œiw/2:-1 ä¸­çš„ iw æŒ‡å®šæŒ‰æ•´å‹å–è§†é¢‘çš„å®½åº¦ã€‚ -1 è¡¨ç¤ºé«˜åº¦éšå®½åº¦ä¸€èµ·å˜åŒ–ã€‚<h3 id="è§†é¢‘è£å‰ª"><a href="#è§†é¢‘è£å‰ª" class="headerlink" title="è§†é¢‘è£å‰ª"></a>è§†é¢‘è£å‰ª</h3><code>ffmpeg -i VR.mov  -vf crop=in_w-200:in_h-200 -c:v libx264 -c:a copy -video_size 1280x720 vr_new.mp4</code><br>crop æ ¼å¼ï¼šcrop=out_w:out_h:x:y</li>
<li>out_w: è¾“å‡ºçš„å®½åº¦ã€‚å¯ä»¥ä½¿ç”¨ in_w è¡¨å¼è¾“å…¥è§†é¢‘çš„å®½åº¦ã€‚</li>
<li>out_h: è¾“å‡ºçš„é«˜åº¦ã€‚å¯ä»¥ä½¿ç”¨ in_h è¡¨å¼è¾“å…¥è§†é¢‘çš„é«˜åº¦ã€‚</li>
<li>x : Xåæ ‡</li>
<li>y : Yåæ ‡</li>
</ul>
<p>å¦‚æœ xå’Œy è®¾ç½®ä¸º 0,è¯´æ˜ä»å·¦ä¸Šè§’å¼€å§‹è£å‰ªã€‚å¦‚æœä¸å†™æ˜¯ä»ä¸­å¿ƒç‚¹è£å‰ªã€‚</p>
<h3 id="å€é€Ÿæ’­æ”¾"><a href="#å€é€Ÿæ’­æ”¾" class="headerlink" title="å€é€Ÿæ’­æ”¾"></a>å€é€Ÿæ’­æ”¾</h3><p><code>ffmpeg -i out.mp4 -filter_complex &quot;[0:v]setpts=0.5*PTS[v];[0:a]atempo=2.0[a]&quot; -map &quot;[v]&quot; -map &quot;[a]&quot; speed2.0.mp4</code></p>
<ul>
<li>-filter_complex å¤æ‚æ»¤é•œï¼Œ[0:v]è¡¨ç¤ºç¬¬ä¸€ä¸ªï¼ˆæ–‡ä»¶ç´¢å¼•å·æ˜¯0ï¼‰æ–‡ä»¶çš„è§†é¢‘ä½œä¸ºè¾“å…¥ã€‚setpts=0.5*PTSè¡¨ç¤ºæ¯å¸§è§†é¢‘çš„ptsæ—¶é—´æˆ³éƒ½ä¹˜0.5 ï¼Œä¹Ÿå°±æ˜¯å·®å°‘ä¸€åŠã€‚[v]è¡¨ç¤ºè¾“å‡ºçš„åˆ«åã€‚éŸ³é¢‘åŒç†å°±ä¸è¯¦è¿°äº†ã€‚</li>
<li>map å¯ç”¨äºå¤„ç†å¤æ‚è¾“å‡ºï¼Œå¦‚å¯ä»¥å°†æŒ‡å®šçš„å¤šè·¯æµè¾“å‡ºåˆ°ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¾“å‡ºåˆ°å¤šä¸ªæ–‡ä»¶ã€‚â€[v]â€ å¤æ‚æ»¤é•œè¾“å‡ºçš„åˆ«åä½œä¸ºè¾“å‡ºæ–‡ä»¶çš„ä¸€è·¯æµã€‚ä¸Šé¢ mapçš„ç”¨æ³•æ˜¯å°†å¤æ‚æ»¤é•œè¾“å‡ºçš„è§†é¢‘å’ŒéŸ³é¢‘è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚</li>
</ul>
<h3 id="å¯¹ç§°è§†é¢‘"><a href="#å¯¹ç§°è§†é¢‘" class="headerlink" title="å¯¹ç§°è§†é¢‘"></a>å¯¹ç§°è§†é¢‘</h3><p><code>ffmpeg  -i out.mp4 -filter_complex &quot;[0:v]pad=w=2*iw[a];[0:v]hflip[b];[a][b]overlay=x=w&quot; duicheng.mp4</code></p>
<ul>
<li>hflip æ°´å¹³ç¿»è½¬<br>å¦‚æœè¦ä¿®æ”¹ä¸ºå‚ç›´ç¿»è½¬å¯ä»¥ç”¨vflipã€‚<h3 id="ç”»ä¸­ç”»"><a href="#ç”»ä¸­ç”»" class="headerlink" title="ç”»ä¸­ç”»"></a>ç”»ä¸­ç”»</h3><code>ffmpeg -i out.mp4 -i out1.mp4 -filter_complex &quot;[1:v]scale=w=176:h=144:force_original_aspect_ratio=decrease[ckout];[0:v][ckout]overlay=x=W-w-10:y=0[out]&quot; -map &quot;[out]&quot; -movflags faststart new.mp4</code></li>
</ul>
<h3 id="å½•åˆ¶ç”»ä¸­ç”»"><a href="#å½•åˆ¶ç”»ä¸­ç”»" class="headerlink" title="å½•åˆ¶ç”»ä¸­ç”»"></a>å½•åˆ¶ç”»ä¸­ç”»</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ffmpeg  -f avfoundation -i <span class="string">"1"</span> -framerate 30 -f avfoundation -i <span class="string">"0:0"</span></span><br><span class="line">-r 30 -c:v libx264 -preset ultrafast </span><br><span class="line">-c:a libfdk_aac -profile:a aac_he_v2 -ar 44100 -ac 2 </span><br><span class="line">-filter_complex <span class="string">"[1:v]scale=w=176:h=144:force_original_aspect_ratio=decrease[a];[0:v][a]overlay=x=W-w-10:y=0[out]"</span> </span><br><span class="line">-map <span class="string">"[out]"</span> -movflags faststart -map 1:a b.mp4</span><br></pre></td></tr></table></figure>

<h3 id="å¤šè·¯è§†é¢‘æ‹¼æ¥"><a href="#å¤šè·¯è§†é¢‘æ‹¼æ¥" class="headerlink" title="å¤šè·¯è§†é¢‘æ‹¼æ¥"></a>å¤šè·¯è§†é¢‘æ‹¼æ¥</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ffmpeg  -f avfoundation -i <span class="string">"1"</span> -framerate 30 -f avfoundation   -i <span class="string">"0:0"</span> -r 30 -c:v libx264 -preset ultrafast -c:a libfdk_aac -profile:a aac_he_v2 -ar 44100 -ac 2 -filter_complex <span class="string">"[0:v]scale=320:240[a];[a]pad=640:240[b];[b][1:v]overlay=320:0[out]"</span> -map <span class="string">"[out]"</span> -movflags faststart  -map 1:a  c.mp4</span><br></pre></td></tr></table></figure>

<h2 id="éŸ³è§†é¢‘çš„æ‹¼æ¥ä¸è£å‰ª"><a href="#éŸ³è§†é¢‘çš„æ‹¼æ¥ä¸è£å‰ª" class="headerlink" title="éŸ³è§†é¢‘çš„æ‹¼æ¥ä¸è£å‰ª"></a>éŸ³è§†é¢‘çš„æ‹¼æ¥ä¸è£å‰ª</h2><h3 id="è£å‰ª"><a href="#è£å‰ª" class="headerlink" title="è£å‰ª"></a>è£å‰ª</h3><p><code>ffmpeg -i out.mp4 -ss 00:00:00 -t 10 out1.mp4</code></p>
<ul>
<li>-ss æŒ‡å®šè£å‰ªçš„å¼€å§‹æ—¶é—´ï¼Œç²¾ç¡®åˆ°ç§’</li>
<li>-t è¢«è£å‰ªåçš„æ—¶é•¿ã€‚</li>
</ul>
<h3 id="åˆå¹¶"><a href="#åˆå¹¶" class="headerlink" title="åˆå¹¶"></a>åˆå¹¶</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª inputs.txt æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">file <span class="string">'1.flv'</span></span><br><span class="line">file <span class="string">'2.flv'</span></span><br><span class="line">file <span class="string">'3.flv'</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š<br><code>ffmpeg -f concat -i inputs.txt -c copy output.flv</code></p>
<p>hlsåˆ‡ç‰‡<br><code>ffmpeg -i out.mp4 -c:v libx264 -c:a libfdk_aac -strict -2 -f hls  out.m3u8</code></p>
<ul>
<li>-strict -2 æŒ‡æ˜éŸ³é¢‘ä½¿æœ‰AACã€‚</li>
<li>-f hls è½¬æˆ m3u8 æ ¼å¼ã€‚</li>
</ul>
<h2 id="è§†é¢‘å›¾ç‰‡äº’è½¬"><a href="#è§†é¢‘å›¾ç‰‡äº’è½¬" class="headerlink" title="è§†é¢‘å›¾ç‰‡äº’è½¬"></a>è§†é¢‘å›¾ç‰‡äº’è½¬</h2><h3 id="è§†é¢‘è½¬JPEG"><a href="#è§†é¢‘è½¬JPEG" class="headerlink" title="è§†é¢‘è½¬JPEG"></a>è§†é¢‘è½¬JPEG</h3><p><code>ffmpeg -i test.flv -r 1 -f image2 image-%3d.jpeg</code></p>
<h3 id="è§†é¢‘è½¬gif"><a href="#è§†é¢‘è½¬gif" class="headerlink" title="è§†é¢‘è½¬gif"></a>è§†é¢‘è½¬gif</h3><p><code>ffmpeg -i out.mp4 -ss 00:00:00 -t 10 out.gif</code></p>
<h3 id="å›¾ç‰‡è½¬è§†é¢‘"><a href="#å›¾ç‰‡è½¬è§†é¢‘" class="headerlink" title="å›¾ç‰‡è½¬è§†é¢‘"></a>å›¾ç‰‡è½¬è§†é¢‘</h3><p><code>ffmpeg  -f image2 -i image-%3d.jpeg images.mp4</code></p>
<h2 id="ç›´æ’­ç›¸å…³"><a href="#ç›´æ’­ç›¸å…³" class="headerlink" title="ç›´æ’­ç›¸å…³"></a>ç›´æ’­ç›¸å…³</h2><h3 id="æ¨æµ"><a href="#æ¨æµ" class="headerlink" title="æ¨æµ"></a>æ¨æµ</h3><p><code>ffmpeg -re -i out.mp4 -c copy -f flv rtmp://server/live/streamName</code></p>
<h3 id="æ‹‰æµä¿å­˜"><a href="#æ‹‰æµä¿å­˜" class="headerlink" title="æ‹‰æµä¿å­˜"></a>æ‹‰æµä¿å­˜</h3><p><code>ffmpeg -i rtmp://server/live/streamName -c copy dump.flv</code></p>
<h3 id="è½¬æµ"><a href="#è½¬æµ" class="headerlink" title="è½¬æµ"></a>è½¬æµ</h3><p><code>ffmpeg -i rtmp://server/live/originalStream -c:a copy -c:v copy -f flv rtmp://server/live/h264Stream</code></p>
<h3 id="å®æ—¶æ¨æµ"><a href="#å®æ—¶æ¨æµ" class="headerlink" title="å®æ—¶æ¨æµ"></a>å®æ—¶æ¨æµ</h3><p><code>ffmpeg -framerate 15 -f avfoundation -i &quot;1&quot; -s 1280x720 -c:v libx264  -f  flv rtmp://localhost:1935/live/room
ffplay</code></p>
<h3 id="æ’­æ”¾YUV-æ•°æ®"><a href="#æ’­æ”¾YUV-æ•°æ®" class="headerlink" title="æ’­æ”¾YUV æ•°æ®"></a>æ’­æ”¾YUV æ•°æ®</h3><p><code>ffplay -pix_fmt nv12 -s 192x144 1.yuv</code></p>
<h3 id="æ’­æ”¾YUVä¸­çš„-Yå¹³é¢"><a href="#æ’­æ”¾YUVä¸­çš„-Yå¹³é¢" class="headerlink" title="æ’­æ”¾YUVä¸­çš„ Yå¹³é¢"></a>æ’­æ”¾YUVä¸­çš„ Yå¹³é¢</h3><p><code>ffplay -pix_fmt nv21 -s 640x480 -vf extractplanes=&#39;y&#39; 1.yuv</code></p>
]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>FFmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>WebRTCï¼ˆäºŒï¼‰</title>
    <url>/2020/03/22/WebRTC%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨<a href="https://samtake.github.io/2019/11/04/WebRTC/" target="_blank" rel="noopener">å‰ä¸€ç¯‡</a>æœ‰å¯¹WebRTCä»¥åŠç”¨åˆ°çš„åè®®åšäº†ä¸€äº›ç®€å•ä»‹ç»ã€‚</p>
<p>å…ˆå›å¿†ä¸‹WebRTCç»ˆç«¯çš„äº”ä¸ªæµç¨‹ï¼š</p>
<ul>
<li>è·å–æƒé™ï¼ˆæ‘„åƒå¤´ã€éº¦å…‹é£ï¼‰</li>
<li>æœ¬åœ°è§†é¢‘çš„é‡‡é›†ä¸å±•ç¤º</li>
<li>åˆ›å»º<code>RTCPeerConnection</code></li>
<li>åª’ä½“åå•†</li>
<li>è¿œç«¯è§†é¢‘çš„å±•ç¤º</li>
</ul>
<h1 id="åª’ä½“åå•†"><a href="#åª’ä½“åå•†" class="headerlink" title="åª’ä½“åå•†"></a>åª’ä½“åå•†</h1><p>åœ¨åŒæ–¹é€šä¿¡æ—¶ï¼ŒåŒæ–¹å¿…é¡»æ¸…æ¥šå½¼æ­¤ä½¿ç”¨çš„ç¼–è§£ç å™¨æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå¿…é¡»çŸ¥é“ä¼ è¾“è¿‡æ¥çš„éŸ³è§†é¢‘æµçš„ SSRCã€‚åª’ä½“åå•†çš„ä½œç”¨å°±æ˜¯è®©åŒæ–¹æ‰¾åˆ°å…±åŒæ”¯æŒçš„åª’ä½“èƒ½åŠ›ï¼Œå¦‚åŒæ–¹éƒ½æ”¯æŒçš„ç¼–è§£ç å™¨ï¼Œä»è€Œæœ€ç»ˆå®ç°å½¼æ­¤ä¹‹é—´çš„éŸ³è§†é¢‘é€šä¿¡ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª RTCPeerConnection å¯¹è±¡</li>
<li>createOffer ï¼Œåˆ›å»º Offerï¼›</li>
<li>createAnswerï¼Œåˆ›å»º Answerï¼›</li>
<li>setLocalDescriptionï¼Œè®¾ç½®æœ¬åœ° SDP ä¿¡æ¯ï¼›</li>
<li>setRemoteDescriptionï¼Œè®¾ç½®è¿œç«¯çš„ SDP ä¿¡æ¯ã€‚</li>
</ul>
<p>æµç¨‹å™è¿°ï¼š</p>
<p>é¦–å…ˆï¼Œå‘¼å«æ–¹åˆ›å»º Offer ç±»å‹çš„ SDP æ¶ˆæ¯ã€‚åˆ›å»ºå®Œæˆåï¼Œè°ƒç”¨ setLocalDescriptoin æ–¹æ³•å°†è¯¥ Offer ä¿å­˜åˆ°æœ¬åœ° Local åŸŸï¼Œç„¶åé€šè¿‡ä¿¡ä»¤å°† Offer å‘é€ç»™è¢«å‘¼å«æ–¹ã€‚</p>
<p>è¢«å‘¼å«æ–¹æ”¶åˆ° Offer ç±»å‹çš„ SDP æ¶ˆæ¯åï¼Œè°ƒç”¨ setRemoteDescription æ–¹æ³•å°† Offer ä¿å­˜åˆ°å®ƒçš„ Remote åŸŸã€‚ä½œä¸ºåº”ç­”ï¼Œè¢«å‘¼å«æ–¹è¦åˆ›å»º Answer ç±»å‹çš„ SDP æ¶ˆæ¯ï¼ŒAnswer æ¶ˆæ¯åˆ›å»ºæˆåŠŸåï¼Œå†è°ƒç”¨ setLocalDescription æ–¹æ³•å°† Answer ç±»å‹çš„ SDP æ¶ˆæ¯ä¿å­˜åˆ°æœ¬åœ°çš„ Local åŸŸã€‚æœ€åï¼Œè¢«å‘¼å«æ–¹å°† Answer æ¶ˆæ¯é€šè¿‡ä¿¡ä»¤å‘é€ç»™å‘¼å«æ–¹ã€‚è‡³æ­¤ï¼Œè¢«å‘¼å«æ–¹çš„å·¥ä½œå°±å®Œéƒ¨å®Œæˆäº†ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯å‘¼å«æ–¹çš„æ”¶å°¾å·¥ä½œï¼Œå‘¼å«æ–¹æ”¶åˆ° Answer ç±»å‹çš„æ¶ˆæ¯åï¼Œè°ƒç”¨ RTCPeerConnecton å¯¹è±¡çš„ setRemoteDescription æ–¹æ³•ï¼Œå°† Answer ä¿å­˜åˆ°å®ƒçš„ Remote åŸŸã€‚</p>
<p>è‡³æ­¤ï¼Œæ•´ä¸ªåª’ä½“åå•†è¿‡ç¨‹å¤„ç†å®Œæ¯•ã€‚</p>
<h1 id="WebRTCå»ºç«‹è¿æ¥"><a href="#WebRTCå»ºç«‹è¿æ¥" class="headerlink" title="WebRTCå»ºç«‹è¿æ¥"></a>WebRTCå»ºç«‹è¿æ¥</h1><p><img src="/2020/03/22/WebRTC%EF%BC%88%E4%BA%8C%EF%BC%89/1to1-connected.png" alt></p>
<p>é¦–å…ˆä¼šå°è¯• NAT ç©¿è¶Šï¼Œå³å°è¯•ç«¯åˆ°ç«¯ç›´è¿ã€‚å¦‚æœèƒ½å¤Ÿç©¿è¶ŠæˆåŠŸï¼Œé‚£åŒæ–¹å°±é€šè¿‡ç›´è¿çš„æ–¹å¼ä¼ è¾“æ•°æ®ï¼Œè¿™æ˜¯æœ€é«˜æ•ˆçš„ã€‚ä½†å¦‚æœ NAT ç©¿è¶Šå¤±è´¥ï¼Œä¸ºäº†ä¿éšœé€šä¿¡åŒæ–¹çš„è¿é€šæ€§ï¼ŒWebRTC ä¼šä½¿ç”¨ä¸­ç»§æ–¹å¼ï¼Œå½“ç„¶ä½¿ç”¨è¿™ç§æ–¹å¼ä¼ è¾“æ•ˆç‡ä¼šä½ä¸€äº›ã€‚</p>
<p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒWebRTC ä½¿ç”¨ä¼˜å…ˆçº§çš„æ–¹æ³•å»å»ºç«‹è¿æ¥ï¼Œå³å±€åŸŸç½‘å†…çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå…¶æ¬¡æ˜¯ NAT ç©¿è¶Šï¼Œå†æ¬¡æ˜¯é€šè¿‡ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œä¸­è½¬ï¼Œè¿™æ ·å°±å·§å¦™åœ°å®ç°äº†â€œæ—¢è¦é«˜æ•ˆä¼ è¾“ï¼Œåˆèƒ½ä¿è¯è¿é€šç‡â€è¿™ä¸ªç›®æ ‡ã€‚</p>
]]></content>
      <categories>
        <category>WebRTC</category>
      </categories>
      <tags>
        <tag>WebRTC</tag>
      </tags>
  </entry>
  <entry>
    <title>lightworksè§†é¢‘å‰ªè¾‘è½¯ä»¶åŸºæœ¬æ“ä½œæ•™ç¨‹</title>
    <url>/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h1><p><code>LOG</code>æ”¾æ–‡ä»¶å†…å®¹<br><code>EDIT</code>å‰ªè¾‘<br><code>VFX</code>åŠ æ–‡å­—ç­‰æ•ˆæœ<br><code>AUDIO</code>æ·»åŠ éŸ³é¢‘</p>
<h2 id="LOG"><a href="#LOG" class="headerlink" title="LOG"></a>LOG</h2><p>Project Contents<br>Local Files<br>Audio Network<br>Pond5</p>
<h2 id="EDIT"><a href="#EDIT" class="headerlink" title="EDIT"></a>EDIT</h2><p>Aå¼€å¤´çš„æ˜¯è§†é¢‘æ–‡ä»¶æœ¬èº«è‡ªå¸¦çš„éŸ³æ•ˆï¼Œç‚¹ä¸€ä¸‹å˜æš—åæ’­æ”¾å°±æ²¡æœ‰è¿™ä¸ªéŸ³æ•ˆäº†</p>
<p>å‰ªåˆ‡å’Œåˆå¹¶ç‚¹Xé”®ï¼Œå‰ªåˆ‡åå¯ä»¥éšæ„çœ‹å¥¥è¿ä¸ç»„åˆï¼Œç‚¹å‡»ä¸è¦çš„éƒ¨åˆ†ç‚¹é‚®ä»¶åˆ é™¤</p>
<p>å³é”®ç‚¹å‡»é€Ÿåº¦å¯å˜æ…¢æˆ–åŠ å¿«æ’­æ”¾é€Ÿåº¦ï¼Œä¸è¦çš„è¯å°±ç‚¹åˆ é™¤ï¼Œè·¨ç•Œè§CTRL+Zå¯ä»¥è¿˜åŸä¸Šä¸€æ­¥æ“ä½œ</p>
<p>å¯è¦†ç›–åŸæœ¬çš„éŸ³é¢‘æˆ–å®¶åœ¨ä¸‹é¢</p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/EDIT-Audio.png" alt></p>
<h2 id="VFX"><a href="#VFX" class="headerlink" title="VFX"></a>VFX</h2><p>ç‚¹å‡»+æ·»åŠ æ–‡å­—ï¼Œæ”¹å˜å­—ä½“å¤§å°å’Œé¢œè‰²</p>
<h2 id="AUDIO"><a href="#AUDIO" class="headerlink" title="AUDIO"></a>AUDIO</h2><p>éŸ³é‡å¤§å°ç­‰ä¿®æ”¹</p>
<p>ä¿å­˜æ–‡ä»¶ç‚¹å³é”®å‡ºå£-åª’ä½“æ–‡ä»¶-ä¸€èˆ¬æ˜¯MP4/AVI 720é€‚å®œï¼Œå½“ç„¶è¶Šå¤§ä¹Ÿè¶Šæ¸…æ¥šï¼Œæ–‡ä»¶å†…å­˜ä¹Ÿè¶Šå¤§</p>
<h1 id="2-ç•Œé¢å’Œæ–°å»ºå·¥ç¨‹"><a href="#2-ç•Œé¢å’Œæ–°å»ºå·¥ç¨‹" class="headerlink" title="2.ç•Œé¢å’Œæ–°å»ºå·¥ç¨‹"></a>2.ç•Œé¢å’Œæ–°å»ºå·¥ç¨‹</h1><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial2-setting.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial2-project-type.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial2-project-contents.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial2-project-contents-windows.png" alt></p>
<h1 id="3-å¯¼å…¥ç´ æå’Œæ–°å»ºåºåˆ—"><a href="#3-å¯¼å…¥ç´ æå’Œæ–°å»ºåºåˆ—" class="headerlink" title="3.å¯¼å…¥ç´ æå’Œæ–°å»ºåºåˆ—"></a>3.å¯¼å…¥ç´ æå’Œæ–°å»ºåºåˆ—</h1><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial3-import-setting3.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial3-import-setting3.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial3-new-serial1.png" alt></p>
<p>åºåˆ—ä¹‹é—´æ˜¯ä¸èƒ½åµŒå¥—çš„ã€‚</p>
<h1 id="4-æ—¶é—´çº¿æ“ä½œ-amp-é€‰å®šç´ æåŒºåŸŸæ’å…¥æ—¶é—´è½´"><a href="#4-æ—¶é—´çº¿æ“ä½œ-amp-é€‰å®šç´ æåŒºåŸŸæ’å…¥æ—¶é—´è½´" class="headerlink" title="4.æ—¶é—´çº¿æ“ä½œ&amp;é€‰å®šç´ æåŒºåŸŸæ’å…¥æ—¶é—´è½´"></a>4.æ—¶é—´çº¿æ“ä½œ&amp;é€‰å®šç´ æåŒºåŸŸæ’å…¥æ—¶é—´è½´</h1><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial4-time-operation.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial4-time-blank.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial4-time-source.png" alt></p>
<p>åŒæ—¶æ—¶é—´è½´ä¸Šçš„ç´ æå¯ä»¥å·¦å³æ‹–æ‹‰ï¼šåˆ‡æ¢ä½ç½®ã€å‰åæ—¶é—´å»¶é•¿</p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial4-time-source-only.png" alt></p>
<h1 id="5-æ—¶é—´è½´ç´ æè°ƒæ•´-amp-éŸ³é¢‘è½¨é“åŒæ­¥"><a href="#5-æ—¶é—´è½´ç´ æè°ƒæ•´-amp-éŸ³é¢‘è½¨é“åŒæ­¥" class="headerlink" title="5.æ—¶é—´è½´ç´ æè°ƒæ•´&amp;éŸ³é¢‘è½¨é“åŒæ­¥"></a>5.æ—¶é—´è½´ç´ æè°ƒæ•´&amp;éŸ³é¢‘è½¨é“åŒæ­¥</h1><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-zoom.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut1.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut2.png" alt></p>
<p>é”®ç›˜çš„åŠ å‡å·æ˜¯æ”¾å¤§å’Œç¼©å°æ—¶é—´è½´</p>
<h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut-method2.png" alt></p>
<p><code>Slip - Y</code>ç‚¹å‡»ç©ºæ ¼é”®æ’­æ”¾ï¼Œé€‰ä¸­ç´ æçš„å¦å¤–å‰åç´ æä½ç½®æ²¡æœ‰å˜åŒ–ï¼Œæ’­æ”¾æ—¶é•¿ä¹Ÿæ²¡æœ‰å˜åŒ–ï¼Œè€Œè¯¥é€‰ä¸­ç´ æåˆ™éšç€æ’­æ”¾ï¼Œæ—¶é—´æ…¢æ…¢å¢åŠ ã€‚<br><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut-method2-slip.png" alt></p>
<p><code>Slide - T</code>é€‰ä¸­ç´ ææ²¡æœ‰å˜åŒ–ã€‚</p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut-method2-Slide.png" alt></p>
<p><code>Trim In - W</code></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut-method2-trim-in.png" alt></p>
<p><code>Trim Out - E</code>åœ¨å‡ºç‚¹æ ‡è®°å¤„è¿›è¡Œå»¶é•¿æˆ–ç¼©çŸ­</p>
<h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><p>1.å‡è®¾åªå¯¹è§†é¢‘è¿›è¡Œç¼©å‡æ—¶ï¼Œè¿™ä¼šå¯¼è‡´éŸ³è§†é¢‘ä¸åŒè½¨ï¼Œå¤„ç†æ–¹æ³•<br><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut-method2-auto-track.png" alt></p>
<p>2.<br><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial5-time-cut-method2-track-operation.png" alt></p>
<p> 3.å¿«æ·é”®</p>
<p> <code>j</code> å€’æ–¹</p>
<p> <code>k</code> åœæ­¢ </p>
<p> <code>l</code> ç´ æå‘å³æ’­æ”¾ï¼Œé‡å¤æŒ‰ä¸‹<code>j</code>ä¼šåŠ é€Ÿå‘å³æ’­æ”¾</p>
<h1 id="6-æ·»åŠ è½¬åœº-amp-è½¬åœºç›¸å…³è®¾ç½®"><a href="#6-æ·»åŠ è½¬åœº-amp-è½¬åœºç›¸å…³è®¾ç½®" class="headerlink" title="6.æ·»åŠ è½¬åœº&amp;è½¬åœºç›¸å…³è®¾ç½®"></a>6.æ·»åŠ è½¬åœº&amp;è½¬åœºç›¸å…³è®¾ç½®</h1><h2 id="æ·»åŠ è½¬åœºæ­¥éª¤"><a href="#æ·»åŠ è½¬åœºæ­¥éª¤" class="headerlink" title="æ·»åŠ è½¬åœºæ­¥éª¤"></a>æ·»åŠ è½¬åœºæ­¥éª¤</h2><p>å…ˆè¦é€šè¿‡æ‹–åŠ¨ç´ æï¼Œè®©ä¸¤ä¸ªç´ æçš„æŸä¸ªéƒ¨åˆ†é‡å ï¼Œç•™å‡ºè½¬åœºçš„ç©ºé—´ã€‚</p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial6-transitions-steps.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial6-transitions-other.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial6-transitions-other2.png" alt></p>
<p>éŸ³é¢‘å’Œè§†é¢‘è½¬åœºéƒ½æ˜¯ä¸€æ ·ï½ï½ï½æ“ä½œå·®ä¸å¤š</p>
<h2 id="è®©ç»“å°¾å¤„æ¸æš—"><a href="#è®©ç»“å°¾å¤„æ¸æš—" class="headerlink" title="è®©ç»“å°¾å¤„æ¸æš—"></a>è®©ç»“å°¾å¤„æ¸æš—</h2><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial6-transitions-black1.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial6-transitions-black2.png" alt></p>
<h1 id="7-VFXèŠ‚æœ¬æ“ä½œ-amp-å‰ªè¾‘æ’­æ”¾é€Ÿåº¦è°ƒæ•´"><a href="#7-VFXèŠ‚æœ¬æ“ä½œ-amp-å‰ªè¾‘æ’­æ”¾é€Ÿåº¦è°ƒæ•´" class="headerlink" title="7.VFXèŠ‚æœ¬æ“ä½œ&amp;å‰ªè¾‘æ’­æ”¾é€Ÿåº¦è°ƒæ•´"></a>7.VFXèŠ‚æœ¬æ“ä½œ&amp;å‰ªè¾‘æ’­æ”¾é€Ÿåº¦è°ƒæ•´</h1><h2 id="æ·»åŠ å­—å¹•"><a href="#æ·»åŠ å­—å¹•" class="headerlink" title="æ·»åŠ å­—å¹•"></a>æ·»åŠ å­—å¹•</h2><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial7-VFX1.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial7-VFX2.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial7-VFX3.png" alt></p>
<h2 id="8-è°ƒæ•´ç´ ææ’­æ”¾é€Ÿåº¦"><a href="#8-è°ƒæ•´ç´ ææ’­æ”¾é€Ÿåº¦" class="headerlink" title="8.è°ƒæ•´ç´ ææ’­æ”¾é€Ÿåº¦"></a>8.è°ƒæ•´ç´ ææ’­æ”¾é€Ÿåº¦</h2><p>æ—¶é—´è½´-å³é”®-Speed-è®¾ç½®é€Ÿåº¦å³å¯</p>
<h1 id="8-Routingç®€ä»‹-amp-åº”ç”¨"><a href="#8-Routingç®€ä»‹-amp-åº”ç”¨" class="headerlink" title="8.Routingç®€ä»‹&amp;åº”ç”¨"></a>8.Routingç®€ä»‹&amp;åº”ç”¨</h1><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial8-routing.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial8-routing-use1.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial8-routing-use2.png" alt></p>
<h1 id="9-éŸ³é¢‘æ•ˆæœçª—å£-amp-å¯¼å‡ºè®¾ç½®"><a href="#9-éŸ³é¢‘æ•ˆæœçª—å£-amp-å¯¼å‡ºè®¾ç½®" class="headerlink" title="9.éŸ³é¢‘æ•ˆæœçª—å£&amp;å¯¼å‡ºè®¾ç½®"></a>9.éŸ³é¢‘æ•ˆæœçª—å£&amp;å¯¼å‡ºè®¾ç½®</h1><h2 id="æ¸å…¥éŸ³æ•ˆ"><a href="#æ¸å…¥éŸ³æ•ˆ" class="headerlink" title="æ¸å…¥éŸ³æ•ˆ"></a>æ¸å…¥éŸ³æ•ˆ</h2><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial9-audio1.png" alt></p>
<h2 id="è®©å…³é”®å¸§æ•ˆæœä½ç½®æ•´ä½“æ”¹å˜"><a href="#è®©å…³é”®å¸§æ•ˆæœä½ç½®æ•´ä½“æ”¹å˜" class="headerlink" title="è®©å…³é”®å¸§æ•ˆæœä½ç½®æ•´ä½“æ”¹å˜"></a>è®©å…³é”®å¸§æ•ˆæœä½ç½®æ•´ä½“æ”¹å˜</h2><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial9-audio2.png" alt></p>
<h2 id="å…¶ä»–çš„ä¿®éŸ³è®¾ç½®"><a href="#å…¶ä»–çš„ä¿®éŸ³è®¾ç½®" class="headerlink" title="å…¶ä»–çš„ä¿®éŸ³è®¾ç½®"></a>å…¶ä»–çš„ä¿®éŸ³è®¾ç½®</h2><h2 id="å¯¼å‡ºè®¾ç½®"><a href="#å¯¼å‡ºè®¾ç½®" class="headerlink" title="å¯¼å‡ºè®¾ç½®"></a>å¯¼å‡ºè®¾ç½®</h2><p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial9-export1.png" alt></p>
<p><img src="/2020/03/15/lightworks%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91%E8%BD%AF%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/serial9-export2.jpeg" alt></p>
<h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><p><a href="https://www.bilibili.com/video/av31939070" target="_blank" rel="noopener">Lightworks 14 Tutorials ä¸­æ–‡å­—å¹•æ•™ç¨‹</a></p>
<p><a href="https://www.lwks.com/" target="_blank" rel="noopener">Lightworks è½¯ä»¶å®˜æ–¹åœ°å€</a></p>
]]></content>
      <categories>
        <category>lightworks</category>
      </categories>
      <tags>
        <tag>lightworks</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯»ä¹¦è®°å½•-20200311</title>
    <url>/2020/03/11/%E8%AF%BB%E4%B9%A6%E8%AE%B0%E5%BD%95-20200311/</url>
    <content><![CDATA[<p><img src="/2020/03/11/%E8%AF%BB%E4%B9%A6%E8%AE%B0%E5%BD%95-20200311/20200311-%E4%B9%A6%E5%8D%95.jpeg" alt></p>
<p>é™„å½•</p>
<p><a href="https://www.bilibili.com/video/av3755315?from=search&seid=1211682021322553260" target="_blank" rel="noopener">100ä¸ªæ¢¦æƒ³çš„èµåŠ©å•†ï¼ˆå¾®ç”µå½±ï¼‰</a></p>
<p><a href="https://www.bilibili.com/video/av37465443?from=search&seid=14561064290056795500" target="_blank" rel="noopener">æˆ‘ä»¬çš„æ—¶ä»£</a></p>
]]></content>
      <categories>
        <category>è¯»ä¹¦</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦</tag>
      </tags>
  </entry>
  <entry>
    <title>ant-designå­¦ä¹ </title>
    <url>/2020/03/03/ant-design%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…¨ç¯‡ä¸‹æ¥å¤ªå•°å—¦ï¼Œ<a href="https://github.com/sorrycc/blog/issues/62" target="_blank" rel="noopener">umi + dvaï¼Œå®Œæˆç”¨æˆ·ç®¡ç†çš„ CURD åº”ç”¨</a>æ˜¯é‡ç‚¹ï¼Œçœ‹è¿™é‡Œå°±è¡Œäº†ï¼ï¼ï¼</p>
<h2 id="antd"><a href="#antd" class="headerlink" title="antd"></a>antd</h2><p><a href="https://ant.design/index-cn" target="_blank" rel="noopener">Ant Design</a>,<code>antd</code> æ˜¯åŸºäº Ant Design è®¾è®¡ä½“ç³»çš„ React UI ç»„ä»¶åº“ï¼Œä¸»è¦ç”¨äºç ”å‘ä¼ä¸šçº§ä¸­åå°äº§å“ã€‚</p>
<h3 id="ç›®å½•ç»“æ„è¯´æ˜"><a href="#ç›®å½•ç»“æ„è¯´æ˜" class="headerlink" title="ç›®å½•ç»“æ„è¯´æ˜"></a>ç›®å½•ç»“æ„è¯´æ˜</h3><ul>
<li><p>configï¼šé…ç½®ä¿¡æ¯<br><code>config.js</code>å…¨å±€é…ç½®ï¼Œè·¯ç”±é…ç½®<br><code>defaultSettings.js</code>ä¸€äº›é»˜è®¤é…ç½®<br><code>plugin.config.js</code>æ’ä»¶é…ç½®</p>
</li>
<li><p>mock æ¨¡æ‹Ÿæ•°æ®è¯·æ±‚çš„</p>
</li>
<li><p>mode_modules ç¬¬ä¸‰æ–¹åº“</p>
</li>
<li><p>public æ”¾ç½®ç¬¬ä¸‰æ–¹æ–‡ä»¶ï¼ˆæ¯”å¦‚è¯´å›¾ç‰‡ï¼Œç¬¬ä¸‰æ–¹çš„jsonæ–‡ä»¶ï¼‰</p>
</li>
<li><p>tests åšä¸€äº›æµ‹è¯•çš„</p>
</li>
<li><p>package.json</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"ant-design-pro"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"An out-of-box UI solution for enterprise applications"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"analyze"</span>: <span class="string">"åˆ†æ"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"ç¼–è¯‘"</span>,</span><br><span class="line">    <span class="string">"deploy"</span>: <span class="string">"éƒ¨ç½²"</span>,</span><br><span class="line">    <span class="string">"fetch:blocks"</span>: <span class="string">"ä»å®˜ç½‘gité‡Œé¢å»æ‹‰æ¨¡å—"</span>,</span><br><span class="line">    <span class="string">"format-imports"</span>: <span class="string">"ä»£ç æ ¼å¼ï¼ˆä¾‹å¦‚ç©ºæ ¼ï¼‰"</span>,</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"å¯åŠ¨"</span>,</span><br><span class="line">    <span class="string">"start:no-mock"</span>: <span class="string">"cross-env MOCK=none umi dev"</span>,</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"æµ‹è¯•"</span>,</span><br><span class="line">    <span class="string">"test:all"</span>: <span class="string">"node ./tests/run-tests.js"</span>,</span><br><span class="line">    <span class="string">"test:component"</span>: <span class="string">"umi test ./src/components"</span>,</span><br><span class="line">    <span class="string">"ui"</span>: <span class="string">"umi ui"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>src</p>
</li>
</ul>
<p><code>assets</code>é™æ€èµ„æº<br><code>components</code>ç»„ä»¶ç›®å½•<br><code>e2e</code><br><code>layouts</code>å¸ƒå±€<br><code>locales</code>å¤šè¯­è¨€<br><code>models</code>æ¨¡å‹ç›®å½•<br><code>pages</code>é¡µé¢<br><code>services</code>æä¾›æœåŠ¡ï¼Œç»™é¡µé¢æä¾›è¯·æ±‚<br><code>utils</code>å·¥å…·ç±»<br><code>global.less</code><br><code>global.tsx</code><br><code>manifelst.json</code><br><code>service-worker.js</code><br><code>typings.d.ts</code></p>
<h3 id="å¢åŠ æ–°é¡µé¢"><a href="#å¢åŠ æ–°é¡µé¢" class="headerlink" title="å¢åŠ æ–°é¡µé¢"></a>å¢åŠ æ–°é¡µé¢</h3><p>1.åœ¨config-config.jsæ–‡ä»¶çš„routersèŠ‚ç‚¹æ·»åŠ ä»£ç </p>
<p>{name: â€˜demoâ€™, path: â€˜/demoâ€™, component: â€˜./demoâ€™},</p>
<p>2.åœ¨pageç›®å½•ä¸‹åˆ›å»ºdemoç›®å½•ï¼Œå¹¶æ–°å»ºä¸€ä¸ªindex.jsxæ–‡ä»¶ã€‚<br>3.æ·»åŠ æºç ã€‚</p>
<h2 id="dva"><a href="#dva" class="headerlink" title="dva"></a>dva</h2><ul>
<li><a href="https://dvajs.com" target="_blank" rel="noopener">dvaå®˜ç½‘</a></li>
<li><a href="https://www.bilibili.com/video/av55863089?from=search&seid=7612457114058753391" target="_blank" rel="noopener">dvaè§†é¢‘æ•™ç¨‹</a>ï¼Œä»¥åŠç»ƒä¹ <a href="https://github.com/samtake/dva" target="_blank" rel="noopener">æºç </a></li>
<li><a href="https://www.jianshu.com/p/0568a725f8f9" target="_blank" rel="noopener">dva.jsçš„ä½¿ç”¨ä¸è¯´æ˜</a></li>
</ul>
<h2 id="UmiJS"><a href="#UmiJS" class="headerlink" title="UmiJS"></a>UmiJS</h2><ul>
<li><a href="https://umijs.org/zh-CN" target="_blank" rel="noopener">UmiJS</a></li>
<li><a href="https://www.bilibili.com/video/av74033079?p=51" target="_blank" rel="noopener">UmiJSè§†é¢‘æ•™ç¨‹</a>ï¼Œä»¥åŠ<a href="https://github.com/plter/ReactCourse20191031" target="_blank" rel="noopener">æºç </a></li>
<li><a href="https://www.cnblogs.com/lihuijuan/p/11242976.html" target="_blank" rel="noopener">Ant Design Pro è„šæ‰‹æ¶+umiJS å®è·µæ€»ç»“</a></li>
</ul>
<h2 id="dva-umi"><a href="#dva-umi" class="headerlink" title="dva + umi"></a>dva + umi</h2><p>ä¸»è¦ææ‡‚modelã€serviceçš„å…³ç³»</p>
<ul>
<li><a href="https://github.com/sorrycc/blog/issues/62" target="_blank" rel="noopener">umi + dvaï¼Œå®Œæˆç”¨æˆ·ç®¡ç†çš„ CURD åº”ç”¨</a></li>
<li><a href="https://github.com/umijs/umi-example-dva-user-dashboard" target="_blank" rel="noopener">umi-example-dva-user-dashboard</a></li>
</ul>
]]></content>
      <categories>
        <category>ant-design</category>
      </categories>
      <tags>
        <tag>ant-design</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitea</title>
    <url>/2020/03/02/Gitea/</url>
    <content><![CDATA[<p><a href="https://gitea.io/zh-cn/" target="_blank" rel="noopener">Gitea</a>:ä¸€ä¸ªå¼€æºç¤¾åŒºé©±åŠ¨çš„è½»é‡çº§ä»£ç æ‰˜ç®¡è§£å†³æ–¹æ¡ˆ</p>
]]></content>
  </entry>
  <entry>
    <title>Golangæ­å»ºå¹¶è¡Œå¤„ç†ç®¡é“</title>
    <url>/2020/03/02/Golang%E6%90%AD%E5%BB%BA%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86%E7%AE%A1%E9%81%93/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>Golangç»ƒä¹ ç¬”è®°</title>
    <url>/2020/02/22/Golang%E7%BB%83%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="å®šä¹‰å˜é‡"><a href="#å®šä¹‰å˜é‡" class="headerlink" title="å®šä¹‰å˜é‡"></a>å®šä¹‰å˜é‡</h2><p>ç©ºå€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">variableZeroValue</span></span>() &#123;</span><br><span class="line">	var a int</span><br><span class="line">	var s string</span><br><span class="line">	fmt.Printf(<span class="string">"%d %q\n"</span>, a, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">variableInitialValue</span></span>() &#123;</span><br><span class="line">	var a, b int = 3, 4</span><br><span class="line">	var s string = <span class="string">"abc"</span></span><br><span class="line">	fmt.Println(a, b, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»å‹æ¨æ–­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">variableTypeDeduction</span></span>() &#123;</span><br><span class="line">	var a, b, c, d = 3, 4, <span class="literal">true</span>, <span class="string">"def"</span></span><br><span class="line">	var s string = <span class="string">"abc"</span></span><br><span class="line">	fmt.Println(a, b, c, d, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>åˆ©ç”¨å†’å·å®šä¹‰çš„ç®€å•å†™æ³•  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">variableShorter</span></span>() &#123;</span><br><span class="line">	a, b, c, d := 3, 4, <span class="literal">true</span>, <span class="string">"def"</span></span><br><span class="line">	b = 6</span><br><span class="line">	var s string = <span class="string">"abc"</span></span><br><span class="line">	fmt.Println(a, b, c, d, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å¤–çš„å˜é‡å®šä¹‰(ä¸èƒ½ä½¿ç”¨å†’å·å®šä¹‰ï¼Œä¸”å®ƒçš„ä½œç”¨åŸŸåªåœ¨è¯¥åŒ…å†…éƒ¨)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var aa = 55</span><br><span class="line">var ss = <span class="string">"llll"</span></span><br><span class="line">var bb = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var (</span><br><span class="line">	bbb = 666</span><br><span class="line">	sss = <span class="string">"jjj"</span></span><br><span class="line">	ttt = <span class="literal">false</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="å†…å»ºå˜é‡ç±»å‹"><a href="#å†…å»ºå˜é‡ç±»å‹" class="headerlink" title="å†…å»ºå˜é‡ç±»å‹"></a>å†…å»ºå˜é‡ç±»å‹</h2><p><code>bool</code>, <code>string</code>,</p>
<p><code>(u)int</code>, <code>(u)int8</code>, <code>(u)int16</code>, <code>(u)int32</code>, <code>(u)int64</code>, <code>uintptr</code>,</p>
<p><code>byte</code>, <code>rune</code>,</p>
<p><code>float32</code>, <code>float64</code>, <code>complex64</code>, <code>complex128</code>,</p>
<h2 id="å¸¸é‡ä¸æšä¸¾"><a href="#å¸¸é‡ä¸æšä¸¾" class="headerlink" title="å¸¸é‡ä¸æšä¸¾"></a>å¸¸é‡ä¸æšä¸¾</h2> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> func <span class="function"><span class="title">consts</span></span>() &#123;</span><br><span class="line">	const filename = <span class="string">"abc.txt"</span></span><br><span class="line">	const a, b = 3, 4</span><br><span class="line">	var c int</span><br><span class="line">	c = int(math.Sqrt(a*a + b + b))</span><br><span class="line">	fmt.Println(filename, c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">enums</span></span>() &#123;</span><br><span class="line">	const (</span><br><span class="line">		cpp = iota</span><br><span class="line">		java</span><br><span class="line">		golang</span><br><span class="line">		swift</span><br><span class="line">		_</span><br><span class="line">		C</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	const (</span><br><span class="line">		b = 1 &lt;&lt; (10 * iota)</span><br><span class="line">		bb</span><br><span class="line">		bbb</span><br><span class="line">		bbbb</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	fmt.Println(cpp, java, golang, C)</span><br><span class="line">	fmt.Println(b, bb, bbb, bbbb)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">abc.txt 4</span><br><span class="line">0 1 2 5</span><br><span class="line">1 1024 1048576 1073741824</span><br></pre></td></tr></table></figure>

<h2 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h2><p>ifçš„æ¡ä»¶é‡Œå¯ä»¥èµ‹å€¼<br>ifçš„æ¡ä»¶é‡Œèµ‹å€¼çš„å˜é‡ä½œç”¨åŸŸå°±åœ¨è¿™ä¸ªifè¯­å¥é‡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	const filename = <span class="string">"abc.txt"</span></span><br><span class="line">	<span class="keyword">if</span> contents, err := ioutil.ReadFile(filename); err != nil &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"%s\n"</span>, contents)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>switchåé¢å¯ä»¥æ²¡æœ‰è¡¨è¾¾å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func grade(score int) string &#123;</span><br><span class="line">	g := <span class="string">""</span></span><br><span class="line">	switch &#123;</span><br><span class="line">	<span class="keyword">case</span> score &lt; 0 || score &gt; 100:</span><br><span class="line">		panic(fmt.Sprintf(<span class="string">"wrong score: %d"</span>, score))</span><br><span class="line">	<span class="keyword">case</span> score &lt; 60:</span><br><span class="line">		g = <span class="string">"F"</span></span><br><span class="line">	<span class="keyword">case</span> score &lt; 80:</span><br><span class="line">		g = <span class="string">"C"</span></span><br><span class="line">	<span class="keyword">case</span> score &lt; 90:</span><br><span class="line">		g = <span class="string">"B"</span></span><br><span class="line">	<span class="keyword">case</span> score &lt; 100:</span><br><span class="line">		g = <span class="string">"A"</span></span><br><span class="line">		// default:</span><br><span class="line">		// 	panic(fmt.Sprintf(<span class="string">"wrong score: %d"</span>, score))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> g</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>for</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func convertToBin(n int) string &#123;</span><br><span class="line">	res := <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> ; n &gt; 0; n /= 2 &#123;</span><br><span class="line">		lsb := n % 2</span><br><span class="line">		res = strconv.Itoa(lsb) + res</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func printFile(filename string) &#123;</span><br><span class="line">	file, err := os.Open(filename)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	scanner := bufio.NewScanner(file)</span><br><span class="line">	<span class="keyword">for</span> scanner.<span class="function"><span class="title">Scan</span></span>() &#123;</span><br><span class="line">		fmt.Println(scanner.Text)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­»å¾ªç¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">forever</span></span>() &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"abc"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><ul>
<li>è¿”å›å€¼ç±»å‹å†™åœ¨åé¢</li>
<li>å¯è¿”å›å¤šä¸ªå€¼</li>
<li>å‡½æ•°ä½œä¸ºå‚æ•°</li>
<li>æ²¡æœ‰é»˜è®¤å‚æ•°ï¼Œæœ‰å¯é€‰å‚æ•°</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func div(a, b int) (q, r int) &#123;</span><br><span class="line">	// <span class="built_in">return</span> a / b, a % b</span><br><span class="line">	q = a / b</span><br><span class="line">	r = a % b</span><br><span class="line">	<span class="built_in">return</span> q, r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func pow(a, b int) int &#123;</span><br><span class="line">	<span class="built_in">return</span> int(math.Pow(float64(a), float64(b)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	q, r := div(8, 6)</span><br><span class="line">	fmt.Println(q, r)</span><br><span class="line"></span><br><span class="line">	fmt.Println(apply(pow, 1, 5))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä»¥åŒ¿åå‡½æ•°çš„å½¢å¼è¿›è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">	fmt.Println(apply(</span><br><span class="line">		func(a int, b int) int &#123;</span><br><span class="line">			<span class="built_in">return</span> int(math.Pow(</span><br><span class="line">				float64(a), float64(b)))</span><br><span class="line">		&#125;, 1, 5))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>å‡½æ•°ä½œä¸ºå‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func apply(op func(int, int) int, a, b int) int &#123;</span><br><span class="line">	p := reflect.ValueOf(op).Pointer()</span><br><span class="line">	opName := runtime.FuncForPC(p).Name()</span><br><span class="line">	fmt.Printf(<span class="string">"Calling function %s with args "</span>+</span><br><span class="line">		<span class="string">"(%d, %d)\n"</span>, opName, a, b)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> op(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯å˜å‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func sum(numbers ...int) int &#123;</span><br><span class="line">	s := 0</span><br><span class="line">	<span class="keyword">for</span> i := range numbers &#123;</span><br><span class="line">		s += numbers[i]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">exp</span></span>() &#123;</span><br><span class="line">	var a int = 2</span><br><span class="line">	var pa *int = &amp;a</span><br><span class="line">	*pa = 3</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>å‚æ•°ä¼ é€’</p>
<ul>
<li><p>goè¯­è¨€åªæœ‰å€¼ä¼ é€’ä¸€ç§æ–¹å¼<br><code>var a int</code> å½“å‚æ•°ä¼ é€’ç»™<code>fun f(pa *int)</code>å®ƒå…¶å®å°±æ˜¯å°†açš„æŒ‡é’ˆ&amp;aæ‹·è´ä¸€ä»½ä¼ é€’ç»™pa,paä¹Ÿè·Ÿ&amp;aä¸€æ ·ï¼ŒåŒæ—¶æŒ‡å‘a</p>
</li>
<li><p>å†å¦‚ï¼š<code>var cache Cache</code> å½“å‚æ•°ä¼ é€’ç»™<code>func f(cache Cache)</code>,å‚æ•°Cacheé‚£ä¹ˆå¤§ä¸å¯èƒ½æ‹·è´ä¸€ä»½çš„ï¼Œå®é™…ä¸ŠCacheä¹Ÿåªæ˜¯ä¸€ä¸ªæŒ‡å‘dataçš„æŒ‡é’ˆï¼Œæ‰€ä»¥cacheå½“å‚æ•°çš„æ—¶å€™ï¼Œå®ƒåªæ˜¯æ‹·è´äº†ä¸€ä»½æŒ‡é’ˆï¼Œå®ƒåŒæ—¶ä¹ŸæŒ‡å‘äº†data</p>
</li>
</ul>
<p>äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func swap(a, b int) &#123;</span><br><span class="line">	b, a = a, b</span><br><span class="line">&#125;</span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	exp()</span><br><span class="line"></span><br><span class="line">	a, b := 3, 4</span><br><span class="line">	swap(a, b)</span><br><span class="line">	println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  hello go run point.go</span><br><span class="line">3</span><br><span class="line">3 4</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°å€¼æ²¡æœ‰å˜ï¼Œè¿™æ˜¯éœ€è¦ä½¿ç”¨æŒ‡é’ˆï¼Œå°†a,bæ‰€æŒ‡å‘çš„å€¼æ”¹å˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">exp</span></span>() &#123;</span><br><span class="line">	var a int = 2</span><br><span class="line">	var pa *int = &amp;a</span><br><span class="line">	*pa = 3</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func swap(a, b *int) &#123;</span><br><span class="line">	*b, *a = *a, *b</span><br><span class="line">&#125;</span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	exp()</span><br><span class="line"></span><br><span class="line">	a, b := 3, 4</span><br><span class="line">	swap(&amp;a, &amp;b)</span><br><span class="line">	println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>æ•°ç»„çš„å®šä¹‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">exp</span></span>() &#123;</span><br><span class="line">	var arr1 [5]int</span><br><span class="line">	arr2 := [3]int&#123;1, 2, 3&#125;      //å†’å·ç­‰äºçš„å®šä¹‰ï¼Œéœ€è¦ç»™æ•°ç»„ä¸€ä¸ªåˆå€¼</span><br><span class="line">	arr3 := [...]int&#123;1, 2, 3, 4&#125; //æˆ–è€…ä¸æŒ‡å®šæ•°ç»„ä¸ªæ•°</span><br><span class="line">	fmt.Println(arr1, arr2, arr3)</span><br><span class="line"></span><br><span class="line">	//äºŒç»´æ•°ç»„å®šä¹‰</span><br><span class="line">	var grid [4][5]int</span><br><span class="line">	fmt.Println(grid)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•°ç»„çš„éå†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i := 0; i &lt; len(arr3); i++ &#123;</span><br><span class="line">		fmt.Println(arr3[i])</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹æ ‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i := range arr3 &#123;</span><br><span class="line">		fmt.Println(arr3[i])</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> _, v := range arr3 &#123;</span><br><span class="line">		fmt.Println(v)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹æ ‡å’Œå€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i, v := range arr3 &#123;</span><br><span class="line">		fmt.Println(i, v)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


<p>æ•°ç»„æ˜¯å€¼ç±»å‹çš„ï¼Œæ‰€ä»¥å½“å‚æ•°ç”¨çš„æ—¶å€™éœ€è¦æŒ‡å®šé•¿åº¦<code>cannot use arr1 (type [5]int) as type [4]int in argument to printArray</code>ï¼Œä¸”åœ¨å‡½æ•°é‡Œé¢å†æ¬¡èµ‹å€¼åï¼Œå®ƒåœ¨å¤–é¢æ˜¯ä¸ä¼šæ”¹å˜çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func printArray(arr [4]int) &#123;</span><br><span class="line">	<span class="keyword">for</span> i, v := range arr &#123;</span><br><span class="line">		fmt.Println(i, v)</span><br><span class="line">	&#125;</span><br><span class="line">	arr[0] = 100 //åœ¨å¤–é¢è°ƒç”¨æ—¶ï¼Œä¾æ—§æ˜¯1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>æ‰€ä»¥ï¼Œ[10]intå’Œ[20]int æ˜¯ä¸åŒç±»å‹ï¼›è°ƒç”¨func f(arr [10]int)ä¼šæ‹·è´æ•°ç»„ã€‚éœ€è¦æ”¹å˜å®ƒå°±éœ€è¦ç”¨åˆ°æŒ‡é’ˆäº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">exp</span></span>() &#123;</span><br><span class="line">	arr3 := [...]int&#123;1, 2, 3, 4&#125; </span><br><span class="line"></span><br><span class="line">	printArray(&amp;arr3)</span><br><span class="line">	fmt.Println(arr3, arr3[0])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func printArray(arr *[4]int) &#123;</span><br><span class="line">	<span class="keyword">for</span> i, v := range arr &#123;</span><br><span class="line">		fmt.Println(i, v)</span><br><span class="line">	&#125;</span><br><span class="line">	arr[0] = 100 //åœ¨å¤–é¢è°ƒç”¨æ—¶ï¼Œæ”¹å˜ä¸º100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">func updateSlice(s []int)&#123;</span><br><span class="line">	s[0] = 100</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">	arr := [...]int&#123;0, 1, 2, 3, 4, 5, 6, 7&#125;</span><br><span class="line">	//s := arr[2:6]</span><br><span class="line">	fmt.Println(<span class="string">"arr[2:6] ="</span>, arr[2:6])<span class="comment">#arr[2:6] = [2 3 4 5]</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"arr[:6] ="</span>, arr[:6])<span class="comment">#arr[:6] = [0 1 2 3 4 5]</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"arr[2:] ="</span>, arr[2:])<span class="comment">#arr[2:] = [2 3 4 5 6 7]</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"arr[:] ="</span>, arr[:])<span class="comment">#arr[:] = [0 1 2 3 4 5 6 7]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	s1 := arr[2:]</span><br><span class="line">	s2 := arr[:]</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"after updateSlice(s1"</span>)</span><br><span class="line">	updateSlice(s1)</span><br><span class="line">	fmt.Println(s1)</span><br><span class="line">	fmt.Println(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 	after updateSlice(s1</span></span><br><span class="line"><span class="comment">#   [100 3 4 5 6 7]</span></span><br><span class="line"><span class="comment"># 	[0 1 100 3 4 5 6 7]</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"after updateSlice(s2"</span>)</span><br><span class="line">	updateSlice(s2)</span><br><span class="line">	fmt.Println(s2)</span><br><span class="line">	fmt.Println(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 	after updateSlice(s2</span></span><br><span class="line"><span class="comment"># 	[100 1 100 3 4 5 6 7] </span></span><br><span class="line"><span class="comment"># 	[100 1 100 3 4 5 6 7]</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"printArray"</span>)</span><br><span class="line">	printArray(arr[:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 	printArray</span></span><br><span class="line"><span class="comment"># 	0 100</span></span><br><span class="line"><span class="comment"># 	1 50</span></span><br><span class="line"><span class="comment"># 	2 100</span></span><br><span class="line"><span class="comment"># 	3 3</span></span><br><span class="line"><span class="comment"># 	4 4</span></span><br><span class="line"><span class="comment">#	 5 5</span></span><br><span class="line"><span class="comment"># 	6 6</span></span><br><span class="line"><span class="comment"># 	7 7</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"reslice"</span>)</span><br><span class="line">	fmt.Println(s2)</span><br><span class="line">	s2 = s2[:5]</span><br><span class="line">	fmt.Println(s2)</span><br><span class="line">	s2 = s2[2:]</span><br><span class="line">	fmt.Println(s2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 	reslice</span></span><br><span class="line"><span class="comment"># 	[100 50 100 3 4 5 6 7]</span></span><br><span class="line"><span class="comment"># 	[100 50 100 3 4]</span></span><br><span class="line"><span class="comment"># 	[100 3 4]</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/22/Golang%E7%BB%83%E4%B9%A0%E7%AC%94%E8%AE%B0/slice.png" alt="slice"></p>
<p>sliceå¯ä»¥å‘åæ‰©å±•ï¼Œä¸å¯ä»¥å‘å‰æ‰©å±•<br>s[i]ä¸å¯ä»¥è¶…è¶Šlen(s)ï¼Œå‘åæ‰©å±•ä¸å¯ä»¥è¶…è¶Šåº•å±‚æ•°ç»„ cap(s)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">sliceExtension</span></span>() &#123;</span><br><span class="line">	fmt.Println(<span class="string">"sliceExtension"</span>)</span><br><span class="line">	arr := [...]int&#123;0, 1, 2, 3, 4, 5, 6, 7&#125;</span><br><span class="line">	s1 := arr[2:6]</span><br><span class="line">	s2 := s1[3:5]</span><br><span class="line">	fmt.Println(<span class="string">"s1="</span>, s1)</span><br><span class="line">	fmt.Println(<span class="string">"s2="</span>, s2)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># sliceExtension</span></span><br><span class="line"><span class="comment"># s1= [2 3 4 5]</span></span><br><span class="line"><span class="comment"># s2= [5 6]</span></span><br></pre></td></tr></table></figure>

<p>å‘sliceæ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœè¶…è¶Šäº†capï¼Œç³»ç»Ÿä¼šé‡æ–°åˆ†é…æ›´å¤§çš„åº•å±‚æ•°ç»„<br>æ–°çš„sliceé‡Œé¢ï¼Œ ptr len capéƒ½ä¼šå˜æ‰ï¼Œæ‰€ä»¥å¿…é¡»æ¥æ”¶appendçš„è¿”å›å€¼</p>
<p>s = append(s, value)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">sliceAppend</span></span>() &#123;</span><br><span class="line">	fmt.Println(<span class="string">"slice append"</span>)</span><br><span class="line">	arr := [...]int&#123;0, 1, 2, 3, 4, 5, 6, 7&#125;</span><br><span class="line">	s1 := arr[2:6]       <span class="comment">#	2 3 4 5</span></span><br><span class="line">	s2 := s1[3:5]        <span class="comment">#	5 6</span></span><br><span class="line">	s3 := append(s2, 10) <span class="comment">#	5 6 10</span></span><br><span class="line">	s4 := append(s3, 11) <span class="comment">#	5 6 10 11</span></span><br><span class="line">	s5 := append(s4, 12) <span class="comment">#	5 6 10 11 12</span></span><br><span class="line">	fmt.Println(<span class="string">"s3="</span>, s3)</span><br><span class="line">	fmt.Println(<span class="string">"s4="</span>, s4)</span><br><span class="line">	fmt.Println(<span class="string">"s5="</span>, s5)</span><br><span class="line">	fmt.Println(<span class="string">"arr="</span>, arr) <span class="comment">#	0, 1, 2, 3, 4, 5, 6 10  æ•°ç»„é•¿åº¦ä¸å˜çš„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sliceçš„åˆ›å»º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">sliceCreate</span></span>() &#123;</span><br><span class="line">	var s []int  <span class="comment">#å®šä¹‰ä¸€ä¸ªç©ºslice</span></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 20; i++ &#123;</span><br><span class="line">		printSlice(s)</span><br><span class="line">		s = append(s, 2*i+1)</span><br><span class="line">	&#125;</span><br><span class="line">	println(s)</span><br><span class="line"></span><br><span class="line">	s1 := []int&#123;2, 3, 5, 6, 8, 2, 5&#125;</span><br><span class="line">	println(s1)</span><br><span class="line"></span><br><span class="line">	s2 := make([]int, 16)</span><br><span class="line">	s3 := make([]int, 10, 32) //32æ˜¯å¼€è¾Ÿçš„ç©ºé—´<span class="built_in">cap</span></span><br><span class="line">	println(<span class="string">"print Slice  s2 s3"</span>)</span><br><span class="line">	printSlice(s2)</span><br><span class="line">	printSlice(s3)</span><br><span class="line"></span><br><span class="line">	println(<span class="string">"Slice copy"</span>)</span><br><span class="line">	copy(s2, s1) <span class="comment"># å°†s1å¤åˆ¶ç»™s2</span></span><br><span class="line">	printSlice(s2)</span><br><span class="line"></span><br><span class="line">	//[2 3 5 6 8 2 5 0 0 0 0 0 0 0 0 0], len=16, <span class="built_in">cap</span>= 16</span><br><span class="line">	//å¦‚ä½•åˆ é™¤8</span><br><span class="line">	println(<span class="string">"Slice delete"</span>)</span><br><span class="line">	s2 = append(s2[:4], s2[5:]...)</span><br><span class="line">	printSlice(s2)</span><br><span class="line"></span><br><span class="line">	//åˆ é™¤å¤´å°¾</span><br><span class="line">	fmt.Println(<span class="string">"pop from front"</span>)</span><br><span class="line">	front := s2[0]</span><br><span class="line">	s2 = s2[1:]</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"pop from back"</span>)</span><br><span class="line">	back := s2[len(s2)-1]</span><br><span class="line">	s2 = s2[:len(s2)-1]</span><br><span class="line">	fmt.Println(front, back)</span><br><span class="line">	printSlice(s2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span> Slice  s2 s3</span><br><span class="line">[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0], len=16, <span class="built_in">cap</span>= 16</span><br><span class="line">[0 0 0 0 0 0 0 0 0 0], len=10, <span class="built_in">cap</span>= 32</span><br><span class="line">Slice copy</span><br><span class="line">[2 3 5 6 8 2 5 0 0 0 0 0 0 0 0 0], len=16, <span class="built_in">cap</span>= 16</span><br><span class="line">Slice delete</span><br><span class="line">[2 3 5 6 2 5 0 0 0 0 0 0 0 0 0], len=15, <span class="built_in">cap</span>= 16</span><br><span class="line">pop from front</span><br><span class="line">pop from back</span><br><span class="line">2 0</span><br><span class="line">[3 5 6 2 5 0 0 0 0 0 0 0 0], len=13, <span class="built_in">cap</span>= 15</span><br></pre></td></tr></table></figure>



<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>å®šä¹‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	m := map[string]string&#123;</span><br><span class="line">		<span class="string">"name"</span>:  <span class="string">"sam"</span>,</span><br><span class="line">		<span class="string">"class"</span>: <span class="string">"go"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(m)</span><br><span class="line"></span><br><span class="line">	m2 := make(map[string]int)</span><br><span class="line"></span><br><span class="line">	var m3 map[string]int</span><br><span class="line"></span><br><span class="line">	fmt.Println(m2, m3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>éå†ï¼Œkeyåœ¨mapé‡Œæ˜¯æ— åºçš„ï½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> k, v := range m &#123;</span><br><span class="line">    fmt.Println(k, v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>å½“keyæ‰“é”™äº†ï¼Œè·å–åˆ°çš„æ˜¯ç©ºå€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//è·å–å€¼</span><br><span class="line">	fmt.Println(<span class="string">"getting values"</span>)</span><br><span class="line">	name := m[<span class="string">"name"</span>]</span><br><span class="line">	println(name)</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> name, ok := m[<span class="string">"name"</span>]; ok &#123;</span><br><span class="line">	println(name)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	println(<span class="string">"key does not exist"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//åˆ é™¤</span><br><span class="line">	fmt.Println(<span class="string">"delete values"</span>)</span><br><span class="line">	name1, ok := m[<span class="string">"name"</span>]</span><br><span class="line">	println(name1, ok)</span><br></pre></td></tr></table></figure>

<p>mapçš„keyçš„ç±»å‹å¯ä»¥æ˜¯<br>é™¤äº†slice,map,functionçš„å†…å»ºç±»å‹éƒ½å¯ä»¥ä½œä¸ºkey<br>structç±»å‹ä¸åŒ…å«ä¸Šè¿°å­—æ®µï¼Œä¹Ÿå¯ä»¥ä½œä¸ºkey</p>
<h2 id="å­—ç¬¦å’Œå­—ç¬¦ä¸²çš„å¤„ç†"><a href="#å­—ç¬¦å’Œå­—ç¬¦ä¸²çš„å¤„ç†" class="headerlink" title="å­—ç¬¦å’Œå­—ç¬¦ä¸²çš„å¤„ç†"></a>å­—ç¬¦å’Œå­—ç¬¦ä¸²çš„å¤„ç†</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	s := <span class="string">"yesä¸­æ–‡ä¸­æ–‡"</span></span><br><span class="line">	fmt.Println(s)</span><br><span class="line">	<span class="keyword">for</span> _, b := range []byte(s) &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%X  "</span>, b)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, ch := range s &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"(%d %X)"</span>, i, ch)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line">	fmt.Println(<span class="string">"rune count:"</span>, utf8.RuneCountInString(s))</span><br><span class="line"></span><br><span class="line">	//å•ä¸ªå­—ç¬¦è½¬ä¹‰</span><br><span class="line">	bytes := []byte(s)</span><br><span class="line">	<span class="keyword">for</span> len(bytes) &gt; 0 &#123;</span><br><span class="line">		ch, size := utf8.DecodeRune(bytes)</span><br><span class="line">		bytes = bytes[size:]</span><br><span class="line">		fmt.Printf(<span class="string">"%c "</span>, ch)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yesä¸­æ–‡ä¸­æ–‡</span><br><span class="line">79  65  73  E4  B8  AD  E6  96  87  E4  B8  AD  E6  96  87  </span><br><span class="line">(0 79)(1 65)(2 73)(3 4E2D)(6 6587)(9 4E2D)(12 6587)</span><br><span class="line">rune count: 7</span><br><span class="line">y e s ä¸­ æ–‡ ä¸­ æ–‡</span><br></pre></td></tr></table></figure>
<p>runeç›¸å½“äºgoçš„char<br>ä½¿ç”¨rangeéå†stringï¼Œruneå¯¹<br>ä½¿ç”¨utf8.RuneCountInString(s)è·å¾—å­—ç¬¦æ•°é‡<br>ä½¿ç”¨lenè·å¾—å­—èŠ‚é•¿åº¦<br>ä½¿ç”¨[]byteè·å¾—æ‰€æœ‰çš„å­—èŠ‚</p>
<p>å¯»æ‰¾æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­—ä¸²</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func lengthOfNonRepeatSubStr(s string) int &#123;</span><br><span class="line">	lastOccurred := make(map[rune]int)</span><br><span class="line">	start := 0</span><br><span class="line">	maxLength := 0</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, ch := range []rune(s) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> lastI, ok := lastOccurred[ch]; ok &amp;&amp; lastI &gt;= start &#123;</span><br><span class="line">			start = lastI + 1</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> i-start+1 &gt; maxLength &#123;</span><br><span class="line">			maxLength = i - start + 1</span><br><span class="line">		&#125;</span><br><span class="line">		lastOccurred[ch] = i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> maxLength</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>å…¶å®ƒå­—ç¬¦ä¸²æ“ä½œ<br>Fields Split Join<br>Contains Index<br>ToLower ToUpper<br>Trim TrimRight TrimLeft</p>
<h2 id="ç»“æ„ä½“å’Œæ–¹æ³•"><a href="#ç»“æ„ä½“å’Œæ–¹æ³•" class="headerlink" title="ç»“æ„ä½“å’Œæ–¹æ³•"></a>ç»“æ„ä½“å’Œæ–¹æ³•</h2><h3 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h3><p>goä»…æ”¯æŒå°è£…ï¼Œä¸æ”¯æŒç»§æ‰¿å’Œå¤šæ€</p>
<p>ç»“æ„ä½“çš„åˆ›å»ºï¼šä¸è®ºåœ°å€è¿˜æ˜¯ç»“æ„æœ¬èº«ï¼Œä¸€å¾‹ä½¿ç”¨<code>.</code>æ¥è®¿é—®æˆå‘˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//å®šä¹‰</span><br><span class="line"><span class="built_in">type</span> treeNode struct &#123;</span><br><span class="line">	value       int</span><br><span class="line">	left, right *treeNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å·¥å‚å‡½æ•°åˆ›å»º</span><br><span class="line">func createNode(value int) *treeNode &#123;</span><br><span class="line">	<span class="built_in">return</span> &amp;treeNode&#123;value: value&#125; //è¿™é‡Œè¿”å›çš„æ˜¯å±€éƒ¨å˜é‡çš„åœ°å€ç»™å¤–éƒ¨ä½¿ç”¨ï¼Œåœ¨goä¾æ—§æ˜¯å¯ä»¥çš„</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	var root treeNode</span><br><span class="line">	fmt.Println(root)</span><br><span class="line"></span><br><span class="line">	//åˆ›å»º</span><br><span class="line">	root = treeNode&#123;value: 3&#125;</span><br><span class="line">	root.left = &amp;treeNode&#123;&#125;</span><br><span class="line">	root.right = &amp;treeNode&#123;5, nil, nil&#125;</span><br><span class="line">	root.right.left = new(treeNode)</span><br><span class="line">	fmt.Println(root)</span><br><span class="line">	nodes := []treeNode&#123;</span><br><span class="line">		&#123;value: 3&#125;,</span><br><span class="line">		&#123;&#125;, </span><br><span class="line">		&#123;6, nil, &amp;root&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(nodes)</span><br><span class="line"></span><br><span class="line">	root.left.right = createNode(2)</span><br><span class="line">	fmt.Println(root)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»™ç»“æ„å®šä¹‰æ–¹æ³•:<br>funcåé¢æ‹¬å·çš„æ˜¯æ–¹æ³•æ¥æ”¶è€…ï¼ˆå…¶å®å°±è·Ÿå‡½æ•°çš„è¿”å›å€¼ä¸€æ ·ï¼‰<br>åªæœ‰ä½¿ç”¨æŒ‡é’ˆæ‰å¯ä»¥æ”¹å˜ç»“æ„çš„å†…å®¹<br>nilæŒ‡é’ˆä¹Ÿå¯ä»¥è°ƒç”¨æ–¹æ³•ï¼ˆå¯ä»¥å°†å€¼ä¼ è¿›æ¥ï¼Œä½†æ˜¯nilçš„èµ‹å€¼ä¼šæŠ¥é”™ï¼Œéœ€è¦åšreturnå¤„ç†ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//æ ‘çš„éå†:ç»™ç»“æ„å®šä¹‰æ–¹æ³•</span><br><span class="line">func (node *treeNode) setValue(value int) &#123;</span><br><span class="line">	<span class="keyword">if</span> node == nil &#123;</span><br><span class="line">		fmt.Println(<span class="string">"setting value to nil node"</span>)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	node.value = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//å€¼ä¸ä¼šå˜</span><br><span class="line">// func (node treeNode) setValue(value int) &#123;</span><br><span class="line">// 	node.value = value</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">func (node *treeNode) setValue(value int) &#123;</span><br><span class="line">	node.value = value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fmt.Println(<span class="string">"print\n"</span>)</span><br><span class="line">	root.print()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"\nsetValue\n"</span>)</span><br><span class="line">	root.right.left.setValue(9)</span><br><span class="line">	root.right.left.print()</span><br></pre></td></tr></table></figure>


<p>ä¸­åºéå†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"> æ€»ç»“ï¼š</span><br><span class="line"> è¦æ”¹å˜å†…å®¹å¿…é¡»ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…</span><br><span class="line"> ç»“æ„è¿‡å¤§ä¹Ÿè€ƒè™‘ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## åŒ…å’Œå°è£…</span></span><br><span class="line"></span><br><span class="line">å°è£…</span><br><span class="line">åå­—ä¸€èˆ¬ä½¿ç”¨é©¼å³°å‘½å</span><br><span class="line">é¦–å­—æ¯å¤§å†™ï¼špublicï¼ˆé’ˆå¯¹äºåŒ…ï¼‰</span><br><span class="line">é¦–å­—æ¯å°å†™ï¼šprivateï¼ˆé’ˆå¯¹äºåŒ…ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åŒ…</span><br><span class="line">æ¯ä¸ªç›®å½•ä¸€ä¸ªåŒ…</span><br><span class="line">mainåŒ…åŒ…å«å¯æ‰§è¡Œå…¥å£</span><br><span class="line">ä¸ºç»“æ„å®šä¹‰çš„æ–¹æ³•å¿…é¡»æ”¾åœ¨åŒä¸€ä¸ªåŒ…å†…</span><br><span class="line">ä¸€ä¸ªåŒ…å¯ä»¥æ”¾ä¸åŒçš„æ–‡ä»¶</span><br><span class="line">å»ºè®®ç»“æ„ä½“éƒ½ä¸éœ€è¦å‰ç¼€åŒ…åï¼ˆTreeNodeæ”¹ä¸ºNodeå³å¯ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ‹“å±•å·²æœ‰ç±»å‹</span></span><br><span class="line"></span><br><span class="line">å®šä¹‰åˆ«å</span><br><span class="line">```bash</span><br><span class="line"><span class="built_in">type</span> myTreeNode struct &#123;</span><br><span class="line">	node *tree.TreeNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ååºéå†</span><br><span class="line">func (myNode *myTreeNode) <span class="function"><span class="title">postOrder</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> myNode == nil || myNode.node == nil &#123;</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	left := myTreeNode&#123;myNode.node.Left&#125;</span><br><span class="line">	left.postOrder()</span><br><span class="line"></span><br><span class="line">	right := myTreeNode&#123;myNode.node.Right&#125;</span><br><span class="line">	right.postOrder()</span><br><span class="line"></span><br><span class="line">	myNode.node.Print()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>ä½¿ç”¨ç»„åˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package queue</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Queue []int</span><br><span class="line"></span><br><span class="line">func (q *Queue) Push(v int) &#123;</span><br><span class="line">	*q = append(*q, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (q *Queue) Pop() int &#123;</span><br><span class="line">	head := (*q)[0]</span><br><span class="line">	*q = (*q)[1:]</span><br><span class="line">	<span class="built_in">return</span> head</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (q *Queue) IsEmpty() bool &#123;</span><br><span class="line">	<span class="built_in">return</span> len(*q) == 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"learngo/queue"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	q := queue.Queue&#123;1&#125;</span><br><span class="line">	q.Push(2)</span><br><span class="line">	q.Push(3)</span><br><span class="line">	fmt.Println(q.Pop())</span><br><span class="line">	fmt.Println(q.Pop())</span><br><span class="line">	fmt.Println(q.IsEmpty())</span><br><span class="line">	fmt.Println(q.Pop())</span><br><span class="line">	fmt.Println(q.IsEmpty())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å†…åµŒæ¥æ‰©å±•å·²æœ‰ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> myTreeNode struct &#123;</span><br><span class="line">	*tree.Node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h2><ul>
<li>GOPATH</li>
<li>GOVENDOR</li>
<li>go mod</li>
</ul>
<p>go modçš„ä½¿ç”¨</p>
<p>å¼•å…¥éœ€è¦çš„åº“</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import (</span><br><span class="line">	<span class="string">"go.uber.org/zap"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go run zaptest.go</span><br></pre></td></tr></table></figure>


<p>æˆ–è€…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get -u åº“å </span><br><span class="line"></span><br><span class="line">go mod init modtest</span><br><span class="line"></span><br><span class="line">go build ./...</span><br></pre></td></tr></table></figure>

<p>å¢åŠ ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get [@version]</span><br><span class="line"></span><br><span class="line">go mod tidy  //æ›´æ–°ç‰ˆæœ¬ä¹‹åï¼Œä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥å»é™¤å¤šä½™çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h2 id="ç›®å½•ç®¡ç†"><a href="#ç›®å½•ç®¡ç†" class="headerlink" title="ç›®å½•ç®¡ç†"></a>ç›®å½•ç®¡ç†</h2><p>æ¯ä¸ªå•ç‹¬ç›®å½•åªæœ‰ä¸€ä¸ªmianå‡½æ•°</p>
<p>buildå½“å‰ç›®å½•çš„æ‰€æœ‰å­æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go build ./...</span><br></pre></td></tr></table></figure>

<p>äº§ç”Ÿç»“æœ, ç»“æœæ”¾åœ¨GOPATHçš„binç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go install ./...</span><br><span class="line">go env GOPATH</span><br></pre></td></tr></table></figure>

<h2 id="æ¥å£çš„æ¦‚å¿µ"><a href="#æ¥å£çš„æ¦‚å¿µ" class="headerlink" title="æ¥å£çš„æ¦‚å¿µ"></a>æ¥å£çš„æ¦‚å¿µ</h2><p>infra</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package infra</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Retriver struct&#123;&#125;</span><br><span class="line"></span><br><span class="line">func (Retriver) Get(url string) string &#123;</span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	defer resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	bytes, _ := ioutil.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> string(bytes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>testing</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package testing</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Retriver struct&#123;&#125;</span><br><span class="line"></span><br><span class="line">func (Retriver) Get(url string) string &#123;</span><br><span class="line">	<span class="built_in">return</span> <span class="string">"fake content"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>download</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"learngo/downloader/infra"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func getRetriver() retriver &#123;</span><br><span class="line">	// <span class="built_in">return</span> testing.Retriver&#123;&#125;//æµ‹è¯•</span><br><span class="line">	<span class="built_in">return</span> infra.Retriver&#123;&#125;//çœŸå®æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ˜¯infraè¿˜æ˜¯testingçš„Retriverå‘¢ï¼Ÿå¦‚ä½•åˆ¤æ–­å‘¢ï¼šé€šè¿‡æ¥å£</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> retriver interface &#123;</span><br><span class="line">	Get(string) string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	var r retriver = getRetriver()</span><br><span class="line">	fmt.Printf(<span class="string">"%s\n"</span>, r.Get(<span class="string">"http://www.imooc.com"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="duck-typing"><a href="#duck-typing" class="headerlink" title="duck typing"></a>duck typing</h2><h2 id="æ¥å£çš„å®šä¹‰å’Œå®ç°"><a href="#æ¥å£çš„å®šä¹‰å’Œå®ç°" class="headerlink" title="æ¥å£çš„å®šä¹‰å’Œå®ç°"></a>æ¥å£çš„å®šä¹‰å’Œå®ç°</h2><p>æ¥å£çš„å®šä¹‰(æ¥å£ç”±ä½¿ç”¨è€…å®šä¹‰)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"learngo/retriever/mock"</span></span><br><span class="line">	<span class="string">"learngo/retriever/real"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Retriver interface &#123;</span><br><span class="line">	Get(url string) string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func download(r Retriver) string &#123;</span><br><span class="line">	<span class="built_in">return</span> r.Get(<span class="string">"http://www.imooc.com"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	var r Retriver</span><br><span class="line">	r = mock.Retriver&#123;<span class="string">"this is a fake imooc.com"</span>&#125;</span><br><span class="line">	r = real.Retriver&#123;&#125;</span><br><span class="line">	fmt.Println(download(r))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥å£çš„å®ç°ï¼ˆä¸éœ€è¦å®ç°Retriveræ¥å£ï¼Œåªéœ€è¦å®ç°æ¥å£é‡Œçš„æ–¹æ³•ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package real</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"net/http/httputil"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Retriver struct &#123;</span><br><span class="line">	UserAgent string</span><br><span class="line">	TimeOut   time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (r Retriver) Get(url string) string &#123;</span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	result, err := httputil.DumpResponse(resp, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">	resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> string(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ¥å£çš„å€¼ç±»å‹"><a href="#æ¥å£çš„å€¼ç±»å‹" class="headerlink" title="æ¥å£çš„å€¼ç±»å‹"></a>æ¥å£çš„å€¼ç±»å‹</h2><p>switchåˆ¤æ–­ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func inspect(r Retriver) &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"ç±»å‹=%T å€¼=%v\n"</span>, r, r)</span><br><span class="line">	switch v := r.(<span class="built_in">type</span>) &#123;</span><br><span class="line">	<span class="keyword">case</span> mock.Retriver:</span><br><span class="line">		fmt.Println(<span class="string">"Contents:"</span>, v.Contents)</span><br><span class="line">	<span class="keyword">case</span> *real.Retriver:</span><br><span class="line">		fmt.Println(<span class="string">"UserAgent:"</span>, v.UserAgent)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>type assertion</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//<span class="built_in">type</span> assertion</span><br><span class="line"></span><br><span class="line">	//real</span><br><span class="line">	realRetriver := r.(*real.Retriver)</span><br><span class="line">	fmt.Println(realRetriver.TimeOut)</span><br><span class="line"></span><br><span class="line">	//å‡ºé”™å†™æ³•</span><br><span class="line">	realRetriver := r.(real.Retriver)</span><br><span class="line">	fmt.Println(realRetriver.TimeOut)</span><br><span class="line"></span><br><span class="line">	//é˜²æ­¢å‡ºé”™</span><br><span class="line">	<span class="keyword">if</span> mockRetriver, ok := r.(mock.Retriver); ok &#123;</span><br><span class="line">		fmt.Println(mockRetriver.Contents)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"not a mock retriver"</span>)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


<p>è¡¨ç¤ºä»»ä½•ç±»å‹:interface{}</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//æ”¹ä¸ºæ”¯æŒä»»ä½•ç±»å‹</span><br><span class="line"><span class="built_in">type</span> Queue []interface&#123;&#125;</span><br><span class="line"></span><br><span class="line">func (q *Queue) Push(v interface&#123;&#125;) &#123;</span><br><span class="line">	*q = append(*q, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (q *Queue) Pop() interface&#123;&#125; &#123;</span><br><span class="line">	head := (*q)[0]</span><br><span class="line">	*q = (*q)[1:]</span><br><span class="line">	<span class="built_in">return</span> head</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (q *Queue) IsEmpty() bool &#123;</span><br><span class="line">	<span class="built_in">return</span> len(*q) == 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ¥å£çš„ç»„åˆ"><a href="#æ¥å£çš„ç»„åˆ" class="headerlink" title="æ¥å£çš„ç»„åˆ"></a>æ¥å£çš„ç»„åˆ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> Retriver interface &#123;</span><br><span class="line">	Get(url string) string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Poster interface &#123;</span><br><span class="line">	Post(url string, form map[string]string) string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const url = <span class="string">"http://www.imooc.com"</span></span><br><span class="line"></span><br><span class="line">func download(r Retriver) string &#123;</span><br><span class="line">	<span class="built_in">return</span> r.Get(url)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func poster(poster Poster) &#123;</span><br><span class="line">	poster.Post(url,</span><br><span class="line">		map[string]string&#123;</span><br><span class="line">			<span class="string">"name"</span>:     <span class="string">"sam"</span>,</span><br><span class="line">			<span class="string">"language"</span>: <span class="string">"golang"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> RetriverPoster interface &#123;</span><br><span class="line">	Retriver</span><br><span class="line">	Poster</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func session(s RetriverPoster) string &#123;</span><br><span class="line">	s.Post(url, map[string]string&#123;</span><br><span class="line">		<span class="string">"contents"</span>: <span class="string">"another facked imooc.com"</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="built_in">return</span> s.Get(url)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£"><a href="#å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£" class="headerlink" title="å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£"></a>å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£</h2><h2 id="å‡½æ•°å¼ç¼–ç¨‹"><a href="#å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹"></a>å‡½æ•°å¼ç¼–ç¨‹</h2><p>å‚æ•°ã€å˜é‡ã€è¿”å›å€¼éƒ½å¯ä»¥æ˜¯å‡½æ•°<br>é«˜é˜¶å‡½æ•°ï¼ˆå‡½æ•°çš„å‚æ•°ä¾æ—§æ˜¯ä¸ªå‡½æ•°ï¼‰<br>å‡½æ•°é—­åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//è¿”å›ä¸€ä¸ªå‡½æ•°</span><br><span class="line">func adder() func(int) int &#123;</span><br><span class="line">	sum := 0</span><br><span class="line">	<span class="built_in">return</span> func(v int) int &#123;</span><br><span class="line">		sum += v</span><br><span class="line">		<span class="built_in">return</span> sum</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	a := adder()</span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		fmt.Println((a(i)))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–æ³¢é‚£å¥‘æ•°åˆ—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func fibonacci() func() int &#123;</span><br><span class="line">	a, b := 0, 1</span><br><span class="line">	<span class="built_in">return</span> func() int &#123;</span><br><span class="line">		a, b = b, a+b</span><br><span class="line">		<span class="built_in">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>ä¸ºå‡½æ•°å®ç°æ¥å£</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> intGen func() int</span><br><span class="line"></span><br><span class="line">func (g intGen) Read(</span><br><span class="line">	p []byte) (n int, err error) &#123;</span><br><span class="line">	next := g()</span><br><span class="line">	<span class="keyword">if</span> next &gt; 10000 &#123;</span><br><span class="line">		<span class="built_in">return</span> 0, io.EOF</span><br><span class="line">	&#125;</span><br><span class="line">	s := fmt.Sprintf(<span class="string">"%d\n"</span>, next)</span><br><span class="line"></span><br><span class="line">	// TODO: incorrect <span class="keyword">if</span> p is too small!</span><br><span class="line">	<span class="built_in">return</span> strings.NewReader(s).Read(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func printFileContents(reader io.Reader) &#123;</span><br><span class="line">	scanner := bufio.NewScanner(reader)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> scanner.<span class="function"><span class="title">Scan</span></span>() &#123;</span><br><span class="line">		fmt.Println(scanner.Text())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	var f intGen = fib.Fibonacci()</span><br><span class="line">	printFileContents(f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>åˆ©ç”¨å‡½æ•°éå†äºŒå‰æ ‘</p>
<h2 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h2><p>ç¡®ä¿è°ƒç”¨åœ¨å‡½æ•°ç»“æŸæ—¶å‘ç”Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">tryDefer</span></span>() &#123;</span><br><span class="line">	defer fmt.Println(1)</span><br><span class="line">	defer fmt.Println(2)</span><br><span class="line">	defer fmt.Println(3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>deferæ˜¯ä¸€ä¸ªæ ˆï¼Œå…ˆè¿›åå‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">tryDefer</span></span>() &#123;</span><br><span class="line">	defer fmt.Println(1)</span><br><span class="line">	defer fmt.Println(2)</span><br><span class="line">	defer fmt.Println(3)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 100; i++ &#123;</span><br><span class="line">		defer fmt.Println(i)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> i == 30 &#123;</span><br><span class="line">			panic(<span class="string">"printed too many"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func writeFle(filename string) &#123;</span><br><span class="line">	file, err := os.Create(filename)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	defer file.Close()</span><br><span class="line"></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	defer writer.Flush()</span><br><span class="line"></span><br><span class="line">	f := fib.Fibonacci()</span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 20; i++ &#123;</span><br><span class="line">		fmt.Fprintln(writer, f())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	writeFle(<span class="string">"fib.txt"</span>)</span><br><span class="line"></span><br><span class="line">	tryDefer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  defer go run defer.go</span><br><span class="line">30</span><br><span class="line">29</span><br><span class="line">28</span><br><span class="line">27</span><br><span class="line">26</span><br><span class="line">25</span><br><span class="line">24</span><br><span class="line">23</span><br><span class="line">22</span><br><span class="line">21</span><br><span class="line">20</span><br><span class="line">19</span><br><span class="line">18</span><br><span class="line">17</span><br><span class="line">16</span><br><span class="line">15</span><br><span class="line">14</span><br><span class="line">13</span><br><span class="line">12</span><br><span class="line">11</span><br><span class="line">10</span><br><span class="line">9</span><br><span class="line">8</span><br><span class="line">7</span><br><span class="line">6</span><br><span class="line">5</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">panic: printed too many</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">main.tryDefer()</span><br><span class="line">        /Users/samtake/Desktop/learngo/hello/errHandling/defer/defer.go:19 +0x2fc</span><br><span class="line">main.main()</span><br><span class="line">        /Users/samtake/Desktop/learngo/hello/errHandling/defer/defer.go:43 +0x3b</span><br><span class="line"><span class="built_in">exit</span> status 2</span><br></pre></td></tr></table></figure>

<p>ä½•æ—¶è°ƒç”¨defer</p>
<ul>
<li><p>Open/Close</p>
</li>
<li><p>Lock/Unlock</p>
</li>
<li><p>PrintHeader/PrintFooter</p>
</li>
</ul>
<p>é”™è¯¯å¤„ç†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">tryDefer</span></span>() &#123;</span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 100; i++ &#123;</span><br><span class="line">		defer fmt.Println(i)</span><br><span class="line">		<span class="keyword">if</span> i == 30 &#123;</span><br><span class="line">			// Uncomment panic to see</span><br><span class="line">			// how it works with defer</span><br><span class="line">			// panic(<span class="string">"printed too many"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func writeFle(filename string) &#123;</span><br><span class="line">	file, err := os.OpenFile(filename,</span><br><span class="line">		os.O_EXCL|os.O_CREATE|os.O_WRONLY, 0666)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		<span class="keyword">if</span> pathError, ok := err.(*os.PathError); !ok &#123;</span><br><span class="line">			panic(err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"%s, %s, %s\n"</span>,</span><br><span class="line">				pathError.Op,</span><br><span class="line">				pathError.Path,</span><br><span class="line">				pathError.Err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	defer file.Close()</span><br><span class="line"></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	defer writer.Flush()</span><br><span class="line"></span><br><span class="line">	f := fib.Fibonacci()</span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 20; i++ &#123;</span><br><span class="line">		fmt.Fprintln(writer, f())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨ç»Ÿä¸€å‡ºé”™å¤„ç†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> appHandler func(writer http.ResponseWriter,</span><br><span class="line">	request *http.Request) error</span><br><span class="line"></span><br><span class="line">func errWrapper(</span><br><span class="line">	handler appHandler) func(</span><br><span class="line">	http.ResponseWriter, *http.Request) &#123;</span><br><span class="line">	<span class="built_in">return</span> func(writer http.ResponseWriter,</span><br><span class="line">		request *http.Request) &#123;</span><br><span class="line">		// panic</span><br><span class="line">		defer <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">			<span class="keyword">if</span> r := recover(); r != nil &#123;</span><br><span class="line">				log.Printf(<span class="string">"Panic: %v"</span>, r)</span><br><span class="line">				http.Error(writer,</span><br><span class="line">					http.StatusText(http.StatusInternalServerError),</span><br><span class="line">					http.StatusInternalServerError)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line"></span><br><span class="line">		err := handler(writer, request)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">			log.Printf(<span class="string">"Error occurred "</span>+</span><br><span class="line">				<span class="string">"handling request: %s"</span>,</span><br><span class="line">				err.Error())</span><br><span class="line"></span><br><span class="line">			// user error</span><br><span class="line">			<span class="keyword">if</span> userErr, ok := err.(userError); ok &#123;</span><br><span class="line">				http.Error(writer,</span><br><span class="line">					userErr.Message(),</span><br><span class="line">					http.StatusBadRequest)</span><br><span class="line">				<span class="built_in">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			// system error</span><br><span class="line">			code := http.StatusOK</span><br><span class="line">			switch &#123;</span><br><span class="line">			<span class="keyword">case</span> os.IsNotExist(err):</span><br><span class="line">				code = http.StatusNotFound</span><br><span class="line">			<span class="keyword">case</span> os.IsPermission(err):</span><br><span class="line">				code = http.StatusForbidden</span><br><span class="line">			default:</span><br><span class="line">				code = http.StatusInternalServerError</span><br><span class="line">			&#125;</span><br><span class="line">			http.Error(writer,</span><br><span class="line">				http.StatusText(code), code)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> userError interface &#123;</span><br><span class="line">	error</span><br><span class="line">	Message() string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>,</span><br><span class="line">		errWrapper(filelisting.HandleFileList))</span><br><span class="line"></span><br><span class="line">	err := http.ListenAndServe(<span class="string">":8888"</span>, nil)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="panicå’Œrecover"><a href="#panicå’Œrecover" class="headerlink" title="panicå’Œrecover"></a>panicå’Œrecover</h2><p>panic<br>åœæ­¢å½“å‰å‡½æ•°æ‰§è¡Œ<br>ä¸€ç›´å‘ä¸Šè¿”å›ï¼Œæ‰§è¡Œæ¯ä¸€å±‚çš„defer<br>å¦‚æœæ²¡æœ‰é‡è§recoverï¼Œç¨‹åºå°±é€€å‡º</p>
<p>recover<br>ä»…åœ¨deferè°ƒç”¨ä¸­ä½¿ç”¨<br>è·å–panicçš„å€¼<br>å¦‚æœæ— æ³•å¤„ç†ï¼Œå¯é‡æ–°panic</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">tryRecover</span></span>() &#123;</span><br><span class="line">	defer <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		r := recover()</span><br><span class="line">		<span class="keyword">if</span> r == nil &#123;</span><br><span class="line">			fmt.Println(<span class="string">"Nothing to recover. "</span> +</span><br><span class="line">				<span class="string">"Please try uncomment errors "</span> +</span><br><span class="line">				<span class="string">"below."</span>)</span><br><span class="line">			<span class="built_in">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> err, ok := r.(error); ok &#123;</span><br><span class="line">			fmt.Println(<span class="string">"Error occurred:"</span>, err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			panic(fmt.Sprintf(</span><br><span class="line">				<span class="string">"I don't know what to do: %v"</span>, r))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>go test ä¼šè‡ªåŠ¨æ‰§è¡Œè·¯å¾„åŒ…ä¸‹é¢çš„â€œ_test.goâ€æ–‡ä»¶ï¼ˆåŒ…æ‹¬æ–‡ä»¶ååŒ…å« â€œ_test.goâ€ çš„æºæ–‡ä»¶ï¼‰ï¼Œæˆ‘ä»¬ç®¡ç§°è¿™äº›æ˜¯æµ‹è¯•æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«ç€ä½ çš„æµ‹è¯•å‡½æ•°ï¼Œæµ‹è¯•ç”¨ä¾‹ç­‰ã€‚æ›´å¤šç”¨æ³•å¯ä»¥è¾“å…¥ â€œgo help testâ€ æŸ¥çœ‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h2 id="ä»£ç è¦†ç›–ç‡å’Œæ€§èƒ½æµ‹è¯•"><a href="#ä»£ç è¦†ç›–ç‡å’Œæ€§èƒ½æµ‹è¯•" class="headerlink" title="ä»£ç è¦†ç›–ç‡å’Œæ€§èƒ½æµ‹è¯•"></a>ä»£ç è¦†ç›–ç‡å’Œæ€§èƒ½æµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä½¿ç”¨pprofè¿›è¡Œæ€§èƒ½è°ƒä¼˜</span></span><br><span class="line">```bash</span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•httpæœåŠ¡å™¨"><a href="#æµ‹è¯•httpæœåŠ¡å™¨" class="headerlink" title="æµ‹è¯•httpæœåŠ¡å™¨"></a>æµ‹è¯•httpæœåŠ¡å™¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç”Ÿæˆæ–‡æ¡£å’Œå®åŠ›ä»£ç </span></span><br><span class="line">```bash</span><br></pre></td></tr></table></figure>

<h2 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h2><p>è½»é‡çº§â€œçº¿ç¨‹â€<br>éæŠ¢å å¼å¤šä»»åŠ¡å¤„ç†ï¼Œç”±åç¨‹ä¸»åŠ¨äº¤å‡ºæ§åˆ¶æƒï¼ˆPrintfæ˜¯ä¸ªIOæ“ä½œï¼Œå†…éƒ¨åšäº†æ§åˆ¶æƒåˆ‡æ¢ï¼‰<br>å¤šä¸ªåç¨‹å¯èƒ½åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 1000; i++ &#123;</span><br><span class="line">		go func(i int) &#123;</span><br><span class="line">			<span class="keyword">for</span> &#123;</span><br><span class="line">				fmt.Printf(<span class="string">"hello form goroutine %d\n"</span>, i)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">func <span class="function"><span class="title">tryGoroutine</span></span>() &#123;</span><br><span class="line">	var a [10]int</span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		go func(ii int) &#123;</span><br><span class="line">			<span class="keyword">for</span> &#123;</span><br><span class="line">				a[ii]++</span><br><span class="line">				runtime.Gosched()//ä¸»åŠ¨äº¤å‡ºæ§åˆ¶æƒ</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•°æ®è®¿é—®çš„å†²çª</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go run -race goroutine.go</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹cpuå ç”¨ç‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure>
<p>goè¯­è¨€çš„è°ƒåº¦å™¨</p>
<p>ä»»ä½•å‡½æ•°åªéœ€åŠ ä¸Šgoå°±èƒ½é€ç»™è°ƒåº¦å™¨è¿è¡Œ<br>ä¸éœ€è¦åœ¨å®šä¹‰æ—¶åŒºåˆ†æ˜¯å¦æ˜¯å¼‚æ­¥å‡½æ•°<br>è°ƒåº¦å™¨åœ¨åˆé€‚çš„ç‚¹è¿›è¡Œåˆ‡æ¢<br>ä½¿ç”¨-raceæ¥æ£€æµ‹æ•°æ®è®¿é—®å†²çª</p>
<p>goroutine å¯èƒ½çš„åˆ‡æ¢ç‚¹<br>I/Oã€select<br>channel<br>ç­‰å¾…é”<br>å‡½æ•°è°ƒç”¨ï¼ˆæœ‰æ—¶ä¼šï¼‰<br>runtime.Gosched()<br>ä»¥ä¸Šæ‰€åˆ—åªæ˜¯å‚è€ƒï½çœŸå®æƒ…å†µå°±ä¸ä¸€å®šï½</p>
<h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">chanDemo</span></span>() &#123;</span><br><span class="line">	// var c chan int //c == nil</span><br><span class="line">	c := make(chan int)</span><br><span class="line"></span><br><span class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			n := &lt;-c</span><br><span class="line">			fmt.Println(n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	c &lt;- 1</span><br><span class="line">	c &lt;- 2 //å¦‚æœmainé€€å‡ºäº†ï¼Œ2æ˜¯æ²¡æœ‰è¾“å‡ºçš„</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func worker(c chan int) &#123;</span><br><span class="line">	<span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			n := &lt;-c</span><br><span class="line">			fmt.Println(n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br><span class="line">func <span class="function"><span class="title">chanDemo</span></span>() &#123;</span><br><span class="line">	// var c chan int //c == nil</span><br><span class="line">	c := make(chan int)</span><br><span class="line"></span><br><span class="line">	go worker(c)</span><br><span class="line">	c &lt;- 1</span><br><span class="line">	c &lt;- 2 //å¦‚æœmainé€€å‡ºäº†ï¼Œ2æ˜¯æ²¡æœ‰è¾“å‡ºçš„</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>channelä½œä¸ºå‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func worker(id int, c chan int) &#123;</span><br><span class="line">	<span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"Worker %d received %c\n"</span>, id, &lt;-c)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br><span class="line">func <span class="function"><span class="title">chanDemo</span></span>() &#123;</span><br><span class="line">	var channels [10]chan int</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] = make(chan int)</span><br><span class="line">		go worker(i, channels[i])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] &lt;- <span class="string">'a'</span> + i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] &lt;- <span class="string">'A'</span> + i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>channelä½œä¸ºè¿”å›å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func creatWorker(id int) chan&lt;- int &#123;</span><br><span class="line">	c := make(chan int)</span><br><span class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"Worker %d received %c\n"</span>, id, &lt;-c)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> c</span><br><span class="line">&#125;</span><br><span class="line">func <span class="function"><span class="title">chanDemo</span></span>() &#123;</span><br><span class="line">	var channels [10]chan&lt;- int</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] = creatWorker(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] &lt;- <span class="string">'a'</span> + i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] &lt;- <span class="string">'A'</span> + i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼“å­˜channel</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func work(id int, c chan int) &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Worker %d received %c\n"</span>, id, &lt;-c)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">func <span class="function"><span class="title">bufferedChannel</span></span>() &#123;</span><br><span class="line">	c := make(chan int, 3) //ç»™ä¸ªç¼“å­˜3</span><br><span class="line">	go work(0, c)</span><br><span class="line">	c &lt;- 1</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>å…³é—­é€šé“</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">channelClose</span></span>() &#123;</span><br><span class="line">	c := make(chan int)</span><br><span class="line">	go work(0, c)</span><br><span class="line">	c &lt;- <span class="string">'a'</span></span><br><span class="line">	c &lt;- <span class="string">'b'</span></span><br><span class="line">	c &lt;- <span class="string">'c'</span></span><br><span class="line">	c &lt;- <span class="string">'d'</span></span><br><span class="line">	close(c)</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é—­ä¹‹åï¼Œä¾æ—§èƒ½æ”¶åˆ°ï¼ˆç©ºä¸²ï¼Œ0ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Worker 0 received a</span><br><span class="line">Worker 0 received b</span><br><span class="line">Worker 0 received c</span><br><span class="line">Worker 0 received d</span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 received </span><br><span class="line">Worker 0 r</span><br></pre></td></tr></table></figure>

<p>è§£å†³å…³é—­ä¹‹åä¸å†è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func work(id int, c chan int) &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		n, ok := &lt;-c</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="built_in">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		fmt.Printf(<span class="string">"Worker %d received %c\n"</span>, id, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func work(id int, c chan int) &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> n := range c &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"Worker %d received %c\n"</span>, id, n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="ä½¿ç”¨channelç­‰å¾…goroutineç»“æŸï¼ˆé‡ç‚¹ï¼‰"><a href="#ä½¿ç”¨channelç­‰å¾…goroutineç»“æŸï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="ä½¿ç”¨channelç­‰å¾…goroutineç»“æŸï¼ˆé‡ç‚¹ï¼‰"></a>ä½¿ç”¨channelç­‰å¾…goroutineç»“æŸï¼ˆé‡ç‚¹ï¼‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func doWork(id int,</span><br><span class="line">	w worker) &#123;</span><br><span class="line">	<span class="keyword">for</span> n := range w.in &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Worker %d received %c\n"</span>,</span><br><span class="line">			id, n)</span><br><span class="line">		w.done()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> worker struct &#123;</span><br><span class="line">	<span class="keyword">in</span>   chan int</span><br><span class="line">	<span class="keyword">done</span> func()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func createWorker(</span><br><span class="line">	id int, wg *sync.WaitGroup) worker &#123;</span><br><span class="line">	w := worker&#123;</span><br><span class="line">		<span class="keyword">in</span>: make(chan int),</span><br><span class="line">		<span class="keyword">done</span>: <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	go doWork(id, w)</span><br><span class="line">	<span class="built_in">return</span> w</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">chanDemo</span></span>() &#123;</span><br><span class="line">	var wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">	var workers [10]worker</span><br><span class="line">	<span class="keyword">for</span> i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		workers[i] = createWorker(i, &amp;wg)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	wg.Add(20)</span><br><span class="line">	<span class="keyword">for</span> i, worker := range workers &#123;</span><br><span class="line">		worker.in &lt;- <span class="string">'a'</span> + i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i, worker := range workers &#123;</span><br><span class="line">		worker.in &lt;- <span class="string">'A'</span> + i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	chanDemo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Worker 7 received h</span><br><span class="line">Worker 5 received f</span><br><span class="line">Worker 0 received a</span><br><span class="line">Worker 1 received b</span><br><span class="line">Worker 1 received B</span><br><span class="line">Worker 4 received e</span><br><span class="line">Worker 9 received j</span><br><span class="line">Worker 8 received i</span><br><span class="line">Worker 2 received c</span><br><span class="line">Worker 0 received A</span><br><span class="line">Worker 6 received g</span><br><span class="line">Worker 3 received d</span><br><span class="line">Worker 9 received J</span><br><span class="line">Worker 6 received G</span><br><span class="line">Worker 7 received H</span><br><span class="line">Worker 2 received C</span><br><span class="line">Worker 4 received E</span><br><span class="line">Worker 8 received I</span><br><span class="line">Worker 3 received D</span><br><span class="line">Worker 5 received F</span><br></pre></td></tr></table></figure>


<p>ä½¿ç”¨Channelè¿›è¡Œä¹¦çš„éå†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨Selectè¿›è¡Œè°ƒåº¦ï¼ˆé‡ç‚¹ï¼‰"><a href="#ä½¿ç”¨Selectè¿›è¡Œè°ƒåº¦ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="ä½¿ç”¨Selectè¿›è¡Œè°ƒåº¦ï¼ˆé‡ç‚¹ï¼‰"></a>ä½¿ç”¨Selectè¿›è¡Œè°ƒåº¦ï¼ˆé‡ç‚¹ï¼‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func generator() chan int &#123;</span><br><span class="line">	out := make(chan int)</span><br><span class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		i := 0</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			time.Sleep(</span><br><span class="line">				time.Duration(rand.Intn(1500)) *</span><br><span class="line">					time.Millisecond)</span><br><span class="line">			out &lt;- i</span><br><span class="line">			i++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="built_in">return</span> out</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func worker(id int, c chan int) &#123;</span><br><span class="line">	<span class="keyword">for</span> n := range c &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		fmt.Printf(<span class="string">"Worker %d received %d\n"</span>,</span><br><span class="line">			id, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func createWorker(id int) chan&lt;- int &#123;</span><br><span class="line">	c := make(chan int)</span><br><span class="line">	go worker(id, c)</span><br><span class="line">	<span class="built_in">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	var c1, c2 = generator(), generator()</span><br><span class="line">	var worker = createWorker(0)</span><br><span class="line"></span><br><span class="line">	var values []int</span><br><span class="line">	tm := time.After(10 * time.Second)</span><br><span class="line">	tick := time.Tick(time.Second)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		var activeWorker chan&lt;- int</span><br><span class="line">		var activeValue int</span><br><span class="line">		<span class="keyword">if</span> len(values) &gt; 0 &#123;</span><br><span class="line">			activeWorker = worker</span><br><span class="line">			activeValue = values[0]</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		select &#123;</span><br><span class="line">		<span class="keyword">case</span> n := &lt;-c1:</span><br><span class="line">			values = append(values, n)</span><br><span class="line">		<span class="keyword">case</span> n := &lt;-c2:</span><br><span class="line">			values = append(values, n)</span><br><span class="line">		<span class="keyword">case</span> activeWorker &lt;- activeValue:</span><br><span class="line">			values = values[1:]</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> &lt;-time.After(800 * time.Millisecond):</span><br><span class="line">			fmt.Println(<span class="string">"timeout"</span>)</span><br><span class="line">		<span class="keyword">case</span> &lt;-tick:</span><br><span class="line">			fmt.Println(</span><br><span class="line">				<span class="string">"queue len ="</span>, len(values))</span><br><span class="line">		<span class="keyword">case</span> &lt;-tm:</span><br><span class="line">			fmt.Println(<span class="string">"bye"</span>)</span><br><span class="line">			<span class="built_in">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åŒæ­¥æœºåˆ¶"><a href="#åŒæ­¥æœºåˆ¶" class="headerlink" title="åŒæ­¥æœºåˆ¶"></a>åŒæ­¥æœºåˆ¶</h2><p>WaitGroup<br>Mutex<br>Cond</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment">## è¿·å®«ç®—æ³•</span></span><br><span class="line">```bash</span><br></pre></td></tr></table></figure>

<h2 id="httpæ ‡å‡†åº“"><a href="#httpæ ‡å‡†åº“" class="headerlink" title="httpæ ‡å‡†åº“"></a>httpæ ‡å‡†åº“</h2><p>ä½¿ç”¨httpå®¢æˆ·ç«¯å‘é€è¯·æ±‚<br>ä½¿ç”¨http.Clientæ§åˆ¶è¯·æ±‚å¤´éƒ¨ç­‰<br>ä½¿ç”¨httputilç®€åŒ–å·¥ä½œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"net/http/httputil"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	request, err := http.NewRequest(</span><br><span class="line">		http.MethodGet,</span><br><span class="line">		<span class="string">"http://www.imooc.com"</span>, nil)</span><br><span class="line">	request.Header.Add(<span class="string">"User-Agent"</span>,</span><br><span class="line">		<span class="string">"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) CriOS/56.0.2924.75 Mobile/14E5239e Safari/602.1"</span>)</span><br><span class="line"></span><br><span class="line">	client := http.Client&#123;</span><br><span class="line">		CheckRedirect: func(</span><br><span class="line">			req *http.Request,</span><br><span class="line">			via []*http.Request) error &#123;</span><br><span class="line">			fmt.Println(<span class="string">"Redirect:"</span>, req)</span><br><span class="line">			<span class="built_in">return</span> nil</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	resp, err := client.Do(request)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	defer resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	s, err := httputil.DumpResponse(resp, <span class="literal">true</span>)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"%s\n"</span>, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pprof</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">_ <span class="string">"net/http/pprof"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">...../debug/pprof/</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go tool pprof [åœ°å€]</span><br></pre></td></tr></table></figure>



<h2 id="å…¶å®ƒæ ‡å‡†åº“"><a href="#å…¶å®ƒæ ‡å‡†åº“" class="headerlink" title="å…¶å®ƒæ ‡å‡†åº“"></a>å…¶å®ƒæ ‡å‡†åº“</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bufio</span><br><span class="line"><span class="built_in">log</span></span><br><span class="line">encoding/json</span><br><span class="line">regexp</span><br><span class="line">time</span><br><span class="line">strings/math/rand</span><br></pre></td></tr></table></figure>

<p>è·å–æ–‡æ¡£</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">godoc -http :8888</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://docscn.studygolang.com/</span><br></pre></td></tr></table></figure>



<h2 id="gin-amp-å¢åŠ middleware"><a href="#gin-amp-å¢åŠ middleware" class="headerlink" title="gin&amp;å¢åŠ middleware"></a>gin&amp;å¢åŠ middleware</h2><p>æ‹‰å–ginå’Œæ—¥å¿—åº“zap</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br><span class="line">go get -u go.uber.org/zap</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/ping"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://localhost:8080/ping</span><br></pre></td></tr></table></figure>





<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">listen tcp :8080: <span class="built_in">bind</span>: address already <span class="keyword">in</span> use é—®é¢˜è§£å†³</span><br><span class="line">å‘½ä»¤è¡Œ lsof -i:8080 è¿™é‡Œ8080æ˜¯æˆ‘è¦é‡Šæ”¾çš„ç«¯å£å·</span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç«¯å£è¢«idä¸º51217çš„è¿›ç¨‹æ‰€å ç”¨ï¼Œè¿™ä¸ªæ—¶å€™ç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å…¥</span><br><span class="line"></span><br><span class="line"><span class="built_in">kill</span> 51217</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import (</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"go.uber.org/zap"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	logger, err := zap.NewProduction()</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	r.Use(func(c *gin.Context) &#123;</span><br><span class="line">		logger.Info(<span class="string">"incoming request"</span>, zap.String(<span class="string">"path"</span>, c.Request.URL.Path))</span><br><span class="line">		c.Next()</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"/ping"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"/hello"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"hello"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import (</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"go.uber.org/zap"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const keyRequestId = <span class="string">"requestId"</span></span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	logger, err := zap.NewProduction()</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	r.Use(func(c *gin.Context) &#123;</span><br><span class="line">		s := time.Now()</span><br><span class="line"></span><br><span class="line">		c.Next()</span><br><span class="line"></span><br><span class="line">		logger.Info(<span class="string">"incoming request"</span>,</span><br><span class="line">			zap.String(<span class="string">"path"</span>, c.Request.URL.Path),</span><br><span class="line">			zap.Int(<span class="string">"status"</span>, c.Writer.Status()),</span><br><span class="line">			zap.Duration(<span class="string">"elapsed"</span>, time.Now().Sub(s)))</span><br><span class="line">	&#125;, func(c *gin.Context) &#123;</span><br><span class="line">		c.Set(keyRequestId, rand.Int())</span><br><span class="line"></span><br><span class="line">		c.Next()</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"/ping"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		h := gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> rid, exists := c.Get(keyRequestId); exists &#123;</span><br><span class="line">			h[keyRequestId] = rid</span><br><span class="line">		&#125;</span><br><span class="line">		c.JSON(200, h)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.GET(<span class="string">"/hello"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"hello"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"><a href="#ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"></a>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	re := regexp.MustCompile(`[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]+`)</span><br><span class="line">	match := re.FindAllString(text, -1)</span><br><span class="line">	fmt.Println(match)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[sam@gmail.com 5555@qq.com 5555@163.com]</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	re := regexp.MustCompile(`([a-zA-Z0-9]+)@([a-zA-Z0-9]+)\.([a-zA-Z0-9]+)`)</span><br><span class="line">	match := re.FindAllStringSubmatch(text, -1)</span><br><span class="line">	fmt.Println(match)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, m := range match &#123;</span><br><span class="line">		fmt.Println(m)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[sam@gmail.com sam gmail com] [5555@qq.com 5555 qq com] [5555@163.com 5555 163 com]]</span><br><span class="line">[sam@gmail.com sam gmail com]</span><br><span class="line">[5555@qq.com 5555 qq com]</span><br><span class="line">[5555@163.com 5555 163 com]</span><br></pre></td></tr></table></figure>

<h2 id="åŒ…ç®¡ç†-åŒ…å¼•å…¥"><a href="#åŒ…ç®¡ç†-åŒ…å¼•å…¥" class="headerlink" title="åŒ…ç®¡ç†(åŒ…å¼•å…¥)"></a>åŒ…ç®¡ç†(åŒ…å¼•å…¥)</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go mod init [crawler-single-task]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  crawler git:(master) âœ— cat go.mod                     </span><br><span class="line">module crawler-single-task</span><br><span class="line"></span><br><span class="line">go 1.13</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">        golang.org/x/net v0.0.0-20191207000613-e7e4b65ae663</span><br><span class="line">        golang.org/x/text v0.3.2</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<p>ä»¥é¡¹ç›®å½“å‰ç›®å½•ä¸ºèµ·ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import (</span><br><span class="line">	<span class="string">"crawler-single-task/engine"</span></span><br><span class="line">	<span class="string">"crawler-single-task/zhenai/parser"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="å•ä»»åŠ¡çˆ¬è™«è¦ç‚¹ç¬”è®°"><a href="#å•ä»»åŠ¡çˆ¬è™«è¦ç‚¹ç¬”è®°" class="headerlink" title="å•ä»»åŠ¡çˆ¬è™«è¦ç‚¹ç¬”è®°"></a>å•ä»»åŠ¡çˆ¬è™«è¦ç‚¹ç¬”è®°</h2><h3 id="è½¬æ¢-UTF-8-ä¸-GBK-ç¼–ç çš„æ–‡æœ¬"><a href="#è½¬æ¢-UTF-8-ä¸-GBK-ç¼–ç çš„æ–‡æœ¬" class="headerlink" title="è½¬æ¢ UTF-8 ä¸ GBK ç¼–ç çš„æ–‡æœ¬"></a>è½¬æ¢ UTF-8 ä¸ GBK ç¼–ç çš„æ–‡æœ¬</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get golang.org/x/text</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">utf8Reader := transform.NewReader(resp.Body, simplifiedchinese.GBK.NewDecoder())</span><br></pre></td></tr></table></figure>

<h3 id="ç¡®å®šç¼–ç åº“"><a href="#ç¡®å®šç¼–ç åº“" class="headerlink" title="ç¡®å®šç¼–ç åº“"></a>ç¡®å®šç¼–ç åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get golang.org/x/net/html</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//ç¡®å®šç¼–ç </span><br><span class="line">func determinEncoding(r io.Reader) encoding.Encoding &#123;</span><br><span class="line">	bytes, err := bufio.NewReader(r).Peek(1024)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	e, _, _ := charset.DetermineEncoding(bytes, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//è½¬ç </span><br><span class="line">	e := determinEncoding(resp.Body)</span><br><span class="line">	utf8Reader := transform.NewReader(resp.Body, e.NewDecoder())</span><br></pre></td></tr></table></figure>

<h3 id="è·å–åŸå¸‚åå’Œé“¾æ¥çš„æ–¹å¼"><a href="#è·å–åŸå¸‚åå’Œé“¾æ¥çš„æ–¹å¼" class="headerlink" title="è·å–åŸå¸‚åå’Œé“¾æ¥çš„æ–¹å¼"></a>è·å–åŸå¸‚åå’Œé“¾æ¥çš„æ–¹å¼</h3><p>ä½¿ç”¨cssé€‰æ‹©å™¨<code>$(&#39;#cityList&gt;dd&gt;a&#39;)</code></p>
<p>ä½¿ç”¨xpath</p>
<p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	re := regexp.MustCompile(`[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]+`)</span><br><span class="line">	match := re.FindAllString(text, -1)</span><br><span class="line">	fmt.Println(match)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬¬ä¸‰æ–¹åº“httprouter</title>
    <url>/2020/02/21/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93httprouter/</url>
    <content><![CDATA[<p><a href="https://github.com/julienschmidt/httprouter" target="_blank" rel="noopener">httprouter</a>æ˜¯ä¸€ä¸ªé«˜å¯ç”¨çš„httpè·¯ç”±è¯·æ±‚åº“ã€‚è·¯ç”±å™¨é€šè¿‡è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„æ¥åŒ¹é…ä¼ å…¥çš„è¯·æ±‚ã€‚å¦‚æœä¸ºè¯¥è·¯å¾„å’Œæ–¹æ³•æ³¨å†Œäº†å¥æŸ„ï¼Œè·¯ç”±å™¨ä¼šå°†è¯·æ±‚å§”æ‰˜ç»™è¯¥å‡½æ•°ã€‚å¯¹äºæ–¹æ³•GETã€POSTã€PUTã€PATCHã€DELETEå’ŒOPTIONSï¼Œå­˜åœ¨æ³¨å†Œå¥æŸ„çš„å¿«æ·åŠŸèƒ½ï¼Œå¯¹äºæ‰€æœ‰å…¶ä»–æ–¹æ³•è·¯ç”±å™¨ã€‚å¯ä»¥ä½¿ç”¨æ‰‹æŸ„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"github.com/julienschmidt/httprouter"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) &#123;</span><br><span class="line">    fmt.Fprint(w, <span class="string">"Welcome!\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func Hello(w http.ResponseWriter, r *http.Request, ps httprouter.Params) &#123;</span><br><span class="line">    fmt.Fprintf(w, <span class="string">"hello, %s!\n"</span>, ps.ByName(<span class="string">"name"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    router := httprouter.New()</span><br><span class="line">    router.GET(<span class="string">"/"</span>, Index)</span><br><span class="line">    router.GET(<span class="string">"/hello/:name"</span>, Hello)</span><br><span class="line"></span><br><span class="line">    log.Fatal(http.ListenAndServe(<span class="string">":8080"</span>, router))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>Golangæµåª’ä½“ç½‘ç«™ç¬”è®°</title>
    <url>/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/architecture.png" alt></p>
<p><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/api.png" alt></p>
<p>httprouterçš„ä½¿ç”¨</p>
<p>restletæµ‹è¯•æ’ä»¶ </p>
<h2 id="api"><a href="#api" class="headerlink" title="api"></a>api</h2><h3 id="3-6"><a href="#3-6" class="headerlink" title="3-6"></a>3-6</h3><p>æ€»ä½“æ€è·¯ï¼š<br>handleer-&gt;validation{1.request,2.user}-&gt;business login -&gt;response</p>
<ol>
<li>data model</li>
<li>error handler</li>
</ol>
<p>è¿™ä¸ªé”™è¯¯æ¥å£ä»¥åéƒ½å¯ä»¥è¿™æ ·å†™äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package defs</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Err struct &#123;</span><br><span class="line">	Error string `json:<span class="string">"error"</span>`</span><br><span class="line">	ErrorCode string `json:<span class="string">"error_code"</span>`  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> ErrResponse struct &#123;</span><br><span class="line">	HttpSC int</span><br><span class="line">	Error Err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">	ErrorRequestBodyParseFailed = ErrResponse&#123;HttpSC: 400, Error: Err&#123;Error: <span class="string">"Request body is not correct"</span>, ErrorCode: <span class="string">"001"</span>&#125;&#125;</span><br><span class="line">	ErrorNotAuthUser = ErrResponse&#123;HttpSC: 401, Error: Err&#123;Error: <span class="string">"User authentication failed."</span>, ErrorCode: <span class="string">"002"</span>&#125;&#125;</span><br><span class="line">	ErrorDBError = ErrResponse&#123;HttpSC: 500, Error: Err&#123;Error: <span class="string">"DB ops failed"</span>, ErrorCode: <span class="string">"003"</span>&#125;&#125;</span><br><span class="line">	ErrorInternalFaults = ErrResponse&#123;HttpSC: 500, Error: Err&#123;Error: <span class="string">"Internal service error"</span>, ErrorCode: <span class="string">"004"</span>&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="3-7"><a href="#3-7" class="headerlink" title="3-7"></a>3-7</h3><p>å¥½å¥½ç†è§£è¿™é‡Œçš„æ•°æ®åº“ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table comments (</span><br><span class="line">	id varchar(64) not null,</span><br><span class="line">	video_id varchar(64),</span><br><span class="line">	author_id int(10),</span><br><span class="line">	content text,</span><br><span class="line">	time datetime default current_timestamp, primary key(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table sessions (</span><br><span class="line">	session_id tinytext not null,</span><br><span class="line">	TTL tinytext,</span><br><span class="line">	login_name text</span><br><span class="line">);</span><br><span class="line">alter table sessions add primary key (session_id(64));</span><br><span class="line"></span><br><span class="line">create table users (</span><br><span class="line">	id int unsigned not null auto_increment,</span><br><span class="line">	login_name varchar(64),</span><br><span class="line">	<span class="built_in">pwd</span> text not null,</span><br><span class="line">	unique key (login_name),</span><br><span class="line">	primary key (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table video_del_rec (</span><br><span class="line">	video_id varchar(64) not null,</span><br><span class="line">	primary key (video_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table video_info (</span><br><span class="line">	id varchar(64) not null,</span><br><span class="line">	author_id int(10),</span><br><span class="line">	name text,</span><br><span class="line">	display_ctime text,</span><br><span class="line">	create_time datetime default current_timestamp,</span><br><span class="line">	primary key (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<p><code>ç¬¬ä¸‰èŒƒå¼(Third Normal Form,3rd NF)</code>å°±æ˜¯æŒ‡è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®å…ƒç´ ä¸ä½†è¦èƒ½å”¯ä¸€åœ°è¢«ä¸»å…³é”®å­—æ‰€æ ‡è¯†,è€Œä¸”å®ƒä»¬ä¹‹é—´è¿˜å¿…é¡»ç›¸äº’ç‹¬ç«‹,ä¸å­˜åœ¨å…¶ä»–çš„å‡½æ•°å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªæ»¡è¶³2nd NF çš„æ•°æ®ç»“æ„æ¥è¯´ï¼Œè¡¨ä¸­æœ‰å¯èƒ½å­˜åœ¨æŸäº›æ•°æ®å…ƒç´ ä¾èµ–äºå…¶ä»–éå…³é”®å­—æ•°æ®å…ƒç´ çš„ç°è±¡,å¿…é¡»æ¶ˆé™¤ã€‚</p>
<p><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/sql-design.png" alt></p>
<h3 id="3-8"><a href="#3-8" class="headerlink" title="3-8"></a>3-8</h3><p>æ•°æ®åº“è¿æ¥è¿˜æ˜¯å‚è€ƒè‡ªå·±å†™çš„è¿™ä¸ªå§<a href="https://github.com/samtake/goRedisDemo" target="_blank" rel="noopener">demo</a>å§ã€‚</p>
<h3 id="3-10"><a href="#3-10" class="headerlink" title="3-10"></a>3-10</h3><p>api_test.go</p>
<p>å‚è€ƒ<a href="https://samtake.github.io/2020/02/22/Golang%E7%BB%83%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">Golangç»ƒä¹ ç¬”è®°</a>23æµ‹è¯•è®²çš„æ›´è¯¦ç»†ã€‚</p>
<h3 id="3-12"><a href="#3-12" class="headerlink" title="3-12"></a>3-12</h3><p>å®ç°å’ŒéªŒè¯video<br><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/3-12.png" alt></p>
<h3 id="3-13"><a href="#3-13" class="headerlink" title="3-13"></a>3-13</h3><p>Comments</p>
<p> <img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/3-13-comments.png" alt><br>è¯„è®ºæ˜¯éœ€è¦åˆ—è¡¨å‡ºç°çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func ListComments(vid string, from, to int) ([]*defs.Comment, error) &#123;</span><br><span class="line">	stmtOut, err := dbConn.Prepare(`SELECT comments.id, users.login_name, comments.content FROM comments </span><br><span class="line">		INNER JOIN users ON comments.author_id = users.id </span><br><span class="line">		WHERE comments.video_id = ? AND comments.time &gt; FROM_UNIXTIME(?) AND comments.time &lt;= FROM_UNIXTIME(?)</span><br><span class="line">		ORDER BY comments.time DESC`)</span><br><span class="line"></span><br><span class="line">	var res []*defs.Comment</span><br><span class="line">	</span><br><span class="line">	rows, err := stmtOut.Query(vid, from, to)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Printf(<span class="string">"%s"</span>, err)</span><br><span class="line">		<span class="built_in">return</span> res, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> rows.<span class="function"><span class="title">Next</span></span>() &#123;</span><br><span class="line">		var id, name, content string</span><br><span class="line">		<span class="keyword">if</span> err := rows.Scan(&amp;id, &amp;name, &amp;content); err != nil &#123;</span><br><span class="line">			<span class="built_in">return</span> res, err</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		c := &amp;defs.Comment&#123;Id: id, VideoId: vid, Author: name, Content: content&#125;</span><br><span class="line">		res = append(res, c)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	defer stmtOut.Close()</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> res, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-15"><a href="#3-15" class="headerlink" title="3-15"></a>3-15</h3><p><code>session</code>ä¼šè¯ï¼Œ</p>
<p>sessionå’Œcookieçš„åŒºåˆ«ï¼Ÿ</p>
<p>sessionè´Ÿè´£çš„æµç¨‹å›¾ï¼š<br><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/3-15-session.png" alt></p>
<h3 id="3-17"><a href="#3-17" class="headerlink" title="3-17"></a>3-17</h3><p>middleware</p>
<p>duck typingå†…å®¹å‚è€ƒ<a href="https://samtake.github.io/2020/02/22/Golang%E7%BB%83%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">Golangç»ƒä¹ ç¬”è®°</a>15ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> middleWareHandler struct &#123;</span><br><span class="line">	r *httprouter.Router</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewMiddleWareHandler(r *httprouter.Router) http.Handler &#123;</span><br><span class="line">	m := middleWareHandler&#123;&#125;</span><br><span class="line">	m.r = r</span><br><span class="line">	<span class="built_in">return</span> m</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (m middleWareHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">	//check session</span><br><span class="line">	validateUserSession(r)</span><br><span class="line"></span><br><span class="line">	m.r.ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func RegisterHandlers() *httprouter.Router &#123;</span><br><span class="line">	router := httprouter.New()</span><br><span class="line">    router.POST(<span class="string">"/user"</span>, CreateUser)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//response</span><br><span class="line"><span class="built_in">type</span> SignedUp struct &#123;</span><br><span class="line">	Success bool `json:<span class="string">"success"</span>`</span><br><span class="line">	SessionId string `json:<span class="string">"session_id"</span>`</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#æ·»äº†åç¼€ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œä¼šè¿”å›ç»Ÿä¸€çš„jsonæ ¼å¼,å¦‚ä¸‹ï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"success"</span>:XXXXX,</span><br><span class="line">    <span class="string">"session_id"</span>:XXXX</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Streaming"><a href="#Streaming" class="headerlink" title="Streaming"></a>Streaming</h2><h3 id="4-1"><a href="#4-1" class="headerlink" title="4-1"></a>4-1</h3><p>Streamingï¼ˆè§†é¢‘æ’­æ”¾ï¼‰ï¼š</p>
<ul>
<li>é™æ€è§†é¢‘ï¼ŒéRTMPï¼ˆç›´æ’­çš„é‚£äº›éƒ½æ˜¯RTMPï¼‰</li>
<li>ç‹¬ç«‹çš„æœåŠ¡ï¼Œå¯ç‹¬ç«‹éƒ¨ç½²</li>
<li>ç»Ÿä¸€çš„apiæ ¼å¼</li>
</ul>
<h3 id="4-3"><a href="#4-3" class="headerlink" title="4-3"></a>4-3</h3><p><code>æµæ§</code><br><code>token bucket</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å…±äº«é€šé“ instead of shared memory</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> ConnLimiter struct &#123;</span><br><span class="line">	concurrentConn int</span><br><span class="line">	bucket chan int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewConnLimiter(cc int) *ConnLimiter &#123;</span><br><span class="line">	<span class="built_in">return</span> &amp;ConnLimiter &#123;</span><br><span class="line">		concurrentConn: cc,</span><br><span class="line">		bucket: make(chan int, cc),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (cl *ConnLimiter) GetConn() bool &#123;</span><br><span class="line">	<span class="keyword">if</span> len(cl.bucket) &gt;= cl.concurrentConn &#123;</span><br><span class="line">		log.Printf(<span class="string">"Reached the rate limitation."</span>)</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cl.bucket &lt;- 1</span><br><span class="line">	<span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (cl *ConnLimiter) <span class="function"><span class="title">ReleaseConn</span></span>() &#123;</span><br><span class="line">	c :=&lt;- cl.bucket</span><br><span class="line">	log.Printf(<span class="string">"New connction coming: %d"</span>, c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5"><a href="#4-5" class="headerlink" title="4-5"></a>4-5</h3><p>åœ¨http middlewareä¸­åµŒå…¥æµæ§</p>
<h2 id="scheduler"><a href="#scheduler" class="headerlink" title="scheduler"></a>scheduler</h2><h3 id="5-1"><a href="#5-1" class="headerlink" title="5-1"></a>5-1</h3><p><code>scheduler</code>ä»»åŠ¡è°ƒåº¦å™¨ï¼ŒæŸäº›ä¸èƒ½é©¬ä¸Šå¤„ç†çš„ä»»åŠ¡æ”¾åˆ°schedulerï¼Œè®©å®ƒå®šæœŸæˆ–è€…å»¶æ—¶è§¦å‘ã€‚</p>
<p><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/5-1-scheduler.png" alt></p>
<h3 id="5-3"><a href="#5-3" class="headerlink" title="5-3"></a>5-3</h3><p>runnerçš„ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹å®ç°</p>
<h3 id="5-5"><a href="#5-5" class="headerlink" title="5-5"></a>5-5</h3><p>task</p>
<p>api-&gt;videoid-&gt;mysql<br>dispatcher-&gt;mysql-&gt;videoid-&gt;datachannel<br>executor-&gt;datachannel-&gt;videoid-&gt;delete video</p>
<h3 id="5-6"><a href="#5-6" class="headerlink" title="5-6"></a>5-6</h3><p>timer</p>
<p>setup-&gt;strat{runner task}</p>
<h3 id="5-7"><a href="#5-7" class="headerlink" title="5-7"></a>5-7</h3><p><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/5-7-api.png" alt></p>
<h2 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h2><h3 id="6-1"><a href="#6-1" class="headerlink" title="6-1"></a>6-1</h3><p>Goçš„æ¨¡ç‰ˆå¼•æ“</p>
<ul>
<li>æ¨¡ç‰ˆå¼•æ“æ˜¯å°†htmlè§£æå’Œå…ƒç´ é¢„ç½®æ›¿æ¢ç”Ÿæˆæœ€ç»ˆé¡µé¢çš„å·¥å…·</li>
<li>Goçš„æ¨¡ç‰ˆæœ‰ä¸¤ç§text/templateå’Œhtml/template </li>
<li>Goçš„æ¨¡ç‰ˆé‡‡ç”¨åŠ¨æ€ç”Ÿæˆçš„æ¨¡å¼</li>
</ul>
<p><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/6-1-html-template.png" alt></p>
<h3 id="6-2"><a href="#6-2" class="headerlink" title="6-2"></a>6-2</h3><p>å‰ç«¯ä»£ç æ¶æ„<br><img src="/2020/02/21/Golang%E6%B5%81%E5%AA%92%E4%BD%93%E7%BD%91%E7%AB%99%E7%AC%94%E8%AE%B0/6-2-web-document.png" alt></p>
<p>client.goå°±æ˜¯èµ·äº†proxyè½¬å‘ä½œç”¨ï¼Œé¿å…è·¨åŸŸä½œç”¨ã€‚</p>
<h3 id="6-3"><a href="#6-3" class="headerlink" title="6-3"></a>6-3</h3><p>é™æ€é¡µé¢æ¸²æŸ“</p>
<h3 id="6-4"><a href="#6-4" class="headerlink" title="6-4"></a>6-4</h3><p>sh build.sh</p>
<h3 id="6-6-apié€ä¼ ï¼ï¼ï¼"><a href="#6-6-apié€ä¼ ï¼ï¼ï¼" class="headerlink" title="6-6 apié€ä¼ ï¼ï¼ï¼"></a>6-6 apié€ä¼ ï¼ï¼ï¼</h3><h3 id="6-7-proxyè½¬å‘"><a href="#6-7-proxyè½¬å‘" class="headerlink" title="6-7 proxyè½¬å‘"></a>6-7 proxyè½¬å‘</h3><p><code>net/url</code>  </p>
<p><code>net/http/httputil</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func proxyVideoHandler(w http.ResponseWriter, r *http.Request, ps httprouter.Params) &#123;</span><br><span class="line">	u, _ := url.Parse(<span class="string">"http://"</span> + config.GetLbAddr() + <span class="string">":9000/"</span>)</span><br><span class="line">	proxy := httputil.NewSingleHostReverseProxy(u)</span><br><span class="line">	proxy.ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func proxyUploadHandler(w http.ResponseWriter, r *http.Request, ps httprouter.Params) &#123;</span><br><span class="line">	u, _ := url.Parse(<span class="string">"http://"</span> + config.GetLbAddr() + <span class="string">":9000/"</span>)</span><br><span class="line">	proxy := httputil.NewSingleHostReverseProxy(u)</span><br><span class="line">	proxy.ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-11"><a href="#6-11" class="headerlink" title="6-11"></a>6-11</h3><p>js</p>
<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><h3 id="7-4"><a href="#7-4" class="headerlink" title="7-4"></a>7-4</h3><p>å…¬å…±é…ç½®ï¼Œå³å„æ¨¡å—çš„configæ–‡ä»¶ã€‚</p>
<h3 id="7-5-vendor"><a href="#7-5-vendor" class="headerlink" title="7-5  vendor"></a>7-5  vendor</h3><h3 id="7-6-SLBè®²è§£ä¸é…ç½®"><a href="#7-6-SLBè®²è§£ä¸é…ç½®" class="headerlink" title="7-6 SLBè®²è§£ä¸é…ç½®"></a>7-6 SLBè®²è§£ä¸é…ç½®</h3><p>é˜¿é‡Œäº‘è´Ÿè½½å‡è¡¡é…ç½®ã€‚</p>
<h3 id="7-7"><a href="#7-7" class="headerlink" title="7-7"></a>7-7</h3><p>sessionå®¹é”™</p>
<h3 id="7-8-ECSé…ç½®"><a href="#7-8-ECSé…ç½®" class="headerlink" title="7-8 ECSé…ç½®"></a>7-8 ECSé…ç½®</h3><h3 id="7-10-éƒ¨ç½²è„šæœ¬"><a href="#7-10-éƒ¨ç½²è„šæœ¬" class="headerlink" title="7-10 éƒ¨ç½²è„šæœ¬"></a>7-10 éƒ¨ç½²è„šæœ¬</h3><p>åœ¨binæ–‡ä»¶å¤¹æ·»åŠ conf.jsonæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"lb_addr"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">	<span class="string">"oss_addr"</span>: <span class="string">"oss.aliyun.com"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>buildprod.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build web and other services</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/work/src/github.com/avenssi/video_server/api</span><br><span class="line">env GOOS=linux GOARCH=amd64 go build -o ../bin/api</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/work/src/github.com/avenssi/video_server/scheduler</span><br><span class="line">env GOOS=linux GOARCH=amd64 go build -o ../bin/scheduler</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/work/src/github.com/avenssi/video_server/streamserver</span><br><span class="line">env GOOS=linux GOARCH=amd64 go build -o ../bin/streamserver</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/work/src/github.com/avenssi/video_server/web</span><br><span class="line">env GOOS=linux GOARCH=amd64 go build -o ../bin/web</span><br></pre></td></tr></table></figure>


<p><code>deploy.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line">cp -R ./templates ./bin/</span><br><span class="line"></span><br><span class="line">mkdir ./bin/videos</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> bin</span><br><span class="line"></span><br><span class="line">nohup ./api &amp;</span><br><span class="line">nohup ./scheduler &amp;</span><br><span class="line">nohup ./streamserver &amp;</span><br><span class="line">nohup ./web &amp;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"deploy finished"</span></span><br></pre></td></tr></table></figure>


<h3 id="7-11-éƒ¨ç½²"><a href="#7-11-éƒ¨ç½²" class="headerlink" title="7-11 éƒ¨ç½²"></a>7-11 éƒ¨ç½²</h3><p>sh  buildprod.sh ç¼–è¯‘å®Œæˆåæäº¤äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æˆ–è€…æäº¤ä»£ç åˆ°æœåŠ¡å™¨ä¸Šç›´æ¥ç¼–è¯‘</p>
<p>æ£€æŸ¥å¯¹åº”serveræ˜¯å¦å¯åŠ¨<code>ps aux | grep &lt;api?stream?scheduler?web&gt;</code></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>Traefik</title>
    <url>/2020/02/19/Traefik/</url>
    <content><![CDATA[<h3 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h3><p>ç›¸å¯¹nginxï¼ŒåŸºäºå®¹å™¨çš„å¾®æœåŠ¡åå‘ä»£ç†åˆ©å™¨<a href="https://github.com/containous/traefik" target="_blank" rel="noopener">Traefik</a>æ”¯æŒåŠ¨æ€çš„é…ç½®åå‘ä»£ç†.</p>
<p><img src="/2020/02/19/Traefik/traefik-architecture.png" alt></p>
<p>å¦‚ä¸Šå›¾å·¦ä¾§å…¬ç½‘åŸŸåå¯ä»¥é€šè¿‡Traefikç›‘å¬APIåŠ¨æ€åœ°è½¬å‘åˆ°å³ä¾§çš„å†…ç½‘æœåŠ¡å®ä¾‹ï¼ˆä¾‹å¦‚backoffice1æœåŠ¡ï¼‰ã€‚æˆ–è€…è¯´æ˜¯åŠ¨æ€çš„è·¯ç”±è½¬å‘ã€‚</p>
<p><code>frontend</code>ç”¨äºæ§åˆ¶è®¿é—®çš„è·¯ç”±è§„åˆ™ï¼Œæ”¯æŒå•ä¸ªè§„åˆ™åŠæ­£åˆ™åŒ¹é…ã€‚<br><code>backend</code>ç”¨äºåŒ¹é…ä¸€ç»„æœåŠ¡å®ä¾‹ï¼Œé€šè¿‡è½®è¯¢æ–¹å¼æ¥é€‰æ‹©è½¬å‘çš„ç›®æ ‡ã€‚</p>
<h3 id="åŸºäºDocker-composeä¸Traefik1-xçš„å®¹å™¨åŒ–éƒ¨ç½²"><a href="#åŸºäºDocker-composeä¸Traefik1-xçš„å®¹å™¨åŒ–éƒ¨ç½²" class="headerlink" title="åŸºäºDocker-composeä¸Traefik1.xçš„å®¹å™¨åŒ–éƒ¨ç½²"></a>åŸºäºDocker-composeä¸Traefik1.xçš„å®¹å™¨åŒ–éƒ¨ç½²</h3><p>å…·ä½“å‚è€ƒservice_dcå’Œtraefik_dc<br><img src="/2020/02/19/Traefik/Traefik-setting.png" alt></p>
<h3 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h3><p>|<br>æš‚<br>|<br>æ— <br>|</p>
]]></content>
      <categories>
        <category>Traefik</category>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Traefik</tag>
      </tags>
  </entry>
  <entry>
    <title>go-micro</title>
    <url>/2020/02/19/go-micro/</url>
    <content><![CDATA[<h3 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h3><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/micro/go-micro" target="_blank" rel="noopener">go-micro</a></p>
<p>go-microæä¾›çš„æ¥å£åŠŸèƒ½</p>
<p><code>æœåŠ¡å‘ç°</code>æ”¯æŒæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œåº•å±‚æ”¯æŒetcdã€consulã€k8s<br><code>è´Ÿè½½å‡è¡¡</code>rpcæœåŠ¡é—´çš„è¯·æ±‚è°ƒåº¦å‡è¡¡ç­–ç•¥<br><code>åŒæ­¥é€šä¿¡</code>åŸºäºRPCé€šä¿¡ï¼Œæ”¯æŒå•å‘ã€åŒå‘æµé€šé“æ¨¡å¼<br><code>ä¸€æ­¥é€šä¿¡</code>æä¾›pubã€subé€šä¿¡æ¨¡å‹çš„æ¥å£<br><code>é«˜çº§æ¥å£</code>æ¯”å¦‚æœåŠ¡å‘ç°ï¼Œæä¾›è°ƒç”¨çš„æ¥å£æ˜¯ä¸€è‡´çš„</p>
<p><img src="/2020/02/19/go-micro/go-micro.png" alt></p>
<p><code>broker</code>å¼‚æ­¥é€šä¿¡<br><code>codec</code>æ¶ˆæ¯ç¼–ç ï¼Œå¯ä»¥åŠ¨æ€ç¼–ç <br><code>registry</code>æœåŠ¡æ³¨å†Œä¸å‘ç°<br><code>selector</code>è´Ÿè½½å‡è¡¡<br><code>transport</code> åŸºäºRPCçš„é€šä¿¡æ¨¡å—æ¥å£</p>
<h3 id="è´¦å·ç³»ç»Ÿå¾®æœåŠ¡"><a href="#è´¦å·ç³»ç»Ÿå¾®æœåŠ¡" class="headerlink" title="è´¦å·ç³»ç»Ÿå¾®æœåŠ¡"></a>è´¦å·ç³»ç»Ÿå¾®æœåŠ¡</h3><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶<code>XXX.proto</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">"proto3"</span>;</span><br><span class="line"></span><br><span class="line">package go.micro.service.user;</span><br><span class="line"></span><br><span class="line">service UserService &#123;</span><br><span class="line">    // ç”¨æˆ·æ³¨å†Œ</span><br><span class="line">    rpc Signup(ReqSignup) returns (RespSignup) &#123;&#125;</span><br><span class="line">    // ç”¨æˆ·ç™»å½•</span><br><span class="line">    rpc Signin(ReqSignin) returns (RespSignin) &#123;&#125;</span><br><span class="line">    // è·å–ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">    rpc UserInfo(ReqUserInfo) returns (RespUserInfo) &#123;&#125;</span><br><span class="line">    // è·å–ç”¨æˆ·æ–‡ä»¶</span><br><span class="line">    rpc UserFiles(ReqUserFile) returns (RespUserFile) &#123;&#125;</span><br><span class="line">   // è·å–ç”¨æˆ·æ–‡ä»¶</span><br><span class="line">    rpc UserFileRename(ReqUserFileRename) returns (RespUserFileRename) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message ReqSignup &#123;</span><br><span class="line">    string username = 1;</span><br><span class="line">    string password = 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message RespSignup &#123;</span><br><span class="line">    int32 code = 1;</span><br><span class="line">    string message = 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message ReqSignin &#123;</span><br><span class="line">    string username = 1;</span><br><span class="line">    string password = 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message RespSignin &#123;</span><br><span class="line">    int32 code = 1;</span><br><span class="line">    string token = 2;</span><br><span class="line">    string message = 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message ReqUserInfo &#123;</span><br><span class="line">    string username = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message RespUserInfo &#123;</span><br><span class="line">    int32 code = 1;</span><br><span class="line">    string message =2;</span><br><span class="line">    string username =3;</span><br><span class="line">    string email = 4;</span><br><span class="line">    string phone = 5;</span><br><span class="line">    string signupAt = 6;</span><br><span class="line">    string lastActiveAt = 7;</span><br><span class="line">    int32 status = 8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message ReqUserFile &#123;</span><br><span class="line">    string username = 1;</span><br><span class="line">    int32 <span class="built_in">limit</span> = 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message RespUserFile &#123;</span><br><span class="line">    int32 code = 1;</span><br><span class="line">    string message =2;</span><br><span class="line">    bytes fileData = 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message ReqUserFileRename &#123;</span><br><span class="line">  string username = 1;</span><br><span class="line">  string filehash = 2;</span><br><span class="line">  string newFileName = 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message RespUserFileRename &#123;</span><br><span class="line">  int32 code = 1;</span><br><span class="line">  string message =2;</span><br><span class="line">  bytes fileData = 3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>æ‰§è¡ŒæŒ‡ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">protoc --proto_path=service/account/proto --go_out=service/account/proto --micro_out=service/account/proto service/account/proto/user.proto</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶<br><code>XXX.micro.go</code>ä»¥åŠ<code>XXX.pb.go</code></p>
<p>handlerè°ƒç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package handler</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"filestore-server/common"</span></span><br><span class="line">	<span class="string">"filestore-server/config"</span></span><br><span class="line">	cfg <span class="string">"filestore-server/config"</span></span><br><span class="line">	proto <span class="string">"filestore-server/service/account/proto"</span></span><br><span class="line">	dbcli <span class="string">"filestore-server/service/dbproxy/client"</span></span><br><span class="line">	<span class="string">"filestore-server/util"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// User : ç”¨äºå®ç°UserServiceHandleræ¥å£çš„å¯¹è±¡</span><br><span class="line"><span class="built_in">type</span> User struct&#123;&#125;</span><br><span class="line"></span><br><span class="line">// GenToken : ç”Ÿæˆtoken</span><br><span class="line">func GenToken(username string) string &#123;</span><br><span class="line">	// 40ä½å­—ç¬¦:md5(username+timestamp+token_salt)+timestamp[:8]</span><br><span class="line">	ts := fmt.Sprintf(<span class="string">"%x"</span>, time.Now().Unix())</span><br><span class="line">	tokenPrefix := util.MD5([]byte(username + ts + <span class="string">"_tokensalt"</span>))</span><br><span class="line">	<span class="built_in">return</span> tokenPrefix + ts[:8]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Signup : å¤„ç†ç”¨æˆ·æ³¨å†Œè¯·æ±‚</span><br><span class="line">func (u *User) Signup(ctx context.Context, req *proto.ReqSignup, res *proto.RespSignup) error &#123;</span><br><span class="line">	username := req.Username</span><br><span class="line">	passwd := req.Password</span><br><span class="line"></span><br><span class="line">	// å‚æ•°ç®€å•æ ¡éªŒ</span><br><span class="line">	<span class="keyword">if</span> len(username) &lt; 3 || len(passwd) &lt; 5 &#123;</span><br><span class="line">		res.Code = common.StatusParamInvalid</span><br><span class="line">		res.Message = <span class="string">"æ³¨å†Œå‚æ•°æ— æ•ˆ"</span></span><br><span class="line">		<span class="built_in">return</span> nil</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// å¯¹å¯†ç è¿›è¡ŒåŠ ç›åŠå–Sha1å€¼åŠ å¯†</span><br><span class="line">	encPasswd := util.Sha1([]byte(passwd + cfg.PasswordSalt))</span><br><span class="line">	// å°†ç”¨æˆ·ä¿¡æ¯æ³¨å†Œåˆ°ç”¨æˆ·è¡¨ä¸­</span><br><span class="line">	dbResp, err := dbcli.UserSignup(username, encPasswd)</span><br><span class="line">	<span class="keyword">if</span> err == nil &amp;&amp; dbResp.Suc &#123;</span><br><span class="line">		res.Code = common.StatusOK</span><br><span class="line">		res.Message = <span class="string">"æ³¨å†ŒæˆåŠŸ"</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res.Code = common.StatusRegisterFailed</span><br><span class="line">		res.Message = <span class="string">"æ³¨å†Œå¤±è´¥"</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Signin : å¤„ç†ç”¨æˆ·ç™»å½•è¯·æ±‚</span><br><span class="line">func (u *User) Signin(ctx context.Context, req *proto.ReqSignin, res *proto.RespSignin) error &#123;</span><br><span class="line">	username := req.Username</span><br><span class="line">	password := req.Password</span><br><span class="line"></span><br><span class="line">	encPasswd := util.Sha1([]byte(password + config.PasswordSalt))</span><br><span class="line"></span><br><span class="line">	// 1. æ ¡éªŒç”¨æˆ·ååŠå¯†ç </span><br><span class="line">	dbResp, err := dbcli.UserSignin(username, encPasswd)</span><br><span class="line">	<span class="keyword">if</span> err != nil || !dbResp.Suc &#123;</span><br><span class="line">		res.Code = common.StatusLoginFailed</span><br><span class="line">		<span class="built_in">return</span> nil</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 2. ç”Ÿæˆè®¿é—®å‡­è¯(token)</span><br><span class="line">	token := GenToken(username)</span><br><span class="line">	upRes, err := dbcli.UpdateToken(username, token)</span><br><span class="line">	<span class="keyword">if</span> err != nil || !upRes.Suc &#123;</span><br><span class="line">		res.Code = common.StatusServerError</span><br><span class="line">		<span class="built_in">return</span> nil</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 3. ç™»å½•æˆåŠŸ, è¿”å›token</span><br><span class="line">	res.Code = common.StatusOK</span><br><span class="line">	res.Token = token</span><br><span class="line">	<span class="built_in">return</span> nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// UserInfo ï¼š æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">func (u *User) UserInfo(ctx context.Context, req *proto.ReqUserInfo, res *proto.RespUserInfo) error &#123;</span><br><span class="line">	// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">	dbResp, err := dbcli.GetUserInfo(req.Username)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		res.Code = common.StatusServerError</span><br><span class="line">		res.Message = <span class="string">"æœåŠ¡é”™è¯¯"</span></span><br><span class="line">		<span class="built_in">return</span> nil</span><br><span class="line">	&#125;</span><br><span class="line">	// æŸ¥ä¸åˆ°å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">	<span class="keyword">if</span> !dbResp.Suc &#123;</span><br><span class="line">		res.Code = common.StatusUserNotExists</span><br><span class="line">		res.Message = <span class="string">"ç”¨æˆ·ä¸å­˜åœ¨"</span></span><br><span class="line">		<span class="built_in">return</span> nil</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	user := dbcli.ToTableUser(dbResp.Data)</span><br><span class="line"></span><br><span class="line">	// 3. ç»„è£…å¹¶ä¸”å“åº”ç”¨æˆ·æ•°æ®</span><br><span class="line">	res.Code = common.StatusOK</span><br><span class="line">	res.Username = user.Username</span><br><span class="line">	res.SignupAt = user.SignupAt</span><br><span class="line">	res.LastActiveAt = user.LastActiveAt</span><br><span class="line">	res.Status = int32(user.Status)</span><br><span class="line">	// TODO: éœ€å¢åŠ æ¥å£æ”¯æŒå®Œå–„ç”¨æˆ·ä¿¡æ¯(email/phoneç­‰)</span><br><span class="line">	res.Email = user.Email</span><br><span class="line">	res.Phone = user.Phone</span><br><span class="line">	<span class="built_in">return</span> nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªmain.goä½œä¸ºå•ç‹¬çš„å¾®æœåŠ¡å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/micro/go-micro"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"filestore-server/service/account/handler"</span></span><br><span class="line">	proto <span class="string">"filestore-server/service/account/proto"</span></span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    //åˆ›å»ºä¸€ä¸ªservice</span><br><span class="line">	service := micro.NewService(</span><br><span class="line">		// service := k8s.NewService(</span><br><span class="line">		micro.Name(<span class="string">"go.micro.service.user"</span>),</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	// åˆå§‹åŒ–service, è§£æå‘½ä»¤è¡Œå‚æ•°ç­‰</span><br><span class="line">	service.Init()</span><br><span class="line"></span><br><span class="line">	// åˆå§‹åŒ–dbproxy client</span><br><span class="line">	dbproxy.Init(service)</span><br><span class="line"></span><br><span class="line">	proto.RegisterUserServiceHandler(service.Server(), new(handler.User))</span><br><span class="line">	<span class="keyword">if</span> err := service.Run(); err != nil &#123;</span><br><span class="line">		log.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ<code>go run service/account/main.go --registry=consul</code>æŒ‡å®šæ³¨å†Œä¸­å¿ƒä¸ºconsul</p>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®consulçš„webç•Œé¢:<br><a href="localhost:8500/ui/dcl/services" target="_blank" rel="noopener">localhost:8500/ui/dcl/services</a></p>
<h3 id="ç½‘å…³å¾®æœåŠ¡"><a href="#ç½‘å…³å¾®æœåŠ¡" class="headerlink" title="ç½‘å…³å¾®æœåŠ¡"></a>ç½‘å…³å¾®æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package handler</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"filestore-server/common"</span></span><br><span class="line">	<span class="string">"filestore-server/util"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	micro <span class="string">"github.com/micro/go-micro"</span></span><br><span class="line"></span><br><span class="line">	cmn <span class="string">"filestore-server/common"</span></span><br><span class="line">	userProto <span class="string">"filestore-server/service/account/proto"</span></span><br><span class="line">	dlProto <span class="string">"filestore-server/service/download/proto"</span></span><br><span class="line">	upProto <span class="string">"filestore-server/service/upload/proto"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">	userCli userProto.UserService</span><br><span class="line">	upCli   upProto.UploadService</span><br><span class="line">	dlCli   dlProto.DownloadService</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">init</span></span>() &#123;</span><br><span class="line">	service := micro.NewService()</span><br><span class="line">	// åˆå§‹åŒ–ï¼Œ è§£æå‘½ä»¤è¡Œå‚æ•°ç­‰</span><br><span class="line">	service.Init()</span><br><span class="line"></span><br><span class="line">	// åˆå§‹åŒ–ä¸€ä¸ªaccountæœåŠ¡çš„å®¢æˆ·ç«¯</span><br><span class="line">	userCli = userProto.NewUserService(<span class="string">"go.micro.service.user"</span>, service.Client())</span><br><span class="line">	// åˆå§‹åŒ–ä¸€ä¸ªuploadæœåŠ¡çš„å®¢æˆ·ç«¯</span><br><span class="line">	upCli = upProto.NewUploadService(<span class="string">"go.micro.service.upload"</span>, service.Client())</span><br><span class="line">	// åˆå§‹åŒ–ä¸€ä¸ªdownloadæœåŠ¡çš„å®¢æˆ·ç«¯</span><br><span class="line">	dlCli = dlProto.NewDownloadService(<span class="string">"go.micro.service.download"</span>, service.Client())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// SignupHandler : å“åº”æ³¨å†Œé¡µé¢</span><br><span class="line">func SignupHandler(c *gin.Context) &#123;</span><br><span class="line">	c.Redirect(http.StatusFound, <span class="string">"/static/view/signup.html"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// DoSignupHandler : å¤„ç†æ³¨å†Œpostè¯·æ±‚</span><br><span class="line">func DoSignupHandler(c *gin.Context) &#123;</span><br><span class="line">	username := c.Request.FormValue(<span class="string">"username"</span>)</span><br><span class="line">	passwd := c.Request.FormValue(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">	resp, err := userCli.Signup(context.TODO(), &amp;userProto.ReqSignup&#123;</span><br><span class="line">		Username: username,</span><br><span class="line">		Password: passwd,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">		c.Status(http.StatusInternalServerError)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">		<span class="string">"code"</span>: resp.Code,</span><br><span class="line">		<span class="string">"msg"</span>:  resp.Message,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// SigninHandler : å“åº”ç™»å½•é¡µé¢</span><br><span class="line">func SigninHandler(c *gin.Context) &#123;</span><br><span class="line">	c.Redirect(http.StatusFound, <span class="string">"/static/view/signin.html"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// DoSigninHandler : å¤„ç†ç™»å½•postè¯·æ±‚</span><br><span class="line">func DoSigninHandler(c *gin.Context) &#123;</span><br><span class="line">	username := c.Request.FormValue(<span class="string">"username"</span>)</span><br><span class="line">	password := c.Request.FormValue(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">	rpcResp, err := userCli.Signin(context.TODO(), &amp;userProto.ReqSignin&#123;</span><br><span class="line">		Username: username,</span><br><span class="line">		Password: password,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">		c.Status(http.StatusInternalServerError)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> rpcResp.Code != cmn.StatusOK &#123;</span><br><span class="line">		c.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"msg"</span>:  <span class="string">"ç™»å½•å¤±è´¥"</span>,</span><br><span class="line">			<span class="string">"code"</span>: rpcResp.Code,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// åŠ¨æ€è·å–ä¸Šä¼ å…¥å£åœ°å€</span><br><span class="line">	upEntryResp, err := upCli.UploadEntry(context.TODO(), &amp;upProto.ReqEntry&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> upEntryResp.Code != cmn.StatusOK &#123;</span><br><span class="line">		log.Println(upEntryResp.Message)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// åŠ¨æ€è·å–ä¸‹è½½å…¥å£åœ°å€</span><br><span class="line">	dlEntryResp, err := dlCli.DownloadEntry(context.TODO(), &amp;dlProto.ReqEntry&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> dlEntryResp.Code != cmn.StatusOK &#123;</span><br><span class="line">		log.Println(dlEntryResp.Message)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// ç™»å½•æˆåŠŸï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">	cliResp := util.RespMsg&#123;</span><br><span class="line">		Code: int(common.StatusOK),</span><br><span class="line">		Msg:  <span class="string">"ç™»å½•æˆåŠŸ"</span>,</span><br><span class="line">		Data: struct &#123;</span><br><span class="line">			Location      string</span><br><span class="line">			Username      string</span><br><span class="line">			Token         string</span><br><span class="line">			UploadEntry   string</span><br><span class="line">			DownloadEntry string</span><br><span class="line">		&#125;&#123;</span><br><span class="line">			Location:      <span class="string">"/static/view/home.html"</span>,</span><br><span class="line">			Username:      username,</span><br><span class="line">			Token:         rpcResp.Token,</span><br><span class="line">			UploadEntry:   upEntryResp.Entry,</span><br><span class="line">			DownloadEntry: dlEntryResp.Entry,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	c.Data(http.StatusOK, <span class="string">"application/json"</span>, cliResp.JSONBytes())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// UserInfoHandler ï¼š æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">func UserInfoHandler(c *gin.Context) &#123;</span><br><span class="line">	// 1. è§£æè¯·æ±‚å‚æ•°</span><br><span class="line">	username := c.Request.FormValue(<span class="string">"username"</span>)</span><br><span class="line"></span><br><span class="line">	resp, err := userCli.UserInfo(context.TODO(), &amp;userProto.ReqUserInfo&#123;</span><br><span class="line">		Username: username,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">		c.Status(http.StatusInternalServerError)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 3. ç»„è£…å¹¶ä¸”å“åº”ç”¨æˆ·æ•°æ®</span><br><span class="line">	cliResp := util.RespMsg&#123;</span><br><span class="line">		Code: 0,</span><br><span class="line">		Msg:  <span class="string">"OK"</span>,</span><br><span class="line">		Data: gin.H&#123;</span><br><span class="line">			<span class="string">"Username"</span>: username,</span><br><span class="line">			<span class="string">"SignupAt"</span>: resp.SignupAt,</span><br><span class="line">			// TODO: å®Œå–„å…¶ä»–å­—æ®µä¿¡æ¯</span><br><span class="line">			<span class="string">"LastActive"</span>: resp.LastActiveAt,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	c.Data(http.StatusOK, <span class="string">"application/json"</span>, cliResp.JSONBytes())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<p>è·¯ç”±</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package route</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"filestore-server/service/apigw/handler"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// Router : ç½‘å…³apiè·¯ç”±</span><br><span class="line">func Router() *gin.Engine &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.Static(<span class="string">"/static/"</span>, <span class="string">"./static"</span>)</span><br><span class="line"></span><br><span class="line">	// æ³¨å†Œ</span><br><span class="line">	router.GET(<span class="string">"/user/signup"</span>, handler.SignupHandler)</span><br><span class="line">	router.POST(<span class="string">"/user/signup"</span>, handler.DoSignupHandler)</span><br><span class="line">	// ç™»å½•</span><br><span class="line">	router.GET(<span class="string">"/user/signin"</span>, handler.SigninHandler)</span><br><span class="line">	router.POST(<span class="string">"/user/signin"</span>, handler.DoSigninHandler)</span><br><span class="line">	// ç”¨æˆ·æŸ¥è¯¢</span><br><span class="line">	router.POST(<span class="string">"/user/info"</span>, handler.UserInfoHandler)</span><br><span class="line"></span><br><span class="line">	// ç”¨æˆ·æ–‡ä»¶æŸ¥è¯¢</span><br><span class="line">	router.POST(<span class="string">"/file/query"</span>, handler.FileQueryHandler)</span><br><span class="line">	// ç”¨æˆ·æ–‡ä»¶ä¿®æ”¹(é‡å‘½å)</span><br><span class="line">	router.POST(<span class="string">"/file/update"</span>, handler.FileMetaUpdateHandler)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main.go</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"filestore-server/service/apigw/route"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := route.Router()</span><br><span class="line">	r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¿è¡Œ<code>go run service/apigw/main.go --registry=consul</code>æŒ‡å®šæ³¨å†Œä¸­å¿ƒä¸ºconsul</p>
<h3 id="æ–‡ä»¶ä¸Šä¼ å¾®æœåŠ¡"><a href="#æ–‡ä»¶ä¸Šä¼ å¾®æœåŠ¡" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å¾®æœåŠ¡"></a>æ–‡ä»¶ä¸Šä¼ å¾®æœåŠ¡</h3><p>æ–‡ä»¶ä¸Šä¼ éœ€è¦ç”¨åˆ°RPCå¾®æœåŠ¡é—´é€šä¿¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package rpc</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	cfg <span class="string">"filestore-server/service/upload/config"</span></span><br><span class="line">	upProto <span class="string">"filestore-server/service/upload/proto"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// Upload : uploadç»“æ„ä½“</span><br><span class="line"><span class="built_in">type</span> Upload struct&#123;&#125;</span><br><span class="line"></span><br><span class="line">// UploadEntry : è·å–ä¸Šä¼ å…¥å£</span><br><span class="line">func (u *Upload) UploadEntry(</span><br><span class="line">	ctx context.Context,</span><br><span class="line">	req *upProto.ReqEntry,</span><br><span class="line">	res *upProto.RespEntry) error &#123;</span><br><span class="line"></span><br><span class="line">	res.Entry = cfg.UploadEntry</span><br><span class="line">	<span class="built_in">return</span> nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	micro <span class="string">"github.com/micro/go-micro"</span></span><br><span class="line"></span><br><span class="line">	cfg <span class="string">"filestore-server/service/upload/config"</span></span><br><span class="line">	upProto <span class="string">"filestore-server/service/upload/proto"</span></span><br><span class="line">	<span class="string">"filestore-server/service/upload/route"</span></span><br><span class="line">	upRpc <span class="string">"filestore-server/service/upload/rpc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">startRpcService</span></span>() &#123;</span><br><span class="line">	service := micro.NewService(</span><br><span class="line">		micro.Name(<span class="string">"go.micro.service.upload"</span>), // æœåŠ¡åç§°</span><br><span class="line">		micro.RegisterTTL(time.Second*10),     // TTLæŒ‡å®šä»ä¸Šä¸€æ¬¡å¿ƒè·³é—´éš”èµ·ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æœåŠ¡ä¼šè¢«æœåŠ¡å‘ç°ç§»é™¤</span><br><span class="line">		micro.RegisterInterval(time.Second*5), // è®©æœåŠ¡åœ¨æŒ‡å®šæ—¶é—´å†…é‡æ–°æ³¨å†Œï¼Œä¿æŒTTLè·å–çš„æ³¨å†Œæ—¶é—´æœ‰æ•ˆ</span><br><span class="line">	)</span><br><span class="line">	service.Init()</span><br><span class="line"></span><br><span class="line">	upProto.RegisterUploadServiceHandler(service.Server(), new(upRpc.Upload))</span><br><span class="line">	<span class="keyword">if</span> err := service.Run(); err != nil &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">startApiService</span></span>() &#123;</span><br><span class="line">	router := route.Router()</span><br><span class="line">	router.Run(cfg.UploadServiceHost)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	// api æœåŠ¡</span><br><span class="line">	go startApiService()</span><br><span class="line"></span><br><span class="line">	// rpc æœåŠ¡</span><br><span class="line">	startRpcService()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="é€šè¿‡shellè„šæœ¬å¯åŠ¨æ•´ä¸ªé¡¹ç›®çš„å¾®æœåŠ¡-service-start-all-sh-æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹æ‰€éœ€è¦çš„æ–‡ä»¶ç›®å½•"><a href="#é€šè¿‡shellè„šæœ¬å¯åŠ¨æ•´ä¸ªé¡¹ç›®çš„å¾®æœåŠ¡-service-start-all-sh-æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹æ‰€éœ€è¦çš„æ–‡ä»¶ç›®å½•" class="headerlink" title="é€šè¿‡shellè„šæœ¬å¯åŠ¨æ•´ä¸ªé¡¹ç›®çš„å¾®æœåŠ¡./service/start-all.sh(æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹æ‰€éœ€è¦çš„æ–‡ä»¶ç›®å½•)"></a>é€šè¿‡shellè„šæœ¬å¯åŠ¨æ•´ä¸ªé¡¹ç›®çš„å¾®æœåŠ¡<code>./service/start-all.sh</code>(æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹æ‰€éœ€è¦çš„æ–‡ä»¶ç›®å½•)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥serviceè¿›ç¨‹</span></span><br><span class="line"><span class="function"><span class="title">check_process</span></span>() &#123;</span><br><span class="line">    sleep 1</span><br><span class="line">    res=`ps aux | grep -v grep | grep <span class="string">"service/bin"</span> | grep <span class="variable">$1</span>`</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$res</span> != <span class="string">''</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[32m å·²å¯åŠ¨ \033[0m"</span> <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[31m å¯åŠ¨å¤±è´¥ \033[0m"</span> <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">        <span class="built_in">return</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘serviceå¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="title">build_service</span></span>() &#123;</span><br><span class="line">    go build -o service/bin/<span class="variable">$1</span> service/<span class="variable">$1</span>/main.go</span><br><span class="line">    resbin=`ls service/bin/ | grep <span class="variable">$1</span>`</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"\033[32m ç¼–è¯‘å®Œæˆ: \033[0m service/bin/<span class="variable">$resbin</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨service</span></span><br><span class="line"><span class="function"><span class="title">run_service</span></span>() &#123;</span><br><span class="line">    nohup ./service/bin/<span class="variable">$1</span> --registry=consul &gt;&gt; <span class="variable">$logpath</span>/<span class="variable">$1</span>.<span class="built_in">log</span> 2&gt;&amp;1 &amp;</span><br><span class="line">    sleep 1</span><br><span class="line">    check_process <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿è¡Œæ—¥å¿—ç›®å½•</span></span><br><span class="line">logpath=/Users/samtake/Documents/GitHub/www/data/<span class="built_in">log</span>/filestore-server <span class="comment">#/data/log/filestore-server</span></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="variable">$logpath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°å·¥ç¨‹æ ¹ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/filestore-server</span><br><span class="line"><span class="comment">#cd /data/go/work/src/filestore-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾®æœåŠ¡å¯ä»¥ç”¨supervisoråšè¿›ç¨‹ç®¡ç†å·¥å…·ï¼›</span></span><br><span class="line"><span class="comment"># æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡docker/k8sè¿›è¡Œéƒ¨ç½²</span></span><br><span class="line"></span><br><span class="line">services=<span class="string">"</span></span><br><span class="line"><span class="string">dbproxy</span></span><br><span class="line"><span class="string">upload</span></span><br><span class="line"><span class="string">download</span></span><br><span class="line"><span class="string">transfer</span></span><br><span class="line"><span class="string">account</span></span><br><span class="line"><span class="string">apigw</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œç¼–è¯‘service</span></span><br><span class="line"><span class="keyword">for</span> service <span class="keyword">in</span> <span class="variable">$services</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    build_service <span class="variable">$service</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œå¯åŠ¨service</span></span><br><span class="line"><span class="keyword">for</span> service <span class="keyword">in</span> <span class="variable">$services</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    run_service <span class="variable">$service</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'å¾®æœåŠ¡å¯åŠ¨å®Œæ¯•.'</span></span><br></pre></td></tr></table></figure>



<h3 id="go-microå­¦ä¹ èµ„æ–™"><a href="#go-microå­¦ä¹ èµ„æ–™" class="headerlink" title="go-microå­¦ä¹ èµ„æ–™"></a><code>go-micro</code>å­¦ä¹ èµ„æ–™</h3><p>Go-Micro åŸºç¡€ç¯‡ ã€1ã€‘Hello World:<a href="https://www.bilibili.com/video/av75269275?from=search&seid=13701687009895043479" target="_blank" rel="noopener">è§†é¢‘</a> &amp; <a href="https://github.com/micro-in-cn/learning-videos/blob/master/docs/hello-world/doc.md" target="_blank" rel="noopener">æ–‡æ¡£</a></p>
<p>#72 Go-Micro ç¼–å†™å¾®æœåŠ¡å®æˆ˜: <a href="https://www.bilibili.com/video/av79892065?from=search&seid=13701687009895043479" target="_blank" rel="noopener">è§†é¢‘åœ°å€</a></p>
<p><a href="https://github.com/micro-in-cn" target="_blank" rel="noopener">Micro ä¸­å›½ç«™</a></p>
<p><a href="https://www.bilibili.com/video/BV18E411o7c5" target="_blank" rel="noopener">#62 Go-Micro å¾®æœåŠ¡æ¡†æ¶ä»‹ç»ï¼ˆä¸€ï¼‰ by èˆ’å…ˆ ã€ Go å¤œè¯» ã€‘</a></p>
<p><a href="https://www.bilibili.com/video/BV1fJ411t7gg" target="_blank" rel="noopener">#72 Go-Micro ç¼–å†™å¾®æœåŠ¡å®æˆ˜ ã€ Go å¤œè¯» ã€‘</a></p>
<p><a href="https://www.bilibili.com/video/BV1VE41157LP" target="_blank" rel="noopener">#79 Go-Micro è¿è¡Œæ—¶å·¥å…·é›† ã€ Go å¤œè¯» ã€‘</a></p>
]]></content>
      <categories>
        <category>å¾®æœåŠ¡</category>
        <category>RPC</category>
      </categories>
      <tags>
        <tag>RPC</tag>
        <tag>å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘OSS</title>
    <url>/2020/02/16/%E9%98%BF%E9%87%8C%E4%BA%91OSS/</url>
    <content><![CDATA[<p><a href="https://help.aliyun.com/document_detail/31947.html?spm=a2c4g.11174283.6.1505.42967da2nUG4r7" target="_blank" rel="noopener">å¯¹è±¡å­˜å‚¨OSS</a></p>
<p><a href="https://help.aliyun.com/document_detail/87712.html?spm=a2c4g.11186623.6.890.7b7f3bdb5LHLCm" target="_blank" rel="noopener">SDK go ç‰ˆæœ¬</a></p>
]]></content>
      <categories>
        <category>OSS</category>
      </categories>
      <tags>
        <tag>OSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Golangæ“ä½œMySQL</title>
    <url>/2020/02/16/Golang%E6%93%8D%E4%BD%9CMySQL/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸ªæŠ¥é”™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  goRedisDemo git:(master) âœ— go run main.go</span><br><span class="line"><span class="built_in">test</span> mySQL </span><br><span class="line">panic: runtime error: invalid memory address or nil pointer dereference</span><br><span class="line">[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x10c1141]</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">sync.(*Mutex).Lock(...)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/sync/mutex.go:74</span><br><span class="line">database/sql.(*DB).conn(0x0, 0x130f9e0, 0xc000018080, 0x1036801, 0xc000000180, 0x300000002, 0xc000000180)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1132 +0x41</span><br><span class="line">database/sql.(*DB).prepare(0x0, 0x130f9e0, 0xc000018080, 0x12c9f84, 0x69, 0x102da01, 0x203000, 0xc0000b3d78, 0xc0000b3d68)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1431 +0x58</span><br><span class="line">database/sql.(*DB).PrepareContext(0x0, 0x130f9e0, 0xc000018080, 0x12c9f84, 0x69, 0x30, 0x30, 0x128eaa0)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1404 +0x99</span><br><span class="line">database/sql.(*DB).Prepare(...)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1421</span><br><span class="line">goRedisDemo/db.OnFileUploadFinished(0x12bbb58, 0x8, 0x12bbb60, 0x8, 0x0, 0x0, 0x0, 0x0)</span><br><span class="line">        /Users/samtake/Documents/GitHub/goRedisDemo/db/file.go:15 +0x77</span><br><span class="line">goRedisDemo/handler.UploadHandlerDB()</span><br><span class="line">        /Users/samtake/Documents/GitHub/goRedisDemo/handler/testDB.go:10 +0x76</span><br><span class="line">main.main()</span><br><span class="line">        /Users/samtake/Documents/GitHub/goRedisDemo/main.go:14 +0x7a</span><br><span class="line"><span class="built_in">exit</span> status 2</span><br><span class="line">âœ  goRedisDemo git:(master) âœ— go get database/sql</span><br><span class="line">âœ  goRedisDemo git:(master) âœ— go get github.com/go-sql-driver/mysql</span><br><span class="line">âœ  goRedisDemo git:(master) âœ— go run main.go                       </span><br><span class="line"><span class="built_in">test</span> mySQL </span><br><span class="line">panic: runtime error: invalid memory address or nil pointer dereference</span><br><span class="line">[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x10c1141]</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">sync.(*Mutex).Lock(...)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/sync/mutex.go:74</span><br><span class="line">database/sql.(*DB).conn(0x0, 0x130f9e0, 0xc0000b0008, 0x1036801, 0xc000000180, 0x300000002, 0xc000000180)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1132 +0x41</span><br><span class="line">database/sql.(*DB).prepare(0x0, 0x130f9e0, 0xc0000b0008, 0x12c9f84, 0x69, 0x102da01, 0x203000, 0xc0000dfd78, 0xc0000dfd68)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1431 +0x58</span><br><span class="line">database/sql.(*DB).PrepareContext(0x0, 0x130f9e0, 0xc0000b0008, 0x12c9f84, 0x69, 0x30, 0x30, 0x128eaa0)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1404 +0x99</span><br><span class="line">database/sql.(*DB).Prepare(...)</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/database/sql/sql.go:1421</span><br><span class="line">goRedisDemo/db.OnFileUploadFinished(0x12bbb58, 0x8, 0x12bbb60, 0x8, 0x0, 0x0, 0x0, 0x0)</span><br><span class="line">        /Users/samtake/Documents/GitHub/goRedisDemo/db/file.go:22 +0x77</span><br><span class="line">goRedisDemo/handler.UploadHandlerDB()</span><br><span class="line">        /Users/samtake/Documents/GitHub/goRedisDemo/handler/testDB.go:10 +0x76</span><br><span class="line">main.main()</span><br><span class="line">        /Users/samtake/Documents/GitHub/goRedisDemo/main.go:14 +0x7a</span><br><span class="line"><span class="built_in">exit</span> status 2</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.51cto.com/zhixinhu/1844734" target="_blank" rel="noopener">æŸ¥äº†ä¸€ä¸‹ï¼ŒåŸæ¥è¿™æ˜¯Dbå˜é‡å®šä¹‰çš„é—®é¢˜ï¼Œ:=åªåœ¨å½“å‰æ–¹æ³•å†…æœ‰æ•ˆã€‚</a></p>
]]></content>
      <categories>
        <category>MySQL</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerfile</title>
    <url>/2020/02/15/Dockerfile/</url>
    <content><![CDATA[<p>Dockerfile æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡æœ¬å†…å®¹åŒ…å«äº†ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œè¯´æ˜ã€‚</p>
<h3 id="ä¸»è¦æŒ‡ä»¤"><a href="#ä¸»è¦æŒ‡ä»¤" class="headerlink" title="ä¸»è¦æŒ‡ä»¤"></a>ä¸»è¦æŒ‡ä»¤</h3><table>
<thead>
<tr>
<th>æŒ‡ä»¤</th>
<th>è¡Œä¸º</th>
</tr>
</thead>
<tbody><tr>
<td>FROM</td>
<td>å®šåˆ¶çš„é•œåƒéƒ½æ˜¯åŸºäº FROM çš„é•œåƒï¼Œä¾‹å¦‚nginx</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>æŒ‡å®šä¸‹é¢çš„shellè¯­å¥æŒ‡å®šè¿è¡Œåœ¨å“ªä¸ªè·¯å¾„ä¸‹</td>
</tr>
<tr>
<td>COPY</td>
<td>å°†å®¿ä¸»æœºä¸‹çš„ç›®å½•æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­å»</td>
</tr>
<tr>
<td>RUN</td>
<td>æ‰§è¡Œåé¢è·Ÿç€çš„å‘½ä»¤è¡Œå‘½ä»¤</td>
</tr>
<tr>
<td>CMD</td>
<td>æŒ‡å®šæ•´ä¸ªé•œåƒè¿è¡Œèµ·æ¥åæ‰§è¡Œçš„è„šæœ¬ (ä¸€èˆ¬éƒ½æ˜¯é˜»å¡å¼çš„è„šæœ¬)</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM alpine</span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY src/  /app</span><br><span class="line">RUN <span class="built_in">echo</span> 321 &gt;&gt; 1.txt</span><br><span class="line">CMD tail -f 1.txt</span><br></pre></td></tr></table></figure>

<h3 id="COPY-vs-ADD"><a href="#COPY-vs-ADD" class="headerlink" title="COPY vs ADD"></a>COPY vs ADD</h3><p>ä¸¤è€…åŠŸèƒ½å·®ä¸å¤šï¼Œä½†æ˜¯ADDçš„æºæ–‡ä»¶é™¤äº†æ˜¯æœ¬åœ°æ–‡ä»¶èµ„æºï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªurl</p>
<h3 id="CMD-vs-ENTRYPOINT"><a href="#CMD-vs-ENTRYPOINT" class="headerlink" title="CMD vs ENTRYPOINT"></a>CMD vs ENTRYPOINT</h3><h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>ç±»ä¼¼äº CMD æŒ‡ä»¤ï¼Œä½†å…¶ä¸ä¼šè¢« docker run çš„å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šçš„æŒ‡ä»¤æ‰€è¦†ç›–ï¼Œè€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°é€ç»™ ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚</p>
<p>ä½†æ˜¯, å¦‚æœè¿è¡Œ docker run æ—¶ä½¿ç”¨äº† â€“entrypoint é€‰é¡¹ï¼Œæ­¤é€‰é¡¹çš„å‚æ•°å¯å½“ä½œè¦è¿è¡Œçš„ç¨‹åºè¦†ç›– ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚</p>
<p>ä¼˜ç‚¹ï¼šåœ¨æ‰§è¡Œ docker run çš„æ—¶å€™å¯ä»¥æŒ‡å®š ENTRYPOINT è¿è¡Œæ‰€éœ€çš„å‚æ•°ã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœ Dockerfile ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª ENTRYPOINT æŒ‡ä»¤ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p>
<p>åœ¨ Dockerfile æ–‡ä»¶çš„å­˜æ”¾ç›®å½•ä¸‹ï¼Œé€šè¿‡<code>docker build -t &lt;é•œåƒå&gt;:&lt;ç‰ˆæœ¬å·&gt;</code>å‘½ä»¤æ¥æ‰§è¡Œã€‚</p>
<h4 id="å½“ä¸¤è€…æ··ç”¨æ—¶"><a href="#å½“ä¸¤è€…æ··ç”¨æ—¶" class="headerlink" title="å½“ä¸¤è€…æ··ç”¨æ—¶"></a>å½“ä¸¤è€…æ··ç”¨æ—¶</h4><ul>
<li>entrypointéjsonï¼Œåˆ™ä»¥entrypointä¸ºå‡†ã€‚</li>
<li>å¦‚æœentrypointå’Œcmdéƒ½æ˜¯jsonï¼Œåˆ™ä»¥entrypoint+cmdæ‹¼æ¥æˆçš„shellä¸ºå‡†ã€‚</li>
</ul>
<h3 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h3><p>exposeä»…ä»…åªæ˜¯å£°æ˜ç«¯å£ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„ã€‚</li>
<li>åœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯ docker run -P æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£ã€‚</li>
</ul>
<h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p>å®šä¹‰åŒ¿åæ•°æ®å·ã€‚åœ¨å¯åŠ¨å®¹å™¨æ—¶å¿˜è®°æŒ‚è½½æ•°æ®å·ï¼Œä¼šè‡ªåŠ¨æŒ‚è½½åˆ°åŒ¿åå·ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>é¿å…é‡è¦çš„æ•°æ®ï¼Œå› å®¹å™¨é‡å¯è€Œä¸¢å¤±ï¼Œè¿™æ˜¯éå¸¸è‡´å‘½çš„ã€‚</li>
<li>é¿å…å®¹å™¨ä¸æ–­å˜å¤§ã€‚</li>
</ul>
<h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå®šä¹‰äº†ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆåœ¨åç»­çš„æŒ‡ä»¤ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚</p>
<h3 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h3><p>æ„å»ºå‚æ•°ï¼Œä¸ ENV ä½œç”¨ä¸€è‡³ã€‚ä¸è¿‡ä½œç”¨åŸŸä¸ä¸€æ ·ã€‚ARG è®¾ç½®çš„ç¯å¢ƒå˜é‡ä»…å¯¹ Dockerfile å†…æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ docker build çš„è¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œæ„å»ºå¥½çš„é•œåƒå†…ä¸å­˜åœ¨æ­¤ç¯å¢ƒå˜é‡ã€‚</p>
<h3 id="label"><a href="#label" class="headerlink" title="label"></a>label</h3><p>æ ‡è¯†ï¼ˆæ²¡å®é™…ä½œç”¨ï¼‰</p>
<h3 id="onbuild"><a href="#onbuild" class="headerlink" title="onbuild"></a>onbuild</h3><p><code>onbuild env C = 10</code></p>
<p>åœ¨æœ¬æ¬¡æ„å»ºé•œåƒçš„è¿‡ç¨‹ä¸­ä¸ä¼šæ‰§è¡Œï¼ˆå‡è®¾é•œåƒä¸º test-buildï¼‰ã€‚å½“æœ‰æ–°çš„ Dockerfile ä½¿ç”¨äº†ä¹‹å‰æ„å»ºçš„é•œåƒ FROM test-build </p>
<h3 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h3><p><a href="https://www.runoob.com/docker/docker-dockerfile.html" target="_blank" rel="noopener">Dockerfile</a><br><a href="https://www.bilibili.com/video/av85895204?from=search&seid=4835159816508980526" target="_blank" rel="noopener">Dockerfileç”¨æ³•å…¨è§£æ</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker-Compose</title>
    <url>/2020/02/15/Docker-Compose/</url>
    <content><![CDATA[<p>Compose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚é€šè¿‡ Composeï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ YML æ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰æœåŠ¡ã€‚ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥ä» YML æ–‡ä»¶é…ç½®ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚</p>
<p>Mac ç”¨æˆ·ä¸éœ€è¦å•ç‹¬å®‰è£… Composeï¼Œå› ä¸ºDocker æ¡Œé¢ç‰ˆå·²ç»åŒ…å«</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  blogs docker-compose --version</span><br><span class="line">docker-compose version 1.24.1, build 4667896b</span><br></pre></td></tr></table></figure>

<p>Compose ä½¿ç”¨çš„ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<p>1.é€šè¿‡Dockerfileå®šä¹‰å®¹å™¨ç¯å¢ƒï¼Œæ‰“åŒ…æˆé•œåƒ</p>
<p>2.é€šè¿‡docker-compose.ymlå®šä¹‰å„åº”ç”¨æœåŠ¡</p>
<p>3.é€šè¿‡docker-compose upå‘½ä»¤æ¥å¯åŠ¨æ‰€æœ‰å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yaml é…ç½®å®ä¾‹</span></span><br><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">   - <span class="string">"5000:5000"</span></span><br><span class="line">    volumes:</span><br><span class="line">   - .:/code</span><br><span class="line">    - logvolume01:/var/<span class="built_in">log</span></span><br><span class="line">    links:</span><br><span class="line">   - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">volumes:</span><br><span class="line">  logvolume01: &#123;&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.runoob.com/docker/docker-compose.html" target="_blank" rel="noopener">Docker Compose</a><br><a href="https://www.bilibili.com/video/av61131351?from=search&seid=5421358312704070453" target="_blank" rel="noopener">å®æˆ˜~å¦‚ä½•ç»„ç»‡ä¸€ä¸ªå¤šå®¹å™¨é¡¹ç›®docker-compose</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>RPC</title>
    <url>/2020/02/14/RPC/</url>
    <content><![CDATA[<h3 id="RPCåŸç†"><a href="#RPCåŸç†" class="headerlink" title="RPCåŸç†"></a>RPCåŸç†</h3><p><img src="/2020/02/14/RPC/RPC.png" alt></p>
<h3 id="RPCä¸Restfulæ¥å£çš„è°ƒç”¨"><a href="#RPCä¸Restfulæ¥å£çš„è°ƒç”¨" class="headerlink" title="RPCä¸Restfulæ¥å£çš„è°ƒç”¨"></a>RPCä¸Restfulæ¥å£çš„è°ƒç”¨</h3><p>ä¸å…³å¿ƒè°ƒç”¨æ–¹å¼ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“<br>RPCç›¸å¯¹é«˜æ•ˆï¼Œhttpæ¥å£ç›¸å¯¹çµæ´» </p>
<p>restfulæ¥å£æ›´é€‚åˆç»ˆç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„äº¤äº’ï¼Œrpcæ›´é€‚åˆå¾®æœåŠ¡çš„åº”ç”¨é—´é€šè®¯</p>
<h3 id="ProtoBuf"><a href="#ProtoBuf" class="headerlink" title="ProtoBuf"></a>ProtoBuf</h3><p>ProtoBufæ˜¯ä¸€ç§è·¨è¯­è¨€å’Œè·¨å¹³å°çš„æ•°æ®åºåˆ—åŒ–åè®®ï¼›<br>ä¸XML/JSONç›¸æ¯”ï¼Œåºåˆ—åŒ–æ•ˆç‡æ›´å¿«ã€ä½“ç§¯æ›´å°ã€æ›´å®‰å…¨ï¼›<br>ä¸XML/JSONç›¸æ¯”ï¼Œå¯è¯»æ€§å·®ã€çµæ´»æ€§è¾ƒä½ï¼›<br>è‡ªå¸¦ç¼–è¯‘å™¨ï¼Œå®šä¹‰protoæºæ–‡ä»¶ï¼Œå¯ç¼–è¯‘æˆå¤šç§è¯­è¨€çš„ä»£ç ï¼›</p>
<h3 id="gRPCæ¡†æ¶"><a href="#gRPCæ¡†æ¶" class="headerlink" title="gRPCæ¡†æ¶"></a>gRPCæ¡†æ¶</h3><p><img src="/2020/02/14/RPC/gRPC.jpeg" alt></p>
<h3 id="æ¡†æ¶go-micro"><a href="#æ¡†æ¶go-micro" class="headerlink" title="æ¡†æ¶go-micro"></a>æ¡†æ¶go-micro</h3><p>ä¸“æ³¨äºå¾®æœåŠ¡çš„ä¸€ç§RPCæ¡†æ¶ï¼›<br>æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„æ¥å£é›†åˆï¼›</p>
<p>æœåŠ¡å‘ç°ï¼šæ”¯æŒæœåŠ¡æ³¨å†Œä¸å‘ç°</p>
<p>è´Ÿè½½å‡è¡¡ï¼šrpcæœåŠ¡é—´çš„è¯·æ±‚è°ƒåº¦å‡è¡¡ç­–ç•¥</p>
<p>åŒæ­¥é€šä¿¡ï¼šåŸºäºRPCé€šä¿¡ï¼Œæ”¯æŒå•é¡¹ã€åŒå‘æµé€šä¿¡æ¨¡å¼</p>
<p>å¼‚æ­¥é€šä¿¡ï¼šæä¾›pub\subé€šä¿¡æ¨¡å‹çš„æ¥å£</p>
<p>é«˜çº§æ¥å£ï¼šæ¯”å¦‚æœåŠ¡å‘ç°ï¼Œæä¾›è°ƒç”¨çš„æ¥å£æ˜¯ä¸€è‡´çš„</p>
<p><img src="/2020/02/14/RPC/goMicro.png" alt></p>
]]></content>
      <categories>
        <category>RPC</category>
      </categories>
      <tags>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title>GinåŸºæœ¬äº†è§£</title>
    <url>/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/</url>
    <content><![CDATA[<p>å­¦ä¹ èµ„æ–™:<br><a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">giné¡¹ç›®åœ°å€</a><br><a href="https://gin-gonic.com/zh-cn/" target="_blank" rel="noopener">ginä¸­æ–‡æ–‡æ¡£</a><br><a href="https://www.imooc.com/learn/1175" target="_blank" rel="noopener">Ginå…¥é—¨å®æˆ˜</a><br><a href="https://github.com/samtake/gin-demo" target="_blank" rel="noopener">æ–‡ä¸­demo</a></p>
<h2 id="Ginè¿è¡Œæµç¨‹"><a href="#Ginè¿è¡Œæµç¨‹" class="headerlink" title="Ginè¿è¡Œæµç¨‹"></a>Ginè¿è¡Œæµç¨‹</h2><p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/gin.png" alt></p>
<p><code>engine</code>:å®ç°äº†ServeHTTPæ¥å£çš„handler<br><code>methodTree</code>:æ ¹æ®httpè¯·æ±‚æ–¹æ³•åˆ†åˆ«ç»´æŠ¤çš„è·¯ç”±æ ‘<br><code>routerGroup</code>:å°†è·¯ç”±è¡¨åˆ†ç»„ï¼Œæ–¹ä¾¿ä¸­é—´ä»¶ç»Ÿä¸€å¤„ç†<br><code>Context</code>:Ginçš„ä¸Šä¸‹æ–‡ï¼Œåœ¨handlerä¹‹é—´ä¼ é€’å‚æ•°</p>
<h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><p>Router ï¼šè·¯ç”±è§„åˆ™å®šä¹‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import (</span><br><span class="line">	hdl <span class="string">"filestore-server/handler"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// Router ï¼šè·¯ç”±è§„åˆ™å®šä¹‰</span><br><span class="line">func Router() *gin.Engine &#123;</span><br><span class="line">	// gin framework</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	// é™æ€èµ„æºå¤„ç†</span><br><span class="line">	router.Static(<span class="string">"/static/"</span>, <span class="string">"./static"</span>)</span><br><span class="line"></span><br><span class="line">	// å®šä¹‰æ¥å£</span><br><span class="line">	router.GET(<span class="string">"/user/signup"</span>, hdl.SignupHandler)</span><br><span class="line">    router.POST(<span class="string">"/user/signup"</span>, hdl.DoSignupHandler)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>handler</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// SignupHandler : å¤„ç†ç”¨æˆ·æ³¨å†Œè¯·æ±‚</span><br><span class="line">func SignupHandler(c *gin.Context) &#123;</span><br><span class="line">	c.Redirect(http.StatusFound, <span class="string">"http://"</span>+c.Request.Host+<span class="string">"/static/view/signup.html"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// DoSignupHandler : å¤„ç†ç”¨æˆ·æ³¨å†Œè¯·æ±‚</span><br><span class="line">func DoSignupHandler(c *gin.Context) &#123;</span><br><span class="line">	username := c.Request.FormValue(<span class="string">"username"</span>)</span><br><span class="line">	passwd := c.Request.FormValue(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> len(username) &lt; 3 || len(passwd) &lt; 5 &#123;</span><br><span class="line">		c.JSON(http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"msg"</span>: <span class="string">"Invalid parameter"</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// å¯¹å¯†ç è¿›è¡ŒåŠ ç›åŠå–Sha1å€¼åŠ å¯†</span><br><span class="line">	encPasswd := util.Sha1([]byte(passwd + pwdSalt))</span><br><span class="line">	// å°†ç”¨æˆ·ä¿¡æ¯æ³¨å†Œåˆ°ç”¨æˆ·è¡¨ä¸­</span><br><span class="line">	suc := dblayer.UserSignup(username, encPasswd)</span><br><span class="line">	<span class="keyword">if</span> suc &#123;</span><br><span class="line">		c.JSON(http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>:    0,</span><br><span class="line">				<span class="string">"msg"</span>:     <span class="string">"æ³¨å†ŒæˆåŠŸ"</span>,</span><br><span class="line">				<span class="string">"data"</span>:    nil,</span><br><span class="line">				<span class="string">"forward"</span>: <span class="string">"/user/signin"</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>: 0,</span><br><span class="line">				<span class="string">"msg"</span>:  <span class="string">"æ³¨å†Œå¤±è´¥"</span>,</span><br><span class="line">				<span class="string">"data"</span>: nil,</span><br><span class="line">			&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆmain.goå¯ç®€æ´ä¸º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	// gin framework</span><br><span class="line">	router := route.Router()</span><br><span class="line"></span><br><span class="line">	// å¯åŠ¨æœåŠ¡å¹¶ç›‘å¬ç«¯å£</span><br><span class="line">	err := router.Run(config.UploadServiceHost)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Failed to start server, err:%s\n"</span>, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"first"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		fmt.Println(<span class="string">"first ........."</span>)</span><br><span class="line">		c.JSON(200, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	authorized := r.Group(<span class="string">"/try"</span>)</span><br><span class="line"></span><br><span class="line">	authorized.POST(<span class="string">"/second"</span>, second)</span><br><span class="line">	authorized.POST(<span class="string">"/third"</span>, third)</span><br><span class="line"></span><br><span class="line">	// åµŒå¥—è·¯ç”±ç»„</span><br><span class="line">	testing := authorized.Group(<span class="string">"testing"</span>)</span><br><span class="line">	testing.GET(<span class="string">"/forth"</span>, fourth)</span><br><span class="line"></span><br><span class="line">	// ç›‘å¬å¹¶åœ¨ 0.0.0.0:8080 ä¸Šå¯åŠ¨æœåŠ¡</span><br><span class="line">	r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func second(c *gin.Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">"second ........."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func third(c *gin.Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">"third ........."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func fourth(c *gin.Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">"fourth ........."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  gin-demo git:(master) âœ— lsof -i tcp:8080    </span><br><span class="line">COMMAND     PID    USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</span><br><span class="line">QQ          327 samtake   29u  IPv4 0xfdcbb6b79716f31f      0t0  TCP huangloshansmbp:50202-&gt;157.255.13.190:http-alt (ESTABLISHED)</span><br><span class="line">QQ          327 samtake   48u  IPv4 0xfdcbb6b79716f31f      0t0  TCP huangloshansmbp:50202-&gt;157.255.13.190:http-alt (ESTABLISHED)</span><br><span class="line">Google      420 samtake   26u  IPv4 0xfdcbb6b793e58fb7      0t0  TCP localhost:51492-&gt;localhost:http-alt (ESTABLISHED)</span><br><span class="line">Postman   66875 samtake   67u  IPv4 0xfdcbb6b778668ca7      0t0  TCP localhost:51499-&gt;localhost:http-alt (ESTABLISHED)</span><br><span class="line">main      67553 samtake    3u  IPv6 0xfdcbb6b793ea9b8f      0t0  TCP *:http-alt (LISTEN)</span><br><span class="line">main      67553 samtake    7u  IPv6 0xfdcbb6b793eac3cf      0t0  TCP localhost:http-alt-&gt;localhost:51492 (ESTABLISHED)</span><br><span class="line">main      67553 samtake    8u  IPv6 0xfdcbb6b7912a55cf      0t0  TCP localhost:http-alt-&gt;localhost:51499 (ESTABLISHED)</span><br><span class="line">âœ  gin-demo git:(master) âœ— <span class="built_in">kill</span> -9  67553      </span><br><span class="line">âœ  gin-demo git:(master) âœ— go run start/main.go</span><br><span class="line">[GIN-debug] [WARNING] Running <span class="keyword">in</span> <span class="string">"debug"</span> mode. Switch to <span class="string">"release"</span> mode <span class="keyword">in</span> production.</span><br><span class="line"> - using env:   <span class="built_in">export</span> GIN_MODE=release</span><br><span class="line"> - using code:  gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">[GIN-debug] GET    /first                    --&gt; main.main.func1 (3 handlers)</span><br><span class="line">[GIN-debug] POST   /try/second               --&gt; main.second (3 handlers)</span><br><span class="line">[GIN-debug] POST   /try/third                --&gt; main.third (3 handlers)</span><br><span class="line">[GIN-debug] GET    /try/testing/forth        --&gt; main.fourth (3 handlers)</span><br><span class="line">[GIN-debug] Listening and serving HTTP on :8080</span><br><span class="line">first .........</span><br><span class="line">[GIN] 2020/02/25 - 11:51:19 | 200 |     176.613Âµs |       127.0.0.1 | GET      /first</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/gin-first.png" alt></p>
<h2 id="1-è¯·æ±‚è·¯ç”±"><a href="#1-è¯·æ±‚è·¯ç”±" class="headerlink" title="1.è¯·æ±‚è·¯ç”±"></a>1.è¯·æ±‚è·¯ç”±</h2><h3 id="å¤šç§è¯·æ±‚"><a href="#å¤šç§è¯·æ±‚" class="headerlink" title="å¤šç§è¯·æ±‚"></a>å¤šç§è¯·æ±‚</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"get"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"get"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.POST(<span class="string">"post"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"post"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.DELETE(<span class="string">"delete"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"delete"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Any(<span class="string">"/any"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"any"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>ç»™æˆ‘ä»¬åˆ›å»ºçš„anyè¯·æ±‚å‡ ä¹è¦†ç›–äº†æ‰€æœ‰ç§ç±»çš„è¯·æ±‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[GIN-debug] GET    /get                      --&gt; main.main.func1 (3 handlers)</span><br><span class="line">[GIN-debug] POST   /post                     --&gt; main.main.func2 (3 handlers)</span><br><span class="line">[GIN-debug] DELETE /delete                   --&gt; main.main.func3 (3 handlers)</span><br><span class="line">[GIN-debug] GET    /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] POST   /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] PUT    /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] PATCH  /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] HEAD   /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] OPTIONS /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] DELETE /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] CONNECT /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] TRACE  /any                      --&gt; main.main.func4 (3 handlers)</span><br><span class="line">[GIN-debug] Environment variable PORT is undefined. Using port :8080 by default</span><br><span class="line">[GIN-debug] Listening and serving HTTP on :8080</span><br></pre></td></tr></table></figure>

<h3 id="é™æ€æ–‡ä»¶å¤¹"><a href="#é™æ€æ–‡ä»¶å¤¹" class="headerlink" title="é™æ€æ–‡ä»¶å¤¹"></a>é™æ€æ–‡ä»¶å¤¹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	// é™æ€æ–‡ä»¶å¤¹ç»‘å®š+è·¯ç”±ï¼Œæœ‰ä¸¤ç§å†™æ³•ï¼š</span><br><span class="line">	r.Static(<span class="string">"/assets"</span>, <span class="string">"./assets"</span>)</span><br><span class="line">	r.StaticFS(<span class="string">"/static"</span>, http.Dir(<span class="string">"static"</span>))</span><br><span class="line"></span><br><span class="line">	//åˆæˆ–è€…è·¯ç”±+èµ„æº</span><br><span class="line">	r.StaticFile(<span class="string">"/favicon.ico"</span>, <span class="string">"/favicon.ico"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>go build -o router_static &amp;&amp; ./router_static</code>è¿™éœ€è¦åœ¨routerstaticæ–‡ä»¶å¤¹ä¸‹è¿è¡Œï¼Œä¸ç„¶æ‰¾ä¸åˆ°èµ„æºæ–‡ä»¶ï¼Œæœ€åè®¿é—®<code>http://localhost:8080/assets/a.html</code>ä»¥åŠ<code>http://localhost:8080/static/b.html</code>æµ‹è¯•å³å¯ã€‚</p>
<h3 id="å‚æ•°ä½œä¸ºurl"><a href="#å‚æ•°ä½œä¸ºurl" class="headerlink" title="å‚æ•°ä½œä¸ºurl"></a>å‚æ•°ä½œä¸ºurl</h3><p>Getè¯·æ±‚<code>http://localhost:8080/Sam/520</code>å³å¯å¾—åˆ°ç›¸åº”å‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"520"</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Sam"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="2-è·å–è¯·æ±‚å‚æ•°"><a href="#2-è·å–è¯·æ±‚å‚æ•°" class="headerlink" title="2.è·å–è¯·æ±‚å‚æ•°"></a>2.è·å–è¯·æ±‚å‚æ•°</h2><ul>
<li>è·å–getè¯·æ±‚å‚æ•°</li>
<li>è·å–postè¯·æ±‚å‚æ•°</li>
<li>è·å–bodyå€¼</li>
<li>è·å–å‚æ•°ç»‘å®šç»“æ„ä½“</li>
</ul>
<h3 id="æ³›ç»‘å®š"><a href="#æ³›ç»‘å®š" class="headerlink" title="æ³›ç»‘å®š"></a>æ³›ç»‘å®š</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/user/*action"</span>, func(c *gin.Context) &#123; //è®¾ç½®è·å–nameå’Œidçš„å‚æ•°</span><br><span class="line">		c.String(200, <span class="string">"æ³›ç»‘å®šï½"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰userå‰ç¼€çš„è¯·æ±‚éƒ½èƒ½è¯·æ±‚åˆ°ï¼š<code>http://localhost:8080/user/&lt;XXXX&gt;</code></p>
<h3 id="è·å–getå‚æ•°"><a href="#è·å–getå‚æ•°" class="headerlink" title="è·å–getå‚æ•°"></a>è·å–getå‚æ•°</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/testGetParam"</span>, func(c *gin.Context) &#123; //è®¾ç½®è·å–nameå’Œidçš„å‚æ•°</span><br><span class="line">		param1 := c.Query(<span class="string">"parm1"</span>)</span><br><span class="line">		param2 := c.Query(<span class="string">"parm2"</span>)</span><br><span class="line"></span><br><span class="line">		c.String(http.StatusOK, <span class="string">"%s, %s"</span>, param1, param2)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl -X GET <span class="string">'http://127.0.0.1:8080/testGetParam?parm1=11111'</span> </span><br><span class="line">11111, %  </span><br><span class="line">âœ  ~ curl -X GET <span class="string">'http://127.0.0.1:8080/testGetParam?parm1=11111&amp;parm2=2222'</span></span><br><span class="line">11111, 2222%</span><br></pre></td></tr></table></figure>



<h3 id="è·å–bodyå†…å®¹"><a href="#è·å–bodyå†…å®¹" class="headerlink" title="è·å–bodyå†…å®¹"></a>è·å–bodyå†…å®¹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.POST(<span class="string">"/parmBody"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		bodyBytes, err := ioutil.ReadAll(c.Request.Body)</span><br><span class="line">		<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">			c.String(http.StatusBadRequest, err.Error())</span><br><span class="line">			c.Abort()</span><br><span class="line">		&#125;</span><br><span class="line">		c.Request.Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes)) //é‡æ–°å›å†™åˆ°ç¼“å­˜æ‰èƒ½æ‹¿åˆ°parm1 parm2</span><br><span class="line">		parm1 := c.PostForm(<span class="string">"parm1"</span>)</span><br><span class="line">		parm2 := c.PostForm(<span class="string">"parm2"</span>)</span><br><span class="line">		c.String(http.StatusOK, <span class="string">"%s %s %s"</span>, parm1, parm2, string(bodyBytes))</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl -X POST <span class="string">'http://127.0.0.1:8080/parmBody'</span> -d <span class="string">'parm1=value1&amp;parm2=value2'</span> </span><br><span class="line">value1 value2 parm1=value1&amp;parm2=value2%                                                                                                                               </span><br><span class="line">âœ  ~ curl -X POST <span class="string">'http://127.0.0.1:8080/parmBody'</span> -d <span class="string">'&#123;"parm1":"value1","parm2":"value2"&#125;'</span></span><br><span class="line">  &#123;<span class="string">"parm1"</span>:<span class="string">"value1"</span>,<span class="string">"parm2"</span>:<span class="string">"value2"</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="è·å–bindå‚æ•°"><a href="#è·å–bindå‚æ•°" class="headerlink" title="è·å–bindå‚æ•°"></a>è·å–bindå‚æ•°</h3><p>åŒæ—¶å“åº”postå’Œgetï¼ŒåŒæ—¶è®¿é—®åˆ°åŒä¸€ä¸ªå›è°ƒæ–¹æ³•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> Person struct &#123;</span><br><span class="line">	Name     string    `form:<span class="string">"name"</span>` //è®¾ç½®tag `form`å¯ä»¥ç”±å‚æ•°è½¬å˜æˆç»“æ„ä½“</span><br><span class="line">	Address  string    `form:<span class="string">"address"</span>`</span><br><span class="line">	Birthday time.Time `form:<span class="string">"birthday"</span> time_format:<span class="string">"2006-01-03"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, testHandler)</span><br><span class="line">	r.POST(<span class="string">"/test"</span>, testHandler)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func testHandler(c *gin.Context) &#123;</span><br><span class="line">	var person Person</span><br><span class="line">	//æ ¹æ®è¯·æ±‚content-typeæ¥ä½œä¸åŒçš„bindingæ“ä½œ</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBind(&amp;person); err == nil &#123;</span><br><span class="line">		c.String(200, <span class="string">"%v"</span>, person)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.String(200, <span class="string">"person bind error"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl -X GET  <span class="string">'http://127.0.0.1:8080/test?name=samtake&amp;adress=gd'</span></span><br><span class="line">&#123;samtake  0001-01-01 00:00:00 +0000 UTC&#125;</span><br><span class="line">âœ  ~ curl -X GET  <span class="string">'http://127.0.0.1:8080/test?name=samtake&amp;address=gd'</span></span><br><span class="line">&#123;samtake gd 0001-01-01 00:00:00 +0000 UTC&#125;%  </span><br><span class="line">âœ  ~ curl -X POST  <span class="string">'http://127.0.0.1:8080/test?name=samtake&amp;address=gd&amp;birthday=2008-09-09'</span></span><br><span class="line">&#123;samtake gd 2008-09-01 09:00:00 +0800 CST&#125;%   </span><br><span class="line">âœ  ~ curl -X POST  <span class="string">'http://127.0.0.1:8080/test'</span>  -d <span class="string">'name=samtake&amp;address=gd&amp;birthday=2008-09-09'</span></span><br><span class="line">&#123;samtake gd 2008-09-01 09:00:00 +0800 CST&#125;%   </span><br><span class="line">âœ  ~ curl -H <span class="string">"Content-Type:application/json"</span>  -X POST <span class="string">"http://127.0.0.1:8080/test"</span>  -d <span class="string">'&#123;"name":"wang"&#125;'</span></span><br><span class="line">&#123;wang  0001-01-01 00:00:00 +0000 UTC&#125;%</span><br></pre></td></tr></table></figure>


<p>è¿™é‡Œæœ‰ä¸ªå‘ï¼šå¦‚æœæ—¶é—´æ ¼å¼å†™æˆåƒ<code>time_format:&quot;2006-01-03&quot;</code>è¿™ç§ä¼šæŠ¥é”™ï¼Œè§£æä¸äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">person <span class="built_in">bind</span> error%!(EXTRA *time.ParseError=parsing time <span class="string">"2008-00-08"</span> as <span class="string">"2011-01-03"</span>: cannot parse <span class="string">"-00-08"</span> as <span class="string">"1"</span>)</span><br></pre></td></tr></table></figure>


<h2 id="éªŒè¯è¯·æ±‚å‚æ•°"><a href="#éªŒè¯è¯·æ±‚å‚æ•°" class="headerlink" title="éªŒè¯è¯·æ±‚å‚æ•°"></a>éªŒè¯è¯·æ±‚å‚æ•°</h2><ul>
<li>ç»“æ„ä½“éªŒè¯</li>
<li>è‡ªå®šä¹‰éªŒè¯</li>
<li>æ”¯æŒå¤šè¯­è¨€é”™è¯¯ä¿¡æ¯</li>
</ul>
<h3 id="ç»“æ„ä½“éªŒè¯"><a href="#ç»“æ„ä½“éªŒè¯" class="headerlink" title="ç»“æ„ä½“éªŒè¯"></a>ç»“æ„ä½“éªŒè¯</h3><p><a href="https://godoc.org/gopkg.in/go-playground/validator.v9" target="_blank" rel="noopener">validateè§„åˆ™</a><br>bindingæ¡ä»¶æ»¡è¶³</p>
<p>å‘çš„è®°å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> Person struct &#123;</span><br><span class="line">	Age     int    `form:<span class="string">"age"</span>  binding:<span class="string">"required,gt=10"</span>`</span><br><span class="line">	Name    string `form:<span class="string">"name"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">	Address string `form:<span class="string">"address"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/validate-form.png" alt></p>
<p>æ­£ç¡®çš„å®Œæ•´æºç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> Person struct &#123;</span><br><span class="line">	Age     int    `form:<span class="string">"Age"</span>  binding:<span class="string">"required,gt=10"</span>`</span><br><span class="line">	Name    string `form:<span class="string">"Name"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">	Address string `form:<span class="string">"Address"</span> binding:<span class="string">"required"</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, testHandler)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func testHandler(c *gin.Context) &#123;</span><br><span class="line">	var person Person</span><br><span class="line">	//æ ¹æ®è¯·æ±‚content-typeæ¥ä½œä¸åŒçš„bindingæ“ä½œ</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBind(&amp;person); err != nil &#123;</span><br><span class="line">		c.String(500, <span class="string">"%v"</span>, err)</span><br><span class="line">		c.Abort()</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(200, <span class="string">"%v"</span>, person)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl -X GET  <span class="string">"http://127.0.0.1:8080/test?age=19&amp;name=samtake&amp;address=gd"</span></span><br><span class="line">Key: <span class="string">'Person.Age'</span> Error:Field validation <span class="keyword">for</span> <span class="string">'Age'</span> failed on the <span class="string">'required'</span> tag</span><br><span class="line">Key: <span class="string">'Person.Name'</span> Error:Field validation <span class="keyword">for</span> <span class="string">'Name'</span> failed on the <span class="string">'required'</span> tag</span><br><span class="line">Key: <span class="string">'Person.Address'</span> Error:Field validation <span class="keyword">for</span> <span class="string">'Address'</span> failed on the <span class="string">'required'</span> tag% </span><br><span class="line">âœ  ~ curl -X GET  <span class="string">"http://127.0.0.1:8080/test?Age=19&amp;Name=samtake&amp;Address=gd"</span></span><br><span class="line">&#123;19 samtake gd&#125;%</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰éªŒè¯"><a href="#è‡ªå®šä¹‰éªŒè¯" class="headerlink" title="è‡ªå®šä¹‰éªŒè¯"></a>è‡ªå®šä¹‰éªŒè¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;reflect&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/gin-gonic/gin&quot;</span><br><span class="line">	&quot;github.com/gin-gonic/gin/binding&quot;</span><br><span class="line">	&quot;gopkg.in/go-playground/validator.v9&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Booking struct &#123;</span><br><span class="line">	CheckIn  time.Time `form:&quot;check_in&quot;  binding:&quot;required,bookabledate&quot; time_format:&quot;2006-01-01&quot;`</span><br><span class="line">	CheckOut time.Time `form:&quot;check_out&quot;  binding:&quot;required,gtfield=checkIn&quot; time_format:&quot;2006-01-01&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func customFunc(v *validator.Validate, topStruct reflect.Value, currentStructOrField reflect.Value, field reflect.Value, fieldType reflect.Type, fieldKind reflect.Kind, param string) bool &#123;</span><br><span class="line">	if date, ok := field.Interface().(time.Time); ok &#123;</span><br><span class="line">		today := time.Now()</span><br><span class="line">		if date.Unix() &gt; today.Unix() &#123;</span><br><span class="line">			return true</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	if v, ok := binding.Validator.Engine().(*validator.Validate); ok &#123;</span><br><span class="line">		v.RegisterValidation(&quot;bookabledate&quot;, customFunc)</span><br><span class="line">	&#125;</span><br><span class="line">	r.GET(&quot;/bookable&quot;, testHandler)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func testHandler(c *gin.Context) &#123;</span><br><span class="line">	var b Booking</span><br><span class="line">	if err := c.ShouldBind(&amp;b); err != nil &#123;</span><br><span class="line">		c.JSON(500, gin.H&#123;&quot;error&quot;: err.Error()&#125;)</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(200, gin.H&#123;&quot;message&quot;: &quot;ok!&quot;, &quot;booking&quot;: b&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªæŠ¥é”™ï¼Œæˆ‘è‡ªå·±ä¹Ÿè¿˜æ²¡å¼„æ˜ç™½ï¼Œç„¶è€Œæˆ‘çœ‹äº†ä¸‹æºç ï¼Œä¸Šé¢çš„ä½¿ç”¨æ–¹æ³•æ˜¯æ­£ç¡®çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># command-line-arguments</span></span><br><span class="line">validCustom/validCustom.go:30:24: cannot use customFunc (<span class="built_in">type</span> func(*validator.Validate, reflect.Value, reflect.Value, reflect.Value, reflect.Typ</span><br><span class="line">e, reflect.Kind, string) bool) as <span class="built_in">type</span> validator.Func <span class="keyword">in</span> argument to v.RegisterValidation</span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// RegisterValidation adds a validation with the given tag</span><br><span class="line">//</span><br><span class="line">// NOTES:</span><br><span class="line">// - <span class="keyword">if</span> the key already exists, the previous validation <span class="keyword">function</span> will be replaced.</span><br><span class="line">// - this method is not thread-safe it is intended that these all be registered prior to any validation</span><br><span class="line">func (v *Validate) RegisterValidation(tag string, fn Func) error &#123;</span><br><span class="line">	<span class="built_in">return</span> v.RegisterValidationCtx(tag, wrapFunc(fn))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ”¯æŒå¤šè¯­è¨€é”™è¯¯ä¿¡æ¯"><a href="#æ”¯æŒå¤šè¯­è¨€é”™è¯¯ä¿¡æ¯" class="headerlink" title="æ”¯æŒå¤šè¯­è¨€é”™è¯¯ä¿¡æ¯"></a>æ”¯æŒå¤šè¯­è¨€é”™è¯¯ä¿¡æ¯</h3><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><ul>
<li>ä½¿ç”¨Ginä¸­é—´ä»¶</li>
<li>è‡ªå®šä¹‰<code>ipç™½åå•</code>ä¸­é—´ä»¶</li>
</ul>
<h3 id="Ginä¸­é—´ä»¶"><a href="#Ginä¸­é—´ä»¶" class="headerlink" title="Ginä¸­é—´ä»¶"></a>Ginä¸­é—´ä»¶</h3><p><code>Logger</code>æ—¥å¿—<br><code>Recovery</code>æ•è·panic</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	f, _ := os.Create(<span class="string">"gin.log"</span>)</span><br><span class="line">	gin.DefaultWriter = io.MultiWriter(f)</span><br><span class="line">	gin.DefaultErrorWriter = io.MultiWriter(f)</span><br><span class="line"></span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(gin.Logger(),gin.Recovery())</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		name := c.DefaultQuery(<span class="string">"name"</span>, <span class="string">"default_name"</span>)</span><br><span class="line">		c.String(200, <span class="string">"%s"</span>, name)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç™½åå•"><a href="#ç™½åå•" class="headerlink" title="ç™½åå•"></a>ç™½åå•</h3><p><code>r.User(IPAuthMiddleware())</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func IPAuthMiddleware() gin.HandlerFunc &#123;</span><br><span class="line">	<span class="built_in">return</span> func(c *gin.Context) &#123;</span><br><span class="line">		ipList := []string&#123;</span><br><span class="line">			<span class="string">"127.0.0.1"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">		flag := <span class="literal">false</span></span><br><span class="line">		clientIP := c.ClientIP()</span><br><span class="line">		<span class="keyword">for</span> _, host := range ipList &#123;</span><br><span class="line">			<span class="keyword">if</span> clientIP == host &#123;</span><br><span class="line">				flag = <span class="literal">true</span></span><br><span class="line">				<span class="built_in">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !flag &#123;</span><br><span class="line">			c.String(401, <span class="string">"%s,not in iplist"</span>, clientIP)</span><br><span class="line">			c.Abort()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.New()</span><br><span class="line">	r.Use(IPAuthMiddleware())</span><br><span class="line">	r.Use(gin.Logger(), gin.Recovery())</span><br><span class="line">	r.GET(<span class="string">"/test"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(200, <span class="string">"%s"</span>, <span class="string">"hello test"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Ginå»¶å±•"><a href="#Ginå»¶å±•" class="headerlink" title="Ginå»¶å±•"></a>Ginå»¶å±•</h2><ul>
<li>æœåŠ¡å™¨ä¼˜é›…å…³åœ</li>
<li>æ¨¡ç‰ˆæ¸²æŸ“</li>
<li>è‡ªåŠ¨è¯ä¹¦é…ç½®</li>
</ul>
<h3 id="æœåŠ¡å™¨å…³åœ"><a href="#æœåŠ¡å™¨å…³åœ" class="headerlink" title="æœåŠ¡å™¨å…³åœ"></a>æœåŠ¡å™¨å…³åœ</h3><p><img src="/2020/02/14/Gin%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/gin-server-stop.png" alt></p>
<h3 id="æ¨¡ç‰ˆæ¸²æŸ“"><a href="#æ¨¡ç‰ˆæ¸²æŸ“" class="headerlink" title="æ¨¡ç‰ˆæ¸²æŸ“"></a>æ¨¡ç‰ˆæ¸²æŸ“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.LoadHTMLGlob(<span class="string">"template/*"</span>)</span><br><span class="line">	r.GET(<span class="string">"/index"</span>, func(c *gin.Context) &#123;</span><br><span class="line">		c.HTML(200, <span class="string">"index.html"</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"index.html"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl -X GET  <span class="string">"http://127.0.0.1:8080/index"</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;h1&gt;</span><br><span class="line">        index.html</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">&lt;/html&gt;%                                                                        </span><br><span class="line">âœ  ~</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªåŠ¨è¯ä¹¦é…ç½®"><a href="#è‡ªåŠ¨è¯ä¹¦é…ç½®" class="headerlink" title="è‡ªåŠ¨è¯ä¹¦é…ç½®"></a>è‡ªåŠ¨è¯ä¹¦é…ç½®</h3><h2 id="è„šæ‰‹æ¶"><a href="#è„šæ‰‹æ¶" class="headerlink" title="è„šæ‰‹æ¶"></a>è„šæ‰‹æ¶</h2><p>é¡¹ç›®åœ°å€ï¼š<br><a href="https://github.com/e421083458/gin_scaffold" target="_blank" rel="noopener">gin_scaffold</a><br><a href="https://github.com/e421083458/golang_common" target="_blank" rel="noopener">golang_common</a><br><a href="https://github.com/e421083458/vue-admin" target="_blank" rel="noopener">vue-admin</a></p>
<h3 id="è½»é‡çº§Golangç±»åº“"><a href="#è½»é‡çº§Golangç±»åº“" class="headerlink" title="è½»é‡çº§Golangç±»åº“"></a>è½»é‡çº§Golangç±»åº“</h3><p>GORM:<a href="https://gorm.io/zh_CN/" target="_blank" rel="noopener">https://gorm.io/zh_CN/</a><br>redigo:<a href="https://godoc.org/github.com/gomodule/redigo/redis" target="_blank" rel="noopener">https://godoc.org/github.com/gomodule/redigo/redis</a></p>
<p>â”œâ”€â”€ README.md<br>â”œâ”€â”€ conf   é…ç½®æ–‡ä»¶å¤¹<br>â”‚   â””â”€â”€ dev<br>â”‚       â”œâ”€â”€ base.toml<br>â”‚       â”œâ”€â”€ mysql_map.toml<br>â”‚       â””â”€â”€ redis_map.toml<br>â”œâ”€â”€ controller æ§åˆ¶å™¨<br>â”‚   â””â”€â”€ demo.go<br>â”œâ”€â”€ dao DBæ•°æ®è®¿é—®å±‚<br>â”‚   â””â”€â”€ demo.go<br>â”œâ”€â”€ dto  Bindç»“æ„ä½“å±‚<br>â”‚   â””â”€â”€ demo.go<br>â”œâ”€â”€ gin_scaffold.inf.log  infoæ—¥å¿—<br>â”œâ”€â”€ gin_scaffold.wf.log warningæ—¥å¿—<br>â”œâ”€â”€ go.mod go moduleç®¡ç†æ–‡ä»¶<br>â”œâ”€â”€ go.sum<br>â”œâ”€â”€ main.go<br>â”œâ”€â”€ middleware ä¸­é—´ä»¶å±‚<br>â”‚   â”œâ”€â”€ panic.go<br>â”‚   â”œâ”€â”€ response.go<br>â”‚   â”œâ”€â”€ token_auth.go<br>â”‚   â””â”€â”€ translation.go<br>â”œâ”€â”€ public  å…¬å…±æ–‡ä»¶<br>â”‚   â”œâ”€â”€ log.go<br>â”‚   â”œâ”€â”€ mysql.go<br>â”‚   â””â”€â”€ validate.go<br>â”œâ”€â”€ router  è·¯ç”±å±‚<br>â”‚   â”œâ”€â”€ httpserver.go<br>â”‚   â””â”€â”€ route.go<br>â””â”€â”€ tmpl</p>
<h3 id="è¾“å‡ºæ ¼å¼ç»Ÿä¸€å°è£…"><a href="#è¾“å‡ºæ ¼å¼ç»Ÿä¸€å°è£…" class="headerlink" title="è¾“å‡ºæ ¼å¼ç»Ÿä¸€å°è£…"></a>è¾“å‡ºæ ¼å¼ç»Ÿä¸€å°è£…</h3><h3 id="è‡ªå®šä¹‰ä¸­é—´ä»¶æ—¥å¿—æ‰“å°"><a href="#è‡ªå®šä¹‰ä¸­é—´ä»¶æ—¥å¿—æ‰“å°" class="headerlink" title="è‡ªå®šä¹‰ä¸­é—´ä»¶æ—¥å¿—æ‰“å°"></a>è‡ªå®šä¹‰ä¸­é—´ä»¶æ—¥å¿—æ‰“å°</h3><h3 id="è¯·æ±‚æ•°æ®ç»‘å®šç»“æ„ä½“ä¸æ ¡éªŒ"><a href="#è¯·æ±‚æ•°æ®ç»‘å®šç»“æ„ä½“ä¸æ ¡éªŒ" class="headerlink" title="è¯·æ±‚æ•°æ®ç»‘å®šç»“æ„ä½“ä¸æ ¡éªŒ"></a>è¯·æ±‚æ•°æ®ç»‘å®šç»“æ„ä½“ä¸æ ¡éªŒ</h3>]]></content>
      <categories>
        <category>Gin</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Gin</tag>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>é€šè¿‡Dockerå®‰è£…RabbitMQ</title>
    <url>/2020/02/12/%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85RabbitMQ/</url>
    <content><![CDATA[<h3 id="RabbitMQå®‰è£…"><a href="#RabbitMQå®‰è£…" class="headerlink" title="RabbitMQå®‰è£…"></a>RabbitMQå®‰è£…</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /Users/samtake/Documents/GitHub/www/rabbitmqç›®å½•å¯è‡ªå®šä¹‰ï¼Œä¸»è¦ç”¨äºç›®å½•æŒ‚è½½</span></span><br><span class="line">âœ  ~ mkdir -p /Users/samtake/Documents/GitHub/www/rabbitmq</span><br><span class="line">âœ  ~ docker run -d --hostname rabbit-node1 --name rabbit-node1 -p 5672:5672 -p15672:15672 -v /Users/samtake/Documents/GitHub/www/rabbitmq:/var/lib/rabbitmq rabbitmq:management</span><br><span class="line">Unable to find image <span class="string">'rabbitmq:management'</span> locally</span><br><span class="line">management: Pulling from library/rabbitmq</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™æç¤º,æ‰‹åŠ¨æ·»åŠ ä¸€ä¸‹dockeråˆ†äº«ç›®å½•å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">The path /www/rabbitmq</span><br><span class="line">is not shared from OS X and is not known to Docker.</span><br><span class="line">You can configure shared paths from Docker -&gt; Preferences... -&gt; File Sharing.</span><br><span class="line">See https://docs.docker.com/docker-for-mac/osxfs/<span class="comment">#namespaces for more info.</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ docker ps | grep rabbit</span><br><span class="line">75d0ec6821fc        rabbitmq:management   <span class="string">"docker-entrypoint.sâ€¦"</span>   About a minute ago   Up About a minute   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp   rabbit-node1</span><br></pre></td></tr></table></figure>


<p>æµè§ˆå™¨æ‰“å¼€ç™»å½•rabbitmq, å…¥å£:<a href="http://localhost:15672" target="_blank" rel="noopener">http://localhost:15672</a><br>é»˜è®¤ç”¨æˆ·å: guest å¯†ç : guest</p>
<h3 id="RabbitMQçš„UIç•Œé¢ä½¿ç”¨æµ‹è¯•"><a href="#RabbitMQçš„UIç•Œé¢ä½¿ç”¨æµ‹è¯•" class="headerlink" title="RabbitMQçš„UIç•Œé¢ä½¿ç”¨æµ‹è¯•"></a>RabbitMQçš„UIç•Œé¢ä½¿ç”¨æµ‹è¯•</h3><h3 id="RabbitMQçš„å·¥ä½œåŸç†å’Œè½¬å‘æ¨¡å¼"><a href="#RabbitMQçš„å·¥ä½œåŸç†å’Œè½¬å‘æ¨¡å¼" class="headerlink" title="RabbitMQçš„å·¥ä½œåŸç†å’Œè½¬å‘æ¨¡å¼"></a>RabbitMQçš„å·¥ä½œåŸç†å’Œè½¬å‘æ¨¡å¼</h3><p><img src="/2020/02/12/%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85RabbitMQ/RabbitMQ%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png" alt></p>
<p>åè¯è§£æï¼š<br><code>exchange</code>:æ¶ˆæ¯äº¤æ¢æœºï¼Œå†³å®šæ¶ˆæ¯æŒ‰ä»€ä¹ˆè§„åˆ™ï¼Œè·¯ç”±åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚<br><code>queue</code>:æ¶ˆæ¯è½½ä½“ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æŠ•åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚<br><code>binding</code>:ç»‘å®šï¼ŒæŠŠexchangeå’ŒqueueæŒ‰ç…§è·¯ç”±è§„åˆ™ç»‘å®šèµ·æ¥ã€‚<br><code>routing key</code>:è·¯ç”±å…³é”®å­—ï¼Œexchangeæ ¹æ®è¿™å…³é”®å­—æ¥æŠ•é€’æ¶ˆæ¯ã€‚<br><code>channel</code>:æ¶ˆæ¯é€šé“ï¼Œå®¢æˆ·ç«¯çš„æ¯ä¸ªè¿æ¥å»ºç«‹å¤šä¸ªchannnelã€‚<br><code>producer</code>:æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œç”¨äºæŠ•é€’æ¶ˆæ¯çš„ç¨‹åºã€‚<br><code>consumer</code>:æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚</p>
<p>exchangeçš„å·¥ä½œæ¨¡å¼<br><code>fanout</code>:ç±»ä¼¼å¹¿æ’­ï¼Œè½¬å‘åˆ°æ‰€æœ‰ç»‘å®šäº¤æ¢æœºçš„queueã€‚<br><code>direct</code>:ç±»ä¼¼å•æ’­ï¼Œrouting key å’Œbingding keyå®Œç¾åŒ¹é…ã€‚<br><code>topic</code>:ç±»ä¼¼ç»„æ’­ï¼Œè½¬å‘åˆ°ç¬¦åˆé€šé…ç¬¦çš„queueã€‚<br><code>headers</code>:è¯·æ±‚å¤´ä¸æ¶ˆæ¯åŒ¹é…ï¼Œæ‰èƒ½æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p><img src="/2020/02/12/%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85RabbitMQ/fanout.png" alt></p>
<p><img src="/2020/02/12/%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85RabbitMQ/direct.png" alt></p>
<p><img src="/2020/02/12/%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85RabbitMQ/topic.jpeg" alt></p>
<h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><p>1.é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const (</span><br><span class="line">	// AsyncTransferEnable : æ˜¯å¦å¼€å¯æ–‡ä»¶å¼‚æ­¥è½¬ç§»(é»˜è®¤åŒæ­¥)</span><br><span class="line">	AsyncTransferEnable = <span class="literal">true</span></span><br><span class="line">	// RabbitURL : rabbitmqæœåŠ¡çš„å…¥å£url</span><br><span class="line">	RabbitURL = <span class="string">"amqp://guest:guest@127.0.0.1:5672/"</span></span><br><span class="line">	// TransExchangeName : ç”¨äºæ–‡ä»¶transferçš„äº¤æ¢æœº</span><br><span class="line">	TransExchangeName = <span class="string">"uploadserver.trans"</span></span><br><span class="line">	// TransOSSQueueName : ossè½¬ç§»é˜Ÿåˆ—å</span><br><span class="line">	TransOSSQueueName = <span class="string">"uploadserver.trans.oss"</span></span><br><span class="line">	// TransOSSErrQueueName : ossè½¬ç§»å¤±è´¥åå†™å…¥å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é˜Ÿåˆ—å</span><br><span class="line">	TransOSSErrQueueName = <span class="string">"uploadserver.trans.oss.err"</span></span><br><span class="line">	// TransOSSRoutingKey : routingkey</span><br><span class="line">	TransOSSRoutingKey = <span class="string">"oss"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<p>2.ç”Ÿäº§è€…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">init</span></span>() &#123;</span><br><span class="line">	// æ˜¯å¦å¼€å¯å¼‚æ­¥è½¬ç§»åŠŸèƒ½ï¼Œå¼€å¯æ—¶æ‰åˆå§‹åŒ–rabbitMQè¿æ¥</span><br><span class="line">	<span class="keyword">if</span> !config.AsyncTransferEnable &#123;</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="function"><span class="title">initChannel</span></span>() &#123;</span><br><span class="line">		channel.NotifyClose(notifyClose)</span><br><span class="line">	&#125;</span><br><span class="line">	// æ–­çº¿è‡ªåŠ¨é‡è¿</span><br><span class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			select &#123;</span><br><span class="line">			<span class="keyword">case</span> msg := &lt;-notifyClose:</span><br><span class="line">				conn = nil</span><br><span class="line">				channel = nil</span><br><span class="line">				log.Printf(<span class="string">"onNotifyChannelClosed: %+v\n"</span>, msg)</span><br><span class="line">				initChannel()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func initChannel() bool &#123;</span><br><span class="line">	//1.åˆ¤æ–­channelæ˜¯å¦å·²ç»åˆ›å»º</span><br><span class="line">	<span class="keyword">if</span> channel != nil &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//2.è·å¾—rabbitMQçš„ä¸€ä¸ªè¿æ¥</span><br><span class="line">	conn, err := amqp.Dial(config.RabbitURL)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//3.æ‰“å¼€ä¸€ä¸ªchannelï¼Œç”¨äºæ¶ˆæ¯çš„å‘å¸ƒä¸æ¥æ”¶ç­‰</span><br><span class="line">	channel, err = conn.Channel()</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Publish : å‘å¸ƒæ¶ˆæ¯</span><br><span class="line">func Publish(exchange, routingKey string, msg []byte) bool &#123;</span><br><span class="line">	//1.åˆ¤æ–­channelæ˜¯å¦æ­£å¸¸</span><br><span class="line">	<span class="keyword">if</span> !<span class="function"><span class="title">initChannel</span></span>() &#123;</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//2.æ‰§è¡Œæ¶ˆæ¯å‘å¸ƒ</span><br><span class="line">	err := channel.Publish(</span><br><span class="line">		exchange,</span><br><span class="line">		routingKey,</span><br><span class="line">		<span class="literal">false</span>, // å¦‚æœæ²¡æœ‰å¯¹åº”çš„queue, å°±ä¼šä¸¢å¼ƒè¿™æ¡æ¶ˆæ¯</span><br><span class="line">		<span class="literal">false</span>, //</span><br><span class="line">		amqp.Publishing&#123;</span><br><span class="line">			ContentType: <span class="string">"text/plain"</span>, //æ˜æ–‡ç¼–ç </span><br><span class="line">			Body:        msg,</span><br><span class="line">		&#125;,</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Println(err.Error())</span><br><span class="line">		<span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>3.æ¶ˆè´¹è€…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var <span class="keyword">done</span> chan bool</span><br><span class="line"></span><br><span class="line">// StartConsume : å¼€å§‹ç›‘å¬é˜Ÿåˆ—ï¼Œè·å–æ¶ˆæ¯</span><br><span class="line">func StartConsume(qName, cName string, callback func(msg []byte) bool) &#123;</span><br><span class="line">	//1.é€šè¿‡channel.Consumeè·å¾—æ¶ˆæ¯ä¿¡é“</span><br><span class="line">	msgs, err := channel.Consume(</span><br><span class="line">		qName,</span><br><span class="line">		cName,</span><br><span class="line">		<span class="literal">true</span>,  //è‡ªåŠ¨åº”ç­”</span><br><span class="line">		<span class="literal">false</span>, // éå”¯ä¸€çš„æ¶ˆè´¹è€…</span><br><span class="line">		<span class="literal">false</span>, // rabbitMQåªèƒ½è®¾ç½®ä¸º<span class="literal">false</span></span><br><span class="line">		<span class="literal">false</span>, // noWait, <span class="literal">false</span>è¡¨ç¤ºä¼šé˜»å¡ç›´åˆ°æœ‰æ¶ˆæ¯è¿‡æ¥</span><br><span class="line">		nil)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="built_in">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">done</span> = make(chan bool)</span><br><span class="line"></span><br><span class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line">		// 2.å¾ªç¯è¯»å–channelçš„æ•°æ®</span><br><span class="line">		<span class="keyword">for</span> d := range msgs &#123;</span><br><span class="line">			//3.è°ƒç”¨callbackæ–¹æ³•æ¥å¤„ç†æ–°çš„æ¶ˆæ¯</span><br><span class="line">			processErr := callback(d.Body)</span><br><span class="line">			<span class="keyword">if</span> processErr &#123;</span><br><span class="line">				// TODO: å°†ä»»åŠ¡å†™å…¥å¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨äºå¼‚å¸¸æƒ…å†µçš„é‡è¯•</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	// æ¥æ”¶<span class="keyword">done</span>çš„ä¿¡å·, æ²¡æœ‰ä¿¡æ¯è¿‡æ¥åˆ™ä¼šä¸€ç›´é˜»å¡ï¼Œé¿å…è¯¥å‡½æ•°é€€å‡º</span><br><span class="line">	&lt;-<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">	// å…³é—­é€šé“</span><br><span class="line">	channel.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// StopConsume : åœæ­¢ç›‘å¬é˜Ÿåˆ—</span><br><span class="line">func <span class="function"><span class="title">StopConsume</span></span>() &#123;</span><br><span class="line">	<span class="keyword">done</span> &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><a href="https://github.com/samtake/goRedisDemo" target="_blank" rel="noopener">demo</a></p>
]]></content>
      <categories>
        <category>RabbitMQ</category>
      </categories>
      <tags>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>Rediså…¥é—¨</title>
    <url>/2020/02/12/Redis%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h3 id="Docker-å®‰è£…-Redis"><a href="#Docker-å®‰è£…-Redis" class="headerlink" title="Docker å®‰è£… Redis"></a>Docker å®‰è£… Redis</h3><p><code>docker pull redis:latest</code><br>å–æœ€æ–°ç‰ˆçš„ Redis é•œåƒ</p>
<p><code>docker images</code><br>æŸ¥çœ‹æ˜¯å¦å·²å®‰è£…äº† redis</p>
<p>è¿è¡Œ redis å®¹å™¨<br><code>docker run -itd --name redis-test -p 6379:6379 redis</code><br>æˆ–è€…è¿è¡Œrediså¹¶è®¾ç½®å¯†ç <br><code>docker run -d --name myredis -p 6379:6379 redis --requirepass &quot;mypassword&quot;</code></p>
<p>å…¶ä¸­-p 6379:6379ï¼šæ˜ å°„å®¹å™¨æœåŠ¡çš„ 6379 ç«¯å£åˆ°å®¿ä¸»æœºçš„ 6379 ç«¯å£ã€‚å¤–éƒ¨å¯ä»¥ç›´æ¥é€šè¿‡å®¿ä¸»æœºip:6379 è®¿é—®åˆ° Redis çš„æœåŠ¡ã€‚</p>
<p><code>docker ps</code> æŸ¥çœ‹å®¹å™¨çš„è¿è¡Œä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  Desktop docker ps </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                               NAMES</span><br><span class="line">d1f67d1e5fda        redis               <span class="string">"docker-entrypoint.sâ€¦"</span>   About a minute ago   Up About a minute   0.0.0.0:6379-&gt;6379/tcp              redis-test</span><br><span class="line">0eee2c1708be        mysql:5.7           <span class="string">"docker-entrypoint.sâ€¦"</span>   8 hours ago          Up 8 hours          0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   happy_chandrasekhar</span><br></pre></td></tr></table></figure>


<p>æœ€åï¼Œé€šè¿‡è¿‡ redis-cli è¿æ¥æµ‹è¯•ä½¿ç”¨ redis æœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  Desktop docker <span class="built_in">exec</span> -it redis-test /bin/bash</span><br><span class="line">root@d1f67d1e5fda:/data<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> <span class="built_in">test</span> 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>



<h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>å¯ä»¥å­˜å‚¨çš„å€¼</th>
<th>æ“ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td>STRING</td>
<td>å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°</td>
<td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œï¼›å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢æˆ–è€…è‡ªå‡æ“ä½œï¼›</td>
</tr>
<tr>
<td>LIST</td>
<td>åˆ—è¡¨</td>
<td>ä»ä¸¤ç«¯å‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ ï¼›è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼›è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ ï¼›</td>
</tr>
<tr>
<td>SET</td>
<td>æ— åºé›†åˆ</td>
<td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼›è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼›ä»é›†åˆé‡Œé¢éšæœºè·å–å…ƒç´ ï¼›</td>
</tr>
<tr>
<td>HASH</td>
<td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td>
<td>æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªé”®å€¼å¯¹ï¼›è·å–æ‰€æœ‰é”®å€¼å¯¹ï¼›æ£€æŸ¥æŸä¸ªå¥æ˜¯å¦å­˜åœ¨ï¼›</td>
</tr>
<tr>
<td>ZSET</td>
<td>æœ‰åºé›†åˆ</td>
<td>æ·»åŠ ã€è·å–ã€åˆ é™¤å…ƒç´ ï¼›æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ ï¼›è®¡ç®—ä¸€ä¸ªé”®çš„æ’åï¼›</td>
</tr>
</tbody></table>
<h4 id="STRING"><a href="#STRING" class="headerlink" title="STRING"></a>STRING</h4><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¡Œä¸º</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>è·å–å­˜å‚¨åœ¨ç»™å®šå¥ä¸­çš„å€¼</td>
</tr>
<tr>
<td>SET</td>
<td>è®¾ç½®å­˜å‚¨åœ¨ç»™å®šå¥ä¸­çš„å€¼</td>
</tr>
<tr>
<td>DEL</td>
<td>åˆ é™¤å­˜å‚¨åœ¨ç»™å®šå¥ä¸­çš„å€¼ï¼ˆè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨äºæ‰€æœ‰ç±»å‹ï¼‰</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name longshan</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">"longshan"</span></span><br><span class="line">127.0.0.1:6379&gt; del name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>


<h4 id="LIST"><a href="#LIST" class="headerlink" title="LIST"></a>LIST</h4><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¡Œä¸º</th>
</tr>
</thead>
<tbody><tr>
<td>rpush</td>
<td>è·å–å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼</td>
</tr>
<tr>
<td>lrange</td>
<td>è®¾ç½®å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼</td>
</tr>
<tr>
<td>lindex</td>
<td>åˆ é™¤å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼ï¼ˆè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨äºæ‰€æœ‰ç±»å‹ï¼‰</td>
</tr>
<tr>
<td>lpop</td>
<td>åˆ é™¤å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼ï¼ˆè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨äºæ‰€æœ‰ç±»å‹ï¼‰</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange list 0-1</span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">'lrange'</span> <span class="built_in">command</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">"item1"</span></span><br><span class="line">2) <span class="string">"item2"</span></span><br><span class="line">3) <span class="string">"item3"</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 1</span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">'lrange'</span> <span class="built_in">command</span></span><br><span class="line">127.0.0.1:6379&gt; lindex list 1</span><br><span class="line"><span class="string">"item2"</span></span><br><span class="line">127.0.0.1:6379&gt; lpop list</span><br><span class="line"><span class="string">"item1"</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">"item2"</span></span><br><span class="line">2) <span class="string">"item3"</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>



<h4 id="SET"><a href="#SET" class="headerlink" title="SET"></a>SET</h4><p>å‘½ä»¤    | è¡Œä¸º<br>-|-|-<br>sadd    | æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ°é›†åˆé‡Œ<br>smembers |    è·å–é›†åˆé‡Œé¢çš„æ‰€æœ‰å…ƒç´ <br>sismember |    ç¡®å®šä¸€ä¸ªç»™å®šçš„å€¼æ˜¯ä¸€ä¸ªé›†åˆçš„æˆå‘˜<br>srem    | ä»é›†åˆé‡Œåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd <span class="built_in">set</span> item1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd <span class="built_in">set</span> item2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd <span class="built_in">set</span> item3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd <span class="built_in">set</span> item3</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; smember <span class="built_in">set</span></span><br><span class="line">(error) ERR unknown <span class="built_in">command</span> `smember`, with args beginning with: `<span class="built_in">set</span>`, </span><br><span class="line">127.0.0.1:6379&gt; smembers <span class="built_in">set</span></span><br><span class="line">1) <span class="string">"item3"</span></span><br><span class="line">2) <span class="string">"item1"</span></span><br><span class="line">3) <span class="string">"item2"</span></span><br><span class="line">127.0.0.1:6379&gt; sismember <span class="built_in">set</span> item5</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; srem <span class="built_in">set</span> item2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; srem <span class="built_in">set</span> item2</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; smenbers <span class="built_in">set</span></span><br><span class="line">(error) ERR unknown <span class="built_in">command</span> `smenbers`, with args beginning with: `<span class="built_in">set</span>`, </span><br><span class="line">127.0.0.1:6379&gt; smembers <span class="built_in">set</span></span><br><span class="line">1) <span class="string">"item3"</span></span><br><span class="line">2) <span class="string">"item1"</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>


<h4 id="HASH"><a href="#HASH" class="headerlink" title="HASH"></a>HASH</h4><p>å‘½ä»¤    | è¡Œä¸º<br>-|-|-<br>hset    | è®¾ç½® hash é‡Œé¢ä¸€ä¸ªå­—æ®µçš„å€¼<br>hget    | è·å– hash ä¸­åŸŸçš„å€¼<br>hgetall    | ä» hash ä¸­è¯»å–å…¨éƒ¨çš„åŸŸå’Œå€¼<br>hdel    | åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸ</p>
<h4 id="ZSET"><a href="#ZSET" class="headerlink" title="ZSET"></a>ZSET</h4><p>å‘½ä»¤    | è¡Œä¸º<br>-|-|-<br>ZADD    | æ·»åŠ åˆ°æœ‰åº set çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–æ›´æ–°çš„åˆ†æ•°ï¼Œå¦‚æœå®ƒå·²ç»å­˜åœ¨<br>ZRANGE    | æ ¹æ®æŒ‡å®šçš„ index è¿”å›ï¼Œè¿”å› sorted set çš„æˆå‘˜åˆ—è¡¨<br>ZRANGEBYSCORE    | è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜ï¼Œåˆ†æ•°ç”±ä½åˆ°é«˜æ’åºã€‚<br>ZREM    | ä»æ’åºçš„é›†åˆä¸­åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</p>
<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul>
<li><p>ç¼“å­˜ - å°†çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œè®¾ç½®å†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ä»¥åŠè¿‡æœŸæ·˜æ±°ç­–ç•¥æ¥ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚</p>
</li>
<li><p>è®¡æ•°å™¨ - Redis è¿™ç§å†…å­˜æ•°æ®åº“èƒ½æ”¯æŒè®¡æ•°å™¨é¢‘ç¹çš„è¯»å†™æ“ä½œã€‚</p>
</li>
<li><p>åº”ç”¨é™æµ - é™åˆ¶ä¸€ä¸ªç½‘ç«™è®¿é—®æµé‡ã€‚</p>
</li>
<li><p>æ¶ˆæ¯é˜Ÿåˆ— - ä½¿ç”¨ List æ•°æ®ç±»å‹ï¼Œå®ƒæ˜¯åŒå‘é“¾è¡¨ã€‚</p>
</li>
<li><p>æŸ¥æ‰¾è¡¨ - ä½¿ç”¨ HASH æ•°æ®ç±»å‹ã€‚</p>
</li>
<li><p>äº¤é›†è¿ç®— - ä½¿ç”¨ SET ç±»å‹ï¼Œä¾‹å¦‚æ±‚ä¸¤ä¸ªç”¨æˆ·çš„å…±åŒå¥½å‹ã€‚</p>
</li>
<li><p>æ’è¡Œæ¦œ - ä½¿ç”¨ ZSET æ•°æ®ç±»å‹ã€‚</p>
</li>
<li><p>åˆ†å¸ƒå¼ Session - å¤šä¸ªåº”ç”¨æœåŠ¡å™¨çš„ Session éƒ½å­˜å‚¨åˆ° Redis ä¸­æ¥ä¿è¯ Session çš„ä¸€è‡´æ€§ã€‚</p>
</li>
<li><p>åˆ†å¸ƒå¼é” - é™¤äº†å¯ä»¥ä½¿ç”¨ SETNX å®ç°åˆ†å¸ƒå¼é”ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ RedLock åˆ†å¸ƒå¼é”å®ç°ã€‚</p>
</li>
</ul>
<h3 id="é€šè¿‡goè¯­è¨€ä½¿ç”¨Redis"><a href="#é€šè¿‡goè¯­è¨€ä½¿ç”¨Redis" class="headerlink" title="é€šè¿‡goè¯­è¨€ä½¿ç”¨Redis"></a>é€šè¿‡goè¯­è¨€ä½¿ç”¨Redis</h3><p>1.è®¾ç½®ä¸€ä¸‹Rediså¯†ç ç„¶åæµ‹è¯•è¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  egoshop docker rm -f cd93e4361dff                                                 </span><br><span class="line">cd93e4361dff</span><br><span class="line"></span><br><span class="line">âœ  egoshop docker run -d --name myredis -p 6379:6379 redis --requirepass <span class="string">"mypassword"</span></span><br><span class="line">f21ed92618bc5a48a95a05fcf73d1fb911b3020616dfd4950b4827dc9559814e</span><br><span class="line">âœ  egoshop docker ps                                                                 </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">f21ed92618bc        redis               <span class="string">"docker-entrypoint.sâ€¦"</span>   3 seconds ago       Up 1 second         0.0.0.0:6379-&gt;6379/tcp              myredis</span><br><span class="line">0eee2c1708be        mysql:5.7           <span class="string">"docker-entrypoint.sâ€¦"</span>   10 hours ago        Up 10 hours         0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   happy_chandrasekhar</span><br><span class="line">âœ  egoshop docker <span class="built_in">exec</span> -it myredis /bin/bash</span><br><span class="line">root@f21ed92618bc:/data<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; auth <span class="string">"mypassword"</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>2.åˆ›å»ºè¿æ¥æ± </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func newRedisPool() *redis.Pool &#123;</span><br><span class="line">	<span class="built_in">return</span> &amp;redis.Pool&#123;</span><br><span class="line">		MaxIdle:     50,</span><br><span class="line">		MaxActive:   30,</span><br><span class="line">		IdleTimeout: 300 * time.Second,</span><br><span class="line">		Dial: func() (redis.Conn, error) &#123;</span><br><span class="line">			// 1. æ‰“å¼€è¿æ¥</span><br><span class="line">			c, err := redis.Dial(<span class="string">"tcp"</span>, redisHost)</span><br><span class="line">			<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">				fmt.Println(err)</span><br><span class="line">				<span class="built_in">return</span> nil, err</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			// 2. è®¿é—®è®¤è¯</span><br><span class="line">			<span class="keyword">if</span> _, err = c.Do(<span class="string">"AUTH"</span>, redisPass); err != nil &#123;</span><br><span class="line">				c.Close()</span><br><span class="line">				<span class="built_in">return</span> nil, err</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">return</span> c, nil</span><br><span class="line">		&#125;,</span><br><span class="line">		TestOnBorrow: func(conn redis.Conn, t time.Time) error &#123;</span><br><span class="line">			<span class="keyword">if</span> time.Since(t) &lt; time.Minute &#123;</span><br><span class="line">				<span class="built_in">return</span> nil</span><br><span class="line">			&#125;</span><br><span class="line">			_, err := conn.Do(<span class="string">"PING"</span>)</span><br><span class="line">			<span class="built_in">return</span> err</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">init</span></span>() &#123;</span><br><span class="line">	pool = newRedisPool()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func RedisPool() *redis.Pool &#123;</span><br><span class="line">	<span class="built_in">return</span> pool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.æ·»åŠ æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func <span class="function"><span class="title">UploadHandler</span></span>() &#123;</span><br><span class="line">	// è·å¾—redisçš„ä¸€ä¸ªè¿æ¥</span><br><span class="line">	rConn := rPool.RedisPool().Get()</span><br><span class="line">	defer rConn.Close()</span><br><span class="line"></span><br><span class="line">	// å°†åˆä¿¡æ¯å†™å…¥åˆ°redisç¼“å­˜</span><br><span class="line">	rConn.Do(<span class="string">"sadd"</span>, <span class="string">"set"</span>, <span class="string">"uploadHandler"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.æŸ¥çœ‹æ˜¯å¦æœ‰æ·»åŠ æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers <span class="built_in">set</span></span><br><span class="line">1) <span class="string">"upload1"</span></span><br><span class="line">2) <span class="string">"uploadHandler"</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/samtake/goRedisDemo" target="_blank" rel="noopener">å…·ä½“demoæºç </a></p>
<p>å‚è€ƒèµ„æ–™<br><a href="https://www.runoob.com/redis/redis-intro.html" target="_blank" rel="noopener">Redis ç®€ä»‹</a><br><a href="https://www.runoob.com/docker/docker-install-redis.html" target="_blank" rel="noopener">Docker å®‰è£… Redis</a><br><a href="https://mp.weixin.qq.com/s?src=11&timestamp=1581497616&ver=2153&signature=wJL6PdenqSUgK7dgiXas*bbrDcJzwBzrYoKKYFFfsxW*dYcRnVHqpFKbcYqLDd-bp7DY50iIvxGq8jNMAbQXau-uLB0hPqUJc4erX3MDhbuOrvvtCbw7KY3147aW3KBr&new=1" target="_blank" rel="noopener">Redis å…¥é—¨æŒ‡å—</a></p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Navicatä½¿ç”¨èµ„æ–™</title>
    <url>/2020/02/12/Navicat%E4%BD%BF%E7%94%A8%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<p>å®æ“ä¸€ä¸‹</p>
<p>é€šè¿‡dockeræ¥å¯åŠ¨ä¸€ä¸ªmysqlå®¹å™¨åº”ç”¨<br><code>docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7</code></p>
<h3 id="é€šè¿‡docker-exec-it-å®¹å™¨id-bash-æ¥æ“ä½œmysql"><a href="#é€šè¿‡docker-exec-it-å®¹å™¨id-bash-æ¥æ“ä½œmysql" class="headerlink" title="é€šè¿‡docker exec -it å®¹å™¨id bash æ¥æ“ä½œmysql"></a>é€šè¿‡docker exec -it å®¹å™¨id bash æ¥æ“ä½œmysql</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  blogs docker ps                      </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">0eee2c1708be        mysql:5.7           <span class="string">"docker-entrypoint.sâ€¦"</span>   41 minutes ago      Up 41 minutes       0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   happy_chandrasekhar</span><br><span class="line">âœ  blogs docker <span class="built_in">exec</span> -it  0eee2c1708be bash            </span><br><span class="line">root@0eee2c1708be:/<span class="comment"># mysql -uroot -p</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 765627</span><br><span class="line">Server version: 5.7.29 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; status;</span><br><span class="line">--------------</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.29, <span class="keyword">for</span> Linux (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">Connection id:		765627</span><br><span class="line">Current database:	</span><br><span class="line">Current user:		root@localhost</span><br><span class="line">SSL:			Not <span class="keyword">in</span> use</span><br><span class="line">Current pager:		stdout</span><br><span class="line">Using outfile:		<span class="string">''</span></span><br><span class="line">Using delimiter:	;</span><br><span class="line">Server version:		5.7.29 MySQL Community Server (GPL)</span><br><span class="line">Protocol version:	10</span><br><span class="line">Connection:		Localhost via UNIX socket</span><br><span class="line">Server characterset:	latin1</span><br><span class="line">Db     characterset:	latin1</span><br><span class="line">Client characterset:	latin1</span><br><span class="line">Conn.  characterset:	latin1</span><br><span class="line">UNIX socket:		/var/run/mysqld/mysqld.sock</span><br><span class="line">Uptime:			1 hour 2 min 0 sec</span><br><span class="line"></span><br><span class="line">Threads: 2  Questions: 6  Slow queries: 0  Opens: 105  Flush tables: 1  Open tables: 98  Queries per second avg: 0.001</span><br><span class="line">--------------</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>


<h3 id="åœ¨navicatä¸­ä½¿ç”¨sqlè¯­å¥åˆ›å»ºè¡¨"><a href="#åœ¨navicatä¸­ä½¿ç”¨sqlè¯­å¥åˆ›å»ºè¡¨" class="headerlink" title="åœ¨navicatä¸­ä½¿ç”¨sqlè¯­å¥åˆ›å»ºè¡¨"></a>åœ¨navicatä¸­ä½¿ç”¨sqlè¯­å¥åˆ›å»ºè¡¨</h3><p>1.è¿›è¡Œå‘½ä»¤è¡Œæ“ä½œ</p>
<p><img src="/2020/02/12/Navicat%E4%BD%BF%E7%94%A8%E8%B5%84%E6%96%99/navicate-console.jpeg" alt></p>
<p>2.è¾“å…¥mysql<br><img src="/2020/02/12/Navicat%E4%BD%BF%E7%94%A8%E8%B5%84%E6%96%99/navicate-soule-mysql.png" alt></p>
<p>3.å³é”®refreshä¸€ä¸‹å³å¯è§åˆ°åˆšæ‰æ–°å»ºçš„è¡¨tbl_user<br><img src="/2020/02/12/Navicat%E4%BD%BF%E7%94%A8%E8%B5%84%E6%96%99/tbl_user.png" alt></p>
<h3 id="é€šè¿‡navicatè¿æ¥MySQL"><a href="#é€šè¿‡navicatè¿æ¥MySQL" class="headerlink" title="é€šè¿‡navicatè¿æ¥MySQL"></a>é€šè¿‡navicatè¿æ¥MySQL</h3><p>åˆ›å»ºæ•°æ®åº“æ—¶ï¼Œä¸€èˆ¬å­—ç¬¦é›†é€‰æ‹©utf8ï¼Œæ’åºè§„åˆ™é€‰æ‹©utf8_general_ci </p>
<p><a href="https://zhuanlan.zhihu.com/p/44348694" target="_blank" rel="noopener">åœ¨Navicatä¸­å¦‚ä½•æ–°å»ºæ•°æ®åº“å’Œè¡¨å¹¶åšæŸ¥è¯¢</a><br><a href="https://www.navicat.com.cn/manual/online_manual/cn/navicat/win_manual/index.html#/about_0" target="_blank" rel="noopener">Navicatä½¿ç”¨æ‰‹å†Œ</a> </p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸­é€šè¿‡Dockerå®‰è£…é…ç½®MySQLä¸»ä»èŠ‚ç‚¹</title>
    <url>/2020/02/09/Ubuntu%E4%B8%AD%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEMySQL%E4%B8%BB%E4%BB%8E%E8%8A%82%E7%82%B9/</url>
    <content><![CDATA[<h3 id="1-æ‹‰å–MySQL5-7é•œåƒåˆ°æœ¬åœ°"><a href="#1-æ‹‰å–MySQL5-7é•œåƒåˆ°æœ¬åœ°" class="headerlink" title="1.æ‹‰å–MySQL5.7é•œåƒåˆ°æœ¬åœ°"></a>1.æ‹‰å–MySQL5.7é•œåƒåˆ°æœ¬åœ°</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä½ åªéœ€è¦è·‘ä¸€ä¸ªmysqlå®ä¾‹ï¼Œä¸åšä¸»ä»ï¼Œé‚£ä¹ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼Œä¸ç”¨å†åšåé¢çš„å‚è€ƒæ­¥éª¤: docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7 </span></span><br><span class="line"><span class="comment"># ç„¶åç”¨shellæˆ–å®¢æˆ·ç«¯è½¯ä»¶é€šè¿‡é…ç½®( ç”¨æˆ·å:root å¯†ç :132456 IP:ä½ çš„æœ¬æœºip ç«¯å£:3306)æ¥ç™»å½•å³å¯</span></span><br></pre></td></tr></table></figure>

<h3 id="2-å‡†å¤‡MySQLçš„é…ç½®æ–‡ä»¶"><a href="#2-å‡†å¤‡MySQLçš„é…ç½®æ–‡ä»¶" class="headerlink" title="2.å‡†å¤‡MySQLçš„é…ç½®æ–‡ä»¶"></a>2.å‡†å¤‡MySQLçš„é…ç½®æ–‡ä»¶</h3><p>MySQL5.7å®‰è£…ä¹‹åçš„é»˜è®¤é…ç½®æ–‡ä»¶åœ¨/etc/mysql/my.cnfï¼Œè€Œè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ä¸€èˆ¬æ”¾åœ¨/etc/mysql/config.dè¿™ä¸ªè·¯å¾„ä¸‹ã€‚<br>åœ¨æœ¬åœ°hostä¸»æœºä¸Šè‡ªå®šä¹‰çš„æŸä¸ªç›®å½•ä¸‹ï¼ˆå¦‚/data/mysql/conf/ï¼‰ï¼Œå…ˆåˆ›å»ºä¸¤ä¸ªæ–‡ä»¶master.confå’Œslave.confï¼Œåˆ†åˆ«ç”¨äºé…ç½®ä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹ã€‚</p>
<ul>
<li>/data/mysql/conf/master.conf<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[client] </span><br><span class="line">default-character-set=utf8 </span><br><span class="line">[mysql] </span><br><span class="line">default-character-set=utf8 </span><br><span class="line">[mysqld] </span><br><span class="line">log_bin = <span class="built_in">log</span> <span class="comment">#å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œç”¨äºä»èŠ‚ç‚¹çš„å†å²å¤åˆ¶å›æ”¾ </span></span><br><span class="line">collation-server = utf8_unicode_ci </span><br><span class="line">init-connect=<span class="string">'SET NAMES utf8'</span> </span><br><span class="line">character-set-server = utf8 </span><br><span class="line">server_id = 1 <span class="comment">#éœ€ä¿è¯ä¸»åº“å’Œä»åº“çš„server_idä¸åŒï¼Œ å‡è®¾ä¸»åº“è®¾ä¸º1 </span></span><br><span class="line">replicate-do-db=fileserver <span class="comment">#éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼Œéœ€å¤åˆ¶å¤šä¸ªæ•°æ®åº“çš„è¯åˆ™é‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>/data/mysql/conf/slave.conf<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[client] </span><br><span class="line">default-character-set=utf8 </span><br><span class="line">[mysql] </span><br><span class="line">default-character-set=utf8 </span><br><span class="line">[mysqld] </span><br><span class="line">log_bin = <span class="built_in">log</span> <span class="comment">#å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œç”¨äºä»èŠ‚ç‚¹çš„å†å²å¤åˆ¶å›æ”¾ </span></span><br><span class="line">collation-server = utf8_unicode_ci </span><br><span class="line">init-connect=<span class="string">'SET NAMES utf8'</span> </span><br><span class="line">character-set-server = utf8 </span><br><span class="line">server_id = 2 <span class="comment">#éœ€ä¿è¯ä¸»åº“å’Œä»åº“çš„server_idä¸åŒï¼Œ å‡è®¾ä»åº“è®¾ä¸º2 </span></span><br><span class="line">replicate-do-db=fileserver <span class="comment">#éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼Œéœ€å¤åˆ¶å¤šä¸ªæ•°æ®åº“çš„è¯åˆ™é‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="3-Dockeråˆ†åˆ«è¿è¡ŒMySQLä¸»-ä»ä¸¤ä¸ªå®¹å™¨"><a href="#3-Dockeråˆ†åˆ«è¿è¡ŒMySQLä¸»-ä»ä¸¤ä¸ªå®¹å™¨" class="headerlink" title="3. Dockeråˆ†åˆ«è¿è¡ŒMySQLä¸»/ä»ä¸¤ä¸ªå®¹å™¨"></a>3. Dockeråˆ†åˆ«è¿è¡ŒMySQLä¸»/ä»ä¸¤ä¸ªå®¹å™¨</h3><p>å°†mysqlä¸»èŠ‚ç‚¹è¿è¡Œèµ·æ¥ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/mysql/datam </span><br><span class="line">docker run -d --name mysql-master -p 13306:3306 -v /data/mysql/conf/master.conf:/etc/mysql/mysql.conf.d/mysqld.cnf -v /data/mysql/datam:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œå‚æ•°è¯´æ˜:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">â€“name mysql-master: å®¹å™¨çš„åç§°è®¾ä¸ºmysql-master </span><br><span class="line">-p 13306:3306: å°†hostçš„13306ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„3306ç«¯å£ </span><br><span class="line">-v /data/mysql/conf/master.conf:/etc/mysql/mysql.conf.d/mysqld.cnf ï¼š master.confé…ç½®æ–‡ä»¶æŒ‚è½½ </span><br><span class="line">-v /data/mysql/datam:/var/lib/mysql ï¼š mysqlå®¹å™¨å†…æ•°æ®æŒ‚è½½åˆ°hostçš„/data/mysql/datamï¼Œ ç”¨äºæŒä¹…åŒ– </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 : mysqlçš„rootç™»å½•å¯†ç ä¸º123456</span><br></pre></td></tr></table></figure>

<p> å°†mysqlä»èŠ‚ç‚¹è¿è¡Œèµ·æ¥<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/mysql/datas </span><br><span class="line">docker run -d --name mysql-slave -p 13307:3306 -v /data/mysql/conf/slave.conf:/etc/mysql/mysql.conf.d/mysqld.cnf -v /data/mysql/datas:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7</span><br></pre></td></tr></table></figure></p>
<p> è¿è¡Œå‚æ•°è¯´æ˜: </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">â€“name mysql-slave: å®¹å™¨çš„åç§°è®¾ä¸ºmysql-slave </span><br><span class="line">-p 13307:3306: å°†hostçš„13307ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„3306ç«¯å£ </span><br><span class="line">-v /data/mysql/conf/master.conf:/etc/mysql/mysql.conf.d/mysqld.cnf ï¼š master.confé…ç½®æ–‡ä»¶æŒ‚è½½</span><br><span class="line">-v /data/mysql/datam:/var/lib/mysql ï¼š mysqlå®¹å™¨å†…æ•°æ®æŒ‚è½½åˆ°hostçš„/data/mysql/datamï¼Œ ç”¨äºæŒä¹…åŒ– </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 : mysqlçš„rootç™»å½•å¯†ç ä¸º123456</span><br></pre></td></tr></table></figure>

<h3 id="4-ç™»å½•MySQLä¸»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯"><a href="#4-ç™»å½•MySQLä¸»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯" class="headerlink" title="4.ç™»å½•MySQLä¸»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯"></a>4.ç™»å½•MySQLä¸»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯</h3><p>å®¿ä¸»æœºå®‰è£…mysqlå®¢æˆ·ç«¯ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -y mysql-client</span><br></pre></td></tr></table></figure>

<p>ç™»å½•mysql </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 192.168.1.xx æ˜¯ä½ æœ¬æœºçš„å†…ç½‘ip </span></span><br><span class="line">mysql -u root -h 192.168.1.xx -P13306 -p123456</span><br></pre></td></tr></table></figure>

<p>åœ¨mysql clientä¸­æ‰§è¡Œ (åˆ›å»ºç”¨äºè®¿é—®ä¸»èŠ‚ç‚¹æ¥åŒæ­¥æ•°æ®çš„å¸å·) </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; create user slave identified by <span class="string">'slave'</span>; </span><br><span class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO <span class="string">'slave'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'slave'</span>; </span><br><span class="line">mysql&gt; flush privileges; </span><br><span class="line">mysql&gt; create database fileserver default character <span class="built_in">set</span> utf8mb4;</span><br></pre></td></tr></table></figure>
<p>å†è·å–status, å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡º: </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; show master status\G; </span><br><span class="line">*************************** 1. row *************************** </span><br><span class="line">File: log.000025 </span><br><span class="line">Position: 155 Binlog_Do_DB: </span><br><span class="line">Binlog_Ignore_DB: </span><br><span class="line">Executed_Gtid_Set: 1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>


<h3 id="5-ç™»å½•MySQLä»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯"><a href="#5-ç™»å½•MySQLä»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯" class="headerlink" title="5.ç™»å½•MySQLä»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯"></a>5.ç™»å½•MySQLä»èŠ‚ç‚¹é…ç½®åŒæ­¥ä¿¡æ¯</h3><ul>
<li><p>æŸ¥çœ‹mysql masterçš„å®¹å™¨ç‹¬ç«‹ipåœ°å€ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker inspect --format=<span class="string">'&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;'</span> mysql-master </span><br><span class="line"><span class="comment"># æ¯”å¦‚è¾“å‡ºå¾—åˆ°: 172.17.0.2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦å¼€ä¸€ä¸ªtabç™»å½•mysql </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 192.168.1.xx æ˜¯ä½ æœ¬æœºçš„å†…ç½‘ip </span></span><br><span class="line">mysql -u root -h 192.168.1.xx -P13307 -p123456</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨mysql clientä¸­æ“ä½œ: </p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; stop slave; </span><br><span class="line">mysql&gt; create database fileserver default character <span class="built_in">set</span> utf8mb4; </span><br><span class="line"><span class="comment">#æ³¨æ„å…¶ä¸­çš„æ—¥å¿—æ–‡ä»¶å’Œæ•°å€¼è¦å’Œä¸Šé¢show master statusçš„å€¼å¯¹åº” </span></span><br><span class="line">mysql&gt; CHANGE MASTER TO MASTER_HOST=<span class="string">'å‰ä¸¤ä¸ªæ­¥éª¤ä¸­è·å¾—çš„mysql master ip'</span>,MASTER_PORT=3306,MASTER_USER=<span class="string">'slave'</span>,MASTER_PASSWORD=<span class="string">'slave'</span>,MASTER_LOG_FILE=<span class="string">'log.000025'</span>,MASTER_LOG_POS=155; </span><br><span class="line">mysql&gt; start slave;</span><br></pre></td></tr></table></figure>

<p>å†è·å–status, æ­£å¸¸åº”è¯¥å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡º:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status \G; </span><br><span class="line">// ... </span><br><span class="line">Slave_IO_Running: Yes </span><br><span class="line">Slave_SQL_Running: Yes </span><br><span class="line">// ...</span><br></pre></td></tr></table></figure>



<p>åˆ°è¿™æ—¶è¯´æ˜ä¸»ä»é…ç½®å·²ç»å®Œæˆï¼Œå¯ä»¥å°è¯•åœ¨ä¸»mysqlçš„fileserveræ•°æ®åº“é‡Œå»ºè¡¨æ“ä½œä¸‹ï¼Œç„¶ååœ¨ä»èŠ‚ç‚¹ä¸Šæ£€æŸ¥æ•°æ®æ˜¯å¦å·²ç»åŒæ­¥è¿‡æ¥ã€‚</p>
<h3 id="å‡ ä¸ªæŒ‡ä»¤"><a href="#å‡ ä¸ªæŒ‡ä»¤" class="headerlink" title="å‡ ä¸ªæŒ‡ä»¤"></a>å‡ ä¸ªæŒ‡ä»¤</h3><p><code>sudo netstat -antup -antup | grep docker</code> æŸ¥çœ‹dockerå ç”¨ç«¯å£<br><code>ifconfig</code> æŸ¥çœ‹æœ¬æœºip</p>
<h3 id="é€šè¿‡docker-composeæ–¹å¼å®ç°"><a href="#é€šè¿‡docker-composeæ–¹å¼å®ç°" class="headerlink" title="é€šè¿‡docker composeæ–¹å¼å®ç°"></a>é€šè¿‡docker composeæ–¹å¼å®ç°</h3><p><a href="https://github.com/mayinghan/mysql-master-slave-service" target="_blank" rel="noopener">https://github.com/mayinghan/mysql-master-slave-service</a></p>
]]></content>
      <categories>
        <category>MySQL</category>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>é€šè¿‡Dockerå¯åŠ¨MySQLå®¹å™¨</title>
    <url>/2019/12/20/%E9%80%9A%E8%BF%87docker%E5%90%AF%E5%8A%A8mysql%E5%AE%B9%E5%99%A8/</url>
    <content><![CDATA[<p>æ‹‰å–mysql</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>

<p>åœ¨åå°å¯åŠ¨mysqlå®¹å™¨(â€“nameæŒ‡å®šäº†å®¹å™¨çš„åç§°ï¼Œæ–¹ä¾¿ä¹‹åè¿›å…¥å®¹å™¨çš„å‘½ä»¤è¡Œï¼ŒMYSQL_ROOT_PASSWORD=hls123æŒ‡å®šäº†mysqlçš„rootå¯†ç ï¼Œ-dè¡¨ç¤ºåœ¨åå°è¿è¡Œ)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo docker run --name=mysql -it -p 3306:3306 -e MYSQL_ROOT_PASSWORD=hls123 -d mysql</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥å®¹å™¨bashå¹¶è¿›å…¥mysqlå‘½ä»¤è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql bash</span><br></pre></td></tr></table></figure>
<p>éªŒè¯å®¹å™¨çŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>



<p>åˆ›å»ºmysqlå®¹å™¨ 1master+1ä¸ªslave</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name=mysql-master -it -p 3306:3306 -e MYSQL_ROOT_PASSWORD=hls123 -d mysql</span><br></pre></td></tr></table></figure>

<p>â€“name ä¸ºå®¹å™¨æŒ‡å®šåç§°ï¼Œè¿™é‡Œæ˜¯mysql-master</p>
<p>-p å°†å®¹å™¨çš„æŒ‡å®šç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„æŒ‡å®šç«¯å£ï¼Œè¿™é‡Œæ˜¯å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£</p>
<p>-e è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šrootè´¦å·çš„å¯†ç ä¸ºhls123</p>
<p>-d åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</p>
<p>docker run â€“name=mysql-master -it -p 3306:3306 -e MYSQL_ROOT_PASSWORD=hls123 -d mysql:[ç‰ˆæœ¬å·]<br>mysql:ç‰ˆæœ¬å· æŒ‡å®šè¿è¡Œçš„mysqlç‰ˆæœ¬å·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name=mysql-slave1 -it -p 3307:3306 -e MYSQL_ROOT_PASSWORD=hls123 -d mysql</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerå­¦ä¹ </title>
    <url>/2019/12/11/Docker%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><p>å®‰è£…<br>1.é€šè¿‡<a href="å®˜ç½‘">wwww.docker.com</a>ä¸‹è½½æ¡Œé¢ç‰ˆdocker<br>2.<a href="https://www.daocloud.io/mirror" target="_blank" rel="noopener">é…ç½®Dockeré•œåƒç«™</a><br>3.æ‰§è¡Œ<code>docker run hello-world</code>ï¼Œçœ‹è¾“å‡ºå®Œç¾è¿è¡Œï½</p>
<p>åŸºæœ¬æ¦‚å¿µ</p>
<ul>
<li>é•œåƒï¼ˆImageï¼‰</li>
<li>å®¹å™¨ï¼ˆContainerï¼‰</li>
<li>ä»“åº“ï¼ˆRepositoryï¼‰</li>
</ul>
<p>é•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ ç±» å’Œ å®ä¾‹ ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚</p>
<p>å¸¸ç”¨æ“ä½œ</p>
<p>æ‹‰å–é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//ä¸‹è½½å®˜æ–¹nginxé•œåƒæºï¼Œç­‰åŒäºdocker pull docker.io/nginx</span><br><span class="line">//ä¹Ÿç­‰åŒäºdocker pull docker.io/nginx.io/nginx:latest</span><br><span class="line">docker pull nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//ä¸‹è½½å›½å†…é•œåƒæºçš„ubuntué•œåƒï¼Œå¹¶åˆ¶å®šç‰ˆæœ¬</span><br><span class="line">docker pull registry.docker-cn.com/library/ubuntu:18.04</span><br></pre></td></tr></table></figure>

<p>æ¨é€é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//æ¨é€é•œåƒåˆ°docker hub,éœ€è¦å…ˆæ³¨å†Œè´¦å·</span><br><span class="line">docker push &lt;ä½ çš„ç”¨æˆ·å&gt;/&lt;ä½ æ‰“åŒ…æ—¶å®šä¹‰çš„é•œåƒå&gt;:&lt;æ ‡ç­¾ï¼Œç‰ˆæœ¬å·&gt;</span><br><span class="line"></span><br><span class="line">//æ¨é€é•œåƒåˆ°ç§æœ‰é•œåƒåº“ï¼Œéœ€è¦æå‰æ­å»ºå¥½ä»“åº“æœåŠ¡ï¼ˆæ¯”å¦‚ç”¨harboræ¥æ­å»ºï¼‰</span><br><span class="line">docker push &lt;ç§æœ‰é•œåƒåº“åŸŸåï¼Œå¦‚a.b.com&gt;/&lt;é¡¹ç›®åç§°&gt;/é•œåƒå:&lt;æ ‡ç­¾&gt;</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//æå‰å‡†å¤‡å¥½ä¸€ä¸ªDockerfileï¼Œåœ¨Dockerfileç›¸åŒè·¯å¾„ä¸‹æ‰§è¡Œï¼š</span><br><span class="line">docker build -t &lt;æŒ‡å®šä¸€ä¸ªå®Œæ•´çš„é•œåƒåï¼Œæ¯”å¦‚testdemo:v1.0&gt;</span><br><span class="line">//å³å¯æ‰“åŒ…å‡ºä¸€ä¸ªæœ¬åœ°é•œåƒï¼Œç„¶åå†é€šè¿‡docker push å°±å¯ä»¥æ¨é€åˆ°è¿œç«¯é•œåƒä»“åº“</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d //-d è¡¨ç¤ºé€šè¿‡daemonæ–¹å¼æ¥å¯åŠ¨</span><br><span class="line">-p 13306:3306 //ç«¯å£æ˜ å°„ï¼Œå°†hostä¸»æœºçš„13306ç«¯å£å’Œdockerå®¹å™¨çš„3306ç«¯å£æ˜ å°„èµ·æ¥</span><br><span class="line">-v /etc/mysql:/var/mysql //ç›®å½•æŒ‚è½½ï¼Œå°†å®¹å™¨å†…çš„/var/mysqlç›®å½•æŒ‚è½½åˆ°hostä¸»æœºçš„/etc/mysqlç›®å½•ï¼Œå¯ä»¥å®ç°å®¹å™¨å†…è¿™ä¸ªç›®å½•ä¸‹çš„æ•°æ®æŒä¹…åŒ–ï¼Œmysqlä¸ºé•œåƒåï¼ˆæŒ‡å®šåŠ è½½å“ªä¸ªé•œåƒï¼‰</span><br></pre></td></tr></table></figure>

<p>é‡å¯æˆ–åœæ­¢æˆ–åˆ é™¤å®¹å™¨åº”ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps  //åˆ—å‡ºç›®å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ—è¡¨</span><br><span class="line">docker ps -a //åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨åˆ—è¡¨</span><br><span class="line">docker start &lt;å®¹å™¨id&gt;  //é€šè¿‡å®¹å™¨idæ¥é‡å¯æŸä¸ªå®¹å™¨ï¼Œæ‰¹é‡æ“ä½œçš„è¯ï¼Œç›´æ¥åœ¨å‚æ•°åé¢å†è·Ÿå¯¹åº”å®¹å™¨idå³å¯</span><br><span class="line">docker stop &lt;å®¹å™¨id&gt;  //é€šè¿‡å®¹å™¨idæ¥å…³é—­æŸä¸ªå®¹å™¨ï¼Œæ‰¹é‡æ“ä½œçš„è¯ï¼Œç›´æ¥åœ¨å‚æ•°åé¢å†è·Ÿå¯¹åº”å®¹å™¨idå³å¯</span><br><span class="line">docker rm &lt;å®¹å™¨id&gt;  //é€šè¿‡å®¹å™¨idæ¥åˆ é™¤æ‰æŸä¸ªå·²ç»åœæ­¢çš„å®¹å™¨</span><br><span class="line">docker rm -f &lt;å®¹å™¨id&gt;  //é€šè¿‡å®¹å™¨idæ¥åˆ é™¤æ‰æŸä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker container rm  [trusting_newton]</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤æœ¬åœ°é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker rmo &lt;é•œåƒid&gt;</span><br><span class="line">docker rmi -f &lt;é•œåƒid&gt; //å¼ºåˆ¶åˆ é™¤</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker logs -f &lt;å®¹å™¨id&gt;</span><br><span class="line">docker inspect &lt;å®¹å™¨id&gt; //ä»è¿”å›ç»“æœä¸­æ‰¾åˆ°LogPath,è¿è¡Œçš„å†å²æ—¥å¿—ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæ‰¾åˆ°</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥å®¹å™¨å†…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker  <span class="built_in">exec</span>  -it &lt;å®¹å™¨id&gt;  /bin/bash  //è¿›å…¥å®¹å™¨å†…å¹¶è¿›å…¥å®ƒçš„shellç»ˆç«¯</span><br><span class="line">docker  <span class="built_in">exec</span>  -it &lt;å®¹å™¨id&gt; &lt;shellå‘½ä»¤&gt;  //åœ¨å®¹å™¨å†…æ‰§è¡Œshellå‘½ä»¤</span><br><span class="line">docker  <span class="built_in">exec</span>  -it &lt;å®¹å™¨id&gt; ls -l        //æŸ¥çœ‹å®¹å™¨å†…ç³»ç»Ÿè·Ÿç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨åï¼Œå¯ä»¥ç›´æ¥é€šè¿‡exitå‘½ä»¤æ¨å‡ºå®¹å™¨</span></span><br></pre></td></tr></table></figure>

<h3 id="æœåŠ¡å™¨Linuxä¸‹å®‰è£…Dockerç¤¾åŒºç‰ˆ-Centos7ä¸ºä¾‹"><a href="#æœåŠ¡å™¨Linuxä¸‹å®‰è£…Dockerç¤¾åŒºç‰ˆ-Centos7ä¸ºä¾‹" class="headerlink" title="æœåŠ¡å™¨Linuxä¸‹å®‰è£…Dockerç¤¾åŒºç‰ˆ(Centos7ä¸ºä¾‹)"></a>æœåŠ¡å™¨Linuxä¸‹å®‰è£…Dockerç¤¾åŒºç‰ˆ(Centos7ä¸ºä¾‹)</h3><ul>
<li>yumæºä½¿ç”¨é˜¿é‡Œäº‘çš„æº</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line"><span class="comment"># ä¸‹è½½é˜¿é‡Œäº‘çš„yumæº</span></span><br><span class="line">wget http<span class="string">"mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"><span class="string">mv CentOS-Base.repo CentOS-Base.repo.back</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mv Centos-7.repo CentOS-Base.repo</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>é‡ç½®yumæº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum-config-manager --add-repo http://mirros.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…docker</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹é˜¿é‡Œäº‘ä¸Šdocker æºä¿¡æ¯</span></span><br><span class="line">yum list docker-ce</span><br><span class="line"><span class="comment">#å®‰è£…dockeræœ€æ–°ç¤¾åŒºç‰ˆ</span></span><br><span class="line">yum -y install docker-ce</span><br><span class="line"><span class="comment">#æŸ¥çœ‹dockerä¿¡æ¯</span></span><br><span class="line">docker -v</span><br><span class="line"><span class="comment">#å¯åŠ¨docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="comment">#æŸ¥çœ‹dockerè¯¦ç»†çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>








<p>å‚è€ƒèµ„æ–™<br><a href="https://github.com/yeasy/docker_practice" target="_blank" rel="noopener">Docker â€” ä»å…¥é—¨åˆ°å®è·µ</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch</title>
    <url>/2019/12/11/ElasticSearch/</url>
    <content><![CDATA[<p>ElasticSearchï¼šå…¨æ–‡æœç´¢å¼•æ“ï¼Œå®ƒå¯ä»¥å¿«é€Ÿå­˜å‚¨ï¼Œæœç´¢å’Œåˆ†ææµ·é‡æ•°æ®ï¼Œç”¨æˆ·åŒ…æ‹¬ï¼šç»´åŸºç™¾ç§‘ã€Stack Overflowã€GitHub</p>
<p>ç‰¹ç‚¹ï¼šä¸éœ€è¦ç®€è¡¨ï¼Œé…ç½®å­—æ®µç­‰ï¼›åªéœ€è¦å­˜jsonçš„æ–‡æ¡£ï¼›</p>
<p>é€šè¿‡dockerå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull docker.elastic.co/elasticsearch/elasticsearch:7.5.0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -p 9200:9200 -p 9300:9300 -e <span class="string">"discovery.type=single-node"</span> docker.elastic.co/elasticsearch/elasticsearch:7.5.0</span><br></pre></td></tr></table></figure>

<p>å®‰è£…æˆåŠŸä¹‹åè®¿é—®<code>http://localhost:9200/</code>å³å¯è§åˆ°å¯¹åº”ä¿¡æ¯</p>
<p>é“¾æ¥å‚è€ƒ<br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html" target="_blank" rel="noopener">dockerå®‰è£…ElasticSearch</a></p>
]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>Golangäº‘å­˜å‚¨å®æˆ˜</title>
    <url>/2019/12/10/Golang%E4%BA%91%E5%AD%98%E5%82%A8%E5%AE%9E%E6%88%98/</url>
    <content><![CDATA[<h3 id="3mysql"><a href="#3mysql" class="headerlink" title="3mysql"></a>3mysql</h3><p>æ•°æ®åº“åˆ†è¡¨<br>æ°´å¹³åˆ†è¡¨ï¼šå‡è®¾åˆ†æˆ256å¼ æ–‡ä»¶è¡¨ï¼ŒæŒ‰æ–‡ä»¶Sha1å€¼åä¸¤ä½æ¥åˆ‡åˆ†ï¼Œåˆ™ä»¥ï¼štb_${FILE_SHA1}[:-2]çš„è§„åˆ™åˆ°å¯¹åº”è¡¨è¿›è¡Œå­˜å–ã€‚</p>
<p>// OnFileUploadFinished : æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼Œä¿å­˜meta ï¼ˆæ’å…¥ï¼‰<br>// GetFileMeta : ä»mysqlè·å–æ–‡ä»¶å…ƒä¿¡æ¯ï¼ˆæŸ¥è¯¢ï¼‰<br>// UpdateFileLocation : æ›´æ–°æ–‡ä»¶çš„å­˜å‚¨åœ°å€(å¦‚æ–‡ä»¶è¢«è½¬ç§»äº†)  ï¼ˆæ›´æ–°ï¼‰<br>æ¶‰åŠæºç ï¼šdb(file.go   mysql(conn.go))</p>
<p>ä½¿ç”¨MySQLå°ç»“ï¼š<br>é€šè¿‡sql.DBæ¥ç®¡ç†æ•°æ®è¿æ¥å¯¹è±¡<br>é€šè¿‡sql.Openæ¥åˆ›å»ºåç¨‹å®‰å…¨çš„sql.DB<br>ä¼˜å…ˆä½¿ç”¨Prepared Statement</p>
<h3 id="4-1ç”¨æˆ·ç³»ç»Ÿç”¨æˆ·è¡¨è®¾è®¡-æ³¨å†Œå’Œç™»å½•"><a href="#4-1ç”¨æˆ·ç³»ç»Ÿç”¨æˆ·è¡¨è®¾è®¡-æ³¨å†Œå’Œç™»å½•" class="headerlink" title="4-1ç”¨æˆ·ç³»ç»Ÿç”¨æˆ·è¡¨è®¾è®¡(æ³¨å†Œå’Œç™»å½•)"></a>4-1ç”¨æˆ·ç³»ç»Ÿç”¨æˆ·è¡¨è®¾è®¡(æ³¨å†Œå’Œç™»å½•)</h3><p>ç”±äºåŸæœ‰æƒ…å†µä¸‹,å”¯ä¸€ç´¢å¼•ç”¨åœ¨äº†å­—æ®µphoneä¸Š. è€Œå½“å‰æ’å…¥è¡¨çš„sqlè¯­å¥ä¸­, user_nameæ‰æ˜¯åº”è¯¥è¦ä¿æŒå”¯ä¸€çš„, å› æ­¤ç›¸å¯¹äºè§†é¢‘æ‰€æ¼”ç¤ºçš„å»ºè¡¨è¯­å¥è¿›è¡Œäº†æ›´æ–°, å…·ä½“å¦‚ä¸‹: </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `tbl_user` ( </span><br><span class="line">    `id` int(11) NOT NULL AUTO_INCREMENT, </span><br><span class="line">    `user_name` varchar(64) NOT NULL DEFAULT <span class="string">''</span> COMMENT <span class="string">'ç”¨æˆ·å'</span>, </span><br><span class="line">    `user_pwd` varchar(256) NOT NULL DEFAULT <span class="string">''</span> COMMENT <span class="string">'ç”¨æˆ·encodedå¯†ç '</span>, </span><br><span class="line">    `email` varchar(64) DEFAULT <span class="string">''</span> COMMENT <span class="string">'é‚®ç®±'</span>, </span><br><span class="line">    `phone` varchar(128) DEFAULT <span class="string">''</span> COMMENT <span class="string">'æ‰‹æœºå·'</span>, </span><br><span class="line">    `email_validated` tinyint(1) DEFAULT 0 COMMENT <span class="string">'é‚®ç®±æ˜¯å¦å·²éªŒè¯'</span>, </span><br><span class="line">    `phone_validated` tinyint(1) DEFAULT 0 COMMENT <span class="string">'æ‰‹æœºå·æ˜¯å¦å·²éªŒè¯'</span>, </span><br><span class="line">    `signup_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT <span class="string">'æ³¨å†Œæ—¥æœŸ'</span>, </span><br><span class="line">    `last_active` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="string">'æœ€åæ´»è·ƒæ—¶é—´æˆ³'</span>, </span><br><span class="line">    `profile` text COMMENT <span class="string">'ç”¨æˆ·å±æ€§'</span>, </span><br><span class="line">    `status` int(11) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'è´¦æˆ·çŠ¶æ€(å¯ç”¨/ç¦ç”¨/é”å®š/æ ‡è®°åˆ é™¤ç­‰)'</span>, </span><br><span class="line">    PRIMARY KEY (`id`), </span><br><span class="line">    UNIQUE KEY `idx_username` (`user_name`), </span><br><span class="line">    KEY `idx_status` (`status`) </span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br></pre></td></tr></table></figure>

<p>ç™»å½•<br>// 1. æ ¡éªŒç”¨æˆ·ååŠå¯†ç <br>// 2. ç”Ÿæˆè®¿é—®å‡­è¯(token)<br>// 3. ç™»å½•æˆåŠŸåé‡å®šå‘åˆ°é¦–é¡µ<br>æ¶‰åŠæºç ï¼š<br>db(user.go )<br>handle(user.go)</p>
<p>è®¿é—®é‰´æƒï¼ˆéªŒè¯tokençš„æ‹¦æˆªå™¨ï¼‰<br>handler(auth.go)</p>
<h3 id="5-hashç®—æ³•å¯¹æ¯”ä»¥åŠç§’ä¼ åŸç†"><a href="#5-hashç®—æ³•å¯¹æ¯”ä»¥åŠç§’ä¼ åŸç†" class="headerlink" title="5.hashç®—æ³•å¯¹æ¯”ä»¥åŠç§’ä¼ åŸç†"></a>5.hashç®—æ³•å¯¹æ¯”ä»¥åŠç§’ä¼ åŸç†</h3><h3 id="6-Redis"><a href="#6-Redis" class="headerlink" title="6.Redis"></a>6.Redis</h3><p>åˆ†å—ä¸Šä¼ ä¸æ–­ç‚¹ç»­ä¼ <br>åˆ†å—ä¸Šä¼ ï¼šæ–‡ä»¶åˆ‡æˆå¤šå—ï¼Œç‹¬ç«‹ä¸Šä¼ ï¼Œä¸Šä¼ å®Œæˆååˆå¹¶ï¼ˆåˆå§‹åŒ–ä¸Šä¼ -&gt;ä¸Šä¼ åˆ†å—ï¼ˆå¹¶è¡Œï¼‰-&gt;é€šçŸ¥ä¸Šä¼ å®Œæˆï¼‰<br>æ–­ç‚¹ç»­ä¼ ï¼šä¼ è¾“æš‚åœæˆ–ä¸€åœºç»ˆç«¯åï¼Œå¯åŸºäºåŸæ¥è¿›åº¦é‡ä¼ </p>
<p>å°æ–‡ä»¶ä¸å»ºè®®åˆ†å—ä¸Šä¼ <br>å¯ä»¥å¹¶è¡Œä¸Šä¼ åˆ†å—ï¼Œå¹¶ä¸”å¯ä»¥æ— åºä¼ è¾“<br>åˆ†å—ä¸Šä¼ èƒ½æå¤§æé«˜ä¼ è¾“æ•ˆç‡<br>å‡å°‘ä¼ è¾“å¤±è´¥åé‡è¯•çš„æµé‡å’Œæ—¶é—´</p>
<p>åˆå§‹åŒ–åˆ†å—ä¿¡æ¯<br>ä¸Šä¼ åˆ†å—<br>é€šçŸ¥åˆ†å—ä¸Šä¼ å®Œæˆ<br>å–æ¶ˆä¸Šä¼ åˆ†å—<br>æŸ¥çœ‹åˆ†å—ä¸Šä¼ çš„æ•´ä½“çŠ¶æ€</p>
<p>æ¶‰åŠæºç ï¼š<br>cache(redis(conn.go))</p>
<p>handler(mpupload.go)</p>
<h3 id="7-Ceph"><a href="#7-Ceph" class="headerlink" title="7.Ceph"></a>7.Ceph</h3><p>Ceph:redhatå¼€æºå‡ºæ¥çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</p>
<h3 id="8-é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSS"><a href="#8-é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSS" class="headerlink" title="8.é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSS"></a>8.é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSS</h3><h3 id="9-RabbitMQ"><a href="#9-RabbitMQ" class="headerlink" title="9.RabbitMQ"></a>9.RabbitMQ</h3><p>RabbitMQ:ä¸€ç§å¼€æºçš„æ¶ˆæ¯ä»£ç†</p>
<h3 id="10-å¾®æœåŠ¡"><a href="#10-å¾®æœåŠ¡" class="headerlink" title="10.å¾®æœåŠ¡"></a>10.å¾®æœåŠ¡</h3><p><img src="/2019/12/10/Golang%E4%BA%91%E5%AD%98%E5%82%A8%E5%AE%9E%E6%88%98/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.jpeg" alt="å¾®æœåŠ¡æ¶æ„å›¾"></p>
<h4 id="åŸºäºginæ”¹é€ ç”¨æˆ·service"><a href="#åŸºäºginæ”¹é€ ç”¨æˆ·service" class="headerlink" title="åŸºäºginæ”¹é€ ç”¨æˆ·service"></a>åŸºäºginæ”¹é€ ç”¨æˆ·service</h4><h4 id="go-micro"><a href="#go-micro" class="headerlink" title="go-micro"></a>go-micro</h4><h3 id="æºç è¯´æ˜"><a href="#æºç è¯´æ˜" class="headerlink" title="æºç è¯´æ˜:"></a>æºç è¯´æ˜:</h3><ul>
<li>masteråˆ†æ”¯: é€šè¿‡åŸç”Ÿnet/httpå®ç°å„æ¥å£åŠŸèƒ½</li>
<li>ginåˆ†æ”¯: é€šè¿‡Ginæ¡†æ¶æ¥æ”¹é€ (å¾®æœåŠ¡åŒ–ç« èŠ‚ä¹‹åä¸»è¦åŸºäºGinæ¡†æ¶æ¥è¿›è¡Œæ¼”ç¤º)</li>
<li>pkgåˆ†æ”¯: é€šè¿‡go-bindataç­‰å·¥å…·å®ç°é™æ€èµ„æºæ‰“åŒ…çš„ä¸€ä¸ªç¤ºä¾‹</li>
<li>ç¬¬ä¹ç« (RabbitMQå¼‚æ­¥å­˜å‚¨)ç« èŠ‚çš„ä»£ç ï¼Œå¯ä»¥ä¸‹è½½æ ‡ç­¾ä¸º<code>v0.3</code>çš„ç‰ˆæœ¬</li>
<li>ç¬¬å…«ç« (OSS)åŠä¹‹å‰ç« èŠ‚çš„ä»£ç ï¼Œå¯ä»¥ä¸‹è½½æ ‡ç­¾ä¸º<code>v0.2</code>çš„ç‰ˆæœ¬</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li>Goå…¥é—¨: <a href="https://tour.go-zh.org/welcome/1" target="_blank" rel="noopener">è¯­è¨€ä¹‹æ—…</a></li>
<li>MySQL: <a href="https://chhy2009.github.io/document/mysql-reference-manual.pdf" target="_blank" rel="noopener">å¶ç„¶ç¿»åˆ°çš„ä¸€ä½å¤§ç‰›ç¿»è¯‘çš„ä½¿ç”¨æ‰‹å†Œ</a></li>
<li>Redis: <a href="http://redisdoc.com/" target="_blank" rel="noopener">å‘½ä»¤æ‰‹å†Œ</a></li>
<li>Ceph: <a href="http://ceph.org.cn/" target="_blank" rel="noopener">ä¸­æ–‡ç¤¾åŒº</a> <a href="http://docs.ceph.org.cn/" target="_blank" rel="noopener">ä¸­æ–‡æ–‡æ¡£</a></li>
<li>RabbitMQ: <a href="http://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener">è‹±æ–‡å®˜æ–¹</a> <a href="http://rabbitmq.mr-ping.com/" target="_blank" rel="noopener">ä¸€ä¸ªä¸­æ–‡ç‰ˆæ–‡æ¡£</a></li>
<li>é˜¿é‡Œäº‘OSS: <a href="https://help.aliyun.com/product/31815.html?spm=a2c4g.750001.3.1.47287b13LQI3Ah" target="_blank" rel="noopener">æ–‡æ¡£é¦–é¡µ</a></li>
<li>gRPC: <a href="http://doc.oschina.net/grpc?t=56831" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ</a></li>
<li>k8s: <a href="https://www.kubernetes.org.cn/docs" target="_blank" rel="noopener">ä¸­æ–‡ç¤¾åŒº</a></li>
<li>æˆ‘çš„æ‰‹è®°åšå®¢ <a href="http://www.imooc.com/u/6198190" target="_blank" rel="noopener">http://www.imooc.com/u/6198190</a></li>
</ul>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>AFNè¡¨å•å½¢å¼æäº¤å›¾ç‰‡</title>
    <url>/2019/11/15/AFN%E8%A1%A8%E5%8D%95%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BA%A4%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>PromiseKit</title>
    <url>/2019/11/05/PromiseKit/</url>
    <content><![CDATA[<h1 id="then-and-done"><a href="#then-and-done" class="headerlink" title="then and done"></a><code>then</code> and <code>done</code></h1><p>å…¸å‹ä½¿ç”¨:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    login()</span><br><span class="line">&#125;.then &#123; creds <span class="keyword">in</span></span><br><span class="line">    fetch(avatar: creds.user)</span><br><span class="line">&#125;.done &#123; image <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">self</span>.imageView = image</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿™æ®µä»£ç ä½¿ç”¨äº†<code>completion handlers</code>ï¼Œå®ƒå°†å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">login &#123; creds, error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> creds = creds &#123;</span><br><span class="line">        fetch(avatar: creds.user) &#123; image, error <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = image &#123;</span><br><span class="line">                <span class="keyword">self</span>.imageView = image</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>then</code> åªæ˜¯æ„é€ <code>completion handlers</code>çš„å¦ä¸€ç§æ–¹å¼, ä½†ä¹Ÿè¿œä¸æ­¢å¦‚æ­¤ã€‚åœ¨æˆ‘ä»¬ç†è§£çš„æœ€åˆé˜¶æ®µï¼Œå®ƒä¸»è¦æœ‰åŠ©äºå¯è¯»æ€§ã€‚ä¸Šé¢çš„<code>promiseé“¾</code>å¾ˆå®¹æ˜“æµè§ˆå’Œç†è§£:ä¸€ä¸ªå¼‚æ­¥æ“ä½œä¸€è¡Œä¸€è¡Œåœ°é€šå‘å¦ä¸€ä¸ªã€‚é‰´äºSwiftçš„å½“å‰çŠ¶æ€ï¼Œå®ƒå°½å¯èƒ½æ¥è¿‘ç¨‹åºä»£ç ã€‚</p>
<p><code>done</code> å’Œ <code>then</code> ï¼Œä½†æ˜¯ä½ ä¸èƒ½è¿”å›ä¸€ä¸ª<code>promise</code>. è¿™é€šå¸¸æ˜¯é“¾æ¡ä¸­<code>success</code>éƒ¨åˆ†çš„ç»ˆç‚¹. ä¸Šé¢, æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ <code>done</code> æ—¶æ”¶åˆ°äº†æœ€ç»ˆçš„å›¾åƒï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è®¾ç½®ç”¨æˆ·ç•Œé¢ã€‚</p>
<p>ä¸¤ç§å®ç°æ–¹æ³•çš„æ¯”è¾ƒ:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">Creds</span>&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// Compared with:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(completion: <span class="params">(Creds?, Error?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">                        <span class="comment">// ^^ ugh. Optionals. Double optionals.</span></span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«åœ¨äºï¼Œå¯¹äº<code>Promise</code>ï¼Œæ‚¨çš„å‡½æ•°è¿”å›<code>Promise</code>ï¼Œè€Œä¸æ˜¯æ¥å—å’Œè¿è¡Œå›è°ƒã€‚é“¾ä¸­çš„æ¯ä¸ª<code>handler</code>éƒ½ä¼šè¿”å›ä¸€ä¸ª<code>Promise</code>ã€‚<code>Promise</code>å¯¹è±¡å®šä¹‰äº†<code>then</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨é“¾çš„æ‰§è¡Œä¹‹å‰ç­‰å¾…<code>Promise</code>çš„å®Œæˆã€‚é”é“¾æŒ‰ç¨‹åºè§£å†³ï¼Œä¸€æ¬¡ä¸€ä¸ª<code>Promise</code>ã€‚</p>
<p><code>Promise</code> ä»£è¡¨å¼‚æ­¥ä»»åŠ¡çš„è¿”å›å€¼ã€‚å®ƒæœ‰ä¸€ä¸ªè¡¨ç¤ºå®ƒåŒ…è£…çš„å¯¹è±¡ç±»å‹çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>login</code>æ˜¯ä¸€ä¸ªè¿”å›<code>Promise</code>çš„å‡½æ•°ï¼Œè¯¥<code>Promise</code>å°†ä»£è¡¨Credså®ä¾‹ã€‚</p>
<blockquote>
<p><em>Note</em>: <code>done</code> is new to PromiseKit 5. We previously defined a variant of <code>then</code> that<br>did not require you to return a promise. Unfortunately, this convention often confused<br>Swift and led to odd and hard-to-debug error messages. It also made using PromiseKit<br>more painful. The introduction of <code>done</code> lets you type out promise chains that<br>compile without additional qualification to help the compiler figure out type information.</p>
</blockquote>
<hr>
<p>æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œä¸completionæ¨¡å¼ä¸åŒï¼Œpromiseé“¾ä¼¼ä¹<br>å¿½ç•¥errorsã€‚äº‹å®å¹¶éå¦‚æ­¤ï¼äº‹å®ä¸Šï¼Œå®ƒæœ‰ç›¸åçš„æ•ˆæœ:promise<br>é“¾ä½¿å¾—errorså¤„ç†æ›´å®¹æ˜“è®¿é—®ï¼Œä¹Ÿä½¿å¾—errorsæ›´éš¾å¿½ç•¥ã€‚</p>
<h1 id="catch"><a href="#catch" class="headerlink" title="catch"></a><code>catch</code></h1><p>æœ‰äº†promiseï¼Œerrorså°±ä¼šæ²¿ç€promiseé“¾çº§è”ï¼Œç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åº<br>å¥å£®ï¼Œä»£ç æ¸…æ™°:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    login()</span><br><span class="line">&#125;.then &#123; creds <span class="keyword">in</span></span><br><span class="line">    fetch(avatar: creds.user)</span><br><span class="line">&#125;.done &#123; image <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">self</span>.imageView = image</span><br><span class="line">&#125;.<span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="comment">// any errors in the whole chain land here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Swift emits a warning if you forget to <code>catch</code> a chain. But weâ€™ll<br>talk about that in more detail later.</p>
</blockquote>
<p>æ¯ä¸ªpromiseéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å¼‚æ­¥ä»»åŠ¡ã€‚<br>å¦‚æœä»»åŠ¡å¤±è´¥ï¼Œ promiseå°±ä¼šå˜æˆrejectedã€‚ Chains that contain rejected<br>åŒ…å«rejectedçš„promiseé“¾è·³è¿‡æ‰€æœ‰åç»­çš„promiseã€‚ç›¸åï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªæ•è·ã€‚<br>(ä¸¥æ ¼æ¥è¯´ï¼Œæ‰€æœ‰åç»­çš„æ•è·å¤„ç†ç¨‹åºéƒ½ä¼šè¢«æ‰§è¡Œã€‚)</p>
<p><code>completion handler</code>ä¸<code>promise</code>çš„æ¯”è¾ƒ</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(error: Error)</span></span> &#123;</span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">login &#123; creds, error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> creds = creds <span class="keyword">else</span> &#123; <span class="keyword">return</span> handle(error: error!) &#125;</span><br><span class="line">    fetch(avatar: creds.user) &#123; image, error <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> image = image <span class="keyword">else</span> &#123; <span class="keyword">return</span> handle(error: error!) &#125;</span><br><span class="line">        <span class="keyword">self</span>.imageView.image = image</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>guard</code>å’Œ<code>error handler</code>çš„ä½¿ç”¨æœ‰æ‰€å¸®åŠ©ï¼Œä½†æ˜¯promiseé“¾<br>å¯è¯»æ€§ä¸è¨€è‡ªæ˜ã€‚</p>
<h1 id="ensure"><a href="#ensure" class="headerlink" title="ensure"></a><code>ensure</code></h1><p>æˆ‘ä»¬å·²ç»å­¦ä¼šäº†åˆæˆå¼‚æ­¥æ€§ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ‰©å±•:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> login()</span><br><span class="line">&#125;.then &#123;</span><br><span class="line">    fetch(avatar: $<span class="number">0</span>.user)</span><br><span class="line">&#125;.done &#123;</span><br><span class="line">    <span class="keyword">self</span>.imageView = $<span class="number">0</span></span><br><span class="line">&#125;.ensure &#123;</span><br><span class="line">    <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">false</span></span><br><span class="line">&#125;.<span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½ çš„é“¾æ¡çš„ç»“æœæ˜¯ä»€ä¹ˆâ€”â€”å¤±è´¥è¿˜æ˜¯æˆåŠŸ <code>ensure</code><br>handler æ€»æ˜¯è¢«è°ƒç”¨.</p>
<p><code>ensure</code>æ¨¡å¼ä¸å…¶ç­‰ä»·çš„å®Œæˆå¤„ç†ç¨‹åºè¿›è¡Œæ¯”è¾ƒ:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(error: Error)</span></span> &#123;</span><br><span class="line">    <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">false</span></span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">login &#123; creds, error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> creds = creds <span class="keyword">else</span> &#123; <span class="keyword">return</span> handle(error: error!) &#125;</span><br><span class="line">    fetch(avatar: creds.user) &#123; image, error <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> image = image <span class="keyword">else</span> &#123; <span class="keyword">return</span> handle(error: error!) &#125;</span><br><span class="line">        <span class="keyword">self</span>.imageView.image = image</span><br><span class="line">        <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹æŸäººæ¥è¯´ï¼Œä¿®æ”¹è¿™ä¸ªä»£ç å¹¶å¿˜è®°å–æ¶ˆè®¾ç½®æ˜¯éå¸¸å®¹æ˜“çš„<br>å¯¼è‡´é”™è¯¯çš„æ´»åŠ¨æŒ‡ç¤ºå™¨ã€‚æœ‰äº†promisesï¼Œè¿™ç§ç±»å‹çš„é”™è¯¯æ˜¯<br>å‡ ä¹ä¸å¯èƒ½:Swiftç¼–è¯‘å™¨æ‹’ç»ä½ åœ¨æ²¡æœ‰<br>ä½¿ç”¨promisesã€‚æ‚¨å‡ ä¹ä¸éœ€è¦å®¡æŸ¥æ‹‰åŠ¨å¼è¯·æ±‚ã€‚</p>
<blockquote>
<p><em>Note</em>: PromiseKit has perhaps capriciously switched between the names <code>always</code><br>and <code>ensure</code> for this function several times in the past. Sorry about this. We suck.</p>
</blockquote>
<p>You can also use <code>finally</code> as an <code>ensure</code> that terminates the promise chain and does not return a value:<br>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<code>finally</code>ä½œä¸ºç»“æŸçš„promiseé“¾ä¸”ä¸è¿”å›å€¼çš„<code>ensure</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">spinner(visible: true)</span><br><span class="line"></span><br><span class="line">firstly &#123;</span><br><span class="line">    foo()</span><br><span class="line">&#125;.done &#123;</span><br><span class="line">    //â€¦</span><br><span class="line">&#125;.catch &#123;</span><br><span class="line">    //â€¦</span><br><span class="line">&#125;.finally &#123;</span><br><span class="line">    self.spinner(visible: false)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="when"><a href="#when" class="headerlink" title="when"></a><code>when</code></h1><p>å¯¹å¤šä¸ªå¼‚æ­¥æ“ä½œçš„completion handlersååº”æ˜¯ç¼“æ…¢çš„ï¼Œæ„å‘³ç€è¿ç»­æ‰§è¡Œ:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">operation1 &#123; result1 <span class="keyword">in</span></span><br><span class="line">    operation2 &#123; result2 <span class="keyword">in</span></span><br><span class="line">        finish(result1, result2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¿«é€Ÿ(<em>parallel</em>)è·¯å¾„ä»£ç ä½¿ä»£ç ä¸å¤ªæ¸…æ™°</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result1: â€¦!</span><br><span class="line"><span class="keyword">var</span> result2: â€¦!</span><br><span class="line"><span class="keyword">let</span> group = <span class="type">DispatchGroup</span>()</span><br><span class="line">group.enter()</span><br><span class="line">group.enter()</span><br><span class="line">operation1 &#123;</span><br><span class="line">    result1 = $<span class="number">0</span></span><br><span class="line">    group.leave()</span><br><span class="line">&#125;</span><br><span class="line">operation2 &#123;</span><br><span class="line">    result2 = $<span class="number">0</span></span><br><span class="line">    group.leave()</span><br><span class="line">&#125;</span><br><span class="line">group.notify(queue: .main) &#123;</span><br><span class="line">    finish(result1, result2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨Promiseså°±æ›´æ¸…æ™°äº†:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    when(fulfilled: operation1(), operation2())</span><br><span class="line">&#125;.done &#123; result1, result2 <span class="keyword">in</span></span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>when</code> promiseä»£è¡¨ï¼šç­‰å¾…å®ƒä»¬è§£å†³å¹¶è¿”å›åŒ…å«ç»“æœçš„promiseã€‚</p>
<p>ä¸ä»»ä½•promiseé“¾ä¸€æ ·ï¼Œå¦‚æœä»»ä½•ç»„ä»¶promiseå¤±è´¥ï¼Œè¯¥é“¾å°†è°ƒç”¨ä¸‹ä¸€ä¸ª<code>catch</code>ã€‚</p>
<h1 id="PromiseKit-Extensions"><a href="#PromiseKit-Extensions" class="headerlink" title="PromiseKit Extensions"></a>PromiseKit Extensions</h1><p>å½“æˆ‘ä»¬ä½¿ç”¨PromiseKit, æˆ‘ä»¬æ˜¯æƒ³æƒ³é€šè¿‡promiseæ¥å®ç°<br>å¼‚æ­¥è¡Œä¸ºã€‚å› æ­¤ï¼Œåªè¦æœ‰å¯èƒ½ï¼Œæˆ‘ä»¬ä¼šå¯¹è‹¹æœçš„APIsè¿›è¡Œæ‰©å±•ï¼Œé‡æ–°æ„å»º<br>promiseæ–¹é¢çš„åº”ç”¨ç¼–ç¨‹æ¥å£ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    <span class="type">CLLocationManager</span>.promise()</span><br><span class="line">&#125;.then &#123; location <span class="keyword">in</span></span><br><span class="line">    <span class="type">CLGeocoder</span>.reverseGeocode(location)</span><br><span class="line">&#125;.done &#123; placemarks <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">self</span>.placemark.text = <span class="string">"\(placemarks.first)"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦ä½¿ç”¨è¿™äº›æ‰©å±•ï¼Œæ‚¨éœ€è¦æŒ‡å®šå­ä»£ç :</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">pod <span class="string">"PromiseKit"</span></span><br><span class="line">pod <span class="string">"PromiseKit/CoreLocation"</span></span><br><span class="line">pod <span class="string">"PromiseKit/MapKit"</span></span><br></pre></td></tr></table></figure>

<p>All of these extensions are available at the <a href="https://github.com/PromiseKit" target="_blank" rel="noopener">PromiseKit organization</a>.<br>Go there to see whatâ€™s available and to read the source code and documentation. Every file and function<br>has been copiously documented.</p>
<blockquote>
<p>We also provide extensions for common libraries such as <a href="https://github.com/PromiseKit/Alamofire-" target="_blank" rel="noopener">Alamofire</a>.</p>
</blockquote>
<h1 id="Making-Promises"><a href="#Making-Promises" class="headerlink" title="Making Promises"></a>Making Promises</h1><p>The standard extensions will take you a long way, but sometimes youâ€™ll still need to start chains<br>of your own. Maybe youâ€™re using a third party API that doesnâ€™t provide promises, or perhaps you wrote<br>your own asynchronous system. Either way, itâ€™s easy to add promises. If you look at the code of the<br>standard extensions, youâ€™ll see that it uses the same approach  described below.</p>
<p>æ ‡å‡†çš„æ‰©å±•ä¼šè®©ä½ èµ°å¾ˆé•¿ä¸€æ®µè·¯ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä½ ä»ç„¶éœ€è¦å¯åŠ¨é“¾<br>ä½ è‡ªå·±çš„ã€‚ä¹Ÿè®¸ä½ ä½¿ç”¨çš„æ˜¯ä¸æä¾›promisesçš„ç¬¬ä¸‰æ–¹åº”ç”¨ç¼–ç¨‹æ¥å£ï¼Œæˆ–è€…ä½ å†™é“<br>ä½ è‡ªå·±çš„å¼‚æ­¥ç³»ç»Ÿã€‚ä¸ç®¡æ€æ ·ï¼Œæ·»åŠ promiseséƒ½å¾ˆå®¹æ˜“ã€‚å¦‚æœä½ çœ‹çœ‹<br>æ ‡å‡†æ‰©å±•ï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒä½¿ç”¨äº†ä¸‹é¢æè¿°çš„ç›¸åŒæ–¹æ³•ã€‚</p>
<p>Letâ€™s say we have the following method:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetch</span><span class="params">(completion: <span class="params">(String?, Error?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br></pre></td></tr></table></figure>

<p>How do we convert this to a promise? Well, itâ€™s easy:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetch</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Promise</span> &#123; fetch(completion: $<span class="number">0</span>.resolve) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You may find the expanded version more readable:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetch</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Promise</span> &#123; seal <span class="keyword">in</span></span><br><span class="line">        fetch &#123; result, error <span class="keyword">in</span></span><br><span class="line">            seal.resolve(result, error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>seal</code> object that the <code>Promise</code> initializer provides to you defines<br>many methods for handling garden-variety completion handlers. It even<br>covers a variety of rarer situations, thus making it easy for you to add<br>promises to an existing codebase.</p>
<blockquote>
<p><em>Note</em>: We tried to make it so that you could just do <code>Promise(fetch)</code>, but we<br>were not able to make this simpler pattern work universally without requiring<br>extra disambiguation for the Swift compiler. Sorry; we tried.</p>
</blockquote>
<blockquote>
<p><em>Note</em>: In PMK 4, this initializer provided two parameters to your closure:<br><code>fulfill</code> and <code>reject</code>. PMK 5 and 6 give you an object that has both <code>fulfill</code> and<br><code>reject</code> methods, but also many variants of the method <code>resolve</code>. You can<br>typically just pass completion handler parameters to <code>resolve</code> and let Swift figure<br>out which variant to apply to your particular case (as shown in the example above).</p>
</blockquote>
<blockquote>
<p><em>Note</em> <code>Guarantees</code> (below) have a slightly different initializer (since they<br>cannot error) so the parameter to the initializer closure is just a closure. Not<br>a <code>Resolver</code> object. Thus do <code>seal(value)</code> rather than <code>seal.fulfill(value)</code>. This<br>is because there is no variations in what guarantees can be sealed with, they can<br><em>only</em> fulfill.</p>
</blockquote>
<h1 id="Guarantee-lt-T-gt"><a href="#Guarantee-lt-T-gt" class="headerlink" title="Guarantee&lt;T&gt;"></a><code>Guarantee&lt;T&gt;</code></h1><p>Since PromiseKit 5, we have provided <code>Guarantee</code> as a supplementary class to<br><code>Promise</code>. We do this to complement Swiftâ€™s strong error handling system.</p>
<p>Guarantees <em>never</em> fail, so they cannot be rejected. A good example is <code>after</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    after(seconds: 0.1)</span><br><span class="line">&#125;.done &#123;</span><br><span class="line">    // there is no way to add a `catch` because after cannot fail.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Swift warns you if you donâ€™t terminate a regular <code>Promise</code> chain (i.e., not<br>a <code>Guarantee</code> chain). Youâ€™re expected to silence this warning by supplying<br>either a <code>catch</code> or a <code>return</code>. (In the latter case, you will then have to <code>catch</code><br>at the point where you receive that promise.)</p>
<p>Use <code>Guarantee</code>s wherever possible so that your code has error handling where<br>itâ€™s required and no error handling where itâ€™s not required.</p>
<p>In general, you should be able to use <code>Guarantee</code>s and <code>Promise</code>s interchangeably,<br>We have gone to great lengths to try and ensure this, so please open a ticket<br>if you find an issue.</p>
<hr>
<p>If you are creating your own guarantees the syntax is simpler than that of promises;</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetch</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Guarantee</span> &#123; seal <span class="keyword">in</span></span><br><span class="line">        fetch &#123; result <span class="keyword">in</span></span><br><span class="line">            seal(result)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Which could be reduced to:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetch</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Guarantee</span>(resolver: fetch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="map-compactMap-etc"><a href="#map-compactMap-etc" class="headerlink" title="map, compactMap, etc."></a><code>map</code>, <code>compactMap</code>, etc.</h1><p><code>then</code> provides you with the result of the previous promise and requires you to return<br>another promise.</p>
<p><code>map</code> provides you with the result of the previous promise and requires you to return<br>an object or value type.</p>
<p><code>compactMap</code> provides you with the result of the previous promise and requires you<br>to return an <code>Optional</code>. If you return <code>nil</code>, the chain fails with<br><code>PMKError.compactMap</code>.</p>
<blockquote>
<p><em>Rationale</em>: Before PromiseKit 4, <code>then</code> handled all these cases, and it was<br>painful. We hoped the pain would disappear with new Swift versions. However,<br>it has become clear that the various pain points are here to stay. In fact, we<br>as library authors are expected to disambiguate at the naming level of our API.<br>Therefore, we have split the three main kinds of <code>then</code> into <code>then</code>, <code>map</code> and<br><code>done</code>. After using these new functions, we realized this is much nicer in practice,<br>so we added <code>compactMap</code> as well (modeled on <code>Optional.compactMap</code>).</p>
</blockquote>
<p><code>compactMap</code> facilitates quick composition of promise chains. For example:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    <span class="type">URLSession</span>.shared.dataTask(.promise, with: rq)</span><br><span class="line">&#125;.compactMap &#123;</span><br><span class="line">    <span class="keyword">try</span> <span class="type">JSONSerialization</span>.jsonObject($<span class="number">0</span>.data) <span class="keyword">as</span>? [<span class="type">String</span>]</span><br><span class="line">&#125;.done &#123; arrayOfStrings <span class="keyword">in</span></span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;.<span class="keyword">catch</span> &#123; error <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// Foundation.JSONError if JSON was badly formed</span></span><br><span class="line">    <span class="comment">// PMKError.compactMap if JSON was of different type</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><em>Tip</em>: We also provide most of the functional methods you would expect for sequences,<br>e.g., <code>map</code>, <code>thenMap</code>, <code>compactMapValues</code>, <code>firstValue</code>, etc.</p>
</blockquote>
<h1 id="get"><a href="#get" class="headerlink" title="get"></a><code>get</code></h1><p>We provide <code>get</code> as a <code>done</code> that returns the value fed to <code>get</code>.</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    foo()</span><br><span class="line">&#125;.<span class="keyword">get</span> &#123; foo <span class="keyword">in</span></span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;.done &#123; foo <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// same foo!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="tap"><a href="#tap" class="headerlink" title="tap"></a><code>tap</code></h1><p>We provide <code>tap</code> for debugging. Itâ€™s the same as <code>get</code> but provides the<br><code>Result&lt;T&gt;</code> of the <code>Promise</code> so you can inspect the value of the chain at this<br>point without causing any side effects:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">firstly &#123;</span><br><span class="line">    foo()</span><br><span class="line">&#125;.tap &#123;</span><br><span class="line">    <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">&#125;.done &#123;</span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;.<span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="comment">//â€¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Supplement"><a href="#Supplement" class="headerlink" title="Supplement"></a>Supplement</h1><h2 id="firstly"><a href="#firstly" class="headerlink" title="firstly"></a><code>firstly</code></h2><p>Weâ€™ve used <code>firstly</code> several times on this page, but what is it, really? In fact,<br>it is just <a href="https://en.wikipedia.org/wiki/Syntactic_sugar" target="_blank" rel="noopener">syntactic sugar</a>.<br>You donâ€™t really need it, but it </p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>PromiseKit</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue</title>
    <url>/2019/11/04/Vue/</url>
    <content><![CDATA[<p><a href="https://cn.vuejs.org/index.html" target="_blank" rel="noopener">Vueå®˜ç½‘</a></p>
<h1 id="ç¬¬ä¸€ä¸ªVueç¨‹åº"><a href="#ç¬¬ä¸€ä¸ªVueç¨‹åº" class="headerlink" title="ç¬¬ä¸€ä¸ªVueç¨‹åº"></a>ç¬¬ä¸€ä¸ªVueç¨‹åº</h1><p>åœ¨æ•™ç¨‹å®‰è£…é‡Œç»™å‡ºäº†å¤šç§å¼•å…¥æ–¹å¼ï¼Œå…·ä½“<a href="[æ•™ç¨‹å®‰è£…]ï¼ˆhttps://cn.vuejs.org/v2/guide/installation.htmlï¼‰">ç‚¹å‡»è¿™é‡Œ</a></p>
<h2 id="ç›´æ¥-lt-script-gt-å¼•å…¥"><a href="#ç›´æ¥-lt-script-gt-å¼•å…¥" class="headerlink" title="ç›´æ¥&lt;/script&gt;å¼•å…¥"></a>ç›´æ¥<code>&lt;/script&gt;</code>å¼•å…¥</h2><p>åœ¨ç¼–è¾‘å™¨ä¸Šè¾“å…¥htmlå›è½¦ï¼Œè¿™æ—¶å€™å°±ä¼šè‡ªåŠ¨è¡¥å…¨ä»¥ä¸‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span> dir=<span class="string">"ltr"</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>å¼•å…¥ Vue</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š --&gt;</span><br><span class="line">&lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨é¡µé¢è¾“å‡ºhello Vue,ç”¨æµè§ˆå™¨æ‰“å¼€æ–‡ä»¶å¹¶æ£€éªŒæ•ˆæœ<code>&lt;div&gt;hello Vue&lt;/div&gt;</code></p>
<p>å¯ä»¥ä¹‹åæˆ‘ä»¬æ”¹é€ æºæ–‡ä»¶è®©å®ƒä¸Vueäº§ç”Ÿå…³è”ï¼šnew ä¸€ä¸ªVueå®ä¾‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">      el: <span class="string">'#app'</span>,  //æŒ‚è½½åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Š</span><br><span class="line">      data: &#123;</span><br><span class="line">        message: <span class="string">'Hello Vue!'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>æ‰€æŒ‚è½½çš„èŠ‚ç‚¹éœ€è¦æ·»åŠ ä¸€ä¸ªid<code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code></p>
<p>æœ€ç»ˆæºç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &#123;&#123;message&#125;&#125; &#123;&#123;message + message&#125;&#125;</span><br><span class="line">        &lt;div :id=<span class="string">"message"</span>&gt;&lt;/div&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li v-for=<span class="string">"item in list"</span>&gt;</span><br><span class="line">                &lt;span v-if=<span class="string">"!item.del"</span>&gt;&#123;&#123;item.title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span v-else style=<span class="string">"text-decoration: line-through"</span>&gt;&#123;&#123;item.title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;button v-show=<span class="string">"!item.del"</span>&gt;åˆ é™¤&lt;/button&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var vm = new Vue(&#123;</span><br><span class="line">            el: <span class="string">'#app'</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                message: <span class="string">'hello world'</span>,</span><br><span class="line">                list: [&#123;</span><br><span class="line">                    title: <span class="string">'è¯¾ç¨‹1'</span>,</span><br><span class="line">                    del: <span class="literal">false</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    title: <span class="string">'è¯¾ç¨‹2'</span>,</span><br><span class="line">                    del: <span class="literal">true</span></span><br><span class="line">                &#125;],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ç”¨æµè§ˆå™¨æ‰“å¼€å³å¯è§åˆ°æ˜¾ç¤ºHello Vue!</p>
<p>å‚è€ƒå®˜æ–¹demo <a href="https://scrimba.com/p/pXKqta/cQ3QVcr" target="_blank" rel="noopener">é“¾æ¥</a></p>
<h2 id="æ·»åŠ æ–¹æ³•"><a href="#æ·»åŠ æ–¹æ³•" class="headerlink" title="æ·»åŠ æ–¹æ³•"></a>æ·»åŠ æ–¹æ³•</h2><p>æ·»åŠ æ˜¾ç¤º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;div class=<span class="string">"addMethod"</span>&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">""</span> value=<span class="string">""</span> v-model=<span class="string">"info"</span>&gt;</span><br><span class="line">      &lt;button <span class="built_in">type</span>=<span class="string">"button"</span> name=<span class="string">"button"</span> @click=<span class="string">"handleClick"</span>&gt;add&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­</p>
<ul>
<li>v-modelæ˜¯Vueé‡Œé¢çš„åŒå‘ç»‘å®šï¼Œ</li>
<li>v-foræ˜¯å¾ªç¯éå†</li>
<li>@click=â€handleClickâ€ ç»‘å®šæ–¹æ³•</li>
<li>console.log(this.info) æ‰“å°ä¿¡æ¯ï¼Œå¦‚ä½•æŸ¥çœ‹æ‰“å°è¾“å‡ºï¼šæµè§ˆå™¨-å³é”®-æ£€æŸ¥-Console</li>
<li>handleClickæ–¹æ³•ç”Ÿå‘½åœ¨methodså¯¹è±¡é‡Œé¢</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span> dir=<span class="string">"ltr"</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &#123;&#123; message &#125;&#125;</span><br><span class="line">    &lt;div class=<span class="string">"addMethod"</span>&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">""</span> value=<span class="string">""</span> v-model=<span class="string">"info"</span>&gt;</span><br><span class="line">      &lt;button <span class="built_in">type</span>=<span class="string">"button"</span> name=<span class="string">"button"</span> @click=<span class="string">"handleClick"</span>&gt;add&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=<span class="string">"item in list"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š --&gt;</span><br><span class="line">  &lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">      el: <span class="string">'#app'</span>,  //æŒ‚è½½åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Š</span><br><span class="line">      data: &#123;</span><br><span class="line">        message: <span class="string">'Hello Vue!'</span>,</span><br><span class="line">        info: <span class="string">''</span>,</span><br><span class="line">        list:[],</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        <span class="function"><span class="title">handleClick</span></span>()&#123;</span><br><span class="line">          //console</span><br><span class="line">          this.list.push(this.info)</span><br><span class="line">          this.info = <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶"><a href="#ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶"></a>ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶</h2><p>å®šä¹‰åä¸º todo-item çš„æ–°ç»„ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Vue.component(<span class="string">'todo-item'</span>,&#123;</span><br><span class="line">      props:[<span class="string">'item'</span>],</span><br><span class="line">      template: <span class="string">'&lt;li class="item"&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ª todo-item ç»„ä»¶çš„å®ä¾‹ï¼Œå¹¶ä¼ é€’å±æ€§å€¼ <code>v-bind:item=&quot;item&quot;</code>æˆ–è€…ç®€å†™æˆ<code>:item=&quot;item&quot;</code><br><code>&lt;todo-item v-for=&quot;item in list&quot; :item=&quot;item&quot;&gt;&lt;/todo-item&gt;</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span> dir=<span class="string">"ltr"</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;style media=<span class="string">"screen"</span>&gt;</span><br><span class="line">      .item &#123;</span><br><span class="line">        color:red;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &#123;&#123; message &#125;&#125;</span><br><span class="line">    &lt;div class=<span class="string">"addMethod"</span>&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">""</span> value=<span class="string">""</span> v-model=<span class="string">"info"</span>&gt;</span><br><span class="line">      &lt;button <span class="built_in">type</span>=<span class="string">"button"</span> name=<span class="string">"button"</span> @click=<span class="string">"handleClick"</span>&gt;add&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;todo-item v-for=<span class="string">"item in list"</span> :item=<span class="string">"item"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/todo-item&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š --&gt;</span><br><span class="line">  &lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    Vue.component(<span class="string">'todo-item'</span>,&#123;</span><br><span class="line">      props:[<span class="string">'item'</span>],</span><br><span class="line">      template: <span class="string">'&lt;li class="item"&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">      el: <span class="string">'#app'</span>,  //æŒ‚è½½åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Š</span><br><span class="line">      data: &#123;</span><br><span class="line">        message: <span class="string">'Hello Vue!'</span>,</span><br><span class="line">        info: <span class="string">''</span>,</span><br><span class="line">        list:[],</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        <span class="function"><span class="title">handleClick</span></span>()&#123;</span><br><span class="line">          console.log(this.info)</span><br><span class="line">          this.list.push(this.info)//å¾€listæ•°ç»„æ·»åŠ æ•°æ®</span><br><span class="line">          this.info = <span class="string">''</span>//æ¯æ¬¡ç‚¹å‡»addçš„åŒæ—¶ï¼Œæ¸…ç©ºè¾“å…¥æ¡†</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ“ä½œæœ‰å‡ ä¸ªç¼ºç‚¹</p>
<ul>
<li>å…¨å±€å®šä¹‰ï¼šå¼ºåˆ¶è¦æ±‚æ¯ä¸ª<code>component</code>ä¸­çš„å‘½åä¸å¾—é‡å¤</li>
<li>å­—ç¬¦ä¸²æ¨¡ç‰ˆï¼šç¼ºä¹è¯­æ³•é«˜äº®ï¼Œåœ¨htmlæœ‰å¤šè¡Œçš„æ—¶å€™ï¼Œéœ€è¦ç”¨\</li>
<li>ä¸æ”¯æŒCSSï¼šæ„å‘³ç€å½“htmlå’ŒJavaScriptç»„ä»¶åŒ–æ—¶ï¼ŒCSSæ˜æ˜¾è¢«é—æ¼</li>
<li>æ²¡æœ‰æ„å»ºæ­¥éª¤ï¼šé™åˆ¶åªèƒ½ç”¨htmlå’ŒES5 JavaScript,è€Œä¸èƒ½ä½¿ç”¨é¢„å¤„ç†å™¨ï¼Œå¦‚Pug(formerly Jade)å’ŒBabelï¼Œå³æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨åœ¨æµè§ˆå™¨ä¸Šåˆ·æ–°ï¼Œæ²¡æœ‰è‡ªåŠ¨çƒ­æ›´æ–°ã€‚</li>
</ul>
<h2 id="npmå®‰è£…"><a href="#npmå®‰è£…" class="headerlink" title="npmå®‰è£…"></a>npmå®‰è£…</h2><p>å®‰è£…Vue<code>bash npm install vue</code></p>
<p>å®‰è£…å‘½ä»¤è¡Œå·¥å…· (CLI)<a href="https://cli.vuejs.org/zh/guide/installation.html" target="_blank" rel="noopener">Vue CLI</a></p>
<p><code>npm install -g @vue/cli</code></p>
<p>å‡ºç°å®‰è£…é—®é¢˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm WARN deprecated joi@14.3.1: This module has moved and is now available at @hapi/joi. Please update your dependencies as this version is no longer maintained an may contain bugs and security issues.</span><br><span class="line">npm WARN deprecated topo@3.0.3: This module has moved and is now available at @hapi/topo. Please update your dependencies as this version is no longer maintained an may contain bugs and security issues.</span><br><span class="line">npm WARN deprecated hoek@6.1.3: This module has moved and is now available at @hapi/hoek. Please update your dependencies as this version is no longer maintained an may contain bugs and security issues.</span><br><span class="line">npm WARN deprecated cross-spawn-async@2.2.5: cross-spawn no longer requires a build toolchain, use it instead</span><br><span class="line">npm ERR! Unexpected end of JSON input <span class="keyword">while</span> parsing near <span class="string">'...TGOVzYcDOP1jLScCp0ACN'</span></span><br><span class="line"></span><br><span class="line">npm ERR! A complete <span class="built_in">log</span> of this run can be found <span class="keyword">in</span>:</span><br><span class="line">npm ERR!     /Users/sam/.npm/_logs/2019-04-29T01_23_19_163Z-debug.log</span><br></pre></td></tr></table></figure>

<p>æ¸…æ¥šä¸€ä¸‹ç¼“å­˜<code>npm cache clean --force</code></p>
<p>è¿è¡Œ<code>vue --version</code>å‡ºç°ç‰ˆæœ¬ä¿¡æ¯åˆ™è¯´æ˜å®‰è£…æˆåŠŸ</p>
<p>åˆ›å»ºæ–°é¡¹ç›®<code>vue create my-app</code></p>
<p>ä½¿ç”¨é»˜è®¤å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Vue CLI v3.7.0</span><br><span class="line">? Please pick a preset: (Use arrow keys)</span><br><span class="line">â¯ default (babel, eslint)</span><br><span class="line">  Manually select features</span><br></pre></td></tr></table></figure>


<p>å¯åŠ¨é¡¹ç›®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> my-app</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; my-app@0.1.0 serve /Users/sam/Documents/studyUp/my-app</span><br><span class="line">&gt; vue-cli-service serve</span><br><span class="line"></span><br><span class="line"> INFO  Starting development server...</span><br><span class="line"> 98% after emitting CopyPlugin                                                .</span><br><span class="line"> DONE  Compiled successfully <span class="keyword">in</span> 6412ms                               ä¸Šåˆ9:53:14</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  App running at:</span><br><span class="line">  - Local:   http://localhost:8080/</span><br><span class="line">  - Network: http://192.168.43.116:8080/</span><br><span class="line"></span><br><span class="line">  Note that the development build is not optimized.</span><br><span class="line">  To create a production build, run npm run build.</span><br><span class="line">```  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">æ‰“å¼€localhost:8080å³å¯è§åˆ°æ•ˆæœã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## ç›®å½•ä»‹ç»</span></span><br><span class="line"></span><br><span class="line">![image.png](https://upload-images.jianshu.io/upload_images/3850802-8fcdd44c56b23d35.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…¶ä¸­</span><br><span class="line"></span><br><span class="line">1 	node_modules æ•´ä¸ªé¡¹ç›®çš„ä¾èµ–</span><br><span class="line"></span><br><span class="line">2	pubic ico å›¾æ ‡</span><br><span class="line"></span><br><span class="line">3	pubic index.html æ•´ä¸ªé¡¹ç›®çš„è½½ä½“&lt;div id=<span class="string">"app"</span>&gt;&lt;/div&gt;  è·Ÿä¸Šé¢ğŸ‘†ç›´æ¥`&lt;/script&gt;`å¼•å…¥çš„divä¸€æ ·</span><br><span class="line"></span><br><span class="line">4	src æ•´ä¸ªé¡¹ç›®çš„æºä»£ç </span><br><span class="line"></span><br><span class="line">5	Main.js  é¡¹ç›®å…¥å£æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">6	babel.config.js  babelé…ç½®</span><br><span class="line"></span><br><span class="line">7	package.json ä¾èµ–åŒ…ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">8	è¯´æ˜</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å°†ä¸Šé¢çš„ç›´æ¥&lt;/script&gt;å¼•å…¥çš„demoæ”¹æˆå•æ–‡ä»¶å½¢å¼ğŸ‘‡ä¸‰ä¸ªæ¨¡å—ç‹¬ç«‹</span><br><span class="line"></span><br><span class="line">- æ¨¡ç‰ˆ template</span><br><span class="line">- é€»è¾‘ script</span><br><span class="line">- æ ·å¼ style</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;æ ·å¼ä½œç”¨åŸŸåªåœ¨è¯¥æ–‡ä»¶å†…æœ‰æ•ˆ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨App.vueæ–‡ä»¶çš„æ¨¡ç‰ˆä¸­æ›¿æ¢`div`å†…å®¹,æ–°å»ºä¸»ä»¶TodoItem.vue,åœ¨App.vueå¼•å…¥å¹¶ä½¿ç”¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li class=<span class="string">"item"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  props: [<span class="string">'item'</span>],</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.item &#123;</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>




<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &#123;&#123; message &#125;&#125;</span><br><span class="line">    &lt;div class=<span class="string">"addMethod"</span>&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">""</span> value=<span class="string">""</span> v-model=<span class="string">"info"</span>&gt;</span><br><span class="line">      &lt;button <span class="built_in">type</span>=<span class="string">"button"</span> name=<span class="string">"button"</span> @click=<span class="string">"handleClick"</span>&gt;add&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;todo-item v-for=<span class="string">"item in list"</span> :key=<span class="string">"item"</span> :item=<span class="string">"item"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/todo-item&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import TodoItem from <span class="string">'./components/TodoItem.vue'</span> //å¼•å…¥TodoItem</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  name: <span class="string">'app'</span>,</span><br><span class="line">  <span class="function"><span class="title">data</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> &#123;</span><br><span class="line">        message: <span class="string">'hello vue'</span>,</span><br><span class="line">        info: <span class="string">''</span>,</span><br><span class="line">        list: [],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleClick</span></span>() &#123;</span><br><span class="line">        this.list.push(this.info)</span><br><span class="line">        this.info = <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  components: &#123;</span><br><span class="line">    TodoItem,       //æ³¨å†ŒTodoItem</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>




<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;todo-item v-for=<span class="string">"item in list"</span> :key=<span class="string">"item"</span> :item=<span class="string">"item"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/todo-item&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ğŸ‘†æ˜¯é€šè¿‡å±æ€§æ¥ä¼ é€’itemï¼Œä¸‹é¢ğŸ‘‡æ”¹æˆæ’æ§½çš„æ–¹å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;span style=<span class="string">"font-size:20px"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;</span><br></pre></td></tr></table></figure>


<p>æ­¤æ—¶è§£æç”±<code>&lt;li class=&quot;item&quot;&gt;&lt;/li&gt;</code>æ”¹æˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;li class=<span class="string">"item"</span>&gt;</span><br><span class="line">  &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç»™æ’æ§½ä¸€ä¸ªåå­—(å…·åæ’æ§½)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;todo-item v-for=<span class="string">"item in list"</span> :key=<span class="string">"item"</span>&gt;</span><br><span class="line">	&lt;template id=<span class="string">""</span> v-slot:item &gt;</span><br><span class="line">   		&lt;span style=<span class="string">"font-size:20px"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;</span><br><span class="line">   &lt;/template&gt;</span><br><span class="line">&lt;/todo-item&gt;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li class=<span class="string">"item"</span>&gt;</span><br><span class="line">    &lt;slot name=<span class="string">"item"</span>&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>


<p>ä½œç”¨åŸŸæ’æ§½(ä½¿ç”¨åœºæ™¯ï¼šç”±å­æ§ä»¶ä¼ é€’å€¼ç»™çˆ¶æ§ä»¶ï¼Œä¾›çˆ¶æ§ä»¶ä½¿ç”¨ä¿®æ”¹æ˜¾ç¤ºï¼Œé€‰ä¸­ç”±çº¢å˜è“)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;todo-item v-for=<span class="string">"item in list"</span> :key=<span class="string">"item"</span>&gt;</span><br><span class="line">   &lt;template id=<span class="string">""</span> v-slot:item=<span class="string">"itemProps"</span>&gt; è·å–checkedçš„å€¼</span><br><span class="line">      &lt;span :style=<span class="string">"&#123;fontSize:'20px', color: itemProps.checked ? 'red' : 'blue' &#125;"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;</span><br><span class="line">   &lt;/template&gt;</span><br><span class="line">&lt;/todo-item&gt;</span><br></pre></td></tr></table></figure>





<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li class=<span class="string">"item"</span>&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">"checkbox"</span> v-model=<span class="string">"checked"</span>&gt;</span><br><span class="line">    &lt;slot name=<span class="string">"item"</span>  v-bind=<span class="string">"&#123;&#123;checked&#125;&#125;"</span>&gt;&lt;/slot&gt; //å°†checked ä¼ é€’å‡ºå»</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>


<p>åŠ¨æ‰‹å¤åˆ¶ä»£ç è·‘æ¥çœ‹çœ‹æ•ˆæœå§ ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li class=<span class="string">"item"</span>&gt;</span><br><span class="line">    &lt;input  <span class="built_in">type</span>=<span class="string">"checkbox"</span> v-model=<span class="string">"checked"</span>&gt;</span><br><span class="line">    &lt;slot name=<span class="string">"item"</span>  v-bind=<span class="string">"&#123;checked&#125;"</span>&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  props: [<span class="string">'item'</span>],</span><br><span class="line">  <span class="function"><span class="title">data</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> &#123;</span><br><span class="line">      checked:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.item &#123;</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &#123;&#123; message &#125;&#125;</span><br><span class="line">    &lt;div class=<span class="string">"addMethod"</span>&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">""</span> value=<span class="string">""</span> v-model=<span class="string">"info"</span>&gt;</span><br><span class="line">      &lt;button <span class="built_in">type</span>=<span class="string">"button"</span> name=<span class="string">"button"</span> @click=<span class="string">"handleClick"</span>&gt;add&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;todo-item v-for=<span class="string">"item in list"</span> :key=<span class="string">"item"</span>&gt;</span><br><span class="line">        &lt;template id=<span class="string">""</span> v-slot:item=<span class="string">"itemProps"</span>&gt;</span><br><span class="line">          &lt;span :style=<span class="string">"&#123;fontSize:'20px', color: itemProps.checked ? 'red' : 'blue' &#125;"</span>&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/todo-item&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import TodoItem from <span class="string">'./components/TodoItem.vue'</span> //å¼•å…¥TodoItem</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  name: <span class="string">'app'</span>,</span><br><span class="line">  <span class="function"><span class="title">data</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> &#123;</span><br><span class="line">        message: <span class="string">'hello vue'</span>,</span><br><span class="line">        info: <span class="string">''</span>,</span><br><span class="line">        list: [],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleClick</span></span>() &#123;</span><br><span class="line">        this.list.push(this.info)</span><br><span class="line">        this.info = <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  components: &#123;</span><br><span class="line">    TodoItem,       //æ³¨å†ŒTodoItem</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>



<h2 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h2><p><a href="https://cn.vuejs.org/v2/guide/conditional.html" target="_blank" rel="noopener">æ¡ä»¶æ¸²æŸ“å®˜æ–¹æ–‡æ¡£åœ°å€</a><br><code>v-if</code><br><code>v-else</code><br><code>v-show</code><br><code>v-for</code></p>
<h1 id="ç»„ä»¶åŸºç¡€-amp-ç»„ä»¶æ³¨å†Œ"><a href="#ç»„ä»¶åŸºç¡€-amp-ç»„ä»¶æ³¨å†Œ" class="headerlink" title="ç»„ä»¶åŸºç¡€&amp;ç»„ä»¶æ³¨å†Œ"></a>ç»„ä»¶åŸºç¡€&amp;ç»„ä»¶æ³¨å†Œ</h1><p><a href="https://cn.vuejs.org/v2/guide/components.html" target="_blank" rel="noopener">ç»„ä»¶åŸºç¡€</a></p>
<p><a href="https://cn.vuejs.org/v2/guide/components-registration.html" target="_blank" rel="noopener">ç»„ä»¶æ³¨å†Œ</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &#123;&#123;message&#125;&#125; &#123;&#123;message + message&#125;&#125;</span><br><span class="line">        &lt;div :id=<span class="string">"message"</span>&gt;&lt;/div&gt;</span><br><span class="line">        &lt;!-- &lt;ul&gt;</span><br><span class="line">            &lt;todo-item v-for=<span class="string">"item in list"</span> :title=<span class="string">"item.title"</span> :del=<span class="string">"item.del"</span>&gt;&lt;/todo-item&gt;</span><br><span class="line">        &lt;/ul&gt; --&gt;</span><br><span class="line">        &lt;todo-list&gt;&lt;/todo-list&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        Vue.component(<span class="string">'todo-item'</span>, &#123;</span><br><span class="line">            props: &#123;</span><br><span class="line">                title: String,</span><br><span class="line">                del: &#123;</span><br><span class="line">                    <span class="built_in">type</span>: Boolean,</span><br><span class="line">                    default: <span class="literal">false</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            template: `</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;span v-if=<span class="string">"!del"</span>&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span v-else style=<span class="string">"text-decoration: line-through"</span>&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;button v-show=<span class="string">"!del"</span>&gt;åˆ é™¤&lt;/button&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          `,</span><br><span class="line">            data: <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">                <span class="built_in">return</span> &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        Vue.component(<span class="string">'todo-list'</span>, &#123;</span><br><span class="line">            template: `</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">              &lt;todo-item v-for=<span class="string">"item in list"</span> :title=<span class="string">"item.title"</span> :del=<span class="string">"item.del"</span>&gt;&lt;/todo-item&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">          `,</span><br><span class="line">            data: <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">                <span class="built_in">return</span> &#123;</span><br><span class="line">                    list: [&#123;</span><br><span class="line">                        title: <span class="string">'è¯¾ç¨‹1'</span>,</span><br><span class="line">                        del: <span class="literal">false</span></span><br><span class="line">                    &#125;, &#123;</span><br><span class="line">                        title: <span class="string">'è¯¾ç¨‹2'</span>,</span><br><span class="line">                        del: <span class="literal">true</span></span><br><span class="line">                    &#125;],</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        var vm = new Vue(&#123;</span><br><span class="line">            el: <span class="string">'#app'</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                message: <span class="string">'hello world'</span>,</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<p>åœ¨Vueä¸­,ç»„ä»¶:å°å‹çš„ï¼Œä¸€ä¸ªä¸ªç‹¬ç«‹ï¼Œå¯ä»¥å¤ç”¨çš„UIæ¨¡å—ã€‚å®ƒæœ‰ä¸‰å¤§æ¦‚å¿µï¼šå±æ€§ã€äº‹ä»¶ã€æ’æ§½</p>
<h1 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h1><p><a href="https://cn.vuejs.org/v2/guide/components-props.html" target="_blank" rel="noopener">Prop</a></p>
<ul>
<li>è‡ªå®šä¹‰å±æ€§props<ul>
<li>ç»„ä»¶propsä¸­å£°æ˜çš„å±æ€§</li>
</ul>
</li>
<li>åŸç”Ÿå±æ€§attrs<ul>
<li>æ²¡æœ‰ç”Ÿå‘½çš„å±æ€§ï¼Œé»˜è®¤è‡ªåŠ¨æŒ‚è½½åˆ°ç»„ä»¶æ ¹å…ƒç´ ä¸Š</li>
<li>è®¾ç½®inheritAttrs ä¸ºfalseå¯ä»¥å…³é—­è‡ªåŠ¨æŒ‚è½½    </li>
</ul>
</li>
<li>ç‰¹æ®Šå±æ€§ classã€style<ul>
<li>æŒ‚è½½åˆ°ç»„ä»¶æ ¹å…ƒç´ ä¸Š</li>
<li>æ”¯æŒå­—ç¬¦ä¸²ã€å¯¹è±¡ã€æ•°ç»„ç­‰å¤šç§è¯­æ³•</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    name: &#123;&#123; name &#125;&#125;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    <span class="built_in">type</span>: &#123;&#123; <span class="built_in">type</span> &#125;&#125;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    list: &#123;&#123; list &#125;&#125;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    isVisible: &#123;&#123; isVisible &#125;&#125;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;button @click=<span class="string">"handleClick"</span>&gt;change <span class="built_in">type</span>&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  name: <span class="string">"PropsDemo"</span>,</span><br><span class="line">  // inheritAttrs: <span class="literal">false</span>,</span><br><span class="line">  // props: [<span class="string">'name'</span>, <span class="string">'type'</span>, <span class="string">'list'</span>, <span class="string">'isVisible'</span>],</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    <span class="built_in">type</span>: &#123;</span><br><span class="line">      validator: <span class="keyword">function</span>(value) &#123;</span><br><span class="line">        // è¿™ä¸ªå€¼å¿…é¡»åŒ¹é…ä¸‹åˆ—å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ª</span><br><span class="line">        <span class="built_in">return</span> [<span class="string">"success"</span>, <span class="string">"warning"</span>, <span class="string">"danger"</span>].includes(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    list: &#123;</span><br><span class="line">      <span class="built_in">type</span>: Array,</span><br><span class="line">      // å¯¹è±¡æˆ–æ•°ç»„é»˜è®¤å€¼å¿…é¡»ä»ä¸€ä¸ªå·¥å‚å‡½æ•°è·å–</span><br><span class="line">      default: () =&gt; []</span><br><span class="line">    &#125;,</span><br><span class="line">    isVisible: &#123;</span><br><span class="line">      <span class="built_in">type</span>: Boolean,</span><br><span class="line">      default: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    onChange: &#123;</span><br><span class="line">      <span class="built_in">type</span>: Function,</span><br><span class="line">      default: () =&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleClick</span></span>() &#123;</span><br><span class="line">      // ä¸è¦è¿™ä¹ˆåšã€ä¸è¦è¿™ä¹ˆåšã€ä¸è¦è¿™ä¹ˆåš</span><br><span class="line">      // this.type = <span class="string">"warning"</span>;</span><br><span class="line">      // å¯ä»¥ï¼Œè¿˜å¯ä»¥æ›´å¥½</span><br><span class="line">      this.onChange(this.type === <span class="string">"success"</span> ? <span class="string">"warning"</span> : <span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>




<h1 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h1><p><a href="https://cn.vuejs.org/v2/guide/events.html" target="_blank" rel="noopener">äº‹ä»¶å¤„ç†</a></p>
<ul>
<li><p>æ™®é€šæ—¶é—´</p>
<ul>
<li>@click,@input,@change,@xxxç­‰äº‹ä»¶</li>
<li>é€šè¿‡this.$emit(â€˜xxxâ€™,â€¦)è§¦å‘    </li>
</ul>
</li>
<li><p>ä¿®é¥°ç¬¦äº‹ä»¶</p>
<ul>
<li>@input.trim,@click.stop,@submit.prevent ç­‰</li>
<li>ä¸€èˆ¬ç”¨äºåŸç”Ÿhtmlå…ƒç´ ï¼Œè‡ªå®šä¹‰ç»„ä»¶éœ€è¦è‡ªè¡Œå¼€å‘æ”¯æŒ</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    name: &#123;&#123; name || <span class="string">"--"</span> &#125;&#125;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;input :value=<span class="string">"name"</span> @change=<span class="string">"handleChange"</span> /&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;div @click=<span class="string">"handleDivClick"</span>&gt;</span><br><span class="line">      &lt;button @click=<span class="string">"handleClick"</span>&gt;é‡ç½®æˆåŠŸ&lt;/button&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;button @click.stop=<span class="string">"handleClick"</span>&gt;é‡ç½®å¤±è´¥&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  name: <span class="string">"EventDemo"</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleChange(e) &#123;</span><br><span class="line">      this.<span class="variable">$emit</span>(<span class="string">"change"</span>, e.target.value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">handleDivClick</span></span>() &#123;</span><br><span class="line">      this.<span class="variable">$emit</span>(<span class="string">"change"</span>, <span class="string">""</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleClick(e) &#123;</span><br><span class="line">      // éƒ½ä¼šå¤±è´¥</span><br><span class="line">      //e.stopPropagation();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &#123;&#123;message&#125;&#125; &#123;&#123;message + message&#125;&#125;</span><br><span class="line">        &lt;div :id=<span class="string">"message"</span>&gt;&lt;/div&gt;</span><br><span class="line">        &lt;!-- &lt;ul&gt;</span><br><span class="line">            &lt;todo-item v-for=<span class="string">"item in list"</span> :title=<span class="string">"item.title"</span> :del=<span class="string">"item.del"</span>&gt;&lt;/todo-item&gt;</span><br><span class="line">        &lt;/ul&gt; --&gt;</span><br><span class="line">        &lt;todo-list&gt;&lt;/todo-list&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        Vue.component(<span class="string">'todo-item'</span>, &#123;</span><br><span class="line">            props: &#123;</span><br><span class="line">                title: String,</span><br><span class="line">                del: &#123;</span><br><span class="line">                    <span class="built_in">type</span>: Boolean,</span><br><span class="line">                    default: <span class="literal">false</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            template: `</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;span v-if=<span class="string">"!del"</span>&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span v-else style=<span class="string">"text-decoration: line-through"</span>&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;button v-show=<span class="string">"!del"</span> @click=<span class="string">"handleClick"</span>&gt;åˆ é™¤&lt;/button&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          `,</span><br><span class="line">            data: <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">                <span class="built_in">return</span> &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                handleClick(e) &#123;</span><br><span class="line">                    console.log(<span class="string">'ç‚¹å‡»åˆ é™¤æŒ‰é’®'</span>)</span><br><span class="line">                    this.<span class="variable">$emit</span>(<span class="string">'delete'</span>, this.title)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        Vue.component(<span class="string">'todo-list'</span>, &#123;</span><br><span class="line">            template: `</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">              &lt;todo-item @delete=<span class="string">"handleDelete"</span> v-for=<span class="string">"item in list"</span> :title=<span class="string">"item.title"</span> :del=<span class="string">"item.del"</span>&gt;&lt;/todo-item&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">          `,</span><br><span class="line">            data: <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">                <span class="built_in">return</span> &#123;</span><br><span class="line">                    list: [&#123;</span><br><span class="line">                        title: <span class="string">'è¯¾ç¨‹1'</span>,</span><br><span class="line">                        del: <span class="literal">false</span></span><br><span class="line">                    &#125;, &#123;</span><br><span class="line">                        title: <span class="string">'è¯¾ç¨‹2'</span>,</span><br><span class="line">                        del: <span class="literal">true</span></span><br><span class="line">                    &#125;],</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                handleDelete(val) &#123;</span><br><span class="line">                    console.log(<span class="string">'handleDelete'</span>, val)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        var vm = new Vue(&#123;</span><br><span class="line">            el: <span class="string">'#app'</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                message: <span class="string">'hello world'</span>,</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>




<h1 id="æ’æ§½"><a href="#æ’æ§½" class="headerlink" title="æ’æ§½"></a>æ’æ§½</h1><p><a href="https://cn.vuejs.org/v2/guide/components-slots.html" target="_blank" rel="noopener">æ’æ§½</a></p>
<ul>
<li>æ™®é€šæ’æ§½<ul>
<li><code>&lt;template slot=&quot;xxx&quot;&gt;...&lt;/template&gt;</code></li>
<li><code>&lt;template v-slot:xxx&gt;...&lt;/template&gt;</code></li>
</ul>
</li>
</ul>
<ul>
<li>ä½œç”¨åŸŸæ’æ§½    <ul>
<li><code>&lt;template slot=&quot;xxx&quot; slot-scope=&quot;props&quot;&gt;...&lt;/template&gt;</code></li>
<li><code>&lt;template v-slot:xxx=&quot;props&quot;&gt;...&lt;/template&gt;</code></li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;slot /&gt;</span><br><span class="line">    &lt;slot name=<span class="string">"title"</span> /&gt;</span><br><span class="line">    &lt;slot name=<span class="string">"item"</span> v-bind=<span class="string">"&#123; value: 'vue' &#125;"</span> /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  name: <span class="string">"SlotDemo"</span></span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸‡ç‰©çš†â€œå±æ€§â€ï¼Œå³å®ƒä»¬éƒ½æ˜¯çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶ï¼Œç„¶åå­ç»„ä»¶æ ¹æ®ä¼ é€’çš„å†…å®¹æ¥æ‰§è¡Œå¯¹åº”çš„è¡Œä¸ºã€‚è¯·çœ‹demo</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123; name &#125;&#125;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;button @click=<span class="string">"handleChange"</span>&gt;change name&lt;/button&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;!-- &#123;&#123; slotDefault &#125;&#125; --&gt;</span><br><span class="line">    &lt;VNodes :vnodes=<span class="string">"slotDefault"</span> /&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;VNodes :vnodes=<span class="string">"slotTitle"</span> /&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;VNodes :vnodes=<span class="string">"slotScopeItem(&#123; value: 'vue' &#125;)"</span> /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  name: <span class="string">"BigProps"</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    VNodes: &#123;</span><br><span class="line">      functional: <span class="literal">true</span>,</span><br><span class="line">      render: (h, ctx) =&gt; ctx.props.vnodes</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    onChange: &#123;</span><br><span class="line">      <span class="built_in">type</span>: Function,</span><br><span class="line">      default: () =&gt; &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    slotDefault: Array,</span><br><span class="line">    slotTitle: Array,</span><br><span class="line">    slotScopeItem: &#123;</span><br><span class="line">      <span class="built_in">type</span>: Function,</span><br><span class="line">      default: () =&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleChange</span></span>() &#123;</span><br><span class="line">      this.onChange(<span class="string">"Hello vue!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &#123;&#123;message&#125;&#125; &#123;&#123;message + message&#125;&#125;</span><br><span class="line">        &lt;div :id=<span class="string">"message"</span>&gt;&lt;/div&gt;</span><br><span class="line">        &lt;!-- &lt;ul&gt;</span><br><span class="line">            &lt;todo-item v-for=<span class="string">"item in list"</span> :title=<span class="string">"item.title"</span> :del=<span class="string">"item.del"</span>&gt;&lt;/todo-item&gt;</span><br><span class="line">        &lt;/ul&gt; --&gt;</span><br><span class="line">        &lt;todo-list&gt;</span><br><span class="line">            &lt;todo-item @delete=<span class="string">"handleDelete"</span> v-for=<span class="string">"item in list"</span> :title=<span class="string">"item.title"</span> :del=<span class="string">"item.del"</span>&gt;</span><br><span class="line">                &lt;template v-slot:pre-icon=<span class="string">"&#123;value&#125;"</span>&gt;</span><br><span class="line">                    &lt;span&gt;å‰ç½®å›¾æ ‡ &#123;&#123;value&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/todo-item&gt;</span><br><span class="line">        &lt;/todo-list&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        Vue.component(<span class="string">'todo-item'</span>, &#123;</span><br><span class="line">            props: &#123;</span><br><span class="line">                title: String,</span><br><span class="line">                del: &#123;</span><br><span class="line">                    <span class="built_in">type</span>: Boolean,</span><br><span class="line">                    default: <span class="literal">false</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            template: `</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;slot name=<span class="string">"pre-icon"</span> :value=<span class="string">"value"</span>&gt;&lt;/slot&gt;</span><br><span class="line">                &lt;span v-if=<span class="string">"!del"</span>&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span v-else style=<span class="string">"text-decoration: line-through"</span>&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;slot name=<span class="string">"suf-icon"</span>&gt;ğŸ˜„&lt;/slot&gt;</span><br><span class="line">                &lt;button v-show=<span class="string">"!del"</span> @click=<span class="string">"handleClick"</span>&gt;åˆ é™¤&lt;/button&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          `,</span><br><span class="line">            data: <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">                <span class="built_in">return</span> &#123;</span><br><span class="line">                    value: Math.random()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                handleClick(e) &#123;</span><br><span class="line">                    console.log(<span class="string">'ç‚¹å‡»åˆ é™¤æŒ‰é’®'</span>)</span><br><span class="line">                    this.<span class="variable">$emit</span>(<span class="string">'delete'</span>, this.title)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        Vue.component(<span class="string">'todo-list'</span>, &#123;</span><br><span class="line">            template: `</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">              &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">          `,</span><br><span class="line">            data: <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">                <span class="built_in">return</span> &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        var vm = new Vue(&#123;</span><br><span class="line">            el: <span class="string">'#app'</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                message: <span class="string">'hello world'</span>,</span><br><span class="line">                list: [&#123;</span><br><span class="line">                    title: <span class="string">'è¯¾ç¨‹1'</span>,</span><br><span class="line">                    del: <span class="literal">false</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    title: <span class="string">'è¯¾ç¨‹2'</span>,</span><br><span class="line">                    del: <span class="literal">true</span></span><br><span class="line">                &#125;],</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                handleDelete(val) &#123;</span><br><span class="line">                    console.log(<span class="string">'handleDelete'</span>, val)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<h1 id="ç†è§£å•æ–‡ä»¶ç»„ä»¶"><a href="#ç†è§£å•æ–‡ä»¶ç»„ä»¶" class="headerlink" title="ç†è§£å•æ–‡ä»¶ç»„ä»¶"></a>ç†è§£å•æ–‡ä»¶ç»„ä»¶</h1><p>æ„æ€æ˜¯é€šè¿‡<a href="https://cli.vuejs.org/" target="_blank" rel="noopener">Vue CLI</a>æ„å»ºæ•´ä¸ªé¡¹ç›®ï¼Œè€Œä¸æ˜¯å•ä¸ªhtmlæ–‡ä»¶ã€‚</p>
<h1 id="åŒå‘ç»‘å®šå’Œå•å‘æ•°æ®æµä¸å†²çª"><a href="#åŒå‘ç»‘å®šå’Œå•å‘æ•°æ®æµä¸å†²çª" class="headerlink" title="åŒå‘ç»‘å®šå’Œå•å‘æ•°æ®æµä¸å†²çª"></a>åŒå‘ç»‘å®šå’Œå•å‘æ•°æ®æµä¸å†²çª</h1><h2 id="v-modelåˆ›å»ºåŒå‘ç»‘å®š"><a href="#v-modelåˆ›å»ºåŒå‘ç»‘å®š" class="headerlink" title="v-modelåˆ›å»ºåŒå‘ç»‘å®š"></a>v-modelåˆ›å»ºåŒå‘ç»‘å®š</h2><p>åŒå‘ç»‘å®šï¼šæ•°æ®æ›´æ–°æ—¶ï¼Œè§†å›¾åŒæ­¥æ›´æ–°ï¼›åè¿‡æ¥è§†å›¾æ›´æ–°æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šæ›´æ–°ã€‚å¯ä»¥é€šè¿‡<code>v-model</code>æ¥åˆ›å»ºåŒå‘ç»‘å®šã€‚</p>
<p><a href="https://cn.vuejs.org/v2/guide/components.html#%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BD%BF%E7%94%A8-v-model" target="_blank" rel="noopener">v-model</a></p>
<p>æ–‡æ¡£åœ¨<a href="https://cn.vuejs.org/v2/guide/forms.html" target="_blank" rel="noopener">è¡¨å•è¾“å…¥ç»‘å®š</a>æœ‰è¯´æ˜ï¼š</p>
<blockquote>
<p>v-model åœ¨å†…éƒ¨ä¸ºä¸åŒçš„è¾“å…¥å…ƒç´ ä½¿ç”¨ä¸åŒçš„å±æ€§å¹¶æŠ›å‡ºä¸åŒçš„äº‹ä»¶ï¼š</p>
</blockquote>
<ul>
<li>text å’Œ textarea å…ƒç´ ä½¿ç”¨ value å±æ€§å’Œ input äº‹ä»¶ï¼›</li>
<li>checkbox å’Œ radio ä½¿ç”¨ checked å±æ€§å’Œ change äº‹ä»¶ï¼›</li>
<li>select å­—æ®µå°† value ä½œä¸º prop å¹¶å°† change ä½œä¸ºäº‹ä»¶ã€‚</li>
</ul>
<p><a href="https://cn.vuejs.org/v2/guide/components-custom-events.html" target="_blank" rel="noopener">è‡ªå®šä¹‰ç»„ä»¶çš„ v-model</a></p>
<h2 id="syncä¿®é¥°ç¬¦-åˆ›å»ºåŒå‘ç»‘å®š"><a href="#syncä¿®é¥°ç¬¦-åˆ›å»ºåŒå‘ç»‘å®š" class="headerlink" title=".syncä¿®é¥°ç¬¦ åˆ›å»ºåŒå‘ç»‘å®š"></a>.syncä¿®é¥°ç¬¦ åˆ›å»ºåŒå‘ç»‘å®š</h2><p><a href="https://cn.vuejs.org/v2/guide/components-custom-events.html#sync-%E4%BF%AE%E9%A5%B0%E7%AC%A6" target="_blank" rel="noopener">.sync ä¿®é¥°ç¬¦</a></p>
<h2 id="å•å‘æ•°æ®æµ"><a href="#å•å‘æ•°æ®æµ" class="headerlink" title="å•å‘æ•°æ®æµ"></a>å•å‘æ•°æ®æµ</h2><p><a href="https://cn.vuejs.org/v2/guide/components-props.html#%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81" target="_blank" rel="noopener">å•å‘æ•°æ®æµ</a></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>Vueæ˜¯å•å‘æ•°æ®æµï¼Œä¸æ˜¯åŒå‘ç»‘å®š</li>
<li>Vueçš„åŒå‘ç»‘å®šä¸è¿‡æ˜¯è¯­æ³•ç³–</li>
<li>Object.definePropertyæ˜¯ç”¨æ¥åšå“åº”å¼æ›´æ–°çš„ï¼Œå’ŒåŒå‘ç»‘å®šæ²¡å…³ç³»</li>
<li>v-modelæ¥å®ç°åŒå‘ç»‘å®šçš„å®è´¨æ˜¯ï¼šå±æ€§çš„ä¼ é€’å’Œäº‹ä»¶çš„å›è°ƒæ¥åšä¸€ä¸ªæ•°æ®æ›´æ–°ã€‚æ‰€ä»¥è¯´å®ƒä»…ä»…æ˜¯è¯­æ³•ç³–è€Œå·²ã€‚</li>
</ul>
<h1 id="å¦‚ä½•è§¦å‘ç»„ä»¶çš„æ›´æ–°"><a href="#å¦‚ä½•è§¦å‘ç»„ä»¶çš„æ›´æ–°" class="headerlink" title="å¦‚ä½•è§¦å‘ç»„ä»¶çš„æ›´æ–°"></a>å¦‚ä½•è§¦å‘ç»„ä»¶çš„æ›´æ–°</h1><p>æ•°æ®æ¥æºï¼ˆå•å‘çš„ï¼‰</p>
<ul>
<li>æ¥è‡ªçˆ¶ç±»å…ƒç´ çš„å±æ€§</li>
<li>æ¥è‡ªç»„ä»¶è‡ªèº«çš„çŠ¶æ€ data</li>
<li>æ¥è‡ªçŠ¶æ€ç®¡ç†å™¨</li>
</ul>
<p>çŠ¶æ€data å’Œ å±æ€§props åŒºåˆ«</p>
<ul>
<li>çŠ¶æ€æ˜¯ç»„ä»¶è‡ªèº«çš„æ•°æ®</li>
<li>å±æ€§æ¥è‡ªçˆ¶ç»„ä»¶çš„æ•°æ®</li>
<li>çŠ¶æ€æˆ–è€…å±æ€§çš„æ”¹å˜æœªå¿…ä¼šè®©è§†å›¾æ›´æ–°ï¼ˆåªæœ‰åšäº†å“åº”æ‰ä¼šæ›´æ–°ï¼Œå³æ”¾åœ¨äº†returné‡Œé¢ï¼‰</li>
</ul>
<h1 id="åˆç†åº”ç”¨è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨"><a href="#åˆç†åº”ç”¨è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨" class="headerlink" title="åˆç†åº”ç”¨è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨"></a>åˆç†åº”ç”¨è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨</h1><p>ã€€<br>è®¡ç®—å±æ€§computed</p>
<ul>
<li>å‡å°‘æ¨¡ç‰ˆä¸­çš„è®¡ç®—é€»è¾‘</li>
<li>æ•°æ®ç¼“å­˜</li>
<li>ä»¥æ¥å›ºå®šçš„æ•°æ®ç±»å‹ï¼ˆå“åº”å¼ç¼–ç¨‹ï¼‰</li>
</ul>
<p>ä¾¦å¬å™¨watchä¸­å¯ä»¥æ‰§è¡Œä»»ä½•é€»è¾‘ï¼Œå¦‚å‡½æ•°èŠ‚æµï¼ŒAjaxå¼‚æ­¥è·å–æ•°æ®ï¼Œç”šè‡³æ“ä½œcom</p>
<p>æ€»ä¹‹ï¼Œcomputedèƒ½åšçš„ï¼Œwatchéƒ½èƒ½åšï¼Œåä¹‹åˆ™ä¸è¡Œï¼›èƒ½ç”¨computedçš„å°½é‡ç”¨computedï¼›</p>
<h1 id="ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨åœºæ™¯å’Œå‡½æ•°å¼ç»„ä»¶"><a href="#ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨åœºæ™¯å’Œå‡½æ•°å¼ç»„ä»¶" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨åœºæ™¯å’Œå‡½æ•°å¼ç»„ä»¶"></a>ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨åœºæ™¯å’Œå‡½æ•°å¼ç»„ä»¶</h1><p><a href="https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA" target="_blank" rel="noopener">ç”Ÿå‘½å‘¨æœŸå›¾ç¤º</a></p>
<p>å‡½æ•°å¼ç»„ä»¶</p>
<ul>
<li>functional:true å¯ä»¥å°†å®ƒçœ‹ä½œä¸€ä¸ªæ–¹æ³•</li>
<li>æ— çŠ¶æ€ã€æ— å®åŠ›ã€æ²¡æœ‰thisä¸Šä¸‹æ–‡ã€æ— ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<h1 id="æŒ‡ä»¤çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ"><a href="#æŒ‡ä»¤çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="æŒ‡ä»¤çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ"></a>æŒ‡ä»¤çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ</h1><p><a href="https://github.com/tangjinzhou/geektime-vue-1/tree/master/%E6%BC%94%E7%A4%BADEMO%E6%BA%90%E7%A0%81/src/views/1.7" target="_blank" rel="noopener">æºç æ¼”ç¤º</a></p>
<h1 id="provide-amp-inject"><a href="#provide-amp-inject" class="headerlink" title="provide &amp; inject"></a>provide &amp; inject</h1><p><a href="https://cn.vuejs.org/v2/api/#provide-inject" target="_blank" rel="noopener">provide / inject</a></p>
<p><a href="https://github.com/tangjinzhou/geektime-vue-1/tree/master/%E6%BC%94%E7%A4%BADEMO%E6%BA%90%E7%A0%81/src/views/1.8" target="_blank" rel="noopener">æºç æ¼”ç¤º</a></p>
<p>è§£å†³è·¨ç»„ä»¶é—´çš„å±æ€§ä¼ é€’é—®é¢˜ã€‚</p>
<h1 id="è·å–è·¨å±‚çº§ç»„ä»¶å®ä¾‹"><a href="#è·å–è·¨å±‚çº§ç»„ä»¶å®ä¾‹" class="headerlink" title="è·å–è·¨å±‚çº§ç»„ä»¶å®ä¾‹"></a>è·å–è·¨å±‚çº§ç»„ä»¶å®ä¾‹</h1><p><a href="https://github.com/tangjinzhou/geektime-vue-1/tree/master/%E6%BC%94%E7%A4%BADEMO%E6%BA%90%E7%A0%81/src/views/1.9" target="_blank" rel="noopener">æºç æ¼”ç¤º</a></p>
<h1 id="template-VS-JSX"><a href="#template-VS-JSX" class="headerlink" title="template VS JSX"></a>template VS JSX</h1><p><a href="https://github.com/tangjinzhou/geektime-vue-1/tree/master/%E6%BC%94%E7%A4%BADEMO%E6%BA%90%E7%A0%81/src/views/1.10" target="_blank" rel="noopener">æºç æ¼”ç¤º</a></p>
<h1 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h1><p><a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener">Vuex</a> æ˜¯ä¸€ä¸ªä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä»¥ç›¸åº”çš„è§„åˆ™ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚</p>
<ul>
<li>stateï¼Œé©±åŠ¨åº”ç”¨çš„æ•°æ®æºï¼›</li>
<li>viewï¼Œä»¥å£°æ˜æ–¹å¼å°† state æ˜ å°„åˆ°è§†å›¾ï¼›</li>
<li>actionsï¼Œå“åº”åœ¨ view ä¸Šçš„ç”¨æˆ·è¾“å…¥å¯¼è‡´çš„çŠ¶æ€å˜åŒ–ã€‚
ã€€<h1 id="åœ¨Vueä¸­ä½¿ç”¨Vuex"><a href="#åœ¨Vueä¸­ä½¿ç”¨Vuex" class="headerlink" title="åœ¨Vueä¸­ä½¿ç”¨Vuex"></a>åœ¨Vueä¸­ä½¿ç”¨Vuex</h1></li>
</ul>
<p><a href="https://github.com/tangjinzhou/geektime-vue-1/tree/master/vuex-demo1" target="_blank" rel="noopener">æºç æ¼”ç¤º</a></p>
<h1 id="VuexåŸç†"><a href="#VuexåŸç†" class="headerlink" title="VuexåŸç†"></a>VuexåŸç†</h1><ul>
<li><code>State</code>æä¾›ä¸€ä¸ªå“åº”å¼æ•°æ®</li>
<li><code>Getter</code>å€ŸåŠ©Vueçš„è®¡ç®—å±æ€§computedæ¥å®ç°ç¼“å­˜</li>
<li><code>Mutation</code>æ›´æ”¹stateæ–¹æ³•</li>
<li><code>Action</code>è§¦å‘mutationæ–¹æ³•</li>
<li><code>Module</code>Vue.setåŠ¨æ€æ·»åŠ stateåˆ°å“åº”å¼æ•°æ®ä¸­</li>
</ul>
<h1 id="Vue-Router"><a href="#Vue-Router" class="headerlink" title="Vue Router"></a>Vue Router</h1><p><a href="https://router.vuejs.org/zh/" target="_blank" rel="noopener">Vue Router</a></p>
<p><a href="https://github.com/tangjinzhou/geektime-vue-1/tree/master/router-demo" target="_blank" rel="noopener">æºç æ¼”ç¤º</a></p>
<h1 id="Nuxt"><a href="#Nuxt" class="headerlink" title="Nuxt"></a>Nuxt</h1><p><a href="https://zh.nuxtjs.org/" target="_blank" rel="noopener">Nuxt</a></p>
<h1 id="å¼€å‘æ’ä»¶"><a href="#å¼€å‘æ’ä»¶" class="headerlink" title="å¼€å‘æ’ä»¶"></a>å¼€å‘æ’ä»¶</h1><p>vs codeæ’ä»¶ï¼šVeturï¼šä»£ç å—åŠŸèƒ½</p>
<p>ESLint:ä»£ç è§„èŒƒã€é”™è¯¯æ£€æŸ¥ã€</p>
<p>Prettier:ä»£ç è§„èŒƒæç¤º</p>
<h1 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h1><p>ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li>jestæˆ–è€…mocha</li>
<li>@vue/test-utils</li>
<li>sinon</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue create XX</span><br><span class="line">Manually select features</span><br><span class="line">é™¤äº†é»˜è®¤ä¹‹å¤–è¿˜éœ€è¦å‹¾é€‰ Unit Testing</span><br><span class="line">é€‰ç”¨ESLint + Standard config </span><br><span class="line">Lint on save</span><br><span class="line">JEST</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/geektime-geekbang/geektime-vue-1/tree/master/test-demo" target="_blank" rel="noopener">demo</a></p>
<h1 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h1><h2 id="åˆ›å»ºå·¥ç¨‹"><a href="#åˆ›å»ºå·¥ç¨‹" class="headerlink" title="åˆ›å»ºå·¥ç¨‹"></a>åˆ›å»ºå·¥ç¨‹</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  Vue_app git:(master) vue create  vue-app</span><br></pre></td></tr></table></figure>

<p>æ‰‹åŠ¨é€‰æ‹©</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> â—‰ Babel</span><br><span class="line"> â—¯ TypeScript</span><br><span class="line"> â—¯ Progressive Web App (PWA) Support</span><br><span class="line"> â—‰ Router</span><br><span class="line"> â—‰ Vuex</span><br><span class="line"> â—‰ CSS Pre-processors</span><br><span class="line"> â—‰ Linter / Formatter</span><br><span class="line">â¯â—‰ Unit Testing</span><br><span class="line"> â—¯ E2E Testing</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–é€‰é¡¹<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> ? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> produc</span><br><span class="line">tion) Yes</span><br><span class="line">? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by defaul</span><br><span class="line">t): Less</span><br><span class="line">? Pick a linter / formatter config: Prettier</span><br><span class="line">? Pick additional lint features: </span><br><span class="line"> â—‰ Lint on save</span><br><span class="line">â¯â—‰ Lint and fix on commit</span><br><span class="line">? Pick additional lint features: Lint on save, Lint and fix on commit</span><br><span class="line">? Pick a unit testing solution: Jest</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? Yes</span><br><span class="line">? Save preset as: vue-app</span><br><span class="line">? Pick the package manager to use when installing dependencies: Yarn</span><br></pre></td></tr></table></figure></p>
<p>å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> vue-app</span><br><span class="line">$ yarn serve</span><br></pre></td></tr></table></figure>

<p>å®‰è£…ä¸¤ä¸ªä¾èµ–åŒ…ï¼ˆä¸Šé¢æ­¥éª¤åˆ›å»ºå·¥ç¨‹æ—¶é€‰æ‹©äº†Yarnæ„å»ºï¼Œç°åœ¨é€šè¿‡npmå®‰è£…ä¾èµ–åŒ…ä¹Ÿæ˜¯å¯ä»¥çš„åŸæ¥ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i ant-design-vue moment</span><br></pre></td></tr></table></figure>

<h2 id="æ›´æ”¹æ„å»ºæ–¹å¼"><a href="#æ›´æ”¹æ„å»ºæ–¹å¼" class="headerlink" title="æ›´æ”¹æ„å»ºæ–¹å¼"></a>æ›´æ”¹æ„å»ºæ–¹å¼</h2><p><a href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create" target="_blank" rel="noopener">æ–‡æ¡£è¯´æ˜</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi ~/.vuerc </span><br><span class="line">ä¿®æ”¹ï¼š <span class="string">"packageManager"</span>: <span class="string">"yarn"</span>, <span class="comment">#æˆ–è€…æ˜¯npm</span></span><br><span class="line"><span class="built_in">source</span>  ~/.vuerc</span><br></pre></td></tr></table></figure>

<p>æˆ‘è‡ªå·±ä¹Ÿé‡æ–°æ“ä½œäº†ä¸€ä¸‹ï¼Œé¡¹ç›®æ„å»ºæˆåŠŸä¹‹åçš„æç¤ºä¸º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> vue-app</span><br><span class="line">$ npm run serve</span><br></pre></td></tr></table></figure>


<h2 id="webpacké…ç½®"><a href="#webpacké…ç½®" class="headerlink" title="webpacké…ç½®"></a>webpacké…ç½®</h2> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"> ERROR  Failed to compile with 1 errors                                                            7:20:06 PM</span><br><span class="line"></span><br><span class="line"> error  <span class="keyword">in</span> ./node_modules/ant-design-vue/dist/antd.less</span><br><span class="line"></span><br><span class="line">Module build failed (from ./node_modules/less-loader/dist/cjs.js):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// https://github.com/ant-design/ant-motion/issues/44</span><br><span class="line">.bezierEasingMixin();</span><br><span class="line">^</span><br><span class="line">Inline JavaScript is not enabled. Is it <span class="built_in">set</span> <span class="keyword">in</span> your options?</span><br><span class="line">      <span class="keyword">in</span> /Users/samtake/Documents/GitHub/Vue_app/vue-app/node_modules/ant-design-vue/lib/style/color/bezierEa</span><br><span class="line">sing.less (line 110, column 0)</span><br><span class="line"></span><br><span class="line"> @ ./node_modules/ant-design-vue/dist/antd.less 4:14-188 14:3-18:5 15:22-196</span><br><span class="line"> @ ./src/main.js</span><br><span class="line"> @ multi (webpack)-dev-server/client?http://192.168.0.103:8086/sockjs-node (webpack)/hot/dev-server.js ./src/</span><br><span class="line">main.js</span><br></pre></td></tr></table></figure>


<p> <a href="https://cli.vuejs.org/zh/config/#css-loaderoptions" target="_blank" rel="noopener">css.loaderOptions</a></p>
<p> æ–°å»ºä¸€ä¸ª<code>vue.config.js</code>æ–‡ä»¶<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    css: &#123;</span><br><span class="line">        loaderOptions: &#123;</span><br><span class="line">          less: &#123;</span><br><span class="line">            // è¿™é‡Œçš„é€‰é¡¹ä¼šä¼ é€’ç»™ css-loader</span><br><span class="line">            javascriptEnabled:<span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‡æ–°å¯åŠ¨æ„å»º<code>npm run serve</code></p>
<h2 id="æŒ‰éœ€åŠ è½½"><a href="#æŒ‰éœ€åŠ è½½" class="headerlink" title="æŒ‰éœ€åŠ è½½"></a>æŒ‰éœ€åŠ è½½</h2><p><a href="https://www.antdv.com/docs/vue/introduce-cn/#%E7%A4%BA%E4%BE%8B" target="_blank" rel="noopener">æ–‡æ¡£</a></p>
<p>é…ç½®babel.config.jsæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"import"</span>, &#123; <span class="string">"libraryName"</span>: <span class="string">"ant-design-vue"</span>, <span class="string">"libraryDirectory"</span>: <span class="string">"es"</span>, <span class="string">"style"</span>: <span class="literal">true</span> &#125;] // `style: <span class="literal">true</span>` ä¼šåŠ è½½ less æ–‡ä»¶</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">import  &#123;Button&#125;  from <span class="string">'ant-design-vue'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">npm i --save-dev babel-plugin-import</span><br></pre></td></tr></table></figure>


<h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p>åŒæ—¶åˆ·æ–°URLè·¯å¾„çš„æ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i nprogress</span><br></pre></td></tr></table></figure>


<p>æœ‰ä¸¤ç§åŠ è½½æ–¹å¼ï¼Œæ¨èè¿™ç§ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">component: &#123; render: h =&gt; h(<span class="string">"router-view"</span>) &#125;,</span><br></pre></td></tr></table></figure>

<p>App.vue</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &lt;div id=<span class="string">"nav"</span>&gt;</span><br><span class="line">      &lt;router-link to=<span class="string">"/dashboard/analysis"</span>&gt;dashboard&lt;/router-link&gt; |</span><br><span class="line">      &lt;router-link to=<span class="string">"/form"</span>&gt;form&lt;/router-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;router-view /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=<span class="string">"less"</span>&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>BasicLayout.vue</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &lt;SiderMenu /&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;Footer /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Header from <span class="string">"./Header"</span>;</span><br><span class="line">import Footer from <span class="string">"./Footer"</span>;</span><br><span class="line">import SiderMenu from <span class="string">"./SiderMenu"</span>;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    Header,</span><br><span class="line">    Footer,</span><br><span class="line">    SiderMenu</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>


<h2 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h2><p><a href="https://www.antdv.com/components/layout-cn/" target="_blank" rel="noopener">Layout å¸ƒå±€</a></p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>C++é‡æ¸©</title>
    <url>/2019/11/04/C++%E9%87%8D%E6%B8%A9/</url>
    <content><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3850802-c610324dffd5bcc2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Cè‰¹.jpg"></p>
<p>demoé“¾æ¥ğŸ”—<a href="https://github.com/samtake/C-review" target="_blank" rel="noopener">https://github.com/samtake/C-review</a></p>
<h1 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h1><h2 id="å†…è”å‡½æ•°"><a href="#å†…è”å‡½æ•°" class="headerlink" title="å†…è”å‡½æ•°"></a>å†…è”å‡½æ•°</h2><p>C++æä¾›äº†ç¨‹åºå†…è”æœºåˆ¶æ¥å‡å°‘å‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚åœ¨å‡½æ•°å®šä¹‰çš„è¿”å›å€¼ç±»å‹å‰é¢åŠ ä¸€ä¸ª<code>inline</code>å…³é”®å­—ï¼Œâ€œå»ºè®®â€ç¼–è¯‘å™¨å‡½æ•°ä»£ç å¤åˆ¶åˆ°ç¨‹åºä¸­ï¼Œé¿å…å‡½æ•°è°ƒç”¨ã€‚<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">using std::cout;</span><br><span class="line">using std::cin;</span><br><span class="line">using std::endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inline double cube(const double side)&#123;</span><br><span class="line">    <span class="built_in">return</span> side*side*side;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">testInlineFunction</span></span>()&#123;</span><br><span class="line">    double sideValue;</span><br><span class="line">    <span class="keyword">for</span> (int i=1 ; i&lt;=3 ; i++) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">"enter the side length of your cube:"</span>;</span><br><span class="line">        cin &gt;&gt;sideValue;</span><br><span class="line">        </span><br><span class="line">        cout &lt;&lt; <span class="string">"side="</span> &lt;&lt; sideValue &lt;&lt; <span class="string">"cube="</span> &lt;&lt; cube(sideValue) &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>using std::cout;</code>usingè¯­å¥ä½¿æˆ‘ä»¬ä¸ç”¨é‡å¤å†™<code>std::</code>å‰ç¼€ï¼›æˆ–è€…ä½¿ç”¨<code>using namespace std;</code>ä»£æ›¿ã€‚</li>
</ul>
<h2 id="å¼•ç”¨ä»¥åŠå¼•ç”¨å½¢å‚"><a href="#å¼•ç”¨ä»¥åŠå¼•ç”¨å½¢å‚" class="headerlink" title="å¼•ç”¨ä»¥åŠå¼•ç”¨å½¢å‚"></a>å¼•ç”¨ä»¥åŠå¼•ç”¨å½¢å‚</h2><ul>
<li>ä¸¤ç§ä¼ å‚æ–¹å¼æ˜¯ï¼šæŒ‰å€¼ä¼ é€’å’ŒæŒ‰å¼•ç”¨ä¼ é€’ã€‚</li>
<li>é‡‡ç”¨æŒ‰å€¼ä¼ é€’æ–¹å¼ä¼ å‚æ—¶ï¼Œé¦–å…ˆç”Ÿæˆå®å‚å€¼çš„å‰¯æœ¬ï¼Œç„¶åå°†è¯¥å€¼ä¼ é€’ç»™è¢«è°ƒå‡½æ•°ã€‚æ”¹å˜å‰¯æœ¬çš„å€¼ä¸ä¼šå½±å“ä¸»è°ƒå‡½æ•°ä¸­å®å‚çš„å€¼ã€‚</li>
<li>é€šè¿‡æŒ‰å¼•ç”¨ä¼ å‚ï¼Œå…è®¸è¢«è°ƒå‡½æ•°ç›´æ¥è®¿é—®ä¸»è°ƒå‡½æ•°ä¸­çš„æ•°æ®ï¼Œå…è®¸è¢«è°ƒå‡½æ•°æœ‰é€‰æ‹©çš„ä¿®æ”¹ä¸»è°ƒå‡½æ•°ä¸­çš„æ•°æ®ã€‚</li>
<li>å¼•ç”¨å®å‚æ˜¯å…¶å¯¹åº”çš„å‡½æ•°è°ƒç”¨ä¸­å®å‚çš„åˆ«åã€‚</li>
<li>é€šè¿‡<code>&amp;</code>æ¥æ ‡è®°æŒ‰å¼•ç”¨ä¼ å‚</li>
</ul>
<p>å¼•ç”¨ä»¥å’Œå¼•ç”¨å½¢å‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int squareByValue(int number)&#123;</span><br><span class="line">    <span class="built_in">return</span> number *=number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void squareByReference(int &amp;numberRef)&#123;</span><br><span class="line">    numberRef *=numberRef;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°ä½“å†…å¼•ç”¨ä½œä¸ºåˆ«å<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int z = 3;</span><br><span class="line">    int &amp;z_alias = z;//int &amp;z_aliasï¼›</span><br><span class="line">    cout &lt;&lt; <span class="string">"z= "</span> &lt;&lt; z &lt;&lt; endl &lt;&lt; <span class="string">" z_alias = "</span>  &lt;&lt;  z_alias &lt;&lt; endl;</span><br><span class="line">    z = 7;</span><br><span class="line">    cout &lt;&lt; <span class="string">"z= "</span> &lt;&lt; z &lt;&lt; endl &lt;&lt; <span class="string">" z_alias = "</span>  &lt;&lt;  z_alias &lt;&lt; endl;</span><br></pre></td></tr></table></figure><br>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">z= 3</span><br><span class="line"> z_alias = 3</span><br><span class="line">z= 7</span><br><span class="line"> z_alias = 7</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”ä¸ºåˆå§‹åŒ–çš„å¼•ç”¨<code>int &amp;z_aliasï¼›</code>ä¼šå¯¼è‡´é”™è¯¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Declaration of reference variable <span class="string">'z_alias'</span> requires an initializer</span><br></pre></td></tr></table></figure>

<h2 id="ç©ºå½¢å‚åˆ—è¡¨"><a href="#ç©ºå½¢å‚åˆ—è¡¨" class="headerlink" title="ç©ºå½¢å‚åˆ—è¡¨"></a>ç©ºå½¢å‚åˆ—è¡¨</h2><p>åœ¨C++ä¸­ï¼Œå¯ä»¥ç”¨<code>void</code>æŒ‡å®šä¹Ÿå¯ä»¥é€šè¿‡åœ¨æ‹¬å·å†…ä¸å†™ä»»ä½•è¯­å¥å®šä¹‰ç©ºå½¢å‚åˆ—è¡¨ã€‚å¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°æ˜¯ç­‰ä»·çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">void <span class="built_in">print</span>();</span><br><span class="line">void <span class="built_in">print</span>(void);</span><br></pre></td></tr></table></figure>
<h2 id="é»˜è®¤å®å‚"><a href="#é»˜è®¤å®å‚" class="headerlink" title="é»˜è®¤å®å‚"></a>é»˜è®¤å®å‚</h2><ul>
<li>æœ‰äº›ç¨‹åºåœ¨å¤šæ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ç»å¸¸å°†ç›¸åŒçš„å®å‚ä¼ é€’ç»™æŸä¸ªå½¢å‚ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†è¯¥å½¢å‚æŒ‡å®šé»˜è®¤å®å‚ï¼Œå³ä¼ é€’ç»™è¯¥å½¢å‚çš„é»˜è®¤å€¼ã€‚</li>
<li>å½“å‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œå¦‚æœçœç•¥äº†å¯¹åº”ä½ç½®ä¸Šçš„å®å‚å€¼ï¼Œåˆ™ç¼–è¯‘å™¨å°±ä¼šé‡å†™è¯¥å‡½æ•°è°ƒç”¨å¹¶å°†é»˜è®¤å€¼ä½œä¸ºå®å‚æ’å…¥åˆ°å‡½æ•°è°ƒç”¨ä¸­ï¼Œåœ¨æ‰§è¡Œè¢«è°ƒå‡½æ•°æ—¶ï¼Œä»¥è¯¥å½¢å‚çš„é»˜è®¤å€¼è¿›è¡Œè¿ç®—ã€‚</li>
<li>é»˜è®¤å®å‚å¿…é¡»æ˜¯å‡½æ•°å½¢å‚åˆ—è¡¨ä¸­æœ€å³è¾¹çš„å®å‚ã€‚</li>
<li>åº”è¯¥åœ¨å‡½æ•°åç¬¬ä¸€æ¬¡å‡ºç°æ—¶æŒ‡å®šé»˜è®¤å®å‚â€“é€šå¸¸åœ¨å‡½æ•°åŸå‹ä¸­æŒ‡å®šã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int boxVolume(int length = 1, int width = 1, int height = 1);</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">testDefaultArgument</span></span>()&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">"default = "</span> &lt;&lt;boxVolume() &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"length  = 2 : "</span> &lt;&lt;boxVolume(2) &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"length  = 2 , width =3 : "</span> &lt;&lt;boxVolume(2,3) &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"length  = 2 , width =3 , height = 4 : "</span> &lt;&lt;boxVolume(2, 3, 4) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int boxVolume(int length, int width, int height)&#123;</span><br><span class="line">    <span class="built_in">return</span> length*width*height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸€å…ƒä½œç”¨åŸŸè¿ç®—ç¬¦"><a href="#ä¸€å…ƒä½œç”¨åŸŸè¿ç®—ç¬¦" class="headerlink" title="ä¸€å…ƒä½œç”¨åŸŸè¿ç®—ç¬¦"></a>ä¸€å…ƒä½œç”¨åŸŸè¿ç®—ç¬¦</h2><p>C++æä¾›äº†ä¸€å…ƒä½œç”¨åŸŸè¿ç®—ç¬¦ï¼Œå¯ä»¥åœ¨å«æœ‰ä¸å…¨å±€å˜é‡åçš„å±€éƒ¨å˜é‡çš„åŸŸä¸­è®¿é—®è¯¥å…¨å±€å˜é‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int number = 7;</span><br><span class="line">void <span class="function"><span class="title">testUnaryOperation</span></span>()&#123;</span><br><span class="line">    double number = 10.7;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"location number = "</span> &lt;&lt; number &lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"gloable number = "</span> &lt;&lt; ::number &lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location number = 10.7</span><br><span class="line">gloable number = 7</span><br></pre></td></tr></table></figure>

<h2 id="å‡½æ•°é‡è½½"><a href="#å‡½æ•°é‡è½½" class="headerlink" title="å‡½æ•°é‡è½½"></a>å‡½æ•°é‡è½½</h2><ul>
<li>C++ä¸­å…è®¸å®šä¹‰åŒåçš„å‡½æ•°ï¼Œåªè¦è¿™äº›å‡½æ•°å…·æœ‰ä¸åŒçš„å½¢å‚é›†åˆå³å¯ï¼ˆè‡³å°‘åœ¨å½¢å‚ç±»å‹æˆ–å½¢å‚ä¸ªæ•°æˆ–å½¢å‚ç±»å‹çš„é¡ºåºä¸Šæœ‰åŒºåˆ«ï¼‰ã€‚è¿™ä¸ªåŠŸèƒ½ç§°ä¸ºå‡½æ•°é‡è½½ã€‚</li>
<li>è°ƒç”¨é‡è½½å‡½æ•°æ—¶ï¼ŒC++ç¼–è¯‘å™¨é€šè¿‡æ£€æŸ¥å‡½æ•°è°ƒç”¨è¯­å¥ä¸­çš„å®å‚ä¸ªæ•°ã€ç±»å‹åŠé¡ºåºé€‰æ‹©é€‚å½“çš„å‡½æ•°ã€‚</li>
<li>é‡è½½å‡½æ•°ç”±å‡½æ•°çš„ç­¾åè¿›è¡ŒåŒºåˆ†ã€‚</li>
<li>ç¼–è¯‘å™¨æ ¹æ®å‡½æ•°å½¢å‚çš„ä¸ªæ•°ä¸ç±»å‹å°†æ¯ä¸ªå‡½æ•°æ ‡è¯†ç¬¦ç¼–ç ï¼Œä»¥ä¿è¯ç±»å‹å®‰å…¨é“¾æ¥ï¼Œä»è€Œç¡®ä¿å¯ä»¥è°ƒç”¨é€‚å½“çš„é‡è½½å‡½æ•°ï¼Œä¹Ÿç¡®ä¿å®å‚ä¸å½¢å‚ç±»å‹ä¸€è‡´ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">void <span class="function"><span class="title">functionOverloading</span></span>()&#123;</span><br><span class="line">    cout &lt;&lt; square(7) &lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; square(0.5) &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int square(int x)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">"integer : "</span>;</span><br><span class="line">    <span class="built_in">return</span> x*x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">double square(double x)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">"double : "</span>;</span><br><span class="line">    <span class="built_in">return</span> x*x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
è¾“å‡º<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">integer</span> : 49</span><br><span class="line">double : 0.25</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="å‡½æ•°æ¨¡ç‰ˆ"><a href="#å‡½æ•°æ¨¡ç‰ˆ" class="headerlink" title="å‡½æ•°æ¨¡ç‰ˆ"></a>å‡½æ•°æ¨¡ç‰ˆ</h2><p>é‡è½½å‡½æ•°ç”¨äºå¯¹ä¸åŒæ•°æ®ç±»å‹çš„ç¨‹åºé€»è¾‘æ‰§è¡Œç›¸ä¼¼æ“ä½œã€‚å¦‚æœå„ç§æ•°æ®ç±»å‹çš„ç¨‹åºé€»è¾‘å’Œæ“ä½œæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œé‚£ä¹ˆä½¿ç”¨å‡½æ•°æ¨¡ç‰ˆå¯ä»¥æ›´åŠ ç®€æ´ã€æ–¹ä¾¿çš„æ‰§è¡Œé‡è½½ã€‚</p>
<ul>
<li>æ‰€æœ‰å‡½æ•°æ¨¡ç‰ˆå®šä¹‰å‡ä»¥å…³é”®å­—<code>template</code>å¼€å§‹ï¼Œéšåæ˜¯ç”¨å°–æ‹¬å·<code>&lt;&gt;</code>æ‹¬èµ·æ¥çš„æ¨¡ç‰ˆå½¢å‚åˆ—è¡¨.</li>
<li>æ¨¡ç‰ˆåˆ—è¡¨ä¸­çš„æ¯ä¸ªå½¢å‚ï¼ˆç§°ä¸ºå½¢å¼ç±»å‹å½¢å‚ï¼‰å‰é¢éƒ½åŠ å…³é”®å­—<code>typename</code>å’Œ <code>class</code>ã€‚ä¸¤è€…å«ä¹‰ç›¸åŒã€‚</li>
<li>å½¢å¼ç±»å‹å½¢å‚æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–ç”¨æˆ·å®šä¹‰ç±»å‹çš„å ä½ç¬¦<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">template &lt;class T&gt;</span><br><span class="line">T maximum(T value1, T value2, T value3 ) &#123;</span><br><span class="line">    T maximumValue = value1;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (value2 &gt; maximumValue) &#123;</span><br><span class="line">        maximumValue = value2 ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (value3 &gt; maximumValue) &#123;</span><br><span class="line">        maximumValue = value3 ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> maximumValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h1 id="ç±»ä¸å¯¹è±¡"><a href="#ç±»ä¸å¯¹è±¡" class="headerlink" title="ç±»ä¸å¯¹è±¡"></a>ç±»ä¸å¯¹è±¡</h1><p>åœ¨C++ä¸­é€šå¸¸æœ‰mainå‡½æ•°ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªæ—¢åŒ…å«æ•°æ®æˆå‘˜ä¹ŸåŒ…å«æˆå‘˜å‡½æ•°çš„ç±»æ„æˆï¼Œæ‰€ä»¥ï¼š</p>
<ul>
<li>åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¯æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜å‡½æ•°ã€‚</li>
<li>ç±»ä¼¼çš„ï¼Œå¯¹è±¡ä¹Ÿæœ‰å±æ€§ï¼Œåœ¨ç¨‹åºä¸­ä½¿ç”¨å¯¹è±¡æ—¶å¸¦æœ‰è¿™äº›å±æ€§ã€‚è¿™äº›å±æ€§æ˜¯å¯¹è±¡æ‰€å±çš„ç±»çš„ä¸€éƒ¨åˆ†ã€‚</li>
</ul>
<h2 id="å®šä¹‰ä¸€ä¸ªå…·æœ‰æˆå‘˜å‡½æ•°çš„ç±»"><a href="#å®šä¹‰ä¸€ä¸ªå…·æœ‰æˆå‘˜å‡½æ•°çš„ç±»" class="headerlink" title="å®šä¹‰ä¸€ä¸ªå…·æœ‰æˆå‘˜å‡½æ•°çš„ç±»"></a>å®šä¹‰ä¸€ä¸ªå…·æœ‰æˆå‘˜å‡½æ•°çš„ç±»</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//å®šä¹‰</span><br><span class="line">class GradeBook &#123;</span><br><span class="line">    //  </span><br><span class="line">public:</span><br><span class="line">    void <span class="function"><span class="title">displayMessage</span></span>()&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">"grade book"</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//è°ƒç”¨</span><br><span class="line">void <span class="function"><span class="title">funcTestGradeBook</span></span>()&#123;</span><br><span class="line">    GradeBook myGradeBook;</span><br><span class="line">    myGradeBook.displayMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Hello, World!</span><br><span class="line">grade book</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure>
<ul>
<li>ç±»çš„å®šä¹‰ç”± <code>class</code>åŠéšåçš„ç±»åGradeBookå¼€å§‹ï¼Œç±»åé€šå¸¸ä½¿ç”¨é©¼å³°æ¨¡å¼æ‹¼å†™ï¼Œé€šå¸¸é¦–å­—æ¯å¤§å†™ã€‚</li>
<li>æ¯ä¸ªç±»ä½“ç”±å·¦å³æ‰“æ‹¬å·<code>{}</code> æ‹¬èµ·æ¥ã€‚</li>
<li>ç±»å®šä¹‰ç”±<code>;</code>åˆ†å·ç»“æŸã€‚</li>
<li>æˆå‘˜å‡½æ•°çš„è®¿é—®é™å®šç¬¦æœ‰ï¼š<code>public</code>ã€<code>private</code>ã€<code>protected</code>ä¸‰ç§ã€‚</li>
<li>åœ¨å®šä¹‰å‡½æ•°æ—¶ï¼Œå¿…é¡»æŒ‡å®šè¿”å›å€¼ç±»å‹ã€‚</li>
<li>æˆå‘˜å‡½æ•°ååçš„ç©ºæ‹¬å·è¡¨ç¤ºè¯¥æˆå‘˜å‡½æ•°ä¸éœ€è¦ä¼ å‚ã€‚</li>
</ul>
<h2 id="å®šä¹‰ä¸€ä¸ªæœ‰å‚æˆå‘˜å‡½æ•°"><a href="#å®šä¹‰ä¸€ä¸ªæœ‰å‚æˆå‘˜å‡½æ•°" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæœ‰å‚æˆå‘˜å‡½æ•°"></a>å®šä¹‰ä¸€ä¸ªæœ‰å‚æˆå‘˜å‡½æ•°</h2> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//å®šä¹‰ä¸€ä¸ªæœ‰å‚æˆå‘˜å‡½æ•°</span><br><span class="line">    void displayMessageWithParms(string courseName)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">"grade book"</span>&lt;&lt; courseName &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">string courseName;</span><br><span class="line">    cout&lt;&lt; <span class="string">"enter course name:"</span>&lt;&lt;endl;</span><br><span class="line">    getline(cin, courseName);</span><br><span class="line">    cout&lt;&lt;endl;</span><br><span class="line">    myGradeBook.displayMessageWithParms(<span class="string">"Chinese"</span>);</span><br><span class="line">    myGradeBook.displayMessageWithParms(courseName);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">enter course name:</span><br><span class="line">kjjkjkj</span><br><span class="line"></span><br><span class="line">grade bookChinese</span><br><span class="line">grade bookkjjkjkj</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure>
<h2 id="æ•°æ®æˆå‘˜ã€setå‡½æ•°ä¸getå‡½æ•°"><a href="#æ•°æ®æˆå‘˜ã€setå‡½æ•°ä¸getå‡½æ•°" class="headerlink" title="æ•°æ®æˆå‘˜ã€setå‡½æ•°ä¸getå‡½æ•°"></a>æ•°æ®æˆå‘˜ã€setå‡½æ•°ä¸getå‡½æ•°</h2><ul>
<li>åœ¨å‡½æ•°å®šä¹‰ä½“é‡å£°æ˜çš„å˜é‡ç§°ä¸ºå±€éƒ¨å˜é‡ï¼Œå®ƒä»¬åªèƒ½åœ¨ä»å£°æ˜å®ƒä»¬çš„è¡Œåˆ°è¯¥å‡½æ•°å®šä¹‰çš„ç»“æŸå³æ‰“æ‹¬å·<code>}</code>çš„èŒƒå›´å†…ä½¿ç”¨ã€‚</li>
<li>ç±»é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜å‡½æ•°æ¥æ“ä½œå±äºè¯¥ç±»ç‰¹å®šå¯¹è±¡çš„å±æ€§ã€‚å±æ€§åœ¨ç±»å®šä¹‰ä¸­è¡¨ç¤ºä¸ºå˜é‡ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">class GradeBookHaveLocalVariable&#123;</span><br><span class="line">public:</span><br><span class="line">    void setCourseName(string name)&#123;</span><br><span class="line">        courseName = name;</span><br><span class="line">    &#125;</span><br><span class="line">    string <span class="function"><span class="title">getCourseName</span></span>()&#123;</span><br><span class="line">        <span class="built_in">return</span> courseName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    void <span class="function"><span class="title">displayMessage</span></span>()&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">"course  name: "</span>&lt;&lt; getCourseName() &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    //å®šä¹‰ä¸€ä¸ªæœ‰å‚æˆå‘˜å‡½æ•°</span><br><span class="line">    void displayMessageWithParms(string courseName)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">"grade book"</span>&lt;&lt; courseName &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">private:</span><br><span class="line">    string courseName;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">course  name: è¯­æ–‡</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡"><a href="#ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡" class="headerlink" title="ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡"></a>ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡</h2><p>æ„é€ å‡½æ•°:</p>
<ul>
<li>ç”¨äºåœ¨åˆ›å»ºè¯¥ç±»å¯¹è±¡æ—¶åˆå§‹åŒ–è¯¥å¯¹è±¡ã€‚</li>
<li>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æˆå‘˜å‡½æ•°ï¼Œå®ƒçš„åå­—å¿…é¡»ä¸ç±»åç›¸åŒã€‚</li>
<li>ä¸èƒ½æœ‰è¿”å›å€¼ã€‚</li>
<li>é€šå¸¸å£°æ˜ä¸º<code>public</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">class GradeBookConstructor&#123;</span><br><span class="line">    </span><br><span class="line">public:</span><br><span class="line">    </span><br><span class="line">    GradeBookConstructor(string name)&#123;</span><br><span class="line">        setCourseName(name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    void setCourseName(string name)&#123;</span><br><span class="line">        courseName = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    string <span class="function"><span class="title">getCourseName</span></span>()&#123;</span><br><span class="line">        <span class="built_in">return</span> courseName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    void <span class="function"><span class="title">displayMessage</span></span>()&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">"course  name: "</span>&lt;&lt; getCourseName() &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //å®šä¹‰ä¸€ä¸ªæœ‰å‚æˆå‘˜å‡½æ•°</span><br><span class="line">    void displayMessageWithParms(string courseName)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">"grade book"</span>&lt;&lt; courseName &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">private:</span><br><span class="line">    string courseName;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">funcTestGradeBookConstructor</span></span>()&#123;</span><br><span class="line">    GradeBookConstructor myGradeBookConstructor1(<span class="string">"Constructor"</span>);</span><br><span class="line">    GradeBookConstructor myGradeBookConstructor2(<span class="string">"æ„é€ å‡½æ•°"</span>);</span><br><span class="line">    </span><br><span class="line">    myGradeBookConstructor1.displayMessage();</span><br><span class="line">    myGradeBookConstructor2.displayMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">course  name: Constructor</span><br><span class="line">course  name: æ„é€ å‡½æ•°</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure>


<h1 id="ç”¨setå‡½æ•°éªŒè¯æ•°æ®"><a href="#ç”¨setå‡½æ•°éªŒè¯æ•°æ®" class="headerlink" title="ç”¨setå‡½æ•°éªŒè¯æ•°æ®"></a>ç”¨setå‡½æ•°éªŒè¯æ•°æ®</h1><p>æˆ‘ä»¬åœ¨<code>.h</code>æ–‡ä»¶ä¸­è¿›è¡Œç±»çš„å®šä¹‰ï¼Œå¹¶åŒ…å«æŒ‡å®šæŒ‡å®šç±»çš„æ¥å£ï¼ˆç±»çš„<code>public</code>æˆå‘˜å‡½æ•°ï¼‰çš„å‡½æ•°åŸå½¢ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">class VertifyWithSetFunc &#123;</span><br><span class="line">    //instance variables</span><br><span class="line">    </span><br><span class="line">public:</span><br><span class="line">    </span><br><span class="line">    VertifyWithSetFunc(string);</span><br><span class="line">    </span><br><span class="line">    void setCourseName(string);</span><br><span class="line">    string getCourseName();</span><br><span class="line">    </span><br><span class="line">    void displayMessage();</span><br><span class="line">    </span><br><span class="line">private:</span><br><span class="line">    string courseName;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åœ¨å•ç‹¬çš„æºç æ–‡ä»¶ä¸­å®šä¹‰æˆå‘˜å‡½æ•°ï¼šæ¯ä¸ªæˆå‘˜å‡½æ•°åå‰é¢éƒ½æœ‰ç±»åä¸äºŒé™¢ä½œç”¨åŸŸè¿ç®—ç¬¦<code>::</code>ï¼Œè¿™å°†æ¯ä¸ªæˆå‘˜å‡½æ•°ç»‘å®šåˆ°å£°æ˜æˆå‘˜å‡½æ•°ä¸æ•°æ®æˆå‘˜çš„VertifyWithSetFuncç±»å®šä¹‰ä¸Šã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">VertifyWithSetFunc::VertifyWithSetFunc(string name)&#123;</span><br><span class="line">    setCourseName(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çŸ¥é“å¯ä»¥é€šè¿‡<code>set</code>å‡½æ•°ï¼Œå¯ä»¥ä¿®æ”¹<code>private</code>æ•°æ®æˆå‘˜çš„å€¼ã€‚è¿™é‡Œæˆ‘ä»¬è¦åšçš„æ˜¯åœ¨<code>set</code>å‡½æ•°è¿›è¡Œå€¼å¾—åˆ¤æ–­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">void VertifyWithSetFunc::setCourseName(string name)&#123;</span><br><span class="line">    <span class="keyword">if</span> (name.length() &lt;= 10) &#123;</span><br><span class="line">        courseName = name ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (name.length() &gt; 10) &#123;</span><br><span class="line">        courseName = name.substr(0, 10);</span><br><span class="line">        cout&lt;&lt; <span class="string">"name is long than 10 :"</span>&lt;&lt; name &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">name is long than 10 :test2test2test2test2test2test2test2test2test2test2</span><br><span class="line">vertify1: test1</span><br><span class="line">vertify2: test2test2</span><br></pre></td></tr></table></figure>


<h1 id="è®¿é—®æˆå‘˜å‡½æ•°çš„ä¸‰ç§æ–¹å¼"><a href="#è®¿é—®æˆå‘˜å‡½æ•°çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="è®¿é—®æˆå‘˜å‡½æ•°çš„ä¸‰ç§æ–¹å¼"></a>è®¿é—®æˆå‘˜å‡½æ•°çš„ä¸‰ç§æ–¹å¼</h1><p>è®¿é—®æˆå‘˜å‡½æ•°çš„ä¸‰ç§æ–¹å¼:</p>
<p>å¯¹è±¡å</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Count counter;</span><br><span class="line">counter.setX(1);</span><br><span class="line">cout &lt;&lt; <span class="string">"counter.setX(1);"</span> ;</span><br><span class="line">counter.print();</span><br></pre></td></tr></table></figure>



<p>æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Count *counterPtr = &amp;counter;</span><br><span class="line">counterPtr-&gt;setX(2);</span><br><span class="line">cout &lt;&lt; <span class="string">"counterPtr-&gt;setX(2);"</span>;</span><br><span class="line">counterPtr-&gt;<span class="built_in">print</span>();</span><br></pre></td></tr></table></figure>

<p>å¯¹è±¡çš„å¼•ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Count &amp;counterRef = counter;</span><br><span class="line">counterRef.setX(3);</span><br><span class="line">cout &lt;&lt; <span class="string">"counterRef.setX(3);"</span>;</span><br><span class="line">counterRef.print();</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">counter.setX(1);1</span><br><span class="line">counterPtr-&gt;setX(2);2</span><br><span class="line">counterRef.setX(3);3</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure>




<h1 id="ææ„å‡½æ•°"><a href="#ææ„å‡½æ•°" class="headerlink" title="ææ„å‡½æ•°"></a>ææ„å‡½æ•°</h1><p>ææ„å‡½æ•°(destructor)æ˜¯ä¸€ç§ç‰¹æ®Šçš„æˆå‘˜å‡½æ•°ã€‚</p>
<ul>
<li>ç±»çš„ææ„å‡½æ•°åæ˜¯åœ¨ç±»åå‰åŠ ä¸€ä¸ªæ³¢æµªå¥½<code>~</code></li>
<li>ç´¯çš„ææ„å‡½æ•°æ˜¯åœ¨åˆ é™¤å¯¹è±¡çš„æ—¶å€™è¢«éšå¼è°ƒç”¨</li>
<li>ææ„å‡½æ•°æ²¡æœ‰å½¢å‚é¡µä¸åæ‚”ä»»ä½•å€¼</li>
<li>ææ„å‡½æ•°å¿…é¡»æ˜¯ <code>public</code>ç±»å‹çš„</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CreateAndDestructor::CreateAndDestructor(int ID, string msg)&#123;</span><br><span class="line">    objectID = ID;</span><br><span class="line">    message = msg;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"Object "</span> &lt;&lt; objectID &lt;&lt; <span class="string">" æ„é€ å‡½æ•° runs  "</span> &lt;&lt;message &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void create(void)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">"createFunc "</span> &lt;&lt; endl;</span><br><span class="line">    CreateAndDestructor fifth(5, <span class="string">"(local automatic in create)"</span>);</span><br><span class="line">    static CreateAndDestructor sixth(6, <span class="string">"(local automatic in create)"</span>);</span><br><span class="line">    CreateAndDestructor seventh(7, <span class="string">"(local automatic in create)"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CreateAndDestructor::~<span class="function"><span class="title">CreateAndDestructor</span></span>()&#123;</span><br><span class="line">    cout&lt;&lt;(objectID ==1 || objectID == 6 ? <span class="string">"\n"</span> : <span class="string">""</span>);</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"Object "</span> &lt;&lt; objectID &lt;&lt; <span class="string">" ææ„å‡½æ•° runs   "</span> &lt;&lt;message &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">testCreateAndDestructor</span></span>()&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">"testFunc "</span> &lt;&lt; endl;</span><br><span class="line">    CreateAndDestructor second(2, <span class="string">"(local automatic in testFunc)"</span>);</span><br><span class="line">    static CreateAndDestructor third(3, <span class="string">"(local automatic in testFunc)"</span>);</span><br><span class="line">    </span><br><span class="line">    create();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"testFunc : "</span> &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    CreateAndDestructor forth(4, <span class="string">"(local automatic in testFunc)"</span>);</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">"\ntestFunc end \n"</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">testFunc </span><br><span class="line">Object 2 æ„é€ å‡½æ•° runs  (<span class="built_in">local</span> automatic <span class="keyword">in</span> testFunc)</span><br><span class="line">Object 3 æ„é€ å‡½æ•° runs  (<span class="built_in">local</span> automatic <span class="keyword">in</span> testFunc)</span><br><span class="line">createFunc </span><br><span class="line">Object 5 æ„é€ å‡½æ•° runs  (<span class="built_in">local</span> automatic <span class="keyword">in</span> create)</span><br><span class="line">Object 6 æ„é€ å‡½æ•° runs  (<span class="built_in">local</span> automatic <span class="keyword">in</span> create)</span><br><span class="line">Object 7 æ„é€ å‡½æ•° runs  (<span class="built_in">local</span> automatic <span class="keyword">in</span> create)</span><br><span class="line">Object 7 ææ„å‡½æ•° runs   (<span class="built_in">local</span> automatic <span class="keyword">in</span> create)</span><br><span class="line">Object 5 ææ„å‡½æ•° runs   (<span class="built_in">local</span> automatic <span class="keyword">in</span> create)</span><br><span class="line">testFunc : </span><br><span class="line">Object 4 æ„é€ å‡½æ•° runs  (<span class="built_in">local</span> automatic <span class="keyword">in</span> testFunc)</span><br><span class="line"></span><br><span class="line">testFunc end </span><br><span class="line"></span><br><span class="line">Object 4 ææ„å‡½æ•° runs   (<span class="built_in">local</span> automatic <span class="keyword">in</span> testFunc)</span><br><span class="line">Object 2 ææ„å‡½æ•° runs   (<span class="built_in">local</span> automatic <span class="keyword">in</span> testFunc)</span><br><span class="line"></span><br><span class="line">Object 6 ææ„å‡½æ•° runs   (<span class="built_in">local</span> automatic <span class="keyword">in</span> create)</span><br><span class="line">Object 3 ææ„å‡½æ•° runs   (<span class="built_in">local</span> automatic <span class="keyword">in</span> testFunc)</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨å…¨å±€ä½œç”¨åŸŸå†…å®šä¹‰çš„å¯¹è±¡çš„æ„é€ å‡½æ•°åœ¨è¯¥æ–‡ä»¶ä¸­çš„ä»»ä½•å…¶ä»–å‡½æ•°ï¼ˆåŒ…æ‹¬<code>main</code>å‡½æ•°ï¼‰å¼€å§‹æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚</li>
<li>åœ¨<code>main</code>å‡½æ•°ç»ˆæ­¢æ—¶ï¼Œè°ƒç”¨å“åº”çš„ææ„å‡½æ•°ã€‚<code>exit</code>å‡½æ•°å¼ºåˆ¶ç¨‹åºç«‹å³ç»ˆæ­¢å¹¶ä¸”ä¸æ‰§è¡Œè‡ªåŠ¨å¯¹è±¡çš„ææ„å‡½æ•°ã€‚</li>
<li>è‡ªåŠ¨å±€éƒ¨å¯¹è±¡çš„ <code>ææ„å‡½æ•°</code>åœ¨æ‰§è¡Œåˆ°è¾¾å®šä¹‰è¯¥å¯¹è±¡çš„ç¨‹åºç‚¹æ˜¯è°ƒç”¨ï¼Œ<code>å¯¹åº”çš„ææ„å‡½æ•°</code>æ˜¯åœ¨è¯¥å¯¹è±¡ç¦»å¼€è¯¥å¯¹åƒæ‰€åœ¨çš„ä½œç”¨åŸŸæ—¶è°ƒç”¨ã€‚</li>
<li><code>static</code>å±€éƒ¨å¯¹è±¡çš„<code>ææ„å‡½æ•°</code>åªåœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡åˆ°è¾¾å®šä¹‰å¯¹è±¡çš„ç¨‹åºç‚¹æ—¶è°ƒç”¨ä¸€æ¬¡,<code>å¯¹åº”çš„ææ„å‡½æ•°</code>æ˜¯åœ¨<code>main</code>å‡½æ•°ç»ˆæ­¢æ—¶æˆ–è€…<code>exit</code>å‡½æ•°æ—¶è°ƒç”¨ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>WebRTC</title>
    <url>/2019/11/04/WebRTC/</url>
    <content><![CDATA[<h1 id="WebRTCä»‹ç»"><a href="#WebRTCä»‹ç»" class="headerlink" title="WebRTCä»‹ç»"></a>WebRTCä»‹ç»</h1><p><a href="[https://webrtc.org/](https://webrtc.org/)">WebRTC</a>ä¸€ä¸ªç”±googleå¼€æºçš„éŸ³è§†é¢‘å¤„ç†+å³æ—¶é€šè®¯çš„å¼€æºåº“ï¼Œä¼˜ç§€çš„å¤šåª’ä½“ã€è·¨å¹³å°æ¡†æ¶ã€‚å®ƒæå…¶åºå¤§å¤æ‚ï¼Œæ¢å¥è¯æ¥è¯´åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œç„¶åå°±æ˜¯WebRTCåªæ˜¯å®šä¹‰äº†å®¢æˆ·ç«¯çš„è§„èŒƒï¼Œè‡³äºæœåŠ¡å™¨å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯æ¥å®ç°ï¼Œä¸€èˆ¬åº”ç”¨äºï¼š</p>
<ul>
<li>éŸ³è§†é¢‘ä¼šè®®ã€åœ¨çº¿æ•™è‚²</li>
<li>ç…§ç›¸æœº</li>
<li>éŸ³ä¹æ’­æ”¾å™¨</li>
<li>å…±äº«è¿œç¨‹æ¡Œé¢</li>
<li>å½•åˆ¶</li>
<li>å®æ–½äººè„¸è¯†åˆ«</li>
<li>æ¸¸æˆ</li>
<li>æ–‡ä»¶ä¼ è¾“å·¥å…·</li>
<li>P2Pç½‘ç»œåŠ é€Ÿ</li>
<li>å³æ—¶é€šè®¯å·¥å…·</li>
</ul>
<h1 id="WebRTC-1-å¯¹-1-éŸ³è§†é¢‘å®æ—¶é€šè¯"><a href="#WebRTC-1-å¯¹-1-éŸ³è§†é¢‘å®æ—¶é€šè¯" class="headerlink" title="WebRTC 1 å¯¹ 1 éŸ³è§†é¢‘å®æ—¶é€šè¯"></a>WebRTC 1 å¯¹ 1 éŸ³è§†é¢‘å®æ—¶é€šè¯</h1><p><img src="/2019/11/04/WebRTC/webrtc1-1to1.png" alt="è¿‡ç¨‹ç¤ºæ„å›¾"></p>
<p>å³ä¸¤ä¸ª WebRTC ç»ˆç«¯ï¼ˆä¸Šå›¾ä¸­çš„ä¸¤ä¸ªå¤§æ–¹æ¡†ï¼‰ã€ä¸€ä¸ª Signalï¼ˆä¿¡ä»¤ï¼‰æœåŠ¡å™¨å’Œä¸€ä¸ª STUN/TURN æœåŠ¡å™¨ã€‚</p>
<p><code>WebRTC ç»ˆç«¯</code>è´Ÿè´£éŸ³è§†é¢‘é‡‡é›†ã€ç¼–è§£ç ã€NAT ç©¿è¶Šã€éŸ³è§†é¢‘æ•°æ®ä¼ è¾“ã€‚æ­¥éª¤æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>è·å–æƒé™ï¼ˆæ‘„åƒå¤´ã€éº¦å…‹é£ï¼‰</li>
<li>æœ¬åœ°è§†é¢‘çš„é‡‡é›†ä¸å±•ç¤º</li>
<li>åˆ›å»º<code>RTCPeerConnection</code></li>
<li>åª’ä½“åå•†</li>
<li>è¿œç«¯è§†é¢‘çš„å±•ç¤º</li>
</ul>
<p><code>Signal æœåŠ¡å™¨</code>è´Ÿè´£ä¿¡ä»¤å¤„ç†ï¼Œå¦‚åŠ å…¥æˆ¿é—´ã€ç¦»å¼€æˆ¿é—´ã€åª’ä½“åå•†æ¶ˆæ¯çš„ä¼ é€’ç­‰ã€‚<br><code>STUN/TURN æœåŠ¡å™¨</code>è´Ÿè´£è·å– WebRTC ç»ˆç«¯åœ¨å…¬ç½‘çš„ IP åœ°å€ï¼Œä»¥åŠ NAT ç©¿è¶Šå¤±è´¥åçš„æ•°æ®ä¸­è½¬ã€‚</p>
<h1 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h1><p><code>Full Cone</code> å®Œå…¨é”¥å‹NAT<br>å½“ host ä¸»æœºé€šè¿‡ NAT è®¿é—®å¤–ç½‘çš„ B ä¸»æœºæ—¶ï¼Œå°±ä¼šåœ¨ NAT ä¸Šæ‰“ä¸ªâ€œæ´â€ï¼Œæ‰€æœ‰çŸ¥é“è¿™ä¸ªâ€œæ´â€çš„ä¸»æœºéƒ½å¯ä»¥é€šè¿‡å®ƒä¸å†…ç½‘ä¸»æœºä¸Šçš„ä¾¦å¬ç¨‹åºé€šä¿¡ã€‚<br><code>æ‰€è°“çš„â€œæ‰“æ´â€å°±æ˜¯åœ¨ NAT ä¸Šå»ºç«‹ä¸€ä¸ªå†…å¤–ç½‘çš„æ˜ å°„è¡¨ã€‚</code><br>å¤§å¤šæ•°äººéƒ½é€‰ç”¨<code>UDP</code>ä½œä¸ºæ‰“æ´åè®®.</p>
<p><img src="/2019/11/04/WebRTC/webrtc10-full-cone.png" alt></p>
<p><code>ip restricted</code>IP é™åˆ¶é”¥å‹NAT<br>host ä¸»æœºåœ¨ NAT ä¸Šâ€œæ‰“æ´â€åï¼ŒNAT ä¼šå¯¹ç©¿è¶Šæ´å£çš„ IP åœ°å€åšé™åˆ¶ã€‚åªæœ‰ç™»è®°çš„ IP åœ°å€æ‰å¯ä»¥é€šè¿‡ã€‚</p>
<p>IP é™åˆ¶é”¥å‹ NAT çš„æ˜ å°„è¡¨æ˜¯ä¸€ä¸ª 5 å…ƒç»„ï¼Œå³ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	å†…ç½‘ IPï¼Œ</span><br><span class="line">	å†…ç½‘ç«¯å£ï¼Œ</span><br><span class="line">	æ˜ å°„çš„å¤–ç½‘ IPï¼Œ</span><br><span class="line">	æ˜ å°„çš„å¤–ç½‘ç«¯å£ï¼Œ</span><br><span class="line">	è¢«è®¿é—®ä¸»æœºçš„ IP</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/04/WebRTC/webrtc10-ip-restricted.png" alt></p>
<p><code>port restrected</code> ç«¯å£é™åˆ¶å‹NAT</p>
<p>ä¸å…‰åœ¨ NAT ä¸Šå¯¹æ‰“æ´çš„ IP åœ°å€åšäº†é™åˆ¶ï¼Œè€Œä¸”è¿˜å¯¹å…·ä½“çš„ç«¯å£åšäº†é™åˆ¶ã€‚å› æ­¤ï¼Œç«¯å£é™åˆ¶å‹ NAT çš„æ˜ å°„è¡¨æ˜¯ä¸€ä¸ª 6 å…ƒç»„ï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	å†…ç½‘ IPï¼Œ</span><br><span class="line">	å†…ç½‘ç«¯å£ï¼Œ</span><br><span class="line">	æ˜ å°„çš„å¤–ç½‘ IPï¼Œ</span><br><span class="line">	æ˜ å°„çš„å¤–ç½‘ç«¯å£ï¼Œ</span><br><span class="line">	è¢«è®¿é—®ä¸»æœºçš„ IP,</span><br><span class="line">	è¢«è®¿é—®ä¸»æœºçš„ç«¯å£</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/04/WebRTC/webrtc10-port-restrcted.png" alt></p>
<p><code>symmetric</code> å¯¹æˆå‹NAT<br>host ä¸»æœºè®¿é—® B æ—¶å®ƒåœ¨ NAT ä¸Šæ‰“äº†ä¸€ä¸ªâ€œæ´â€ï¼Œè€Œè¿™ä¸ªâ€œæ´â€åªæœ‰ B ä¸»æœºä¸Šæä¾›æœåŠ¡çš„ç«¯å£å‘é€çš„æ•°æ®æ‰èƒ½ç©¿è¶Šï¼Œè¿™ä¸€ç‚¹ä¸ç«¯å£é™åˆ¶å‹ NAT æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>ä½†å®ƒä¸ç«¯å£é™åˆ¶å‹ NAT æœ€å¤§çš„ä¸åŒåœ¨äºï¼Œå¦‚æœ host ä¸»æœºè®¿é—® A æ—¶ï¼Œå®ƒä¼šåœ¨ NAT ä¸Šé‡æ–°å¼€ä¸€ä¸ªâ€œæ´â€ï¼Œè€Œä¸ä¼šä½¿ç”¨ä¹‹å‰è®¿é—® B æ—¶æ‰“å¼€çš„â€œæ´â€ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹ç§°å‹ NAT å¯¹æ¯ä¸ªè¿æ¥éƒ½ä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼Œç”šè‡³æ›´æ¢ IP åœ°å€ï¼Œè€Œç«¯å£é™åˆ¶å‹ NAT çš„å¤šä¸ªè¿æ¥åˆ™ä½¿ç”¨åŒä¸€ä¸ªç«¯å£ï¼Œè¿™å¯¹ç§°å‹ NAT ä¸ç«¯å£é™åˆ¶å‹ NAT æœ€å¤§çš„ä¸åŒ.</p>
<p><img src="/2019/11/04/WebRTC/webrtc10-symmetric.png" alt></p>
<p><code>NAT ç±»å‹æ£€æµ‹</code>æ­¥éª¤</p>
<ul>
<li>åˆ¤æ–­æ˜¯å¦æœ‰ NAT é˜²æŠ¤</li>
<li>æ¢æµ‹ NAT ç¯å¢ƒ</li>
</ul>
<p><img src="/2019/11/04/WebRTC/webrtc10-nat-check.png" alt></p>
<h1 id="STUNåè®®"><a href="#STUNåè®®" class="headerlink" title="STUNåè®®"></a>STUNåè®®</h1><ul>
<li>STUNå­˜åœ¨çš„ç›®çš„å°±æ˜¯è¿›è¡ŒNATç©¿è¶Šã€‚</li>
<li>STUNæ˜¯å…¸å‹çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼ï¼Œå³ï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿›è¡Œç›¸åº”ã€‚</li>
</ul>
<p>STUNæœ‰ç€ä¸¤å¥—è§„èŒƒï¼Œåˆ†åˆ«æ˜¯ï¼š<br><code>RFC3489</code>Simple Traversal of UDP Through NAT</p>
<p>RFC3489å®šä¹‰å±æ€§<br>| å±æ€§ | ä½œç”¨ |  |<br>| :â€”â€“| :â€” | :â€”- |<br>| 0x001 | mapped-address | è·å–å®¢æˆ·ç«¯æ˜ å°„åœ°å€ |<br>| 0x002 | response-address | æŒ‡æ˜å¯¹äºmapped-addressçš„ç›¸åº”åº”è¯¥ç”±å“ªé‡Œå‘é€ |<br>| 0x003 | change-request | è¯·æ±‚æœåŠ¡ç«¯ä½¿ç”¨ä¸åŒçš„IPå’Œç«¯å£å‘é€å“åº” |<br>| 0x004 | souce-address | åˆ¶å®šæœåŠ¡å™¨çš„IPå’Œç«¯å£ |<br>| 0x005 | change-addresss | å®ƒæ˜¯change-addresssè¯·æ±‚çš„å“åº” |<br>| 0x006 | user-name | ç”¨äºå®‰å…¨éªŒè¯ |<br>| 0x007 | password | ç”¨äºå®‰å…¨éªŒè¯ |<br>| 0x008 | message-integrity | æ¶ˆæ¯å®Œæ•´æ€§éªŒè¯ |<br>| 0x009 | error-code | é”™è¯¯ç  |<br>| 0x00a | unknow-attributes | æœªçŸ¥å±æ€§ |<br>| 0x00b | peflected-from | æ‹’çº¦ |</p>
<p><code>RFC5389</code>Session Traversal Utilities for NATï¼ˆå®ƒæ˜¯UDPå’ŒTCPéƒ½æœ‰ç”¨åˆ°çš„ï¼‰</p>
<h1 id="TURNåè®®"><a href="#TURNåè®®" class="headerlink" title="TURNåè®®"></a>TURNåè®®</h1><ul>
<li>ç›®çš„æ˜¯è§£å†³å †æˆNATæ— æ³•ç©¿è¶Šçš„é—®é¢˜</li>
<li>å…¶å»ºç«‹åœ¨STUNä¹‹ä¸Šï¼Œæ¶ˆæ¯æ ¼å¼ä½¿ç”¨STUNæ ¼å¼æ¶ˆæ¯</li>
<li>TURN Clientè¦æ±‚æœåŠ¡ç«¯åˆ†é…ä¸€ä¸ªå…¬å…±IPå’ŒPortç”¨äºæ¥æ”¶æˆ–å‘é€æ•°æ®</li>
</ul>
<p><img src="/2019/11/04/WebRTC/turn-demo.png" alt></p>
<h1 id="ICEæ¡†æ¶"><a href="#ICEæ¡†æ¶" class="headerlink" title="ICEæ¡†æ¶"></a>ICEæ¡†æ¶</h1><ul>
<li>æ”¶é›†Candidateï¼ˆæœ¬æœºæ‰€æœ‰IPå’Œåˆ¶å®šç«¯å£ï¼‰</li>
<li>å¯¹Candidate Pair æ’åº</li>
<li>è¿é€šæ€§æ£€æŸ¥</li>
</ul>
<p>ä»€ä¹ˆæ˜¯ Candidate?<br>å®ƒè¡¨ç¤º WebRTC ä¸è¿œç«¯é€šä¿¡æ—¶ä½¿ç”¨çš„åè®®ã€IP åœ°å€å’Œç«¯å£ï¼Œä¸€èˆ¬ç”±ä»¥ä¸‹å­—æ®µç»„æˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	IP: xxx.xxx.xxx.xxx,</span><br><span class="line">	port: number,</span><br><span class="line">	<span class="built_in">type</span>: host/srflx/relay,</span><br><span class="line">	priority: number,</span><br><span class="line">	protocol: UDP/TCP,</span><br><span class="line">	usernameFragment: string</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œå€™é€‰è€…ç±»å‹ä¸­çš„ host è¡¨ç¤ºæœ¬æœºå€™é€‰è€…ï¼Œsrflx è¡¨ç¤ºå†…ç½‘ä¸»æœºæ˜ å°„çš„å¤–ç½‘çš„åœ°å€å’Œç«¯å£ï¼Œrelay è¡¨ç¤ºä¸­ç»§å€™é€‰è€…ã€‚</p>
<h1 id="SDP"><a href="#SDP" class="headerlink" title="SDP"></a>SDP</h1><p><code>SDP</code>session description protocolï¼Œå®ƒæ˜¯ä¸€ç§ä¿¡æ¯æ ¼å¼çš„æè¿°æ ‡å‡†ï¼Œæœ¬èº«ä¸å±äºä¼ è¾“åè®®ï¼Œä½†æ˜¯å¯ä»¥è¢«å…¶ä»–ä¼ è¾“åè®®ç”¨æ¥äº¤æ¢å¿…è¦çš„ä¿¡æ¯ã€‚</p>
<h1 id="RTP-RTCP"><a href="#RTP-RTCP" class="headerlink" title="RTP/RTCP"></a>RTP/RTCP</h1><p> ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨å®æ—¶äº’åŠ¨ç›´æ’­ç³»ç»Ÿä¼ è¾“éŸ³è§†é¢‘æ•°æ®æµæ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸ç›´æ¥å°†éŸ³è§†é¢‘æ•°æ®æµäº¤ç»™ UDP ä¼ è¾“ï¼Œè€Œæ˜¯å…ˆç»™éŸ³è§†é¢‘æ•°æ®åŠ ä¸ª RTP å¤´ï¼Œç„¶åå†äº¤ç»™ UDP è¿›è¡Œä¼ è¾“ã€‚</p>
<p>åœ¨ä½¿ç”¨ RTP åŒ…ä¼ è¾“æ•°æ®æ—¶ï¼Œéš¾å…ä¼šå‘ç”Ÿä¸¢åŒ…ã€ä¹±åºã€æŠ–åŠ¨ç­‰é—®é¢˜ï¼Œä½†åœ¨å¤„ç†è¿™äº›é—®é¢˜ä¹‹å‰ï¼Œå®ƒé¦–å…ˆè¦è®©å„ç«¯éƒ½çŸ¥é“å®ƒä»¬è‡ªå·±çš„ç½‘ç»œè´¨é‡åˆ°åº•æ˜¯æ€æ ·çš„ï¼Œè¿™å°±æ˜¯ RTCP çš„ä½œç”¨ã€‚</p>
<p>å„åè®®å¤´å­—æ®µå¦‚ä¸‹ï¼ŒSSRCä¸ºå…±äº«åª’ä½“æµçš„æºã€‚</p>
<p><img src="/2019/11/04/WebRTC/RTP-protocol-header.png" alt="RTP"></p>
<p><img src="/2019/11/04/WebRTC/RTCP-protocol-header.png" alt="RTCP"></p>
]]></content>
      <categories>
        <category>WebRTC</category>
      </categories>
      <tags>
        <tag>WebRTC</tag>
      </tags>
  </entry>
  <entry>
    <title>FFmpeg</title>
    <url>/2019/11/04/FFmpeg/</url>
    <content><![CDATA[<h1 id="äº†è§£"><a href="#äº†è§£" class="headerlink" title="äº†è§£"></a>äº†è§£</h1><p><a href="http://ffmpeg.org/download.html" target="_blank" rel="noopener">FFmpeg</a>æ˜¯ä¸€ä¸ªéŸ³è§†é¢‘å¤„ç†åº“ï¼Œæä¾›äº†å¦‚ ffmpeg, ffplay, ffprobeï¼Œæ¥ç¼–è¾‘ä½ çš„éŸ³è§†é¢‘æ–‡ä»¶ã€‚</p>
<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>æºç å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  GitHub git <span class="built_in">clone</span> https://git.ffmpeg.org/ffmpeg.git ffmpeg</span><br><span class="line">Cloning into <span class="string">'ffmpeg'</span>...</span><br><span class="line">remote: Counting objects: 588505, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (120835/120835), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 588505 (delta 471727), reused 581424 (delta 466456)</span><br><span class="line">Receiving objects: 100% (588505/588505), 138.43 MiB | 2.74 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (471727/471727), <span class="keyword">done</span>.</span><br><span class="line">Checking out files: 100% (7264/7264), <span class="keyword">done</span>.</span><br><span class="line">âœ  GitHub <span class="built_in">cd</span> ffmpeg </span><br><span class="line">âœ  ffmpeg git:(master) ls</span><br><span class="line">CONTRIBUTING.md  LICENSE.md       ffbuild          libpostproc</span><br><span class="line">COPYING.GPLv2    MAINTAINERS      fftools          libswresample</span><br><span class="line">COPYING.GPLv3    Makefile         libavcodec       libswscale</span><br><span class="line">COPYING.LGPLv2.1 README.md        libavdevice      presets</span><br><span class="line">COPYING.LGPLv3   RELEASE          libavfilter      tests</span><br><span class="line">CREDITS          compat           libavformat      tools</span><br><span class="line">Changelog        configure        libavresample</span><br><span class="line">INSTALL.md       doc              libavutil</span><br><span class="line">âœ  ffmpeg git:(master) ./configure --<span class="built_in">help</span></span><br><span class="line">âœ  ffmpeg git:(master) ./configure --<span class="built_in">help</span> | more </span><br><span class="line">Usage: configure [options]</span><br><span class="line">Options: [defaults <span class="keyword">in</span> brackets after descriptions]</span><br><span class="line"></span><br><span class="line">âœ  ffmpeg git:(master) ./configure --prefix=/usr/<span class="built_in">local</span>/ffmpeg --<span class="built_in">enable</span>-gpl  --<span class="built_in">enable</span>-nonfree  --<span class="built_in">enable</span>-libfdk-aac  --<span class="built_in">enable</span>-libx264   --<span class="built_in">enable</span>-libx265  --<span class="built_in">enable</span>-filter=delogo  --<span class="built_in">enable</span>-debug  --<span class="built_in">disable</span>-optimizations --<span class="built_in">enable</span>-libspeex  --<span class="built_in">enable</span>-videotoolbox  --<span class="built_in">enable</span>-shared  --<span class="built_in">enable</span>-pthreads  --<span class="built_in">enable</span>-version3  --<span class="built_in">enable</span>-hardcoded-tables --cc=clang --host-cflags=  --host-ldflags=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æŠ¥é”™ã€æŠ¥é”™ã€æŠ¥é”™ã€æŠ¥é”™ã€</span><br><span class="line">nasm/yasm not found or too old. Use --<span class="built_in">disable</span>-x86asm <span class="keyword">for</span> a crippled build.</span><br><span class="line">ERROR: libfdk_aac not found</span><br><span class="line">ERROR: speex not found using pkg-config</span><br><span class="line">ERROR: libx264 not found</span><br><span class="line"></span><br><span class="line">å‰é¢ä¸‰ç§éƒ½å¯ä»¥é€šè¿‡brew installæ¥è§£å†³ï¼Œä½†æ˜¯libx264æ€ä¹ˆæéƒ½æ‹‰ä¸ä¸‹ã€‚ã€‚ã€‚</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡brewå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ffmpeg git:(master) brew install ffmpeg</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Installing dependencies <span class="keyword">for</span> ffmpeg: aom,,,,</span><br><span class="line"></span><br><span class="line">==&gt; Caveats</span><br><span class="line">gettext is keg-only, <span class="built_in">which</span> means it was not symlinked into /usr/<span class="built_in">local</span>,</span><br><span class="line">because macOS provides the BSD gettext library &amp; some software gets confused <span class="keyword">if</span> both are <span class="keyword">in</span> the library path.</span><br><span class="line"></span><br><span class="line">If you need to have gettext first <span class="keyword">in</span> your PATH run:</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/gettext/bin:$PATH"'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line">For compilers to find gettext you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> LDFLAGS=<span class="string">"-L/usr/local/opt/gettext/lib"</span></span><br><span class="line">  <span class="built_in">export</span> CPPFLAGS=<span class="string">"-I/usr/local/opt/gettext/include"</span></span><br><span class="line">==&gt; Caveats</span><br><span class="line">libffi is keg-only, <span class="built_in">which</span> means it was not symlinked into /usr/<span class="built_in">local</span>,</span><br><span class="line">because some formulae require a newer version of libffi.</span><br><span class="line"></span><br><span class="line">For compilers to find libffi you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> LDFLAGS=<span class="string">"-L/usr/local/opt/libffi/lib"</span></span><br><span class="line"></span><br><span class="line">For pkg-config to find libffi you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> PKG_CONFIG_PATH=<span class="string">"/usr/local/opt/libffi/lib/pkgconfig"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==&gt; Caveats</span><br><span class="line">==&gt; gettext</span><br><span class="line">gettext is keg-only, <span class="built_in">which</span> means it was not symlinked into /usr/<span class="built_in">local</span>,</span><br><span class="line">because macOS provides the BSD gettext library &amp; some software gets confused <span class="keyword">if</span> both are <span class="keyword">in</span> the library path.</span><br><span class="line"></span><br><span class="line">If you need to have gettext first <span class="keyword">in</span> your PATH run:</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/gettext/bin:$PATH"'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line">For compilers to find gettext you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> LDFLAGS=<span class="string">"-L/usr/local/opt/gettext/lib"</span></span><br><span class="line">  <span class="built_in">export</span> CPPFLAGS=<span class="string">"-I/usr/local/opt/gettext/include"</span></span><br><span class="line"></span><br><span class="line">==&gt; libffi</span><br><span class="line">libffi is keg-only, <span class="built_in">which</span> means it was not symlinked into /usr/<span class="built_in">local</span>,</span><br><span class="line">because some formulae require a newer version of libffi.</span><br><span class="line"></span><br><span class="line">For compilers to find libffi you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> LDFLAGS=<span class="string">"-L/usr/local/opt/libffi/lib"</span></span><br><span class="line"></span><br><span class="line">For pkg-config to find libffi you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> PKG_CONFIG_PATH=<span class="string">"/usr/local/opt/libffi/lib/pkgconfig"</span></span><br><span class="line"></span><br><span class="line">==&gt; unbound</span><br><span class="line">To have launchd start unbound now and restart at startup:</span><br><span class="line">  sudo brew services start unbound</span><br><span class="line">==&gt; glib</span><br><span class="line">Bash completion has been installed to:</span><br><span class="line">  /usr/<span class="built_in">local</span>/etc/bash_completion.d</span><br><span class="line">==&gt; tesseract</span><br><span class="line">This formula contains only the <span class="string">"eng"</span>, <span class="string">"osd"</span>, and <span class="string">"snum"</span> language data files.</span><br><span class="line">If you need any other supported languages, run `brew install tesseract-lang`.</span><br></pre></td></tr></table></figure>


<p><code>brew info ffmpeg</code>å¯ä»¥çœ‹åˆ°x264, x265è¿™äº›åŒ…éƒ½æ˜¯æœ‰å®‰è£…çš„ã€‚å‡çº§åˆ™é€šè¿‡<code>brew update &amp;&amp; brew upgrade ffmpeg</code>.</p>
<p>ç¬¬äºŒç§æ–¹å¼å®‰è£…è¿ç¯å¢ƒå˜é‡éƒ½ä¸éœ€è¦è®¾ç½®ï¼Œå®Œç¾æäº†ã€‚</p>
<h1 id="ç›®å½•åŠä½œç”¨"><a href="#ç›®å½•åŠä½œç”¨" class="headerlink" title="ç›®å½•åŠä½œç”¨"></a>ç›®å½•åŠä½œç”¨</h1><ul>
<li>libavcodecï¼š æä¾›äº†ä¸€ç³»åˆ—ç¼–ç å™¨çš„å®ç°ã€‚</li>
<li>libavformatï¼š å®ç°åœ¨æµåè®®ï¼Œå®¹å™¨æ ¼å¼åŠå…¶æœ¬IOè®¿é—®ã€‚</li>
<li>libavutilï¼š åŒ…æ‹¬äº†hashå™¨ï¼Œè§£ç å™¨å’Œå„åˆ©å·¥å…·å‡½æ•°ã€‚</li>
<li>libavfilterï¼š æä¾›äº†å„ç§éŸ³è§†é¢‘è¿‡æ»¤å™¨ã€‚</li>
<li>libavdeviceï¼š æä¾›äº†è®¿é—®æ•è·è®¾å¤‡å’Œå›æ”¾è®¾å¤‡çš„æ¥å£ã€‚</li>
<li>libswresampleï¼š å®ç°äº†æ··éŸ³å’Œé‡é‡‡æ ·ã€‚</li>
<li>libswscaleï¼š å®ç°äº†è‰²å½©è½¬æ¢å’Œç¼©æ”¾å·¥èƒ½ã€‚</li>
</ul>
<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p><code>éŸ³ï¼è§†é¢‘æµ</code> åœ¨éŸ³è§†é¢‘é¢†åŸŸï¼Œæˆ‘ä»¬æŠŠä¸€è·¯éŸ³ï¼è§†é¢‘ç§°ä¸ºä¸€è·¯æµã€‚å¦‚æˆ‘ä»¬å°æ—¶å€™ç»å¸¸ä½¿ç”¨VCDçœ‹æ¸¯ç‰‡ï¼Œåœ¨é‡Œè¾¹å¯ä»¥é€‰æ‹©ç²¤è¯­æˆ–å›½è¯­å£°éŸ³ï¼Œå…¶å®å°±æ˜¯CDè§†é¢‘æ–‡ä»¶ä¸­å­˜æ”¾äº†ä¸¤è·¯éŸ³é¢‘æµï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å…¶ä¸­ä¸€è·¯è¿›è¡Œæ’­æ”¾ã€‚</p>
<p><code>å®¹å™¨</code> æˆ‘ä»¬ä¸€èˆ¬æŠŠ MP4ï½¤ FLVã€MOVç­‰æ–‡ä»¶æ ¼å¼ç§°ä¹‹ä¸ºå®¹å™¨ã€‚ä¹Ÿå°±æ˜¯åœ¨è¿™äº›å¸¸ç”¨æ ¼å¼æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å­˜æ”¾å¤šè·¯éŸ³è§†é¢‘æ–‡ä»¶ã€‚ä»¥ MP4 ä¸ºä¾‹ï¼Œå°±å¯ä»¥å­˜æ”¾ä¸€è·¯è§†é¢‘æµï¼Œå¤šè·¯éŸ³é¢‘æµï¼Œå¤šè·¯å­—å¹•æµã€‚</p>
<p><code>channel</code> æ˜¯éŸ³é¢‘ä¸­çš„æ¦‚å¿µï¼Œç§°ä¹‹ä¸ºå£°é“ã€‚åœ¨ä¸€è·¯éŸ³é¢‘æµä¸­ï¼Œå¯ä»¥æœ‰å•å£°é“ï¼ŒåŒå£°é“æˆ–ç«‹ä½“å£°ã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a href="https://blog.csdn.net/weixin_33985507/article/details/94470495" target="_blank" rel="noopener">https://blog.csdn.net/weixin_33985507/article/details/94470495</a></p>
<p><a href="https://blog.csdn.net/leixiaohua1020/article/details/15811977" target="_blank" rel="noopener">https://blog.csdn.net/leixiaohua1020/article/details/15811977</a></p>
]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>FFmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>SwiftåŸºç¡€01</title>
    <url>/2019/11/01/Swift%E5%9F%BA%E7%A1%8001/</url>
    <content><![CDATA[<h2 id="å¸¸é‡å’Œå˜é‡"><a href="#å¸¸é‡å’Œå˜é‡" class="headerlink" title="å¸¸é‡å’Œå˜é‡"></a>å¸¸é‡å’Œå˜é‡</h2><h3 id="ä½¿ç”¨letå…³é”®å­—æ¥å£°æ˜å¸¸é‡"><a href="#ä½¿ç”¨letå…³é”®å­—æ¥å£°æ˜å¸¸é‡" class="headerlink" title="ä½¿ç”¨letå…³é”®å­—æ¥å£°æ˜å¸¸é‡"></a>ä½¿ç”¨letå…³é”®å­—æ¥å£°æ˜å¸¸é‡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> temp = 10</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨varå…³é”®å­—æ¥å£°æ˜å˜é‡"><a href="#ä½¿ç”¨varå…³é”®å­—æ¥å£°æ˜å˜é‡" class="headerlink" title="ä½¿ç”¨varå…³é”®å­—æ¥å£°æ˜å˜é‡"></a>ä½¿ç”¨varå…³é”®å­—æ¥å£°æ˜å˜é‡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var temp = 0</span><br><span class="line">temp = 10</span><br></pre></td></tr></table></figure>
<h3 id="å¯ä»¥åœ¨ä¸€è¡Œä¸­å£°æ˜å¤šä¸ªå˜é‡æˆ–å¸¸é‡ï¼Œç”¨é€—å·åˆ†éš”"><a href="#å¯ä»¥åœ¨ä¸€è¡Œä¸­å£°æ˜å¤šä¸ªå˜é‡æˆ–å¸¸é‡ï¼Œç”¨é€—å·åˆ†éš”" class="headerlink" title="å¯ä»¥åœ¨ä¸€è¡Œä¸­å£°æ˜å¤šä¸ªå˜é‡æˆ–å¸¸é‡ï¼Œç”¨é€—å·åˆ†éš”"></a>å¯ä»¥åœ¨ä¸€è¡Œä¸­å£°æ˜å¤šä¸ªå˜é‡æˆ–å¸¸é‡ï¼Œç”¨é€—å·åˆ†éš”</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var x=0.1, y=10.1, z=1.0</span><br></pre></td></tr></table></figure>
<h3 id="ç±»å‹æ ‡æ³¨"><a href="#ç±»å‹æ ‡æ³¨" class="headerlink" title="ç±»å‹æ ‡æ³¨"></a>ç±»å‹æ ‡æ³¨</h3><p>åœ¨å£°æ˜ä¸€ä¸ªå˜é‡æˆ–å¸¸é‡çš„æ—¶å€™æä¾›ç±»å‹æ ‡æ³¨ï¼Œæ¥æ˜ç¡®å˜é‡æˆ–å¸¸é‡èƒ½å¤Ÿå‚¨å­˜å€¼çš„ç±»å‹</p>
<p>æ·»åŠ ç±»å‹æ ‡æ³¨çš„æ–¹æ³•æ˜¯åœ¨å˜é‡æˆ–å¸¸é‡çš„åå­—åè¾¹åŠ ä¸€ä¸ªå†’å·ï¼Œå†è·Ÿä¸€ä¸ªç©ºæ ¼ï¼Œæœ€ååŠ ä¸Šè¦ä½¿ç”¨çš„ç±»å‹åç§°</p>
<p>å¯ä»¥åœ¨ä¸€è¡Œä¸­å®šä¹‰å¤šä¸ªç›¸å…³çš„å˜é‡ä¸ºç›¸åŒç±»å‹ï¼Œç”¨é€—å·åˆ†éš”ï¼Œåªè¦åœ¨æœ€åçš„å˜é‡åå­—åè¾¹åŠ ä¸Šç±»å‹æ ‡æ³¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var msg: String</span><br><span class="line">msg = <span class="string">"message"</span></span><br></pre></td></tr></table></figure>

<h3 id="å˜é‡å’Œå¸¸é‡å‘½å"><a href="#å˜é‡å’Œå¸¸é‡å‘½å" class="headerlink" title="å˜é‡å’Œå¸¸é‡å‘½å"></a>å˜é‡å’Œå¸¸é‡å‘½å</h3><p>å‡ ä¹å¯ä»¥ä½¿ç”¨ä»»ä½•è‡ªè´Ÿï¼Œç”šè‡³åŒ…æ‹¬Unicodeå­—ç¬¦</p>
<p>ä¸èƒ½åŒ…æ‹¬ç©ºç™½å­—ç¬¦ã€æ•°å­¦ç¬¦å·ã€ç®­å¤´ã€ä¿ç•™çš„ï¼ˆæˆ–æ— æ•ˆçš„ï¼‰Unicodeç ä½ã€è¿çº¿å’Œåˆ¶è¡¨ç¬¦ã€‚ä¹Ÿä¸èƒ½ä»¥æ•°å­—å¼€å¤´ã€‚</p>
<h3 id="æ‰“å°å¸¸é‡å’Œå˜é‡"><a href="#æ‰“å°å¸¸é‡å’Œå˜é‡" class="headerlink" title="æ‰“å°å¸¸é‡å’Œå˜é‡"></a>æ‰“å°å¸¸é‡å’Œå˜é‡</h3><p>print</p>
<p>å­—ç¬¦ä¸²æ’å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> str = <span class="string">"show string"</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"æ˜¾ç¤ºstr\(str)"</span>)</span><br></pre></td></tr></table></figure>

<h2 id="æ•°å€¼ç±»å‹"><a href="#æ•°å€¼ç±»å‹" class="headerlink" title="æ•°å€¼ç±»å‹"></a>æ•°å€¼ç±»å‹</h2><h3 id="æ•´æ•°"><a href="#æ•´æ•°" class="headerlink" title="æ•´æ•°"></a>æ•´æ•°</h3><p>8ï¼Œ16ï¼Œ32ï¼Œ64ä½ç¼–ç çš„æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ•´æ•°ï¼ˆä¾‹å¦‚ï¼šUInt8,Int8ï¼‰</p>
<p>é€šè¿‡minå’Œmaxå±æ€§è®¿é—®æ¯ä¸ªæ•´æ•°ç±»å‹çš„æœ€å°å€¼å’Œæœ€å¤§å€¼</p>
<p>Intï¼Œæ‹¥æœ‰ä¸å½“å‰å¹³å°çš„åŸç”Ÿå­—ç›¸åŒçš„é•¿åº¦ï¼›UIntï¼Œä¸å¹³å°é•¿åº¦ç›¸å…³çš„æ— ç¬¦å·æ•´æ•°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"UInt8 min \(UInt8.min), UInt8 max \(UInt8.max)"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æµ®ç‚¹æ•°"><a href="#æµ®ç‚¹æ•°" class="headerlink" title="æµ®ç‚¹æ•°"></a>æµ®ç‚¹æ•°</h3><p> Double 64ä½æµ®ç‚¹æ•°ï¼Œè‡³å°‘æœ‰15ä½æ•°å­—çš„ç²¾åº¦</p>
<p> Float 32ä½æµ®ç‚¹æ•°ï¼Œè‡³å°‘æœ‰6ä½æ•°å­—çš„ç²¾åº¦</p>
<h3 id="Bool"><a href="#Bool" class="headerlink" title="Bool"></a>Bool</h3><p>è¡¨ç¤ºtrueå’Œfalse</p>
<p>Swiftçš„ç±»å‹å®‰å…¨æœºåˆ¶ä¼šé˜»æ­¢ä½ ç”¨ä¸€ä¸ªéå¸ƒå°”é‡çš„å€¼æ›¿ä»£æ‰Bool</p>
<h3 id="æ•°å€¼èŒƒå›´"><a href="#æ•°å€¼èŒƒå›´" class="headerlink" title="æ•°å€¼èŒƒå›´"></a>æ•°å€¼èŒƒå›´</h3><p><img src="/2019/11/01/Swift%E5%9F%BA%E7%A1%8001/Swift_%E6%95%B0%E5%80%BC%E8%8C%83%E5%9B%B4.png" alt="Swift_æ•°å€¼èŒƒå›´"></p>
<h3 id="ç±»å‹åˆ«å"><a href="#ç±»å‹åˆ«å" class="headerlink" title="ç±»å‹åˆ«å"></a>ç±»å‹åˆ«å</h3><p> ç±»å‹åˆ«åæ˜¯ä¸€ä¸ªä¸ºå·²å­˜åœ¨ç±»å‹å®šä¹‰çš„ä¸€ä¸ªå¯é€‰æ‹©çš„åå­—<br> <code>typealias</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">typealias AudioSample = UInt8</span><br><span class="line"><span class="built_in">let</span> sample: AudioSample = 32</span><br></pre></td></tr></table></figure>

<h2 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h2><h3 id="ä½¿ç”¨Tupleç»„åˆå¤šä¸ªå€¼"><a href="#ä½¿ç”¨Tupleç»„åˆå¤šä¸ªå€¼" class="headerlink" title="ä½¿ç”¨Tupleç»„åˆå¤šä¸ªå€¼"></a>ä½¿ç”¨Tupleç»„åˆå¤šä¸ªå€¼</h3><p>å…ƒç»„æŠŠå¤šä¸ªå€¼åˆå¹¶æˆå•ä¸€çš„å¤åˆå‹çš„å€¼</p>
<p>å…ƒç»„å†…çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œè€Œä¸”å¯ä»¥ä¸å¿…æ˜¯åŒä¸€ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> error = (1, <span class="string">"æ²¡æœ‰æƒé™"</span>)</span><br><span class="line"><span class="built_in">print</span>(error.0)</span><br><span class="line"><span class="built_in">print</span>(error.1)</span><br></pre></td></tr></table></figure>
<h3 id="å…ƒç´ å‘½å"><a href="#å…ƒç´ å‘½å" class="headerlink" title="å…ƒç´ å‘½å"></a>å…ƒç´ å‘½å</h3><p>å…ƒç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥åˆ¶å®šå¯¹åº”çš„å…ƒç´ åç§°</p>
<p>å¦‚æœæ²¡æœ‰åˆ¶å®šåç§°çš„å…ƒç´ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹æ ‡çš„æ–¹å¼æ¥å¼•ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> error = (error: 1,  errorMsg: <span class="string">"æ²¡æœ‰æƒé™"</span>)</span><br><span class="line"><span class="built_in">print</span>(error.error)</span><br><span class="line"><span class="built_in">print</span>(error.errorMsg)</span><br></pre></td></tr></table></figure>
<h3 id="Tupleä¿®æ”¹"><a href="#Tupleä¿®æ”¹" class="headerlink" title="Tupleä¿®æ”¹"></a>Tupleä¿®æ”¹</h3><p>ç”¨varå®šä¹‰çš„å…ƒç»„å°±æ˜¯å¯å˜å…ƒç»„ï¼Œletå®šä¹‰çš„å°±æ˜¯ä¸å¯å˜å…ƒç»„</p>
<p><code>ä¸ç®¡æ˜¯å¯å˜è¿˜æ˜¯ä¸å¯å˜å…ƒç»„ï¼Œå…ƒç»„åœ¨åˆ›å»ºåå°±ä¸èƒ½å¢åŠ å’Œåˆ é™¤å…ƒç´ </code></p>
<p>å¯ä»¥å¯¹å¯å˜å…ƒç»„çš„å…ƒç´ è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯ä¸èƒ½æ”¹å˜å…¶ç±»å‹</p>
<p>Anyç±»å‹å¯ä»¥æ”¹ä¸ºä»»ä½•ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var error:(errorCode: Int, errorMsg:Any) = (errorCode: 1, errorMsg: <span class="string">"æ²¡æœ‰æƒé™"</span>)</span><br><span class="line">error.errorCode = 2</span><br><span class="line">error.errorMsg = 3</span><br><span class="line"><span class="built_in">print</span>(error)</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†è§£"><a href="#åˆ†è§£" class="headerlink" title="åˆ†è§£"></a>åˆ†è§£</h3><p>å¯ä»¥å°†ä¸€ä¸ªå…ƒç»„çš„å†…å®¹åˆ†è§£æˆå•ç‹¬çš„å¸¸é‡æˆ–å˜é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> error = (1, <span class="string">"æ²¡æœ‰æƒé™"</span>)</span><br><span class="line"><span class="built_in">let</span> (error, errorMsg) = error</span><br><span class="line"><span class="built_in">print</span>(error)</span><br><span class="line"><span class="built_in">print</span>(errorMsg)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåªéœ€è¦ä½¿ç”¨å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä¸éœ€è¦çš„æ•°æ®å¯ä»¥ç”¨ä¸‹åˆ’çº¿<code>_</code>ä»£æ›¿</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> error = (1, <span class="string">"æ²¡æœ‰æƒé™"</span>)</span><br><span class="line"><span class="built_in">let</span> (_, errorMsg) = error</span><br><span class="line"><span class="built_in">print</span>(errorMsg)</span><br></pre></td></tr></table></figure>
<h3 id="ä½œä¸ºå‡½æ•°è¿”å›å€¼"><a href="#ä½œä¸ºå‡½æ•°è¿”å›å€¼" class="headerlink" title="ä½œä¸ºå‡½æ•°è¿”å›å€¼"></a>ä½œä¸ºå‡½æ•°è¿”å›å€¼</h3><p>ä½¿ç”¨Tupleä¸ºå‡½æ•°è¿”å›å¤šä¸ªå€¼</p>
<p>è¿”å›å€¼çš„Tupleå¯ä»¥åœ¨å‡½æ•°çš„è¿”å›ç±»å‹éƒ¨åˆ†è¢«å‘½å</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func requestWithUrl(url: String) -&gt; (errorCode: Int, errorMsg: String) &#123;</span><br><span class="line">    <span class="built_in">return</span> (1, <span class="string">"æ²¡æœ‰æƒé™"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> error = requestWithUrl(url: <span class="string">""</span>)</span><br><span class="line"><span class="built_in">print</span>(error)</span><br></pre></td></tr></table></figure>

<h2 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h2><p>é€šè¿‡åœ¨å˜é‡ç±»å‹åé¢åŠ <code>?</code>è¡¨ç¤ºï¼šè¿™é‡Œæœ‰ä¸€ä¸ªå€¼ï¼Œå®ƒè¡¨ç¤ºxï¼Œæˆ–è€…è¿™é‡Œæ ¹æœ¬æ²¡æœ‰å€¼</p>
<p>å¯ä»¥é€šè¿‡ç»™å¯é€‰å˜é‡èµ‹å€¼ä¸€ä¸ªnilæ¥å°†ä¹‹è®¾ç½®ä¸ºæ²¡æœ‰å€¼</p>
<p>åœ¨Swiftä¸­ï¼Œnilä¸æ˜¯æŒ‡é’ˆï¼Œä»–æ˜¯å€¼ç¼ºå¤±çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œä»»ä½•ç±»å‹çš„å¯é€‰ç±»é¡¹éƒ½å¯ä»¥è®¾ç½®æˆnilè€Œä¸ä»…ä»…æ˜¯å¯¹è¥¿é‚£ä¸ªç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var str : String? = nil</span><br></pre></td></tr></table></figure>

<h3 id="Optional-if"><a href="#Optional-if" class="headerlink" title="Optional-if"></a>Optional-if</h3><p>å¯é€‰é¡¹æ˜¯æ²¡æ³•ç›´æ¥é£Ÿç”¨çš„ï¼Œéœ€è¦ç”¨!å±•å¼€ä¹‹åæ‰èƒ½ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var str : String? = <span class="string">"abc"</span></span><br><span class="line"><span class="keyword">if</span> str != nil &#123;</span><br><span class="line">    <span class="built_in">let</span> cont = str!.count</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Optional-ç»‘å®š"><a href="#Optional-ç»‘å®š" class="headerlink" title="Optional-ç»‘å®š"></a>Optional-ç»‘å®š</h3><p>å¯ä»¥ä½¿ç”¨å¯é€‰é¡¹çš„ç»‘å®šæ¥åˆ¤æ–­æ˜¯å¦åŒ…å«å€¼ï¼Œå¦‚æœåŒ…å«å°±æŠŠå€¼èµ‹ç»™ä¸€ä¸ªä¸´æ—¶çš„å¸¸é‡æˆ–è€…å˜é‡</p>
<p>å¯é€‰ç»‘å®šå¯ä»¥ä¸ifå’Œwhileçš„è¯­å¥ä½¿ç”¨æ¥æ£€æŸ¥å¯é€‰é¡¹å†…éƒ¨çš„å€¼ï¼Œå¹¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æˆ–å¸¸é‡ </p>
<p>åŒä¸€ä¸ªifè¯­å¥ä¸­åŒ…å«å¤šä¸ªå¯é€‰é¡¹ç»‘å®šæ—¶ï¼Œç”¨é€—å·åˆ†éš”å¼€å³å¯ã€‚å¦‚æœäººä¸€ä¸ªé€‰é¡¹ç»‘å®šç»“æœæ˜¯nilæˆ–è€…å¸ƒå°”å€¼ä¸ºfalseï¼Œé‚£ä¹ˆæ•´ä¸ªifåˆ¤æ–­ä¼šè¢«çœ‹ä½œfalse</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var str : String? = <span class="string">"abc"</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">let</span> actualStr = str &#123;</span><br><span class="line">    <span class="built_in">let</span> cont = str!.count</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Optional-éšå¼å±•å¼€"><a href="#Optional-éšå¼å±•å¼€" class="headerlink" title="Optional-éšå¼å±•å¼€"></a>Optional-éšå¼å±•å¼€</h3><p>æœ‰äº›å¯é€‰é¡¹ä¸€æ—¦è¢«è®¾å®šå€¼ä¹‹åï¼Œå°±ä¼šä¸€ç›´æ‹¥æœ‰å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥å»æ‰æ£€æŸ¥çš„éœ€æ±‚ï¼Œä¹Ÿä¸å¿…æ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½è¿›è¡Œå±•å¼€</p>
<p>é€šè¿‡åœ¨å£°æ˜çš„ç±»å‹åè¾¹æ·»åŠ ä¸€ä¸ªå¹å·<code>!</code>è€Œéé—®å¥½æ¥ä¹¦å†™éšå¼å±•å¼€å¯é€‰é¡¹</p>
<p>éšå¼å±•å¼€å¯é€‰é¡¹ä¸»è¦è¢«ç”¨äºSwiftç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var str : String! = <span class="string">"abc"</span></span><br><span class="line"><span class="built_in">let</span> cont = str!.count</span><br><span class="line"><span class="built_in">print</span>(count)</span><br></pre></td></tr></table></figure>

<h3 id="Optional-å¯é€‰é“¾"><a href="#Optional-å¯é€‰é“¾" class="headerlink" title="Optional-å¯é€‰é“¾"></a>Optional-å¯é€‰é“¾</h3><p>å¯é€‰é¡¹åé¢åŠ é—®å·</p>
<p>å¦‚æœå¯é€‰é¡¹ä¸ä¸ºnilï¼Œè¿”å›ä¸€ä¸ªå¯é€‰é¡¹ç»“æœï¼Œå¦åˆ™è¿”å›nil</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var str : String? = <span class="string">"abc"</span></span><br><span class="line"><span class="built_in">let</span> cont = str?.count</span><br><span class="line"><span class="keyword">if</span> count != nil &#123;</span><br><span class="line">    <span class="built_in">let</span> lastIndex = count! - 1</span><br><span class="line">    <span class="built_in">print</span>(lastIndex)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><h3 id="åˆå§‹åŒ–ç©ºä¸²"><a href="#åˆå§‹åŒ–ç©ºä¸²" class="headerlink" title="åˆå§‹åŒ–ç©ºä¸²"></a>åˆå§‹åŒ–ç©ºä¸²</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var emptyString = <span class="string">""</span></span><br><span class="line">var anotherEmptyString = String()</span><br><span class="line"><span class="keyword">if</span> emptyString.isEmpty &#123;</span><br><span class="line">    <span class="built_in">print</span>(Noting<span class="string">")</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h3><p>å­—ç¬¦ä¸²å­—é¢äº®æ˜¯è¢«åŒå¼•å·<code>&quot;</code>åŒ…è£¹çš„å›ºå®šé¡ºåºçš„æ–‡æœ¬å­—ç¬¦</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var str = <span class="string">"some string"</span></span><br></pre></td></tr></table></figure>

<h3 id="å¤šè¡Œå­—é¢é‡"><a href="#å¤šè¡Œå­—é¢é‡" class="headerlink" title="å¤šè¡Œå­—é¢é‡"></a>å¤šè¡Œå­—é¢é‡</h3><p>å­—å¤šè¡Œç¬¦ä¸²å­—é¢é‡æ˜¯è¢«ä¸‰ä¸ªåŒå¼•å·<code>&quot;&quot;&quot;</code>å¼•èµ·æ¥çš„ä¸€ç³»åˆ—å­—ç¬¦</p>
<p>å¼€å§‹å’Œç»“æŸé»˜è®¤ä¸ä¼šæœ‰æ¢è¡Œç¬¦</p>
<p>åæ–œæ åªä¼šåœ¨ä»£ç é˜…è¯»ä¸Šæ–¹ä¾¿ï¼Œè¾“å‡ºæ—¶æ²¡æœ‰å®é™…çš„æ¢è¡ŒåŠŸèƒ½<code>\</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> str = <span class="string">""</span><span class="string">"var emptyString = "</span><span class="string">" \</span></span><br><span class="line"><span class="string">var anotherEmptyString = String() \</span></span><br><span class="line"><span class="string">if emptyString.isEmpty &#123; \</span></span><br><span class="line"><span class="string">    print(Noting"</span>) \</span><br><span class="line"><span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">print(str)</span></span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²é‡Œçš„ç‰¹æ®Šå­—ç¬¦"><a href="#å­—ç¬¦ä¸²é‡Œçš„ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="å­—ç¬¦ä¸²é‡Œçš„ç‰¹æ®Šå­—ç¬¦"></a>å­—ç¬¦ä¸²é‡Œçš„ç‰¹æ®Šå­—ç¬¦</h3><p>è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦</p>
<p>ä»»æ„çš„Unicodeæ ‡é‡  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ‰©å±•å­—ç¬¦ä¸²åˆ†éš”ç¬¦"><a href="#æ‰©å±•å­—ç¬¦ä¸²åˆ†éš”ç¬¦" class="headerlink" title="æ‰©å±•å­—ç¬¦ä¸²åˆ†éš”ç¬¦"></a>æ‰©å±•å­—ç¬¦ä¸²åˆ†éš”ç¬¦</h3><p>åœ¨å­—ç¬¦ä¸²å­—é¢é‡ä¸­æ”¾ç½®æ‰©å±•åˆ†éš”ç¬¦æ¥åœ¨å­—ç¬¦ä¸²ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦è€Œä¸è®©å®ƒä»¬çœŸçš„ç”Ÿæ•ˆ</p>
<p>å°†å­—ç¬¦ä¸²æ”¾åœ¨åŒå¼•å·å†…å¹¶ç”±äº•å·#åŒ…è£¹</p>
<p>å¦‚æœå­—ç¬¦ä¸²é‡Œæœ‰â€#åˆ™é¦–å°¾éœ€è¦ä¸¤ä¸ª##(é¦–å°¾##ä¸åŒ…å«çš„â€#ä¸ä¸€æ ·å³å¯)</p>
<p>å¦‚æœä½ éœ€è¦å­—ç¬¦ä¸²ä¸­æŸä¸ªç‰¹æ®Šç¬¦å·çš„æ•ˆæœï¼Œä½¿ç”¨åŒ¹é…ä½ åŒ…è£¹çš„#å·æ•°é‡çš„#å·ï¼Œå¹¶åœ¨å‰é¢æ·»åŠ è½¬ä¹‰ç¬¦å·\</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> str = <span class="comment">#"122\n\n444"#</span></span><br><span class="line"><span class="built_in">let</span> str = <span class="comment">#"122\#n\n444"#</span></span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²çš„å¯å˜å½¢"><a href="#å­—ç¬¦ä¸²çš„å¯å˜å½¢" class="headerlink" title="å­—ç¬¦ä¸²çš„å¯å˜å½¢"></a>å­—ç¬¦ä¸²çš„å¯å˜å½¢</h3><p>var å¯ä¿®æ”¹<br>let ä¸å¯ä¿®æ”¹</p>
<h3 id="å­—ç¬¦ä¸²æ˜¯å€¼ç±»å‹"><a href="#å­—ç¬¦ä¸²æ˜¯å€¼ç±»å‹" class="headerlink" title="å­—ç¬¦ä¸²æ˜¯å€¼ç±»å‹"></a>å­—ç¬¦ä¸²æ˜¯å€¼ç±»å‹</h3><p>String å€¼åœ¨ä¼ é€’ç»™æ–¹æ³•æˆ–è€…å‡½æ•°çš„æ—¶å€™ä¼šè¢«å¤åˆ¶è¿‡å»</p>
<p>èµ‹å€¼ç»™å¸¸é‡å’Œå˜é‡çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·</p>
<h3 id="æ“ä½œå­—ç¬¦"><a href="#æ“ä½œå­—ç¬¦" class="headerlink" title="æ“ä½œå­—ç¬¦"></a>æ“ä½œå­—ç¬¦</h3><p>for-in å¾ªç¯éå†Stringä¸­çš„æ¯ä¸€ä¸ªç‹¬ç«‹çš„Character</p>
<p>Characterç±»å‹</p>
<p>Stringå€¼å¯ä»¥é€šè¿‡ä¼ å…¥Character æ•°ç»„æ¥æ„é€ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> character <span class="keyword">in</span> <span class="string">"abcdef"</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(character)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> tempCharacters: [Character] = [<span class="string">"d"</span>,<span class="string">"f"</span>,<span class="string">"d"</span>,<span class="string">"h"</span>]</span><br><span class="line"><span class="built_in">let</span> str = String(tempCharacters)</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥"></a>å­—ç¬¦ä¸²æ‹¼æ¥</h3><p>é€šè¿‡åŠ è¿ç®—ç¬¦<code>+</code>åˆ›å»ºæ–°å­—ç¬¦ä¸²</p>
<p>ä½¿ç”¨åŠ èµ‹å€¼ç¬¦å·<code>+=</code>åœ¨å·²ç»å­˜åœ¨çš„Stringå€¼æœ«å°¾è¿½åŠ ä¸€ä¸ªStringå€¼</p>
<p>ä½¿ç”¨Stringç±»å‹çš„<code>append()</code>æ–¹æ³•æ¥ç»™ä¸€ä¸ªStringå˜é‡çš„æœ«å°¾è¿½åŠ characterå€¼</p>
<h3 id="å­—ç¬¦ä¸²æ’å€¼"><a href="#å­—ç¬¦ä¸²æ’å€¼" class="headerlink" title="å­—ç¬¦ä¸²æ’å€¼"></a>å­—ç¬¦ä¸²æ’å€¼</h3><p><code>\(some)</code> someä»£è¡¨ï¼šæ··åˆå¸¸é‡ã€å˜é‡ã€å­—é¢é‡å’Œè¡¨è¾¾å¼çš„å­—ç¬¦ä¸²é¢é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="comment">#"1 * 3 = \#(1*3)."#)</span></span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²ç´¢å¼•"><a href="#å­—ç¬¦ä¸²ç´¢å¼•" class="headerlink" title="å­—ç¬¦ä¸²ç´¢å¼•"></a>å­—ç¬¦ä¸²ç´¢å¼•</h3><p>æ¯ä¸ªStringå€¼éƒ½æœ‰ç›¸å…³çš„ç´¢å¼•ç±»å‹ï¼ŒString.indexï¼Œå®ƒç›¸å½“äºæ¯ä¸ªCharacteråœ¨å­—ç¬¦ä¸²é‡çš„ä½ç½®</p>
<p>startIndexå±æ€§æ¥è®¿é—®Stringä¸­ç¬¬ä¸€ä¸ªCharacterçš„ä½ç½®ã€‚endIndexå±æ€§å°±æ˜¯Stringä¸­æœ€åä¸€ä¸ªå­—ç¬¦åçš„ä½ç½®</p>
<p>endIndexå±æ€§å¹¶ä¸æ˜¯å­—ç¬¦ä¸²ä¸‹è¡¨è„šæœ¬çš„åˆæ³•å®é™…å‚æ•°</p>
<p>å¦‚æœStringä¸ºç©ºï¼Œåˆ™startIndexä¸endIndexç›¸ç­‰</p>
<p>ä½¿ç”¨index(before:)å’Œindex(after:)æ–¹æ³•æ¥è®¿é—®ç»™å®šç´¢å¼•çš„å‰å</p>
<p>è¦è®¿é—®ç»™å®šç´¢å¼•æ›´è¿œçš„ç´¢å¼•ï¼Œä½ å¯ä»¥ä½¿ç”¨index(_:offsetBy:)</p>
<p>ä½¿ç”¨indiceså±æ€§æ¥è®¿é—®å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦çš„ç´¢å¼•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> hello = <span class="string">"hello"</span></span><br><span class="line">hello[hello.startIndex]</span><br><span class="line">hello[hello.index(before: hello.endIndex)]</span><br><span class="line">hello[hello.index(after: hello.startIndex)]</span><br><span class="line"><span class="built_in">let</span> index = hello.index(hello.startIndex, offsetBy: 2)</span><br><span class="line">hello[index]</span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><p>æ’å…¥å­—ç¬¦ï¼Œä½¿ç”¨insert(_:at:)æ–¹æ³•</p>
<p>æ’å…¥å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹åˆ°ç‰¹å®šçš„ç´¢å¼•ï¼Œä½¿ç”¨insert(contentsOs:at:)æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var welcome = <span class="string">"hello"</span></span><br><span class="line">welcome.insert(<span class="string">"!"</span>, at: welcome.endIndex)</span><br><span class="line"></span><br><span class="line">welcome.insert(contentsOf: <span class="string">"ererer"</span>, at: welcome.index(before: welcome.endIndex))</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><p>ç§»é™¤å­—ç¬¦ä¸²remove(at:)</p>
<p>ç§»é™¤ç‰¹å®šèŒƒå›´çš„å­—ç¬¦ä¸²removeSubrange(range)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">welcome.remove(at: welcome.index(before: welcome.endIndex))</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> range = welcome.index(welcome.endIndex, offsetBy: -1)..&lt;welcome.endIndex</span><br><span class="line">welcome.removeSubrange(range)</span><br></pre></td></tr></table></figure>

<h3 id="å­å­—ç¬¦ä¸²"><a href="#å­å­—ç¬¦ä¸²" class="headerlink" title="å­å­—ç¬¦ä¸²"></a>å­å­—ç¬¦ä¸²</h3><p>ä½¿ç”¨ä¸‹è¡¨æˆ–è€…ç´¯æ­»prefix(_:)çš„æ–¹æ³•å¾—åˆ°çš„å­å­—ç¬¦ä¸²æ˜¯SubStringç±»å‹</p>
<p>SubStringæ‹¥æœ‰Stringçš„å¤§éƒ¨åˆ†æ–¹æ³•</p>
<p>SubStringå¯ä»¥è½¬æˆStringç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> index3 = hello.lastIndex(of: <span class="string">"o"</span>) ?? hello.endIndex</span><br><span class="line"><span class="built_in">let</span> begin = hello[..&lt;index3]</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> newHello = String(begin)</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²æ¯”è¾ƒ"><a href="#å­—ç¬¦ä¸²æ¯”è¾ƒ" class="headerlink" title="å­—ç¬¦ä¸²æ¯”è¾ƒ"></a>å­—ç¬¦ä¸²æ¯”è¾ƒ</h3><p>å­—ç¬¦ä¸²å’Œå­—ç¬¦ç›¸ç­‰æ€§(==å’Œ==)</p>
<p>å‰ç¼€ç›¸ç­‰hasPrefix(_:)</p>
<p>åç¼€ç›¸ç­‰hasSuffix(_:)</p>
<h2 id="èµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦"><a href="#èµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="èµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦"></a>èµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦</h2><p>ä¸€å…ƒè¿ç®—ç¬¦ã€äºŒå…ƒè¿ç®—ç¬¦ã€ä¸‰å…ƒè¿ç®—ç¬¦</p>
<p>èµ‹å€¼è¿ç®—ç¬¦ä¸ä¼šè¿”å›å€¼</p>
<h2 id="å¦‚ä½•å¤„ç†ç®—æœ¯ç»“æœæº¢å‡º"><a href="#å¦‚ä½•å¤„ç†ç®—æœ¯ç»“æœæº¢å‡º" class="headerlink" title="å¦‚ä½•å¤„ç†ç®—æœ¯ç»“æœæº¢å‡º"></a>å¦‚ä½•å¤„ç†ç®—æœ¯ç»“æœæº¢å‡º</h2><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªæ•´æ•°èµ‹è¶…è¿‡å®ƒå®¹é‡çš„å€¼æ—¶ï¼ŒSwiftä¼šæŠ¥é”™è€Œä¸æ˜¯ç”Ÿæˆä¸€ä¸ªæ— æ•ˆçš„æ•°ï¼Œç»™æˆ‘ä»¬æ“ä½œè¿‡å¤§æˆ–è€…è¿‡å°çš„æ•°çš„æ—¶å€™æä¾›äº†é¢å¤–çš„å®‰å…¨æ€§</p>
<p>åŒæ—¶æä¾›äº†ä¸‰ä¸ªç®—æœ¯æº¢å‡ºè¿ç®—ç¬¦æ¥è®©ç³»ç»Ÿæ”¯æŒæ•´æ•°æº¢å‡ºçš„è¿ç®—</p>
<p>æº¢å‡ºåŠ æ³•<code>&amp;+</code></p>
<p>æº¢å‡ºå‡æ³•<code>&amp;-</code></p>
<p>æº¢å‡ºä¹˜æ³•<code>&amp;*</code></p>
<h3 id="å€¼æº¢å‡º"><a href="#å€¼æº¢å‡º" class="headerlink" title="å€¼æº¢å‡º"></a>å€¼æº¢å‡º</h3><p>æº¢å‡ºä¹Ÿä¼šå‘ç”Ÿåœ¨æœ‰ç¬¦å·æ•´å½¢æ•°å€¼ä¸Š</p>
<p>å¯¹äºæ— ç¬¦å·ä¸æœ‰ç¬¦å·æ•´å½¢æ•°å€¼æ¥è¯´ï¼Œå½“å‡ºç°ä¸Šæº¢æ—¶ï¼Œå®ƒä»¬ä¼šä»æ•°å€¼æ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°å˜æˆæœ€å°çš„æ•°ã€‚åŒæ ·ï¼Œå½“å‘ç”Ÿä¸‹æº¢æ—¶ï¼Œå®ƒä»¬ä¼šä»æ‰€èƒ½å®¹çº³çš„æœ€å°æ•°å˜æˆæœ€å¤§çš„æ•°ã€‚</p>
<h2 id="åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦"><a href="#åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦" class="headerlink" title="åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦??"></a>åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦<code>??</code></h2><p>åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦(a??b)å¦‚æœé€‰é¡¹aæœ‰å€¼åˆ™å±•å¼€ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œæ˜¯nilï¼Œåˆ™è¿”å›é»˜è®¤å€¼b</p>
<p>è¡¨è¾¾å¼aå¿…é¡»æ˜¯ä¸€ä¸ªå¯é€‰ç±»å‹ã€‚è¡¨è¾¾å¼bå¿…é¡»ä¸açš„å­˜å‚¨ç±»å‹ç›¸åŒã€‚</p>
<p>å®é™…ä¸Šå®ƒå°±æ˜¯ç›¸å½“äºä¸‰ç›®è¿ç®—ç¬¦<code>_?_:_</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func addTwoNum(num1: Int?, num2: Int2?) -&gt; Int &#123;</span><br><span class="line">    <span class="built_in">return</span> (num1 ?? 0) +(num2 ?? 0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åŒºé—´è¿ç®—ç¬¦"><a href="#åŒºé—´è¿ç®—ç¬¦" class="headerlink" title="åŒºé—´è¿ç®—ç¬¦"></a>åŒºé—´è¿ç®—ç¬¦</h2><h3 id="é—­åŒºé—´è¿ç®—ç¬¦a-b"><a href="#é—­åŒºé—´è¿ç®—ç¬¦a-b" class="headerlink" title="é—­åŒºé—´è¿ç®—ç¬¦a...b"></a>é—­åŒºé—´è¿ç®—ç¬¦<code>a...b</code></h3><p>å®šä¹‰äº†ä»aåˆ°bçš„ä¸€ç»„èŒƒå›´ï¼Œå¹¶ä¸”åŒ…å«aå’Œb</p>
<p>açš„å€¼ä¸èƒ½å¤§äºbçš„å€¼</p>
<h3 id="åŠå¼€åŒºé—´è¿ç®—ç¬¦a-lt-b"><a href="#åŠå¼€åŒºé—´è¿ç®—ç¬¦a-lt-b" class="headerlink" title="åŠå¼€åŒºé—´è¿ç®—ç¬¦a..&lt;b"></a>åŠå¼€åŒºé—´è¿ç®—ç¬¦<code>a..&lt;b</code></h3><p>å®šä¹‰äº†ä»aåˆ°bä½†ä¸åŒ…å«bçš„åŒºé—´</p>
<p>açš„å€¼ä¸èƒ½å¤§äºbçš„å€¼ï¼Œå¦‚æœaä¸bçš„å€¼ç›¸ç­‰ï¼Œé‚£è¿”å›çš„åŒºé—´å°†ä¼šæ˜¯ç©ºçš„</p>
<h3 id="å•ä¾§åŒºé—´"><a href="#å•ä¾§åŒºé—´" class="headerlink" title="å•ä¾§åŒºé—´"></a>å•ä¾§åŒºé—´</h3><p>æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªåŒ…å«æ•°ç»„æ‰€æœ‰çš„å…ƒç´ çš„åŒºé—´ï¼Œä»ç´¢å¼•2åˆ°æ•°ç»„çš„ç»“æŸã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥çœç•¥åŒºé—´è¿ç®—ç¬¦ä¸€ä¾§çš„å€¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[2...] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[...2] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å€’åºç´¢å¼•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> (0..&lt;10&gt;).<span class="function"><span class="title">reversed</span></span>()&#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒºé—´è¿ç®—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸Šçš„è¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var welcome = <span class="string">"hello,world"</span></span><br><span class="line"><span class="built_in">let</span> range = welcome.startIndex...welcome.index(welcome.endIndex, offsetBy: -6)</span><br><span class="line">welcome.removeSubrange(range)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(welcome)]</span><br></pre></td></tr></table></figure>

<p>åŒºé—´è¿ç®—ç¬¦åœ¨æ¯”è¾ƒç±»å‹ä¸Šçš„è¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> welcome = <span class="string">"hello,world"</span></span><br><span class="line"><span class="built_in">let</span> interval = <span class="string">"a"</span>...<span class="string">"z"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> welcome &#123;</span><br><span class="line">    <span class="keyword">if</span> !interval.contains(String(c)) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(c)ä¸æ˜¯å°å†™å­—æ¯"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½è¿ç®—ç¬¦"><a href="#ä½è¿ç®—ç¬¦" class="headerlink" title="ä½è¿ç®—ç¬¦"></a>ä½è¿ç®—ç¬¦</h2><h3 id="ä½å–åè¿ç®—ç¬¦"><a href="#ä½å–åè¿ç®—ç¬¦" class="headerlink" title="ä½å–åè¿ç®—ç¬¦"></a>ä½å–åè¿ç®—ç¬¦</h3><p>ä½å–åè¿ç®—ç¬¦(~)æ˜¯å¯¹æ‰€æœ‰ä½çš„æ•°å­—è¿›è¡Œå–åæ“ä½œ</p>
<h3 id="ä½ä¸è¿ç®—ç¬¦"><a href="#ä½ä¸è¿ç®—ç¬¦" class="headerlink" title="ä½ä¸è¿ç®—ç¬¦"></a>ä½ä¸è¿ç®—ç¬¦</h3><p>ä½ä¸è¿ç®—ç¬¦(&amp;)æ˜¯å¯¹ä¸¤ä¸ªæ•°çš„æ¯”ç‰¹ä½è¿›è¡Œåˆå¹¶ã€‚å®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ï¼Œåªæœ‰å½“è¿™ä¸¤ä¸ªæ•°éƒ½æ˜¯1çš„æ—¶å€™æ‰èƒ½è¿”å›1ã€‚</p>
<h3 id="ä½æˆ–è¿ç®—ç¬¦"><a href="#ä½æˆ–è¿ç®—ç¬¦" class="headerlink" title="ä½æˆ–è¿ç®—ç¬¦"></a>ä½æˆ–è¿ç®—ç¬¦</h3><p>ä½æˆ–è¿ç®—ç¬¦(|)æ˜¯å¯¹ä¸¤ä¸ªæ•°çš„æ¯”ç‰¹ä½è¿›è¡Œæ¯”è¾ƒã€‚å®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ï¼Œåªè¦ä¸¤ä¸ªæ“ä½œä½ä»»æ„ä¸€ä¸ªä¸º1æ—¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„ä½æ•°å°±ä¸º1ã€‚</p>
<h3 id="ä½å¼‚æˆ–è¿ç®—ç¬¦"><a href="#ä½å¼‚æˆ–è¿ç®—ç¬¦" class="headerlink" title="ä½å¼‚æˆ–è¿ç®—ç¬¦"></a>ä½å¼‚æˆ–è¿ç®—ç¬¦</h3><p>ä½å¼‚æˆ–è¿ç®—ç¬¦(^))ï¼Œå½“ä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¸ç›¸åŒæ—¶ï¼Œé‚£ä¹ˆè¯¥æ•°å¯¹åº”çš„ä½æ•°å°±ä¸º1ã€‚</p>
<h3 id="ä½å·¦ç§»å’Œå³ç§»è¿ç®—ç¬¦"><a href="#ä½å·¦ç§»å’Œå³ç§»è¿ç®—ç¬¦" class="headerlink" title="ä½å·¦ç§»å’Œå³ç§»è¿ç®—ç¬¦"></a>ä½å·¦ç§»å’Œå³ç§»è¿ç®—ç¬¦</h3><p>ä½å·¦ç§»(&lt;&lt;)å’Œå³ç§»è¿ç®—ç¬¦(&gt;&gt;)å¯ä»¥å§æ‰€æœ‰ä½æ•°çš„æ•°å­—å‘å·¦æˆ–å‘å³ç§»åŠ¨ä¸€ä¸ªç¡®å®šçš„ä½æ•°ã€‚</p>
<p>ä½åº§æ¤…å’Œå³ç§»å…·æœ‰ç»™æ•´æ•°ä¹˜ä»¥æˆ–é™¤ä»¥äºŒçš„æ•ˆæœã€‚å°†ä¸€ä¸ªæ•°å·¦ç§»ä¸€ä½ç›¸å½“äºæŠŠè¿™ä¸ªæ•°ç¿»å€ï¼Œå°†ä¸€ä¸ªæ•°å³ç§»ä¸€ä½ç›¸å½“äºæŠŠè¿™ä¸ªæ•°å‡åŠã€‚</p>
<h3 id="æ— ç¬¦å·æ•´æ•°çš„å”¯ä¸€æ“ä½œ"><a href="#æ— ç¬¦å·æ•´æ•°çš„å”¯ä¸€æ“ä½œ" class="headerlink" title="æ— ç¬¦å·æ•´æ•°çš„å”¯ä¸€æ“ä½œ"></a>æ— ç¬¦å·æ•´æ•°çš„å”¯ä¸€æ“ä½œ</h3><p>ç”¨0å¡«å……å·¦ç§»æˆ–å³ç§»åäº§ç”Ÿçš„ç©ºç™½ä½</p>
<h3 id="æœ‰ç¬¦å·æ•´æ•°çš„ç§»ä½æ“ä½œ"><a href="#æœ‰ç¬¦å·æ•´æ•°çš„ç§»ä½æ“ä½œ" class="headerlink" title="æœ‰ç¬¦å·æ•´æ•°çš„ç§»ä½æ“ä½œ"></a>æœ‰ç¬¦å·æ•´æ•°çš„ç§»ä½æ“ä½œ</h3><p>ç¬¬ä¸€ä½è¡¨ç¤ºæ•´æ•°è¿˜æ˜¯è´Ÿæ•°ï¼ˆ0æ­£æ•°ï¼Œ1è´Ÿæ•°ï¼‰</p>
<h3 id="ä½è¿ç®—ç¬¦åº”ç”¨"><a href="#ä½è¿ç®—ç¬¦åº”ç”¨" class="headerlink" title="ä½è¿ç®—ç¬¦åº”ç”¨"></a>ä½è¿ç®—ç¬¦åº”ç”¨</h3><ul>
<li>ä¸¤ä¸ªæ•°å­—äº¤æ¢</li>
<li>æ±‚èµ‹ç¬¦å·æ•´å½¢æ•°äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</li>
<li>åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸ºä¸º2çš„æ•´æ•°æ¬¡å¹‚</li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/11/01/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"new page title"</span></span><br></pre></td></tr></table></figure>


<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br><span class="line"></span><br><span class="line">$ hexo d --g</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<p>Markdown è¡¨æ ¼<br><code>-:</code> è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…å³å¯¹é½ã€‚<br><code>:-</code> è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…å·¦å¯¹é½ã€‚<br><code>:-:</code> è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…ä¸­å¯¹é½ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å·¦å¯¹é½</th>
<th align="right">å³å¯¹é½</th>
<th align="center">å±…ä¸­å¯¹é½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å•å…ƒæ ¼</td>
<td align="right">å•å…ƒæ ¼</td>
<td align="center">å•å…ƒæ ¼</td>
</tr>
<tr>
<td align="left">å•å…ƒæ ¼</td>
<td align="right">å•å…ƒæ ¼</td>
<td align="center">å•å…ƒæ ¼</td>
</tr>
</tbody></table>
]]></content>
  </entry>
</search>
